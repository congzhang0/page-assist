import{g as w,u as S,a as k,j as e}from"./FontSizeProvider-BQs3lYNB.js";import{S as v}from"./SettingsOptionLayout-B_5QFEQC.js";import{O as N}from"./Layout-D-T_rSeo.js";import{n as m,o as _,k as I,F as n,I as q,S as T,T as E,p as F,q as h}from"./get-screenshot-dbUggNeo.js";import{u as K,a as c,S as C,T as O}from"./SaveButton-_URAgOyg.js";import{f as P,h as z,i as Q}from"./Sidebar-ChItARQ9.js";import{T as M}from"./Trans-Cksffvqj.js";import{T as U}from"./Table-0ItouKyA.js";import{s as i}from"./index-DemEzR4a.js";import"./Ollama-CeSCS9zP.js";import"./blocks-D1BmLOQx.js";import"./chevron-right-BwZdsrtl.js";import"./index-BYRLfKhV.js";import"./index-DrrHHtcZ.js";import"./index-BfGcxbaB.js";import"./index-DbEmuGSy.js";const $=async t=>{const a=await m(`${_(t)}/api/v1/ping`);if(!a.ok)throw new Error("Unable to verify page share");return await a.text()==="pong"},D=()=>{const t=w(),{t:a}=S(["settings"]),[o,u]=k("shareMode",!1),{status:l,data:d}=K({queryKey:["fetchShareInfo"],queryFn:async()=>{const[r,s]=await Promise.all([F(),P()]);return{url:r,shares:s}}}),x=async r=>{o?await $(r.url)&&await h(r.url):await h(r.url)},g=async({api_url:r,share_id:s,id:j})=>{const y=await z();if(!(await m(`${r}/api/v1/share/delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({share_id:s,owner_id:y})})).ok)throw new Error("Failed to delete share link");return await Q(j),"ok"},{mutate:b,isPending:p}=c({mutationFn:x,onSuccess:()=>{t.invalidateQueries({queryKey:["fetchShareInfo"]}),i.success(a("manageShare.notification.pageShareSuccess"))},onError:r=>{i.error((r==null?void 0:r.message)||a("manageShare.notification.someError"))}}),{mutate:f}=c({mutationFn:g,onSuccess:()=>{t.invalidateQueries({queryKey:["fetchShareInfo"]}),i.success(a("manageShare.notification.webShareDeleteSuccess"))},onError:r=>{i.error((r==null?void 0:r.message)||a("manageShare.notification.someError"))}});return e.jsxs("div",{className:"flex flex-col space-y-3",children:[l==="pending"&&e.jsx(I,{paragraph:{rows:4},active:!0}),l==="success"&&e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold leading-7 text-gray-900 dark:text-white",children:a("manageShare.heading")}),e.jsx("div",{className:"border border-b border-gray-200 dark:border-gray-600 mt-3 mb-6"})]}),e.jsxs(n,{layout:"vertical",onFinish:b,initialValues:{url:d.url},children:[e.jsx(n.Item,{name:"url",help:e.jsx(M,{i18nKey:"settings:manageShare.form.url.help",components:{anchor:e.jsx("a",{href:"https://github.com/n4ze3m/page-assist/blob/main/page-share.md",target:"__blank",className:"text-blue-600 dark:text-blue-400"})}}),rules:[{required:!0,message:a("manageShare.form.url.required")}],label:a("manageShare.form.url.label"),children:e.jsx(q,{placeholder:a("manageShare.form.url.placeholder"),size:"large"})}),e.jsx(n.Item,{children:e.jsx("div",{className:"flex justify-end",children:e.jsx(C,{disabled:p,btnType:"submit"})})})]}),e.jsxs("div",{className:"space-y-2 flex mb-4 flex-row items-center justify-between rounded-lg  dark:border-gray-600 ",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{className:"text-sm font-semibold leading-5 text-gray-900 dark:text-white",children:a("manageShare.webshare.label")}),e.jsx("p",{className:"text-sm font-normal leading-5 text-gray-700 dark:text-gray-400",children:a("manageShare.webshare.description")})]}),e.jsx(T,{checked:o,onChange:u})]})]}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold leading-7 text-gray-900 dark:text-white",children:a("manageShare.webshare.heading")}),e.jsx("div",{className:"border border-b border-gray-200 dark:border-gray-600 mt-3 mb-6"})]}),e.jsx("div",{children:e.jsx(U,{dataSource:d.shares,columns:[{title:a("manageShare.webshare.columns.title"),dataIndex:"title",key:"title"},{title:a("manageShare.webshare.columns.url"),dataIndex:"url",key:"url",render:r=>e.jsx("a",{href:r,target:"__blank",className:"text-blue-600 dark:text-blue-400",children:r})},{title:a("manageShare.webshare.columns.actions"),render:(r,s)=>e.jsx(E,{title:a("manageShare.webshare.tooltip.delete"),children:e.jsx("button",{onClick:()=>{window.confirm(a("manageShare.webshare.confirm.delete"))&&f({id:s.id,share_id:s.share_id,api_url:s.api_url})},className:"text-red-500 dark:text-red-400",children:e.jsx(O,{className:"w-5 h-5"})})})}]})})]})]})]})},J=()=>e.jsx(N,{children:e.jsx(v,{children:e.jsx(D,{})})});export{J as default};
