import{a as z,r as m,e as O,j as e}from"./FontSizeProvider-D3enan1E.js";import{S as _}from"./SettingsOptionLayout-s4bKEO4h.js";import{O as $}from"./Layout-_1TcQUPd.js";import{u as T,e as N,a6 as E,a7 as H,a8 as P,F as x,T as Q,a9 as R,aa as D,ab as J,H as W}from"./SaveButton-DmOKJM4n.js";import{s as w}from"./index-FcDqmjI2.js";import{S as X}from"./index-AkKl93ew.js";import{I as f,T as A,S as Y}from"./browser-polyfill-0iagK1yo.js";import{C as V}from"./index-zywBqqSA.js";import{R as K}from"./index-C5awg_Th.js";import{q as Z,s as ee,w as ae,x as le,ab as se}from"./Sidebar-BePlkV0h.js";import{T as te}from"./Table-BtJuQl0B.js";import{M as B}from"./pdfjs-Dk_2IB0p.js";import"./chevron-right-CQkEQ8H0.js";import"./index-Ci6F2mfP.js";const re=({openaiId:l,setOpenModelModal:S})=>{const{t:r}=z(["openai"]),[i,h]=m.useState([]),[g,n]=m.useState(""),[v,y]=m.useState("chat"),U=O(),{data:d,status:p}=T({queryKey:["openAIConfigs",l],queryFn:async()=>{const s=await E(l);return await H({baseUrl:s.baseUrl,apiKey:s.apiKey,customHeaders:s.headers})},enabled:!!l}),o=m.useMemo(()=>(d==null?void 0:d.filter(s=>(s.name??s.id).toLowerCase().includes(g.toLowerCase())))||[],[d,g]),C=s=>{h(s?o.map(c=>c.id):[])},j=(s,c)=>{h(c?a=>[...a,s]:a=>a.filter(t=>t!==s))},I=async s=>{const c=s.map(a=>{var t;return{model_id:a,name:((t=o.find(u=>u.id===a))==null?void 0:t.name)??a,provider_id:l,model_type:v}});return await P(c),!0},{mutate:F,isPending:k}=N({mutationFn:I,onSuccess:()=>{S(!1),U.invalidateQueries({queryKey:["fetchModel"]}),w.success(r("modal.model.success"))}}),q=()=>{F(i)};return p==="pending"?e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx(X,{size:"large"})}):p==="error"||!d||d.length===0?e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx("p",{className:"text-md text-center text-gray-600 dark:text-gray-300",children:r("noModelFound")})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("modal.model.subheading")}),e.jsx(f,{placeholder:r("searchModel"),value:g,onChange:s=>n(s.target.value),className:"w-full"}),e.jsxs("div",{className:"flex  justify-between",children:[e.jsx(V,{checked:i.length===o.length,indeterminate:i.length>0&&i.length<o.length,onChange:s=>C(s.target.checked),children:r("selectAll")}),e.jsx("div",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",children:`${i==null?void 0:i.length} / ${d==null?void 0:d.length}`})]}),e.jsx("div",{className:"space-y-2 custom-scrollbar max-h-[300px] border overflow-y-auto dark:border-gray-600 rounded-md p-3",children:e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:o.map((s,c)=>e.jsx("div",{onClick:()=>{j(s.id,!i.includes(s.id))},className:"flex cursor-pointer items-center justify-between py-3 hover:bg-gray-50 dark:hover:bg-gray-800 px-2 ",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{checked:i.includes(s.id),onChange:a=>j(s.id,a.target.checked)}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:`${(s==null?void 0:s.name)||s.id}`.replaceAll(/accounts\/[^\/]+\/models\//g,"")}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:s.id})]})]})},c))})}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs(K.Group,{onChange:s=>y(s.target.value),value:v,children:[e.jsx(K,{value:"chat",children:r("radio.chat")}),e.jsx(K,{value:"embedding",children:r("radio.embedding")})]}),e.jsx(Z,{content:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("b",{className:"text-gray-800 dark:text-gray-100",children:r("radio.chat")})," ",r("radio.chatInfo")]}),e.jsxs("p",{children:[e.jsx("b",{className:"text-gray-800 dark:text-gray-100",children:r("radio.embedding")})," ",r("radio.embeddingInfo")]})]}),children:e.jsx(ee,{className:"ml-2 h-4 w-4 text-gray-500 cursor-pointer"})})]}),e.jsx("button",{onClick:q,disabled:k,className:"inline-flex justify-center w-full text-center mt-4 items-center rounded-md border border-transparent bg-black px-2 py-2 text-sm font-medium leading-4 text-white shadow-sm hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:bg-white dark:text-gray-800 dark:hover:bg-gray-100 dark:focus:ring-gray-500 dark:focus:ring-offset-gray-100 disabled:opacity-50",children:r(k?"saving":"save")})]})},G=[{label:"Custom",value:"custom",baseUrl:""},{label:"LLaMa.cpp",value:"llamacpp",baseUrl:"http://localhost:8080/v1"},{label:"LM Studio",value:"lmstudio",baseUrl:"http://localhost:1234/v1"},{label:"Llamafile",value:"llamafile",baseUrl:"http://127.0.0.1:8080/v1"},{label:"Ollama",value:"ollama2",baseUrl:"http://localhost:11434/v1"},{label:"OpenAI",value:"openai",baseUrl:"https://api.openai.com/v1"},{label:"DeepSeek",value:"deepseek",baseUrl:"https://api.deepseek.com"},{label:"Fireworks",value:"fireworks",baseUrl:"https://api.fireworks.ai/inference/v1"},{label:"Novita AI",value:"novita",baseUrl:"https://api.novita.ai/v3/openai"},{label:"Groq",value:"groq",baseUrl:"https://api.groq.com/openai/v1"},{label:"Together",value:"together",baseUrl:"https://api.together.xyz/v1"},{label:"OpenRouter",value:"openrouter",baseUrl:"https://openrouter.ai/api/v1"},{label:"Google AI",value:"gemini",baseUrl:"https://generativelanguage.googleapis.com/v1beta/openai"},{label:"Mistral",value:"mistral",baseUrl:"https://api.mistral.ai/v1"},{label:"Infinigence AI",value:"infinitenceai",baseUrl:"https://cloud.infini-ai.com/maas/v1"},{label:"SiliconFlow",value:"siliconflow",baseUrl:"https://api.siliconflow.cn/v1"},{label:"VolcEngine",value:"volcengine",baseUrl:"https://ark.cn-beijing.volces.com/api/v3"},{label:"TencentCloud",value:"tencentcloud",baseUrl:"https://api.lkeap.cloud.tencent.com/v1"},{label:"AliBaBaCloud",value:"alibabacloud",baseUrl:"https://dashscope.aliyuncs.com/compatible-mode/v1"}],L=["lmstudio","llamafile","ollama2","llamacpp"],ie=()=>{const{t:l}=z(["openai","settings"]),[S,r]=m.useState(!1),[i,h]=m.useState(null),g=O(),[n]=x.useForm(),[v,y]=m.useState(null),[U,d]=m.useState(!1),[p,o]=m.useState("custom"),{data:C,isLoading:j}=T({queryKey:["openAIConfigs"],queryFn:W}),I=N({mutationFn:R,onSuccess:a=>{g.invalidateQueries({queryKey:["openAIConfigs"]}),r(!1),w.success(l("addSuccess")),L.includes(p)||(y(a),d(!0)),n.resetFields(),o("custom")}}),F=N({mutationFn:D,onSuccess:()=>{g.invalidateQueries({queryKey:["openAIConfigs"]}),r(!1),n.resetFields(),h(null),w.success(l("updateSuccess"))}}),k=N({mutationFn:J,onSuccess:()=>{g.invalidateQueries({queryKey:["openAIConfigs"]}),w.success(l("deleteSuccess"))}}),q=a=>{i?F.mutate({id:i.id,...a}):I.mutate({...a,provider:p})},s=a=>{h({...a,headers:(a==null?void 0:a.headers)||[]}),n.setFieldsValue({...a,headers:(a==null?void 0:a.headers)||[]}),r(!0)},c=a=>{k.mutate(a)};return e.jsx("div",{children:e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold leading-7 text-gray-900 dark:text-white",children:l("heading")}),e.jsx("p",{className:"mt-1 text-sm leading-6 text-gray-600 dark:text-gray-400",children:l("subheading")}),e.jsx("div",{className:"border border-b border-gray-200 dark:border-gray-600 mt-3 mb-6"})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"-ml-4 -mt-2 flex flex-wrap items-center justify-end sm:flex-nowrap",children:e.jsx("div",{className:"ml-4 mt-2 flex-shrink-0",children:e.jsx("button",{onClick:()=>{h(null),r(!0),n.resetFields()},className:"inline-flex items-center rounded-md border border-transparent bg-black px-2 py-2 text-md font-medium leading-4 text-white shadow-sm hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:bg-white dark:text-gray-800 dark:hover:bg-gray-100 dark:focus:ring-gray-500 dark:focus:ring-offset-gray-100 disabled:opacity-50",children:l("addBtn")})})})}),e.jsx(te,{columns:[{title:l("table.name"),dataIndex:"name",key:"name"},{title:l("table.baseUrl"),dataIndex:"baseUrl",key:"baseUrl"},{title:l("table.actions"),key:"actions",render:(a,t)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx(A,{title:l("edit"),children:e.jsx("button",{className:"text-gray-700 dark:text-gray-400",onClick:()=>s(t),children:e.jsx(ae,{className:"size-4"})})}),e.jsx(A,{title:L.includes(t.provider)?l("noNewModel"):l("newModel"),children:e.jsx("button",{className:"text-gray-700 dark:text-gray-400 disabled:opacity-50",onClick:()=>{d(!0),y(t.id)},disabled:!t.id||L.includes(t.provider),children:e.jsx(le,{className:"size-4"})})}),e.jsx(A,{title:l("delete"),children:e.jsx("button",{className:"text-red-500 dark:text-red-400",onClick:()=>{confirm(l("modal.deleteConfirm",{name:t.name}))&&c(t.id)},children:e.jsx(Q,{className:"size-4"})})})]})}],dataSource:C,loading:j,rowKey:"id",bordered:!0}),e.jsxs(B,{open:S,title:l(i?"modal.titleEdit":"modal.titleAdd"),onCancel:()=>{r(!1),h(null),o("custom"),n.resetFields()},footer:null,children:[!i&&e.jsx(Y,{value:p,onSelect:a=>{const t=G.find(u=>u.value===a);n.setFieldsValue({baseUrl:t==null?void 0:t.baseUrl,name:t==null?void 0:t.label}),o(a)},filterOption:(a,t)=>{var u,b,M;return((M=(b=(u=t==null?void 0:t.label)==null?void 0:u.props["data-title"])==null?void 0:b.toLowerCase())==null?void 0:M.indexOf(a.toLowerCase()))>=0},showSearch:!0,className:"w-full !mb-4",options:G.map(a=>({value:a.value,label:e.jsxs("span",{"data-title":a.label,className:"flex flex-row gap-3 items-center ",children:[e.jsx(se,{provider:a.value,className:"size-5"}),e.jsx("span",{className:"line-clamp-2",children:a.label})]},a.value)}))}),e.jsxs(x,{form:n,layout:"vertical",onFinish:q,initialValues:{...i},children:[e.jsx(x.Item,{name:"name",label:l("modal.name.label"),rules:[{required:!0,message:l("modal.name.required")}],children:e.jsx(f,{size:"large",placeholder:l("modal.name.placeholder")})}),e.jsx(x.Item,{name:"baseUrl",label:l("modal.baseUrl.label"),help:l("modal.baseUrl.help"),rules:[{required:!0,message:l("modal.baseUrl.required")}],children:e.jsx(f,{size:"large",placeholder:l("modal.baseUrl.placeholder")})}),e.jsx(x.Item,{name:"apiKey",label:l("modal.apiKey.label"),children:e.jsx(f.Password,{size:"large",placeholder:l("modal.apiKey.placeholder")})}),e.jsx(x.List,{name:"headers",children:(a,{add:t,remove:u})=>e.jsxs("div",{className:"flex flex-col ",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-md font-semibold",children:l("settings:ollamaSettings.settings.advanced.headers.label")}),e.jsx("button",{type:"button",className:"dark:bg-white dark:text-black text-white bg-black p-1.5 text-xs rounded-md",onClick:()=>{t()},children:l("settings:ollamaSettings.settings.advanced.headers.add")})]}),a.map((b,M)=>e.jsxs("div",{className:"flex items-center   w-full",children:[e.jsxs("div",{className:"flex-grow flex mt-3 space-x-4",children:[e.jsx(x.Item,{label:l("settings:ollamaSettings.settings.advanced.headers.key.label"),name:[b.name,"key"],className:"flex-1 mb-0",children:e.jsx(f,{className:"w-full",placeholder:l("settings:ollamaSettings.settings.advanced.headers.key.placeholder")})}),e.jsx(x.Item,{label:l("settings:ollamaSettings.settings.advanced.headers.value.label"),name:[b.name,"value"],className:"flex-1 mb-0",children:e.jsx(f,{className:"w-full",placeholder:l("settings:ollamaSettings.settings.advanced.headers.value.placeholder")})})]}),e.jsx("button",{type:"button",onClick:()=>{u(b.name)},className:"shrink-0 ml-2 text-red-500 dark:text-red-400",children:e.jsx(Q,{className:"w-5 h-5"})})]},b.key))]})}),p==="lmstudio"&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-4",children:l("modal.tipLMStudio")}),e.jsx("button",{type:"submit",className:"inline-flex justify-center w-full text-center mt-4 items-center rounded-md border border-transparent bg-black px-2 py-2 text-sm font-medium leading-4 text-white shadow-sm hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:bg-white dark:text-gray-800 dark:hover:bg-gray-100 dark:focus:ring-gray-500 dark:focus:ring-offset-gray-100 disabled:opacity-50",children:l(i?"modal.update":"modal.submit")})]})]}),e.jsx(B,{open:U,title:l("modal.model.title"),footer:null,onCancel:()=>d(!1),children:v?e.jsx(re,{openaiId:v,setOpenModelModal:d}):null})]})})},de=()=>e.jsx($,{children:e.jsx(_,{children:e.jsx(ie,{})})});export{de as default};
