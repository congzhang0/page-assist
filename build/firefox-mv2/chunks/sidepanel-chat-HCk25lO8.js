import{r as z,a as A,e as be,f as U,j as e,R as d,__tla as ve}from"./FontSizeProvider-D4Gh80tw.js";import{u as F,X as se,I as je,g as ae,M as ke,a as we,D as Ne,E as Se,P as Ee,B as Ce,C as Me,b as Le,c as Pe,S as Ie,n as Fe,d as _e,f as Te,e as Re,__tla as Oe}from"./Sidebar-uBkE2MHz.js";import{b as $,c as _,u as We,s as De,a as ze,g as Ae,i as Ve,f as Be,S as He,d as re,e as qe,h as V,T as C,L as Qe,j as Ue}from"./SaveButton-Dir2VHfX.js";import{P as $e,M as Ke,u as Ze,a as Ge,g as Je,b as Xe,c as Ye,d as ne,S as et,t as le,h as tt,__tla as st}from"./key-down-CsoB0isT.js";import{L as at}from"./loader-2-CdgHpM7N.js";import{R as rt}from"./rotate-ccw-D4uR6XPq.js";import{T as nt}from"./Trans-BJZsQOvU.js";import{u as lt}from"./use-form-CQanvGBF.js";import{C as K}from"./index-B2Ick9Fr.js";import{l as it}from"./icon-BmsVQuvA.js";import"./elevenlabs-DGtBRP3_.js";import"./color-Rv4jN5Lm.js";import"./index-DZCUgEun.js";let ie,ot=Promise.all([(()=>{try{return ve}catch{}})(),(()=>{try{return Oe}catch{}})(),(()=>{try{return st}catch{}})()]).then(async()=>{function oe(){const[r,l]=z.useState(null);return z.useEffect(()=>{const m=h=>{h.from==="background"&&l(h)};return $.runtime.connect({name:"pgCopilot"}),$.runtime.onMessage.addListener(m),()=>{$.runtime.onMessage.removeListener(m)}},[]),r}const ce=_("Boxes",[["path",{d:"M2.97 12.92A2 2 0 0 0 2 14.63v3.24a2 2 0 0 0 .97 1.71l3 1.8a2 2 0 0 0 2.06 0L12 19v-5.5l-5-3-4.03 2.42Z",key:"lc1i9w"}],["path",{d:"m7 16.5-4.74-2.85",key:"1o9zyk"}],["path",{d:"m7 16.5 5-3",key:"va8pkn"}],["path",{d:"M7 16.5v5.17",key:"jnp8gn"}],["path",{d:"M12 13.5V19l3.97 2.38a2 2 0 0 0 2.06 0l3-1.8a2 2 0 0 0 .97-1.71v-3.24a2 2 0 0 0-.97-1.71L17 10.5l-5 3Z",key:"8zsnat"}],["path",{d:"m17 16.5-5-3",key:"8arw3v"}],["path",{d:"m17 16.5 4.74-2.85",key:"8rfmw"}],["path",{d:"M17 16.5v5.17",key:"k6z78m"}],["path",{d:"M7.97 4.42A2 2 0 0 0 7 6.13v4.37l5 3 5-3V6.13a2 2 0 0 0-.97-1.71l-3-1.8a2 2 0 0 0-2.06 0l-3 1.8Z",key:"1xygjf"}],["path",{d:"M12 8 7.26 5.15",key:"1vbdud"}],["path",{d:"m12 8 4.74-2.85",key:"3rx089"}],["path",{d:"M12 13.5V8",key:"1io7kd"}]]),de=_("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),me=_("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ge=_("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);let Z,G,J,X,Y;Z=_("PlusSquare",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),G=()=>{const[r,l]=z.useState(""),{t:m}=A(["playground","common"]),h=be(),[v]=U("checkOllamaStatus",!0),{data:i,status:y,refetch:n,isRefetching:j}=We({queryKey:["ollamaStatus",v],queryFn:async()=>{const o=await Ae(),c=await Ve(),g=await Be({returnEmpty:!1});return h.invalidateQueries({queryKey:["getAllModelsForSelect"]}),{isOk:v?c:!0,models:g,ollamaURL:o}}});z.useEffect(()=>{i!=null&&i.ollamaURL&&l(i.ollamaURL)},[i]);const{setSelectedModel:s,selectedModel:w,chatMode:a,setChatMode:k}=F(),p=()=>{var o;return e.jsxs("div",{className:"mt-4",children:[e.jsx(He,{onChange:c=>{s(c),localStorage.setItem("selectedModel",c)},value:w,size:"large",filterOption:(c,g)=>g.label.toLowerCase().indexOf(c.toLowerCase())>=0||g.value.toLowerCase().indexOf(c.toLowerCase())>=0,showSearch:!0,placeholder:m("common:selectAModel"),style:{width:"100%"},className:"mt-4",options:(o=i.models)==null?void 0:o.map(c=>({label:(c==null?void 0:c.nickname)||c.name,value:c.model}))}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"inline-flex items-center",children:[e.jsxs("label",{className:"relative flex items-center p-3 rounded-full cursor-pointer",htmlFor:"check",children:[e.jsx("input",{type:"checkbox",checked:a==="rag",onChange:c=>{k(c.target.checked?"rag":"normal")},className:"before:content[''] peer relative h-5 w-5 cursor-pointer appearance-none rounded-md border border-blue-gray-200 transition-all before:absolute before:top-2/4 before:left-2/4 before:block before:h-12 before:w-12 before:-translate-y-2/4 before:-translate-x-2/4 before:rounded-full before:bg-blue-gray-500 before:opacity-0 before:transition-opacity",id:"check"}),e.jsx("span",{className:"absolute text-white transition-opacity opacity-0 pointer-events-none top-2/4 left-2/4 -translate-y-2/4 -translate-x-2/4 peer-checked:opacity-100 ",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",stroke:"currentColor",strokeWidth:"1",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsx("label",{className:"mt-px font-light  cursor-pointer select-none text-gray-900 dark:text-gray-400",htmlFor:"check",children:m("common:chatWithCurrentPage")})]})})]})};return v?e.jsx("div",{className:"mx-auto sm:max-w-lg px-4 mt-10",children:e.jsxs("div",{className:"rounded-lg  justify-center items-center flex flex-col border border-gray-300 dark:border-gray-700 p-8 bg-white dark:bg-[#262626] shadow-sm",children:[(y==="pending"||j)&&e.jsxs("div",{className:"inline-flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-bounce"}),e.jsx("p",{className:"dark:text-gray-400 text-gray-900",children:m("ollamaState.searching")})]}),!j&&y==="success"?i.isOk?e.jsxs("div",{className:"inline-flex  items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("p",{className:"dark:text-gray-400 text-gray-900",children:m("ollamaState.running")})]}):e.jsxs("div",{className:"flex flex-col space-y-2 justify-center items-center",children:[e.jsxs("div",{className:"inline-flex  space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("p",{className:"dark:text-gray-400 text-gray-900",children:m("ollamaState.notRunning")})]}),e.jsx("input",{className:"bg-gray-100 dark:bg-black dark:text-gray-100 rounded-md px-4 py-2 mt-2 w-full",type:"url",value:r,onChange:o=>l(o.target.value)}),e.jsxs("button",{onClick:()=>{De(r),n()},className:"inline-flex mt-4 items-center rounded-md border border-transparent bg-black px-2 py-2 text-sm font-medium leading-4 text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:bg-white dark:text-gray-800 dark:hover:bg-gray-100 dark:focus:ring-gray-500 dark:focus:ring-offset-gray-100 disabled:opacity-50 ",children:[e.jsx(rt,{className:"h-4 w-4 mr-3"}),m("common:retry")]}),r&&ze(r)!=="http://127.0.0.1:11434"&&e.jsx("p",{className:"text-xs text-gray-700 dark:text-gray-400 mb-4 text-center",children:e.jsx(nt,{i18nKey:"playground:ollamaState.connectionError",components:{anchor:e.jsx("a",{href:"https://github.com/n4ze3m/page-assist/blob/main/docs/connection-issue.md",target:"__blank",className:"text-blue-600 dark:text-blue-400"})}})})]}):null,y==="success"&&i.isOk&&p()]})}):e.jsx("div",{className:"mx-auto sm:max-w-md px-4 mt-10",children:e.jsxs("div",{className:"rounded-lg justify-center items-center flex flex-col border dark:border-gray-700 p-8 bg-white dark:bg-[#262626] shadow-sm",children:[e.jsx("div",{className:"inline-flex items-center space-x-2",children:e.jsxs("p",{className:"dark:text-gray-400 text-gray-900",children:[e.jsx("span",{children:"\u{1F44B}"}),m("welcome")]})}),y==="pending"&&e.jsx(at,{className:"mr-2 h-4 w-4 animate-spin"}),y==="success"&&i.isOk&&p()]})})},J=()=>{const{messages:r,streaming:l,regenerateLastMessage:m,editMessage:h,isSearchingInternet:v}=F(),i=d.useRef(null),[y,n]=d.useState(!1),[j,s]=d.useState(null),{ttsEnabled:w}=re();return d.useEffect(()=>{i.current&&i.current.scrollIntoView({behavior:"smooth"})}),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative flex w-full flex-col items-center pt-16 pb-4",children:[r.length===0&&e.jsx(G,{}),r.map((a,k)=>e.jsx($e,{isBot:a.isBot,message:a.message,name:a.name,images:a.images||[],currentMessageIndex:k,totalMessages:r.length,onRengerate:m,message_type:a.messageType,isProcessing:l,isSearchingInternet:v,sources:a.sources,onEditFormSubmit:p=>{h(k,p,!a.isBot)},onSourceClick:p=>{s(p),n(!0)},isTTSEnabled:w,generationInfo:a==null?void 0:a.generationInfo,isStreaming:l,reasoningTimeTaken:a==null?void 0:a.reasoning_time_taken,modelImage:a==null?void 0:a.modelImage,modelName:a==null?void 0:a.modelName},k)),e.jsx("div",{ref:i})]}),e.jsx("div",{className:"w-full pb-[157px]"}),e.jsx(Ke,{open:y,setOpen:n,source:j})]})},X=({dropedFile:r})=>{const l=d.useRef(null),m=d.useRef(null),{sendWhenEnter:h,setSendWhenEnter:v}=re(),[i,y]=d.useState(!1),{t:n}=A(["playground","common"]),[j]=U("chatWithWebsiteEmbedding",!0),s=lt({initialValues:{message:"",image:""}}),{transcript:w,isListening:a,resetTranscript:k,start:p,stop:o,supported:c}=Ze(),g=async()=>{a&&o()},S=async t=>{if(t instanceof File){const u=await le(t);s.setFieldValue("image",u)}else if(t.target.files){const u=await le(t.target.files[0]);s.setFieldValue("image",u)}},b=()=>{l.current&&l.current.focus()},P=t=>{t.key==="Process"||t.key==="229"||tt({e:t,sendWhenEnter:h,typing:i,isSending:te})&&(t.preventDefault(),s.onSubmit(async u=>{if(!(u.message.trim().length===0&&u.image.length===0)){if(await g(),!M||M.length===0){s.setFieldError("message",n("formError.noModel"));return}if(f==="rag"&&!await V()&&j){s.setFieldError("message",n("formError.noEmbeddingModel"));return}if(O){const E=await V(),L=await ae();if(!E&&!L){s.setFieldError("message",n("formError.noEmbeddingModel"));return}}s.reset(),b(),await ee({image:u.image,message:u.message.trim()})}})())},x=t=>{t.clipboardData.files.length>0&&S(t.clipboardData.files[0])},{onSubmit:T,selectedModel:M,chatMode:f,stopStreamingRequest:B,streaming:ue,setChatMode:R,webSearch:O,setWebSearch:H,selectedQuickPrompt:W,setSelectedQuickPrompt:xe,speechToTextLanguage:he,useOCR:fe,setUseOCR:pe,defaultInternetSearchOn:q,defaultChatWithWebsite:Q}=F();d.useEffect(()=>{r&&S(r)},[r]),Ge(l,s.values.message,120),d.useEffect(()=>{a&&s.setFieldValue("message",w)},[w]),d.useEffect(()=>{var t;if(W){const u=Je(W);if(s.setFieldValue("message",W),u){(t=l.current)==null||t.focus();const E=setTimeout(()=>{var L;(L=l.current)==null||L.setSelectionRange(u.start,u.end),xe(null)},100);return()=>{clearInterval(E)}}}},[W]);const{mutateAsync:ee,isPending:te}=qe({mutationFn:T,onSuccess:()=>{b()},onError:t=>{b()}});return d.useEffect(()=>{var E,L;const t=N=>{var I;if(N.preventDefault(),(I=N.dataTransfer)==null?void 0:I.items)for(let D=0;D<N.dataTransfer.items.length;D++)N.dataTransfer.items[D].type==="text/plain"&&N.dataTransfer.items[D].getAsString(ye=>{s.setFieldValue("message",ye)})},u=N=>{N.preventDefault()};return(E=l.current)==null||E.addEventListener("drop",t),(L=l.current)==null||L.addEventListener("dragover",u),q&&H(!0),Q&&R("rag"),()=>{var N,I;(N=l.current)==null||N.removeEventListener("drop",t),(I=l.current)==null||I.removeEventListener("dragover",u)}},[]),d.useEffect(()=>{q&&H(!0)},[q]),d.useEffect(()=>{Q&&R("rag")},[Q]),e.jsx("div",{className:"flex w-full flex-col items-center px-2",children:e.jsx("div",{className:"relative z-10 flex w-full flex-col items-center justify-center gap-2 text-base",children:e.jsx("div",{className:"relative flex w-full flex-row justify-center gap-2 lg:w-4/5",children:e.jsxs("div",{className:` bg-neutral-50  dark:bg-[#262626] relative w-full max-w-[48rem] p-1 backdrop-blur-lg duration-100 border border-gray-300 rounded-t-xl  dark:border-gray-600
          `,children:[e.jsxs("div",{className:`border-b border-gray-200 dark:border-gray-600 relative ${s.values.image.length===0?"hidden":"block"}`,children:[e.jsx("button",{type:"button",onClick:()=>{s.setFieldValue("image","")},className:"absolute top-1 left-1 flex items-center justify-center z-10 bg-white dark:bg-[#262626] p-0.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-600 text-black dark:text-gray-100",children:e.jsx(se,{className:"h-4 w-4"})})," ",e.jsx(je,{src:s.values.image,alt:"Uploaded Image",preview:!1,className:"rounded-md max-h-32"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex",children:e.jsxs("form",{onSubmit:s.onSubmit(async t=>{if(!M||M.length===0){s.setFieldError("message",n("formError.noModel"));return}if(f==="rag"&&!await V()&&j){s.setFieldError("message",n("formError.noEmbeddingModel"));return}if(O){const u=await V(),E=await ae();if(!u&&!E){s.setFieldError("message",n("formError.noEmbeddingModel"));return}}await g(),!(t.message.trim().length===0&&t.image.length===0)&&(s.reset(),b(),await ee({image:t.image,message:t.message.trim()}))}),className:"shrink-0 flex-grow  flex flex-col items-center ",children:[e.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",ref:m,accept:"image/*",multiple:!1,onChange:S}),e.jsxs("div",{className:"w-full  flex flex-col px-1",children:[e.jsx("textarea",{onKeyDown:t=>P(t),ref:l,className:"px-2 py-2 w-full resize-none bg-transparent focus-within:outline-none focus:ring-0 focus-visible:ring-0 ring-0 dark:ring-0 border-0 dark:text-gray-100",onPaste:x,rows:1,style:{minHeight:"60px"},tabIndex:0,onCompositionStart:()=>{},onCompositionEnd:()=>{},placeholder:n("form.textarea.placeholder"),...s.getInputProps("message")}),e.jsxs("div",{className:"flex mt-4 justify-end gap-3",children:[f!=="vision"&&e.jsx(C,{title:n("tooltip.searchInternet"),children:e.jsx("button",{type:"button",onClick:()=>H(!O),className:`inline-flex items-center gap-2   ${f==="rag"?"hidden":"block"}`,children:O?e.jsx(Xe,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}):e.jsx(Ye,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})})}),e.jsx(ke,{}),c&&e.jsx(C,{title:n("tooltip.speechToText"),children:e.jsx("button",{type:"button",onClick:async()=>{a?g():(k(),p({continuous:!0,lang:he}))},className:"flex items-center justify-center dark:text-gray-300",children:a?e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-3 w-3 rounded-full bg-red-400 opacity-75"}),e.jsx(ne,{className:"h-5 w-5"})]}):e.jsx(ne,{className:"h-5 w-5"})})}),e.jsx(C,{title:n("tooltip.vision"),children:e.jsx("button",{type:"button",onClick:()=>{R(f==="vision"?"normal":"vision")},disabled:f==="rag",className:`flex items-center justify-center dark:text-gray-300 ${f==="rag"?"hidden":"block"} disabled:opacity-50`,children:f==="vision"?e.jsx(me,{className:"h-5 w-5"}):e.jsx(de,{className:"h-5 w-5"})})}),e.jsx(C,{title:n("tooltip.uploadImage"),children:e.jsx("button",{type:"button",onClick:()=>{var t;(t=m.current)==null||t.click()},disabled:f==="vision",className:`flex items-center justify-center disabled:opacity-50 dark:text-gray-300 ${f==="rag"?"hidden":"block"}`,children:e.jsx(we,{className:"h-5 w-5"})})}),ue?e.jsx(C,{title:n("tooltip.stopStreaming"),children:e.jsx("button",{type:"button",onClick:B,className:"text-gray-800 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md p-1",children:e.jsx(et,{className:"h-6 w-6"})})}):e.jsx(Ne.Button,{htmlType:"submit",disabled:te,className:"!justify-end !w-auto",icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})}),menu:{items:[{key:1,label:e.jsx(K,{checked:h,onChange:t=>v(t.target.checked),children:n("sendWhenEnter")})},{key:2,label:e.jsx(K,{checked:f==="rag",onChange:t=>{R(t.target.checked?"rag":"normal")},children:n("common:chatWithCurrentPage")})},{key:3,label:e.jsx(K,{checked:fe,onChange:t=>pe(t.target.checked),children:n("useOCR")})}]},children:e.jsxs("div",{className:"inline-flex gap-2",children:[h?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"h-5 w-5",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M9 10L4 15 9 20"}),e.jsx("path",{d:"M20 4v7a4 4 0 01-4 4H4"})]}):null,n("common:submit")]})})]})]})]})}),s.errors.message&&e.jsx("div",{className:"text-red-500 text-center text-sm mt-1",children:s.errors.message})]})]})})})})},Y=()=>{const[r]=U("hideCurrentChatModelSettings",!1),{clearChat:l,isEmbedding:m,messages:h,streaming:v,selectedSystemPrompt:i,setSelectedSystemPrompt:y,setSelectedQuickPrompt:n,setMessages:j,setHistory:s,setHistoryId:w,setSelectedModel:a,historyId:k,history:p}=F(),{t:o}=A(["sidepanel","common","option"]),[c,g]=d.useState(!1),[S,b]=d.useState(!1);return e.jsxs("div",{className:" px-3 justify-between bg-white dark:bg-[#171717] border-b border-gray-300 dark:border-gray-700 py-4 items-center absolute top-0 z-10 flex h-14 w-full",children:[e.jsxs("div",{className:"focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-700 flex items-center dark:text-white",children:[e.jsx("img",{className:"h-6 w-auto",src:it,alt:o("common:pageAssist")}),e.jsx("span",{className:"ml-1 text-sm ",children:o("common:pageAssist")})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[m?e.jsx(C,{title:o("tooltip.embed"),children:e.jsx(ce,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 animate-bounce animate-infinite"})}):null,h.length>0&&!v&&e.jsx("button",{title:o("option:newChat"),onClick:()=>{l()},className:"flex items-center space-x-1 focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-700",children:e.jsx(Z,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),p.length>0&&e.jsx("button",{title:o("tooltip.clearContext"),onClick:()=>{s([])},className:"flex items-center space-x-1 focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-700",children:e.jsx(Se,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),e.jsx(C,{title:o("tooltip.history"),children:e.jsx("button",{onClick:()=>{b(!0)},className:"flex items-center space-x-1 focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-700",children:e.jsx(ge,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})}),e.jsx(Ee,{selectedSystemPrompt:i,setSelectedSystemPrompt:y,setSelectedQuickPrompt:n,className:"text-gray-500 dark:text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors"}),!r&&e.jsx(C,{title:o("common:currentChatModelSettings"),children:e.jsx("button",{onClick:()=>g(!0),className:"text-gray-500 dark:text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:e.jsx(Ce,{className:"w-5 h-5"})})}),e.jsx(Qe,{to:"/settings",children:e.jsx(Me,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]}),e.jsx(Le,{open:c,setOpen:g}),e.jsx(Pe,{title:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center justify-between",children:o("tooltip.history")}),e.jsx("button",{onClick:()=>b(!1),children:e.jsx(se,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]}),placement:"left",closeIcon:null,onClose:()=>b(!1),open:S,children:e.jsx(Ie,{isOpen:S,onClose:()=>b(!1),setMessages:j,setHistory:s,setHistoryId:w,setSelectedModel:a,setSelectedSystemPrompt:y,clearChat:l,historyId:k,setSystemPrompt:P=>{},temporaryChat:!1,history:p})})]})},ie=()=>{const r=d.useRef(null),[l,m]=d.useState(),{t:h}=A(["playground"]),[v,i]=d.useState("idle"),{chatMode:y,streaming:n,onSubmit:j,messages:s,setHistory:w,setHistoryId:a,setMessages:k,selectedModel:p}=F(),o=oe(),c=async()=>{if(await Ue()&&s.length===0){const g=await _e();g&&(a(g.history.id),w(Te(g.messages)),k(Re(g.messages)))}};return d.useEffect(()=>{if(!r.current)return;const g=x=>{x.preventDefault(),x.stopPropagation()},S=x=>{var M,f;if(x.preventDefault(),x.stopPropagation(),i("idle"),!Array.from(((M=x.dataTransfer)==null?void 0:M.files)||[]).every(B=>B.type.startsWith("image/"))){i("error");return}const T=Array.from(((f=x.dataTransfer)==null?void 0:f.files)||[]).slice(0,1);T.length>0&&m(T[0])},b=x=>{x.preventDefault(),x.stopPropagation(),i("dragging")},P=x=>{x.preventDefault(),x.stopPropagation(),i("idle")};return r.current.addEventListener("dragover",g),r.current.addEventListener("drop",S),r.current.addEventListener("dragenter",b),r.current.addEventListener("dragleave",P),()=>{r.current&&(r.current.removeEventListener("dragover",g),r.current.removeEventListener("drop",S),r.current.removeEventListener("dragenter",b),r.current.removeEventListener("dragleave",P))}},[]),d.useEffect(()=>{c()},[]),d.useEffect(()=>{o&&!n&&(p?j({message:o.text,messageType:o.type,image:""}):Fe.error({message:h("formError.noModel")}))},[o]),e.jsx("div",{className:"flex h-full w-full",children:e.jsxs("main",{className:"relative h-dvh w-full",children:[e.jsx("div",{className:"relative z-10 w-full",children:e.jsx(Y,{})}),e.jsxs("div",{ref:r,className:`relative flex h-full flex-col items-center ${v==="dragging"?"bg-gray-100 dark:bg-gray-800":""} bg-white dark:bg-[#171717]`,children:[e.jsx("div",{className:"custom-scrollbar  flex h-full w-full flex-col items-center overflow-x-hidden overflow-y-auto px-5",children:e.jsx(J,{})}),e.jsx("div",{className:"absolute bottom-0 w-full",children:e.jsx(X,{dropedFile:l})})]})]})})}});export{ot as __tla,ie as default};
