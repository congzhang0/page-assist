import{a as Ie,l as E,S as Te,T as fe,M as je}from"./pdfjs-Dk_2IB0p.js";import{R as N,r as o,A as xe,n as ae,v as Ae,w as He,z as b,y as Re,X as Ee,p as re,a as Ge,aq as We,j as s}from"./FontSizeProvider-D3enan1E.js";import{f as Ve,aD as qe,a as De,H as Ce,aE as Xe,s as Fe,A as ie,B as F,I as Q,q as Ke,T as $e,E as Je}from"./browser-polyfill-0iagK1yo.js";import{e as Ue,P as ke,S as _e}from"./index-AkKl93ew.js";import{D as Qe}from"./DeleteOutlined-DatEI-Fw.js";import{s as I}from"./index-FcDqmjI2.js";const ye=N.createContext({});ye.Consumer;var Ne=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};const Ye=t=>{var{prefixCls:e,className:n,avatar:i,title:r,description:l}=t,d=Ne(t,["prefixCls","className","avatar","title","description"]);const{getPrefixCls:u}=o.useContext(xe),p=u("list",e),h=ae(`${p}-item-meta`,n),c=N.createElement("div",{className:`${p}-item-meta-content`},r&&N.createElement("h4",{className:`${p}-item-meta-title`},r),l&&N.createElement("div",{className:`${p}-item-meta-description`},l));return N.createElement("div",Object.assign({},d,{className:h}),i&&N.createElement("div",{className:`${p}-item-meta-avatar`},i),(r||l)&&c)},Ze=(t,e)=>{var{prefixCls:n,children:i,actions:r,extra:l,className:d,colStyle:u}=t,p=Ne(t,["prefixCls","children","actions","extra","className","colStyle"]);const{grid:h,itemLayout:c}=o.useContext(ye),{getPrefixCls:f}=o.useContext(xe),m=()=>{let C;return o.Children.forEach(i,z=>{typeof z=="string"&&(C=!0)}),C&&o.Children.count(i)>1},x=()=>c==="vertical"?!!l:!m(),g=f("list",n),k=r&&r.length>0&&N.createElement("ul",{className:`${g}-item-action`,key:"actions"},r.map((C,z)=>N.createElement("li",{key:`${g}-item-action-${z}`},C,z!==r.length-1&&N.createElement("em",{className:`${g}-item-action-split`})))),L=h?"div":"li",A=N.createElement(L,Object.assign({},p,h?{}:{ref:e},{className:ae(`${g}-item`,{[`${g}-item-no-flex`]:!x()},d)}),c==="vertical"&&l?[N.createElement("div",{className:`${g}-item-main`,key:"content"},i,k),N.createElement("div",{className:`${g}-item-extra`,key:"extra"},l)]:[i,k,Ve(l,{key:"extra"})]);return h?N.createElement(qe,{ref:e,flex:1,style:u},A):A},Pe=o.forwardRef(Ze);Pe.Meta=Ye;const et=Pe,tt=t=>{const{listBorderedCls:e,componentCls:n,paddingLG:i,margin:r,itemPaddingSM:l,itemPaddingLG:d,marginLG:u,borderRadiusLG:p}=t;return{[`${e}`]:{border:`${b(t.lineWidth)} ${t.lineType} ${t.colorBorder}`,borderRadius:p,[`${n}-header,${n}-footer,${n}-item`]:{paddingInline:i},[`${n}-pagination`]:{margin:`${b(r)} ${b(u)}`}},[`${e}${n}-sm`]:{[`${n}-item,${n}-header,${n}-footer`]:{padding:l}},[`${e}${n}-lg`]:{[`${n}-item,${n}-header,${n}-footer`]:{padding:d}}}},nt=t=>{const{componentCls:e,screenSM:n,screenMD:i,marginLG:r,marginSM:l,margin:d}=t;return{[`@media screen and (max-width:${i}px)`]:{[`${e}`]:{[`${e}-item`]:{[`${e}-item-action`]:{marginInlineStart:r}}},[`${e}-vertical`]:{[`${e}-item`]:{[`${e}-item-extra`]:{marginInlineStart:r}}}},[`@media screen and (max-width: ${n}px)`]:{[`${e}`]:{[`${e}-item`]:{flexWrap:"wrap",[`${e}-action`]:{marginInlineStart:l}}},[`${e}-vertical`]:{[`${e}-item`]:{flexWrap:"wrap-reverse",[`${e}-item-main`]:{minWidth:t.contentWidth},[`${e}-item-extra`]:{margin:`auto auto ${b(d)}`}}}}}},at=t=>{const{componentCls:e,antCls:n,controlHeight:i,minHeight:r,paddingSM:l,marginLG:d,padding:u,itemPadding:p,colorPrimary:h,itemPaddingSM:c,itemPaddingLG:f,paddingXS:m,margin:x,colorText:g,colorTextDescription:k,motionDurationSlow:L,lineWidth:A,headerBg:C,footerBg:z,emptyTextPadding:O,metaMarginBottom:W,avatarMarginRight:V,titleMarginBottom:X,descriptionFontSize:H}=t,q={};return["start","center","end"].forEach(B=>{q[`&-align-${B}`]={textAlign:B}}),{[`${e}`]:Object.assign(Object.assign({},Re(t)),{position:"relative","*":{outline:"none"},[`${e}-header`]:{background:C},[`${e}-footer`]:{background:z},[`${e}-header, ${e}-footer`]:{paddingBlock:l},[`${e}-pagination`]:Object.assign(Object.assign({marginBlockStart:d},q),{[`${n}-pagination-options`]:{textAlign:"start"}}),[`${e}-spin`]:{minHeight:r,textAlign:"center"},[`${e}-items`]:{margin:0,padding:0,listStyle:"none"},[`${e}-item`]:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:p,color:g,[`${e}-item-meta`]:{display:"flex",flex:1,alignItems:"flex-start",maxWidth:"100%",[`${e}-item-meta-avatar`]:{marginInlineEnd:V},[`${e}-item-meta-content`]:{flex:"1 0",width:0,color:g},[`${e}-item-meta-title`]:{margin:`0 0 ${b(t.marginXXS)} 0`,color:g,fontSize:t.fontSize,lineHeight:t.lineHeight,"> a":{color:g,transition:`all ${L}`,"&:hover":{color:h}}},[`${e}-item-meta-description`]:{color:k,fontSize:H,lineHeight:t.lineHeight}},[`${e}-item-action`]:{flex:"0 0 auto",marginInlineStart:t.marginXXL,padding:0,fontSize:0,listStyle:"none","& > li":{position:"relative",display:"inline-block",padding:`0 ${b(m)}`,color:k,fontSize:t.fontSize,lineHeight:t.lineHeight,textAlign:"center","&:first-child":{paddingInlineStart:0}},[`${e}-item-action-split`]:{position:"absolute",insetBlockStart:"50%",insetInlineEnd:0,width:A,height:t.calc(t.fontHeight).sub(t.calc(t.marginXXS).mul(2)).equal(),transform:"translateY(-50%)",backgroundColor:t.colorSplit}}},[`${e}-empty`]:{padding:`${b(u)} 0`,color:k,fontSize:t.fontSizeSM,textAlign:"center"},[`${e}-empty-text`]:{padding:O,color:t.colorTextDisabled,fontSize:t.fontSize,textAlign:"center"},[`${e}-item-no-flex`]:{display:"block"}}),[`${e}-grid ${n}-col > ${e}-item`]:{display:"block",maxWidth:"100%",marginBlockEnd:x,paddingBlock:0,borderBlockEnd:"none"},[`${e}-vertical ${e}-item`]:{alignItems:"initial",[`${e}-item-main`]:{display:"block",flex:1},[`${e}-item-extra`]:{marginInlineStart:d},[`${e}-item-meta`]:{marginBlockEnd:W,[`${e}-item-meta-title`]:{marginBlockStart:0,marginBlockEnd:X,color:g,fontSize:t.fontSizeLG,lineHeight:t.lineHeightLG}},[`${e}-item-action`]:{marginBlockStart:u,marginInlineStart:"auto","> li":{padding:`0 ${b(u)}`,"&:first-child":{paddingInlineStart:0}}}},[`${e}-split ${e}-item`]:{borderBlockEnd:`${b(t.lineWidth)} ${t.lineType} ${t.colorSplit}`,"&:last-child":{borderBlockEnd:"none"}},[`${e}-split ${e}-header`]:{borderBlockEnd:`${b(t.lineWidth)} ${t.lineType} ${t.colorSplit}`},[`${e}-split${e}-empty ${e}-footer`]:{borderTop:`${b(t.lineWidth)} ${t.lineType} ${t.colorSplit}`},[`${e}-loading ${e}-spin-nested-loading`]:{minHeight:i},[`${e}-split${e}-something-after-last-item ${n}-spin-container > ${e}-items > ${e}-item:last-child`]:{borderBlockEnd:`${b(t.lineWidth)} ${t.lineType} ${t.colorSplit}`},[`${e}-lg ${e}-item`]:{padding:f},[`${e}-sm ${e}-item`]:{padding:c},[`${e}:not(${e}-vertical)`]:{[`${e}-item-no-flex`]:{[`${e}-item-action`]:{float:"right"}}}}},rt=t=>({contentWidth:220,itemPadding:`${b(t.paddingContentVertical)} 0`,itemPaddingSM:`${b(t.paddingContentVerticalSM)} ${b(t.paddingContentHorizontal)}`,itemPaddingLG:`${b(t.paddingContentVerticalLG)} ${b(t.paddingContentHorizontalLG)}`,headerBg:"transparent",footerBg:"transparent",emptyTextPadding:t.padding,metaMarginBottom:t.padding,avatarMarginRight:t.padding,titleMarginBottom:t.paddingSM,descriptionFontSize:t.fontSize}),it=Ae("List",t=>{const e=He(t,{listBorderedCls:`${t.componentCls}-bordered`,minHeight:t.controlHeightLG});return[at(e),tt(e),nt(e)]},rt);var ot=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};function oe(t){var e,{pagination:n=!1,prefixCls:i,bordered:r=!1,split:l=!0,className:d,rootClassName:u,style:p,children:h,itemLayout:c,loadMore:f,grid:m,dataSource:x=[],size:g,header:k,footer:L,loading:A=!1,rowKey:C,renderItem:z,locale:O}=t,W=ot(t,["pagination","prefixCls","bordered","split","className","rootClassName","style","children","itemLayout","loadMore","grid","dataSource","size","header","footer","loading","rowKey","renderItem","locale"]);const V=n&&typeof n=="object"?n:{},[X,H]=o.useState(V.defaultCurrent||1),[q,B]=o.useState(V.defaultPageSize||10),{getPrefixCls:J,renderEmpty:U,direction:se,list:R}=o.useContext(xe),le={current:1,total:0},Z=$=>(j,M)=>{var he;H(j),B(M),n&&n[$]&&((he=n==null?void 0:n[$])===null||he===void 0||he.call(n,j,M))},ee=Z("onChange"),ce=Z("onShowSizeChange"),de=($,j)=>{if(!z)return null;let M;return typeof C=="function"?M=C($):C?M=$[C]:M=$.key,M||(M=`list-item-${j}`),o.createElement(o.Fragment,{key:M},z($,j))},me=()=>!!(f||n||L),y=J("list",i),[a,v,T]=it(y);let w=A;typeof w=="boolean"&&(w={spinning:w});const G=w&&w.spinning,ge=De(g);let D="";switch(ge){case"large":D="lg";break;case"small":D="sm";break}const _=ae(y,{[`${y}-vertical`]:c==="vertical",[`${y}-${D}`]:D,[`${y}-split`]:l,[`${y}-bordered`]:r,[`${y}-loading`]:G,[`${y}-grid`]:!!m,[`${y}-something-after-last-item`]:me(),[`${y}-rtl`]:se==="rtl"},R==null?void 0:R.className,d,u,v,T),S=Ue(le,{total:x.length,current:X,pageSize:q},n||{}),be=Math.ceil(S.total/S.pageSize);S.current>be&&(S.current=be);const Se=n?o.createElement("div",{className:ae(`${y}-pagination`,`${y}-pagination-align-${(e=S==null?void 0:S.align)!==null&&e!==void 0?e:"end"}`)},o.createElement(ke,Object.assign({},S,{onChange:ee,onShowSizeChange:ce}))):null;let ue=Ee(x);n&&x.length>(S.current-1)*S.pageSize&&(ue=Ee(x).splice((S.current-1)*S.pageSize,S.pageSize));const Le=Object.keys(m||{}).some($=>["xs","sm","md","lg","xl","xxl"].includes($)),we=Ie(Le),te=o.useMemo(()=>{for(let $=0;$<Ce.length;$+=1){const j=Ce[$];if(we[j])return j}},[we]),Oe=o.useMemo(()=>{if(!m)return;const $=te&&m[te]?m[te]:m.column;if($)return{width:`${100/$}%`,maxWidth:`${100/$}%`}},[m==null?void 0:m.column,te]);let pe=G&&o.createElement("div",{style:{minHeight:53}});if(ue.length>0){const $=ue.map((j,M)=>de(j,M));pe=m?o.createElement(Xe,{gutter:m.gutter},o.Children.map($,j=>o.createElement("div",{key:j==null?void 0:j.key,style:Oe},j))):o.createElement("ul",{className:`${y}-items`},$)}else!h&&!G&&(pe=o.createElement("div",{className:`${y}-empty-text`},O&&O.emptyText||(U==null?void 0:U("List"))||o.createElement(Fe,{componentName:"List"})));const ne=S.position||"bottom",Be=o.useMemo(()=>({grid:m,itemLayout:c}),[JSON.stringify(m),c]);return a(o.createElement(ye.Provider,{value:Be},o.createElement("div",Object.assign({style:Object.assign(Object.assign({},R==null?void 0:R.style),p),className:_},W),(ne==="top"||ne==="both")&&Se,k&&o.createElement("div",{className:`${y}-header`},k),o.createElement(_e,Object.assign({},w),pe,h),L&&o.createElement("div",{className:`${y}-footer`},L),f||(ne==="bottom"||ne==="both")&&Se)))}oe.Item=et;var st={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"};const lt=st;var ct=function(t,e){return o.createElement(ie,re({},t,{ref:e,icon:lt}))},dt=o.forwardRef(ct);const mt=dt;var gt={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"};const ut=gt;var pt=function(t,e){return o.createElement(ie,re({},t,{ref:e,icon:ut}))},ht=o.forwardRef(pt);const ft=ht;var xt={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM653.3 424.6l52.2 52.2a8.01 8.01 0 01-4.7 13.6l-179.4 21c-5.1.6-9.5-3.7-8.9-8.9l21-179.4c.8-6.6 8.9-9.4 13.6-4.7l52.4 52.4 256.2-256.2c3.1-3.1 8.2-3.1 11.3 0l42.4 42.4c3.1 3.1 3.1 8.2 0 11.3L653.3 424.6z"}}]},name:"import",theme:"outlined"};const $t=xt;var yt=function(t,e){return o.createElement(ie,re({},t,{ref:e,icon:$t}))},vt=o.forwardRef(yt);const bt=vt;var St={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M938 458.8l-29.6-312.6c-1.5-16.2-14.4-29-30.6-30.6L565.2 86h-.4c-3.2 0-5.7 1-7.6 2.9L88.9 557.2a9.96 9.96 0 000 14.1l363.8 363.8c1.9 1.9 4.4 2.9 7.1 2.9s5.2-1 7.1-2.9l468.3-468.3c2-2.1 3-5 2.8-8zM459.7 834.7L189.3 564.3 589 164.6 836 188l23.4 247-399.7 399.7zM680 256c-48.5 0-88 39.5-88 88s39.5 88 88 88 88-39.5 88-88-39.5-88-88-88zm0 120c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"}}]},name:"tag",theme:"outlined"};const wt=St;var jt=function(t,e){return o.createElement(ie,re({},t,{ref:e,icon:wt}))},Et=o.forwardRef(jt);const Ct=Et,ze="page-assist-saved-pages",Me=1,P="pages",kt=()=>"page_xxxx-xxxx-xxx-xxxx".replace(/[x]/g,()=>Math.floor(Math.random()*16).toString(16)),Y=()=>(E.debug(`\u6B63\u5728\u6253\u5F00\u6570\u636E\u5E93: ${ze}, \u7248\u672C: ${Me}`),new Promise((t,e)=>{const n=indexedDB.open(ze,Me);n.onerror=i=>{const r=n.error;E.error("\u6253\u5F00\u6570\u636E\u5E93\u5931\u8D25",{errorName:r==null?void 0:r.name,errorMessage:r==null?void 0:r.message}),e(new Error(`\u65E0\u6CD5\u6253\u5F00\u6570\u636E\u5E93: ${(r==null?void 0:r.message)||"\u672A\u77E5\u9519\u8BEF"}`))},n.onsuccess=i=>{E.debug("\u6570\u636E\u5E93\u8FDE\u63A5\u6210\u529F\u6253\u5F00"),t(n.result)},n.onupgradeneeded=i=>{E.info(`\u6570\u636E\u5E93\u5347\u7EA7: \u4ECE\u7248\u672C ${i.oldVersion} \u5230 ${i.newVersion}`);const r=n.result;if(!r.objectStoreNames.contains(P)){E.info(`\u521B\u5EFA\u5B58\u50A8\u5BF9\u8C61: ${P}`);const l=r.createObjectStore(P,{keyPath:"id"});E.debug("\u521B\u5EFA\u6570\u636E\u5E93\u7D22\u5F15"),l.createIndex("url","url",{unique:!1}),l.createIndex("createdAt","createdAt",{unique:!1}),l.createIndex("updatedAt","updatedAt",{unique:!1}),l.createIndex("tags","tags",{unique:!1,multiEntry:!0}),E.info("\u6570\u636E\u5E93\u7ED3\u6784\u521D\u59CB\u5316\u5B8C\u6210")}}}));class Nt{async savePage(e){var n,i;E.debug("\u5F00\u59CB\u4FDD\u5B58\u9875\u9762\u5230\u6570\u636E\u5E93",{title:e.title,url:e.url,type:e.type,contentLength:(n=e.content)==null?void 0:n.length,htmlLength:(i=e.html)==null?void 0:i.length,hasScreenshot:!!e.screenshot});try{const r=await Y();return new Promise((l,d)=>{const u=r.transaction([P],"readwrite"),p=u.objectStore(P);u.onerror=x=>{const g=u.error;E.error("\u6570\u636E\u5E93\u4E8B\u52A1\u9519\u8BEF",{errorName:g==null?void 0:g.name,errorMessage:g==null?void 0:g.message}),d(new Error(`\u6570\u636E\u5E93\u4E8B\u52A1\u9519\u8BEF: ${(g==null?void 0:g.message)||"\u672A\u77E5\u9519\u8BEF"}`))};const h=Date.now(),c=kt();E.debug(`\u751F\u6210\u9875\u9762ID: ${c}`);const f={id:c,title:e.title,url:e.url,content:e.content,html:e.html,type:e.type,tags:e.tags||[],notes:e.notes||"",createdAt:h,updatedAt:h,favicon:e.favicon,screenshot:e.screenshot};E.debug("\u51C6\u5907\u6DFB\u52A0\u9875\u9762\u5230\u6570\u636E\u5E93",{id:f.id});const m=p.add(f);m.onsuccess=()=>{E.info("\u9875\u9762\u6210\u529F\u4FDD\u5B58\u5230\u6570\u636E\u5E93",{id:f.id,title:f.title}),l(f)},m.onerror=()=>{const x=m.error;E.error("\u4FDD\u5B58\u9875\u9762\u5931\u8D25",{errorName:x==null?void 0:x.name,errorMessage:x==null?void 0:x.message}),d(new Error(`\u4FDD\u5B58\u9875\u9762\u5931\u8D25: ${(x==null?void 0:x.message)||"\u672A\u77E5\u9519\u8BEF"}`))},u.oncomplete=()=>{E.debug("\u6570\u636E\u5E93\u4E8B\u52A1\u5B8C\u6210\uFF0C\u5173\u95ED\u6570\u636E\u5E93\u8FDE\u63A5"),r.close()}})}catch(r){throw E.error("\u4FDD\u5B58\u9875\u9762\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF",r),r}}async getAllPages(e){const n=await Y();return new Promise((i,r)=>{const l=n.transaction([P],"readonly"),d=l.objectStore(P).index("updatedAt").openCursor(null,"prev"),u=[];d.onsuccess=p=>{const h=d.result;if(h){const c=h.value;let f=!0;if(e&&(e.tags&&e.tags.length>0&&(f=e.tags.some(m=>c.tags.includes(m))),f&&e.searchText)){const m=e.searchText.toLowerCase();f=c.title.toLowerCase().includes(m)||c.content.toLowerCase().includes(m)||c.notes.toLowerCase().includes(m)}f&&u.push(c),h.continue()}else if(e&&(e.offset!==void 0||e.limit!==void 0)){const c=e.offset||0,f=e.limit||u.length;i(u.slice(c,c+f))}else i(u)},d.onerror=()=>{r(new Error("\u83B7\u53D6\u9875\u9762\u5931\u8D25"))},l.oncomplete=()=>{n.close()}})}async getPageById(e){const n=await Y();return new Promise((i,r)=>{const l=n.transaction([P],"readonly"),d=l.objectStore(P).get(e);d.onsuccess=()=>{i(d.result||null)},d.onerror=()=>{r(new Error("\u83B7\u53D6\u9875\u9762\u5931\u8D25"))},l.oncomplete=()=>{n.close()}})}async updatePage(e,n){const i=await Y();return new Promise(async(r,l)=>{const d=i.transaction([P],"readwrite"),u=d.objectStore(P),p=u.get(e);p.onsuccess=()=>{if(!p.result){l(new Error("\u9875\u9762\u4E0D\u5B58\u5728"));return}const h={...p.result,...n,updatedAt:Date.now()},c=u.put(h);c.onsuccess=()=>{r(h)},c.onerror=()=>{l(new Error("\u66F4\u65B0\u9875\u9762\u5931\u8D25"))}},p.onerror=()=>{l(new Error("\u83B7\u53D6\u9875\u9762\u5931\u8D25"))},d.oncomplete=()=>{i.close()}})}async deletePage(e){const n=await Y();return new Promise((i,r)=>{const l=n.transaction([P],"readwrite"),d=l.objectStore(P).delete(e);d.onsuccess=()=>{i()},d.onerror=()=>{r(new Error("\u5220\u9664\u9875\u9762\u5931\u8D25"))},l.oncomplete=()=>{n.close()}})}async getAllTags(){const e=await this.getAllPages(),n=new Set;return e.forEach(i=>{i.tags.forEach(r=>n.add(r))}),Array.from(n)}}const K=new Nt,Pt=async t=>{try{return await K.getAllPages({tags:t==null?void 0:t.tags,searchText:t==null?void 0:t.searchText,limit:t==null?void 0:t.limit,offset:t==null?void 0:t.offset})}catch(e){throw console.error("\u83B7\u53D6\u4FDD\u5B58\u7684\u9875\u9762\u5931\u8D25:",e),new Error("\u83B7\u53D6\u4FDD\u5B58\u7684\u9875\u9762\u5931\u8D25")}},zt=async(t,e)=>{try{return await K.updatePage(t,e)}catch(n){throw console.error("\u66F4\u65B0\u9875\u9762\u5931\u8D25:",n),new Error("\u66F4\u65B0\u9875\u9762\u5931\u8D25")}},Mt=async t=>{try{await K.deletePage(t)}catch(e){throw console.error("\u5220\u9664\u9875\u9762\u5931\u8D25:",e),new Error("\u5220\u9664\u9875\u9762\u5931\u8D25")}},Lt=async()=>{try{return await K.getAllTags()}catch(t){throw console.error("\u83B7\u53D6\u6807\u7B7E\u5931\u8D25:",t),new Error("\u83B7\u53D6\u6807\u7B7E\u5931\u8D25")}},Ot=async t=>{try{const e=await K.getAllPages();return!t||t.length===0?e:e.filter(n=>t.includes(n.id))}catch(e){throw console.error("\u5BFC\u51FA\u9875\u9762\u5931\u8D25:",e),new Error("\u5BFC\u51FA\u9875\u9762\u5931\u8D25")}},Bt=async t=>{try{let e=0;for(const n of t)await K.savePage({title:n.title,url:n.url,content:n.content,html:n.html,type:n.type,tags:n.tags,notes:n.notes,favicon:n.favicon,screenshot:n.screenshot}),e++;return e}catch(e){throw console.error("\u5BFC\u5165\u9875\u9762\u5931\u8D25:",e),new Error("\u5BFC\u5165\u9875\u9762\u5931\u8D25")}},ve=10,It=()=>{Ge(),We();const[t,e]=o.useState([]),[n,i]=o.useState(!0),[r,l]=o.useState(1),[d,u]=o.useState(0),[p,h]=o.useState(""),[c,f]=o.useState([]),[m,x]=o.useState([]),[g,k]=o.useState(!1),[L,A]=o.useState(null),[C,z]=o.useState(""),[O,W]=o.useState([]),[V,X]=o.useState(""),[H,q]=o.useState(""),B=async()=>{try{i(!0);const a=await Pt({searchText:p||void 0,tags:c.length>0?c:void 0});u(a.length);const v=(r-1)*ve,T=v+ve;e(a.slice(v,T)),i(!1)}catch(a){console.error("\u52A0\u8F7D\u9875\u9762\u5931\u8D25:",a),I.error("\u52A0\u8F7D\u9875\u9762\u5931\u8D25"),i(!1)}},J=async()=>{try{const a=await Lt();x(a)}catch(a){console.error("\u52A0\u8F7D\u6807\u7B7E\u5931\u8D25:",a)}};o.useEffect(()=>{B(),J()},[]),o.useEffect(()=>{B()},[p,c,r]);const U=a=>{h(a),l(1)},se=a=>{c.includes(a)?f(c.filter(v=>v!==a)):f([...c,a]),l(1)},R=async a=>{je.confirm({title:"\u786E\u8BA4\u5220\u9664",content:"\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u4FDD\u5B58\u7684\u9875\u9762\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u590D\u3002",okText:"\u5220\u9664",okType:"danger",cancelText:"\u53D6\u6D88",onOk:async()=>{try{await Mt(a),I.success("\u9875\u9762\u5DF2\u5220\u9664"),B()}catch(v){console.error("\u5220\u9664\u9875\u9762\u5931\u8D25:",v),I.error("\u5220\u9664\u9875\u9762\u5931\u8D25")}}})},le=a=>{A(a),z(a.title),W(a.tags),X(a.notes),k(!0)},Z=async()=>{if(L)try{await zt(L.id,{title:C,tags:O,notes:V}),I.success("\u9875\u9762\u5DF2\u66F4\u65B0"),k(!1),B(),J()}catch(a){console.error("\u66F4\u65B0\u9875\u9762\u5931\u8D25:",a),I.error("\u66F4\u65B0\u9875\u9762\u5931\u8D25")}},ee=()=>{H.trim()&&(O.includes(H)||W([...O,H]),q(""))},ce=a=>{W(O.filter(v=>v!==a))},de=async()=>{try{const a=await Ot(),v=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),T=URL.createObjectURL(v),w=document.createElement("a");w.href=T,w.download=`page-assist-saved-pages-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(T),I.success("\u5BFC\u51FA\u6210\u529F")}catch(a){console.error("\u5BFC\u51FA\u5931\u8D25:",a),I.error("\u5BFC\u51FA\u5931\u8D25")}},me=()=>{const a=document.createElement("input");a.type="file",a.accept=".json",a.onchange=async v=>{var w;const T=(w=v.target.files)==null?void 0:w[0];if(T)try{const G=new FileReader;G.onload=async ge=>{var D;try{const _=JSON.parse((D=ge.target)==null?void 0:D.result),S=await Bt(_);I.success(`\u6210\u529F\u5BFC\u5165 ${S} \u4E2A\u9875\u9762`),B(),J()}catch(_){console.error("\u89E3\u6790\u5BFC\u5165\u6587\u4EF6\u5931\u8D25:",_),I.error("\u5BFC\u5165\u5931\u8D25: \u65E0\u6548\u7684\u6587\u4EF6\u683C\u5F0F")}},G.readAsText(T)}catch(G){console.error("\u5BFC\u5165\u5931\u8D25:",G),I.error("\u5BFC\u5165\u5931\u8D25")}},a.click()},y=a=>{window.open(a.url,"_blank")};return s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"mb-4 flex justify-between items-center",children:[s.jsx("h1",{className:"text-xl font-bold",children:"\u5DF2\u4FDD\u5B58\u7684\u9875\u9762"}),s.jsxs(Te,{children:[s.jsx(F,{icon:s.jsx(ft,{}),onClick:de,children:"\u5BFC\u51FA"}),s.jsx(F,{icon:s.jsx(bt,{}),onClick:me,children:"\u5BFC\u5165"})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx(Q.Search,{placeholder:"\u641C\u7D22\u6807\u9898\u6216\u5185\u5BB9",allowClear:!0,enterButton:s.jsx(Ke,{}),onSearch:U,className:"mb-2"}),s.jsxs("div",{className:"mt-2",children:[s.jsx("span",{className:"mr-2",children:"\u6807\u7B7E\u7B5B\u9009:"}),m.map(a=>s.jsx(fe,{color:c.includes(a)?"blue":void 0,className:"cursor-pointer mb-1",onClick:()=>se(a),children:a},a))]})]}),s.jsx(oe,{loading:n,dataSource:t,renderItem:a=>s.jsx(oe.Item,{actions:[s.jsx($e,{title:"\u67E5\u770B\u539F\u9875\u9762",children:s.jsx(F,{icon:s.jsx(Je,{}),onClick:()=>y(a)})}),s.jsx($e,{title:"\u7F16\u8F91",children:s.jsx(F,{icon:s.jsx(mt,{}),onClick:()=>le(a)})}),s.jsx($e,{title:"\u5220\u9664",children:s.jsx(F,{danger:!0,icon:s.jsx(Qe,{}),onClick:()=>R(a.id)})})],children:s.jsx(oe.Item.Meta,{title:s.jsx("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",children:a.title}),description:s.jsxs("div",{children:[s.jsx("div",{className:"text-gray-500 mb-1 truncate",children:a.url}),s.jsx("div",{className:"mb-1",children:a.tags.map(v=>s.jsx(fe,{color:"blue",className:"mr-1",children:v},v))}),a.notes&&s.jsx("div",{className:"text-gray-700",children:a.notes}),s.jsxs("div",{className:"text-gray-400 text-xs mt-1",children:["\u4FDD\u5B58\u4E8E ",new Date(a.createdAt).toLocaleString()]})]}),avatar:a.favicon?s.jsx("img",{src:a.favicon,alt:"favicon",className:"w-4 h-4"}):null})},a.id),pagination:!1}),s.jsx("div",{className:"mt-4 flex justify-center",children:s.jsx(ke,{current:r,pageSize:ve,total:d,onChange:l,showSizeChanger:!1})}),s.jsxs(je,{title:"\u7F16\u8F91\u9875\u9762\u4FE1\u606F",open:g,onOk:Z,onCancel:()=>k(!1),okText:"\u4FDD\u5B58",cancelText:"\u53D6\u6D88",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block mb-1",children:"\u6807\u9898"}),s.jsx(Q,{value:C,onChange:a=>z(a.target.value)})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block mb-1",children:"\u6807\u7B7E"}),s.jsx("div",{className:"mb-2",children:O.map(a=>s.jsx(fe,{closable:!0,onClose:()=>ce(a),className:"mb-1",children:a},a))}),s.jsxs(Q.Group,{compact:!0,children:[s.jsx(Q,{style:{width:"calc(100% - 60px)"},value:H,onChange:a=>q(a.target.value),onPressEnter:ee,placeholder:"\u6DFB\u52A0\u6807\u7B7E"}),s.jsx(F,{icon:s.jsx(Ct,{}),onClick:ee})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block mb-1",children:"\u5907\u6CE8"}),s.jsx(Q.TextArea,{value:V,onChange:a=>X(a.target.value),rows:4})]})]})]})};export{It as default};
