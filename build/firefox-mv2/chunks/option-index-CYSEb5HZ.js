import{a as H,j as e,R as x,f as L,e as ye,r as N,__tla as be}from"./FontSizeProvider-D4Gh80tw.js";import{B as ee,O as je,__tla as ve}from"./Layout-B2rmxZ24.js";import{c as ke,u as te,T as S,d as we,e as Ne,h as se,o as Se,g as Ee,i as _e,s as ae,a as Ce,y as Le}from"./SaveButton-Dir2VHfX.js";import{a as Re,u as De,g as Ie,b as Te,d as re,S as Fe,t as ne,h as Me,P as Pe,M as Be,__tla as Ke}from"./key-down-CsoB0isT.js";import{h as M,D as le,g as ie,X as Oe,I as He,E as Ve,a as We,i as Ae,j as qe,f as ze,e as $e,k as Ue,l as Qe,__tla as Xe}from"./Sidebar-uBkE2MHz.js";import{g as Ye,__tla as Ge}from"./knowledge-BRLesPVX.js";import{u as Je}from"./use-form-CQanvGBF.js";import{C as oe}from"./index-B2Ick9Fr.js";import{R as Ze}from"./rotate-ccw-D4uR6XPq.js";import{T as et}from"./Trans-BJZsQOvU.js";import"./chevron-right-CDZTKm5_.js";import"./elevenlabs-DGtBRP3_.js";import"./color-Rv4jN5Lm.js";import"./index-DZCUgEun.js";let ce,tt=Promise.all([(()=>{try{return be}catch{}})(),(()=>{try{return ve}catch{}})(),(()=>{try{return Ke}catch{}})(),(()=>{try{return Xe}catch{}})(),(()=>{try{return Ge}catch{}})()]).then(async()=>{let V,W,A,q,z,$,U;V=ke("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),W=()=>{const{t:s}=H("playground"),{setSelectedKnowledge:a,selectedKnowledge:r}=M(),{data:l}=te({queryKey:["getAllKnowledge"],queryFn:async()=>await Ye("finished"),refetchInterval:1e3});return e.jsx(e.Fragment,{children:l&&l.length>0&&e.jsx(le,{menu:{items:(l==null?void 0:l.map(o=>({key:o.id,label:e.jsxs("div",{className:"w-52 gap-2 text-lg truncate inline-flex line-clamp-3  items-center  dark:border-gray-700",children:[e.jsx("div",{children:e.jsx(ee,{className:"h-6 w-6 text-gray-400"})}),o.title]}),onClick:()=>{const i=l==null?void 0:l.find(d=>d.id===o.id);(r==null?void 0:r.id)===o.id?a(null):a(i)}})))||[],style:{maxHeight:500,overflowY:"scroll"},className:"no-scrollbar",activeKey:r==null?void 0:r.id},placement:"topLeft",trigger:["click"],children:e.jsx(S,{title:s("tooltip.knowledge"),children:e.jsx("button",{type:"button",className:"dark:text-gray-300",children:e.jsx(ee,{className:"h-6 w-6"})})})})})},A=({dropedFile:s})=>{const{t:a}=H(["playground","common"]),r=x.useRef(null),[l,o]=x.useState(!1),[i]=L("checkWideMode",!1),{onSubmit:d,selectedModel:f,chatMode:u,speechToTextLanguage:j,stopStreamingRequest:w,streaming:k,webSearch:n,setWebSearch:v,selectedQuickPrompt:b,textareaRef:g,setSelectedQuickPrompt:P,selectedKnowledge:h,temporaryChat:p,useOCR:R,setUseOCR:D,defaultInternetSearchOn:m,setHistory:I,history:T}=M(),[E]=L("autoSubmitVoiceMessage",!1),[B]=L("autoStopTimeout",2e3),de=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),_=()=>{g.current&&g.current.selectionStart===g.current.selectionEnd&&(de()?g.current.blur():g.current.focus())},c=Je({initialValues:{message:"",image:""}});x.useEffect(()=>{_(),m&&v(!0)},[]),x.useEffect(()=>{m&&v(!0)},[m]);const K=async t=>{if(t instanceof File){const y=await ne(t);c.setFieldValue("image",y)}else if(t.target.files){const y=await ne(t.target.files[0]);c.setFieldValue("image",y)}},me=t=>{t.clipboardData.files.length>0&&K(t.clipboardData.files[0])};x.useEffect(()=>{s&&K(s)},[s]),Re(g,c.values.message,300);const{transcript:Q,isListening:F,resetTranscript:ge,start:ue,stop:X,supported:xe}=De({autoStop:E,autoStopTimeout:B,onEnd:async()=>{E&&G()}}),{sendWhenEnter:O,setSendWhenEnter:fe}=we();x.useEffect(()=>{F&&c.setFieldValue("message",Q)},[Q]),x.useEffect(()=>{var t;if(b){const y=Ie(b);if(c.setFieldValue("message",b),y){(t=g.current)==null||t.focus();const C=setTimeout(()=>{var Z;(Z=g.current)==null||Z.setSelectionRange(y.start,y.end),P(null)},100);return()=>{clearInterval(C)}}}},[b]);const he=ye(),{mutateAsync:Y}=Ne({mutationFn:d,onSuccess:()=>{_(),he.invalidateQueries({queryKey:["fetchChatHistory"]})},onError:t=>{_()}}),G=()=>{c.onSubmit(async t=>{if(!(t.message.trim().length===0&&t.image.length===0)){if(!f||f.length===0){c.setFieldError("message",a("formError.noModel"));return}if(n){const y=await se(),C=await ie();if(!y&&!C){c.setFieldError("message",a("formError.noEmbeddingModel"));return}}c.reset(),_(),await Y({image:t.image,message:t.message.trim()})}})()},pe=t=>{Me({e:t,sendWhenEnter:O,typing:l,isSending:k})&&(t.preventDefault(),J(),G())},J=async()=>{F&&X()};return e.jsx("div",{className:"flex w-full flex-col items-center px-2",children:e.jsx("div",{className:"relative z-10 flex w-full flex-col items-center justify-center gap-2 text-base",children:e.jsx("div",{className:"relative flex w-full flex-row justify-center gap-2 lg:w-3/5",children:e.jsxs("div",{className:` bg-neutral-50  dark:bg-[#2D2D2D] relative w-full max-w-[48rem] p-1 backdrop-blur-lg duration-100 border border-gray-300 rounded-t-xl  dark:border-gray-600
            ${p?"!bg-gray-200 dark:!bg-black ":""}
            ${i?"max-w-none ":""}
            `,children:[e.jsxs("div",{className:`border-b border-gray-200 dark:border-gray-600 relative ${c.values.image.length===0?"hidden":"block"}`,children:[e.jsx("button",{type:"button",onClick:()=>{c.setFieldValue("image","")},className:"absolute top-1 left-1 flex items-center justify-center z-10 bg-white dark:bg-[#2D2D2D] p-0.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-600 text-black dark:text-gray-100",children:e.jsx(Oe,{className:"h-4 w-4"})})," ",e.jsx(He,{src:c.values.image,alt:"Uploaded Image",preview:!1,className:"rounded-md max-h-32"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex  bg-transparent ",children:e.jsxs("form",{onSubmit:c.onSubmit(async t=>{if(J(),!f||f.length===0){c.setFieldError("message",a("formError.noModel"));return}if(n){const y=await se(),C=await ie();if(!y&&!C){c.setFieldError("message",a("formError.noEmbeddingModel"));return}}t.message.trim().length===0&&t.image.length===0||(c.reset(),_(),await Y({image:t.image,message:t.message.trim()}))}),className:"shrink-0 flex-grow  flex flex-col items-center ",children:[e.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",ref:r,accept:"image/*",multiple:!1,onChange:K}),e.jsxs("div",{className:"w-full  flex flex-col dark:border-gray-600  px-2 pt-2",children:[e.jsx("textarea",{id:"textarea-message",onCompositionStart:()=>{},onCompositionEnd:()=>{},onKeyDown:t=>pe(t),ref:g,className:"px-2 py-2 w-full resize-none bg-transparent focus-within:outline-none focus:ring-0 focus-visible:ring-0 ring-0 dark:ring-0 border-0 dark:text-gray-100",onPaste:me,rows:1,style:{minHeight:"35px"},tabIndex:0,placeholder:a("form.textarea.placeholder"),...c.getInputProps("message")}),e.jsxs("div",{className:"mt-2 flex justify-between items-center",children:[e.jsx("div",{className:"flex",children:!h&&e.jsx(S,{title:a("tooltip.searchInternet"),children:e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 dark:text-gray-300 "}),e.jsx(Se,{value:n,onChange:t=>v(t),checkedChildren:a("form.webSearch.on"),unCheckedChildren:a("form.webSearch.off")})]})})}),e.jsxs("div",{className:"flex !justify-end gap-3",children:[T.length>0&&e.jsx(S,{title:a("tooltip.clearContext"),children:e.jsx("button",{type:"button",onClick:()=>{I([])},className:`flex items-center justify-center dark:text-gray-300 ${u==="rag"?"hidden":"block"}`,children:e.jsx(Ve,{className:"h-5 w-5"})})}),!h&&e.jsx(S,{title:a("tooltip.uploadImage"),children:e.jsx("button",{type:"button",onClick:()=>{var t;(t=r.current)==null||t.click()},className:`flex items-center justify-center dark:text-gray-300 ${u==="rag"?"hidden":"block"}`,children:e.jsx(We,{className:"h-5 w-5"})})}),xe&&e.jsx(S,{title:a("tooltip.speechToText"),children:e.jsx("button",{type:"button",onClick:async()=>{F?X():(ge(),ue({continuous:!0,lang:j}))},className:"flex items-center justify-center dark:text-gray-300",children:F?e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-3 w-3 rounded-full bg-red-400 opacity-75"}),e.jsx(re,{className:"h-5 w-5"})]}):e.jsx(re,{className:"h-5 w-5"})})}),e.jsx(W,{}),k?e.jsxs(S,{title:a("tooltip.stopStreaming"),children:[e.jsx("button",{type:"button",onClick:w,className:"text-gray-800 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md p-1",children:e.jsx(Fe,{className:"size-5"})})," "]}):e.jsx(le.Button,{htmlType:"submit",disabled:k,className:"!justify-end !w-auto",icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})}),menu:{items:[{key:1,label:e.jsx(oe,{checked:O,onChange:t=>fe(t.target.checked),children:a("sendWhenEnter")})},{key:2,label:e.jsx(oe,{checked:R,onChange:t=>D(t.target.checked),children:a("useOCR")})}]},children:e.jsxs("div",{className:"inline-flex gap-2",children:[O?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"h-5 w-5",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M9 10L4 15 9 20"}),e.jsx("path",{d:"M20 4v7a4 4 0 01-4 4H4"})]}):null,a("common:submit")]})})]})]})]})]})}),c.errors.message&&e.jsx("div",{className:"text-red-500 text-center text-sm mt-1",children:c.errors.message})]})]})})})})},q=()=>{const[s,a]=N.useState(""),{t:r}=H(["playground","common"]),[l]=L("checkOllamaStatus",!0),{data:o,status:i,refetch:d,isRefetching:f}=te({queryKey:["ollamaStatus"],queryFn:async()=>{const u=await Ee(),j=await _e();return u&&ae(u),{isOk:j,ollamaURL:u}},enabled:l});return N.useEffect(()=>{o!=null&&o.ollamaURL&&a(o.ollamaURL)},[o]),l?e.jsx("div",{className:"mx-auto sm:max-w-xl px-4 mt-10",children:e.jsxs("div",{className:"rounded-lg justify-center items-center flex flex-col border p-8 bg-gray-50 dark:bg-[#262626]  dark:border-gray-600",children:[(i==="pending"||f)&&e.jsxs("div",{className:"inline-flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),e.jsx("p",{className:"dark:text-gray-400 text-gray-900",children:r("ollamaState.searching")})]}),!f&&i==="success"?o.isOk?e.jsxs("div",{className:"inline-flex  items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsx("p",{className:"dark:text-gray-400 text-gray-900",children:r("ollamaState.running")})]}):e.jsxs("div",{className:"flex flex-col space-y-2 justify-center items-center",children:[e.jsxs("div",{className:"inline-flex  space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx("p",{className:"dark:text-gray-400 text-gray-900",children:r("ollamaState.notRunning")})]}),e.jsx("input",{className:"bg-gray-100 dark:bg-[#262626] dark:text-gray-100 rounded-md px-4 py-2 mt-2 w-full",type:"url",value:s,onChange:u=>a(u.target.value)}),e.jsxs("button",{onClick:()=>{ae(s),d()},className:"inline-flex mt-4 items-center rounded-md border border-transparent bg-black px-2 py-2 text-sm font-medium leading-4 text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:bg-white dark:text-gray-800 dark:hover:bg-gray-100 dark:focus:ring-gray-500 dark:focus:ring-offset-gray-100 disabled:opacity-50 ",children:[e.jsx(Ze,{className:"h-4 w-4 mr-3"}),r("common:retry")]}),s&&Ce(s)!=="http://127.0.0.1:11434"&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-4 text-center",children:e.jsx(et,{i18nKey:"playground:ollamaState.connectionError",components:{anchor:e.jsx("a",{href:"https://github.com/n4ze3m/page-assist/blob/main/docs/connection-issue.md",target:"__blank",className:"text-blue-600 dark:text-blue-400"})}})})]}):null]})}):e.jsx("div",{className:"mx-auto sm:max-w-xl px-4 mt-10",children:e.jsx("div",{className:"rounded-lg justify-center items-center flex flex-col border p-8 bg-gray-50 dark:bg-[#262626] dark:border-gray-600",children:e.jsxs("h1",{className:"text-sm  font-medium text-center text-gray-500 dark:text-gray-400 flex gap-3 items-center justify-center",children:[e.jsx("span",{children:"\u{1F44B}"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:r("welcome")})]})})})},z=()=>{const{messages:s,streaming:a,regenerateLastMessage:r,isSearchingInternet:l,editMessage:o,ttsEnabled:i,onSubmit:d}=M(),[f,u]=x.useState(!1),[j,w]=x.useState(null),[k]=L("openReasoning",!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative flex w-full flex-col items-center pt-16 pb-4",children:[s.length===0&&e.jsx("div",{className:"mt-32 w-full",children:e.jsx(q,{})}),s.map((n,v)=>e.jsx(Pe,{isBot:n.isBot,message:n.message,name:n.name,images:n.images||[],currentMessageIndex:v,totalMessages:s.length,onRengerate:r,isProcessing:a,isSearchingInternet:l,sources:n.sources,onEditFormSubmit:(b,g)=>{o(v,b,!n.isBot,g)},onSourceClick:b=>{w(b),u(!0)},isTTSEnabled:i,generationInfo:n==null?void 0:n.generationInfo,isStreaming:a,reasoningTimeTaken:n==null?void 0:n.reasoning_time_taken,openReasoning:k,modelImage:n==null?void 0:n.modelImage,modelName:n==null?void 0:n.modelName,onContinue:()=>{d({image:"",message:"",isContinue:!0})}},v))]}),e.jsx("div",{className:"w-full pb-[157px]"}),e.jsx(Be,{open:f,setOpen:u,source:j})]})},$=(s,a)=>{const r=N.useRef(null),[l,o]=N.useState(!0);return N.useEffect(()=>{const i=r.current;if(!i)return;const d=()=>{const{scrollTop:f,scrollHeight:u,clientHeight:j}=i;o(u-f-j<50)};return i.addEventListener("scroll",d),()=>i.removeEventListener("scroll",d)},[]),N.useEffect(()=>{var i;if(s.length===0){o(!0);return}if(l&&r.current){const d=a?{behavior:"smooth",block:"end"}:{behavior:"auto",block:"end"};(i=r.current.lastElementChild)==null||i.scrollIntoView(d)}},[s,a,l]),{containerRef:r,isAtBottom:l,scrollToBottom:()=>{var i,d;(d=(i=r.current)==null?void 0:i.lastElementChild)==null||d.scrollIntoView({behavior:"smooth",block:"end"})}}},U=()=>{const s=x.useRef(null),[a,r]=x.useState(),{selectedKnowledge:l,messages:o,setHistoryId:i,setHistory:d,setMessages:f,setSelectedSystemPrompt:u,streaming:j}=M(),{setSystemPrompt:w}=Ae(),{containerRef:k,isAtBottom:n,scrollToBottom:v}=$(o,j),[b,g]=x.useState("idle");x.useEffect(()=>{if(l||!s.current)return;const h=m=>{m.preventDefault(),m.stopPropagation()},p=m=>{var T,E;if(m.preventDefault(),m.stopPropagation(),g("idle"),!Array.from(((T=m.dataTransfer)==null?void 0:T.files)||[]).every(B=>B.type.startsWith("image/"))){g("error");return}const I=Array.from(((E=m.dataTransfer)==null?void 0:E.files)||[]).slice(0,1);I.length>0&&r(I[0])},R=m=>{m.preventDefault(),m.stopPropagation(),g("dragging")},D=m=>{m.preventDefault(),m.stopPropagation(),g("idle")};return s.current.addEventListener("dragover",h),s.current.addEventListener("drop",p),s.current.addEventListener("dragenter",R),s.current.addEventListener("dragleave",D),()=>{s.current&&(s.current.removeEventListener("dragover",h),s.current.removeEventListener("drop",p),s.current.removeEventListener("dragenter",R),s.current.removeEventListener("dragleave",D))}},[l]);const P=async()=>{if(await Le()&&o.length===0){const h=await qe();if(h){i(h.history.id),d(ze(h.messages)),f($e(h.messages));const p=await Ue(h.history.id);p&&(p.prompt_id&&await Qe(p.prompt_id)&&(u(p.prompt_id),w(p.prompt_content)),w(p.prompt_content))}}};return x.useEffect(()=>{P()},[]),e.jsxs("div",{ref:s,className:`relative flex h-full flex-col items-center ${b==="dragging"?"bg-gray-100 dark:bg-gray-800":""} bg-white dark:bg-[#171717]`,children:[e.jsx("div",{ref:k,className:"custom-scrollbar flex h-full w-full flex-col items-center overflow-x-hidden overflow-y-auto px-5",children:e.jsx(z,{})}),e.jsxs("div",{className:"absolute bottom-0 w-full",children:[!n&&e.jsx("div",{className:"fixed bottom-28 z-20 left-0 right-0 flex justify-center",children:e.jsx("button",{onClick:v,className:"bg-gray-50 shadow border border-gray-200 dark:border-none dark:bg-white/20 p-1.5 rounded-full pointer-events-auto",children:e.jsx(V,{className:"size-4 text-gray-600 dark:text-gray-300"})})}),e.jsx(A,{dropedFile:a})]})]})},ce=()=>e.jsx(je,{children:e.jsx(U,{})})});export{tt as __tla,ce as default};
