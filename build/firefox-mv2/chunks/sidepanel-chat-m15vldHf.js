import{r as V,u as D,g as oe,a as K,j as e,R as d}from"./FontSizeProvider-BQs3lYNB.js";import{O as P,X as Y,I as ce,E as J,Q as de,G as me,B as ge,F as ue,R as xe,S as he,T as fe,U as pe,V as ye,W as be,n as ve,Y as je,K as ke,L as we}from"./Sidebar-ChItARQ9.js";import{am as _,c as T,R as Ne,o as Se,U as Ee,an as Me,ap as Ce,y as Le,E as B,T as M,W as Fe,aq as Ie}from"./get-screenshot-dbUggNeo.js";import{b as Pe,c as Te,a as Re,u as Oe,g as We,P as ze,d as Ae,M as X,S as Ve,t as ee,h as De}from"./key-down-C47VeYs1.js";import{u as Be,c as te,a as He}from"./SaveButton-_URAgOyg.js";import{L as qe}from"./loader-2-DtzEi-hS.js";import{R as Ue}from"./rotate-ccw-z_F9fR6X.js";import{T as Qe}from"./Trans-Cksffvqj.js";import{u as Ke}from"./use-form-jBR82XuI.js";import{C as $}from"./index-DrrHHtcZ.js";import{l as _e}from"./icon-BmsVQuvA.js";import"./Ollama-CeSCS9zP.js";import"./elevenlabs-fNYKL-lh.js";import"./color-Csc4ioKI.js";import"./index-BfGcxbaB.js";function $e(){const[r,l]=V.useState(null);return V.useEffect(()=>{const m=h=>{h.from==="background"&&l(h)};return _.runtime.connect({name:"pgCopilot"}),_.runtime.onMessage.addListener(m),()=>{_.runtime.onMessage.removeListener(m)}},[]),r}/**
* @license lucide-react v0.350.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Ze=T("Boxes",[["path",{d:"M2.97 12.92A2 2 0 0 0 2 14.63v3.24a2 2 0 0 0 .97 1.71l3 1.8a2 2 0 0 0 2.06 0L12 19v-5.5l-5-3-4.03 2.42Z",key:"lc1i9w"}],["path",{d:"m7 16.5-4.74-2.85",key:"1o9zyk"}],["path",{d:"m7 16.5 5-3",key:"va8pkn"}],["path",{d:"M7 16.5v5.17",key:"jnp8gn"}],["path",{d:"M12 13.5V19l3.97 2.38a2 2 0 0 0 2.06 0l3-1.8a2 2 0 0 0 .97-1.71v-3.24a2 2 0 0 0-.97-1.71L17 10.5l-5 3Z",key:"8zsnat"}],["path",{d:"m17 16.5-5-3",key:"8arw3v"}],["path",{d:"m17 16.5 4.74-2.85",key:"8rfmw"}],["path",{d:"M17 16.5v5.17",key:"k6z78m"}],["path",{d:"M7.97 4.42A2 2 0 0 0 7 6.13v4.37l5 3 5-3V6.13a2 2 0 0 0-.97-1.71l-3-1.8a2 2 0 0 0-2.06 0l-3 1.8Z",key:"1xygjf"}],["path",{d:"M12 8 7.26 5.15",key:"1vbdud"}],["path",{d:"m12 8 4.74-2.85",key:"3rx089"}],["path",{d:"M12 13.5V8",key:"1io7kd"}]]);/**
* @license lucide-react v0.350.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Ge=T("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
* @license lucide-react v0.350.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Ye=T("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
* @license lucide-react v0.350.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Je=T("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
* @license lucide-react v0.350.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Xe=T("PlusSquare",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),et=()=>{const[r,l]=V.useState(""),{t:m}=D(["playground","common"]),h=oe(),[v]=K("checkOllamaStatus",!0),{data:i,status:y,refetch:n,isRefetching:j}=Be({queryKey:["ollamaStatus",v],queryFn:async()=>{const o=await Ee(),c=await Me(),g=await Ce({returnEmpty:!1});return h.invalidateQueries({queryKey:["getAllModelsForSelect"]}),{isOk:v?c:!0,models:g,ollamaURL:o}}});V.useEffect(()=>{i!=null&&i.ollamaURL&&l(i.ollamaURL)},[i]);const{setSelectedModel:s,selectedModel:w,chatMode:a,setChatMode:k}=P(),p=()=>{var o;return e.jsxs("div",{className:"mt-4",children:[e.jsx(Le,{onChange:c=>{s(c),localStorage.setItem("selectedModel",c)},value:w,size:"large",filterOption:(c,g)=>g.label.toLowerCase().indexOf(c.toLowerCase())>=0||g.value.toLowerCase().indexOf(c.toLowerCase())>=0,showSearch:!0,placeholder:m("common:selectAModel"),style:{width:"100%"},className:"mt-4",options:(o=i.models)==null?void 0:o.map(c=>({label:(c==null?void 0:c.nickname)||c.name,value:c.model}))}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"inline-flex items-center",children:[e.jsxs("label",{className:"relative flex items-center p-3 rounded-full cursor-pointer",htmlFor:"check",children:[e.jsx("input",{type:"checkbox",checked:a==="rag",onChange:c=>{k(c.target.checked?"rag":"normal")},className:"before:content[''] peer relative h-5 w-5 cursor-pointer appearance-none rounded-md border border-blue-gray-200 transition-all before:absolute before:top-2/4 before:left-2/4 before:block before:h-12 before:w-12 before:-translate-y-2/4 before:-translate-x-2/4 before:rounded-full before:bg-blue-gray-500 before:opacity-0 before:transition-opacity",id:"check"}),e.jsx("span",{className:"absolute text-white transition-opacity opacity-0 pointer-events-none top-2/4 left-2/4 -translate-y-2/4 -translate-x-2/4 peer-checked:opacity-100 ",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",stroke:"currentColor",strokeWidth:"1",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsx("label",{className:"mt-px font-light  cursor-pointer select-none text-gray-900 dark:text-gray-400",htmlFor:"check",children:m("common:chatWithCurrentPage")})]})})]})};return v?e.jsx("div",{className:"mx-auto sm:max-w-lg px-4 mt-10",children:e.jsxs("div",{className:"rounded-lg  justify-center items-center flex flex-col border border-gray-300 dark:border-gray-700 p-8 bg-white dark:bg-[#262626] shadow-sm",children:[(y==="pending"||j)&&e.jsxs("div",{className:"inline-flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-bounce"}),e.jsx("p",{className:"dark:text-gray-400 text-gray-900",children:m("ollamaState.searching")})]}),!j&&y==="success"?i.isOk?e.jsxs("div",{className:"inline-flex  items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("p",{className:"dark:text-gray-400 text-gray-900",children:m("ollamaState.running")})]}):e.jsxs("div",{className:"flex flex-col space-y-2 justify-center items-center",children:[e.jsxs("div",{className:"inline-flex  space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("p",{className:"dark:text-gray-400 text-gray-900",children:m("ollamaState.notRunning")})]}),e.jsx("input",{className:"bg-gray-100 dark:bg-black dark:text-gray-100 rounded-md px-4 py-2 mt-2 w-full",type:"url",value:r,onChange:o=>l(o.target.value)}),e.jsxs("button",{onClick:()=>{Ne(r),n()},className:"inline-flex mt-4 items-center rounded-md border border-transparent bg-black px-2 py-2 text-sm font-medium leading-4 text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:bg-white dark:text-gray-800 dark:hover:bg-gray-100 dark:focus:ring-gray-500 dark:focus:ring-offset-gray-100 disabled:opacity-50 ",children:[e.jsx(Ue,{className:"h-4 w-4 mr-3"}),m("common:retry")]}),r&&Se(r)!=="http://127.0.0.1:11434"&&e.jsx("p",{className:"text-xs text-gray-700 dark:text-gray-400 mb-4 text-center",children:e.jsx(Qe,{i18nKey:"playground:ollamaState.connectionError",components:{anchor:e.jsx("a",{href:"https://github.com/n4ze3m/page-assist/blob/main/docs/connection-issue.md",target:"__blank",className:"text-blue-600 dark:text-blue-400"})}})})]}):null,y==="success"&&i.isOk&&p()]})}):e.jsx("div",{className:"mx-auto sm:max-w-md px-4 mt-10",children:e.jsxs("div",{className:"rounded-lg justify-center items-center flex flex-col border dark:border-gray-700 p-8 bg-white dark:bg-[#262626] shadow-sm",children:[e.jsx("div",{className:"inline-flex items-center space-x-2",children:e.jsxs("p",{className:"dark:text-gray-400 text-gray-900",children:[e.jsx("span",{children:"\u{1F44B}"}),m("welcome")]})}),y==="pending"&&e.jsx(qe,{className:"mr-2 h-4 w-4 animate-spin"}),y==="success"&&i.isOk&&p()]})})},tt=()=>{const{messages:r,streaming:l,regenerateLastMessage:m,editMessage:h,isSearchingInternet:v}=P(),i=d.useRef(null),[y,n]=d.useState(!1),[j,s]=d.useState(null),{ttsEnabled:w}=te();return d.useEffect(()=>{i.current&&i.current.scrollIntoView({behavior:"smooth"})}),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative flex w-full flex-col items-center pt-16 pb-4",children:[r.length===0&&e.jsx(et,{}),r.map((a,k)=>e.jsx(Pe,{isBot:a.isBot,message:a.message,name:a.name,images:a.images||[],currentMessageIndex:k,totalMessages:r.length,onRengerate:m,message_type:a.messageType,isProcessing:l,isSearchingInternet:v,sources:a.sources,onEditFormSubmit:p=>{h(k,p,!a.isBot)},onSourceClick:p=>{s(p),n(!0)},isTTSEnabled:w,generationInfo:a==null?void 0:a.generationInfo,isStreaming:l,reasoningTimeTaken:a==null?void 0:a.reasoning_time_taken,modelImage:a==null?void 0:a.modelImage,modelName:a==null?void 0:a.modelName},k)),e.jsx("div",{ref:i})]}),e.jsx("div",{className:"w-full pb-[157px]"}),e.jsx(Te,{open:y,setOpen:n,source:j})]})},st=({dropedFile:r})=>{const l=d.useRef(null),m=d.useRef(null),{sendWhenEnter:h,setSendWhenEnter:v}=te(),[i,y]=d.useState(!1),{t:n}=D(["playground","common"]),[j]=K("chatWithWebsiteEmbedding",!0),s=Ke({initialValues:{message:"",image:""}}),{transcript:w,isListening:a,resetTranscript:k,start:p,stop:o,supported:c}=Re(),g=async()=>{a&&o()},S=async t=>{if(t instanceof File){const u=await ee(t);s.setFieldValue("image",u)}else if(t.target.files){const u=await ee(t.target.files[0]);s.setFieldValue("image",u)}},b=()=>{l.current&&l.current.focus()},F=t=>{t.key==="Process"||t.key==="229"||De({e:t,sendWhenEnter:h,typing:i,isSending:G})&&(t.preventDefault(),s.onSubmit(async u=>{if(!(u.message.trim().length===0&&u.image.length===0)){if(await g(),!C||C.length===0){s.setFieldError("message",n("formError.noModel"));return}if(f==="rag"&&!await B()&&j){s.setFieldError("message",n("formError.noEmbeddingModel"));return}if(W){const E=await B(),L=await J();if(!E&&!L){s.setFieldError("message",n("formError.noEmbeddingModel"));return}}s.reset(),b(),await Z({image:u.image,message:u.message.trim()})}})())},x=t=>{t.clipboardData.files.length>0&&S(t.clipboardData.files[0])},{onSubmit:R,selectedModel:C,chatMode:f,stopStreamingRequest:H,streaming:se,setChatMode:O,webSearch:W,setWebSearch:q,selectedQuickPrompt:z,setSelectedQuickPrompt:ae,speechToTextLanguage:re,useOCR:ne,setUseOCR:le,defaultInternetSearchOn:U,defaultChatWithWebsite:Q}=P();d.useEffect(()=>{r&&S(r)},[r]),Oe(l,s.values.message,120),d.useEffect(()=>{a&&s.setFieldValue("message",w)},[w]),d.useEffect(()=>{var t;if(z){const u=We(z);if(s.setFieldValue("message",z),u){(t=l.current)==null||t.focus();const E=setTimeout(()=>{var L;(L=l.current)==null||L.setSelectionRange(u.start,u.end),ae(null)},100);return()=>{clearInterval(E)}}}},[z]);const{mutateAsync:Z,isPending:G}=He({mutationFn:R,onSuccess:()=>{b()},onError:t=>{b()}});return d.useEffect(()=>{var E,L;const t=N=>{var I;if(N.preventDefault(),(I=N.dataTransfer)==null?void 0:I.items)for(let A=0;A<N.dataTransfer.items.length;A++)N.dataTransfer.items[A].type==="text/plain"&&N.dataTransfer.items[A].getAsString(ie=>{s.setFieldValue("message",ie)})},u=N=>{N.preventDefault()};return(E=l.current)==null||E.addEventListener("drop",t),(L=l.current)==null||L.addEventListener("dragover",u),U&&q(!0),Q&&O("rag"),()=>{var N,I;(N=l.current)==null||N.removeEventListener("drop",t),(I=l.current)==null||I.removeEventListener("dragover",u)}},[]),d.useEffect(()=>{U&&q(!0)},[U]),d.useEffect(()=>{Q&&O("rag")},[Q]),e.jsx("div",{className:"flex w-full flex-col items-center px-2",children:e.jsx("div",{className:"relative z-10 flex w-full flex-col items-center justify-center gap-2 text-base",children:e.jsx("div",{className:"relative flex w-full flex-row justify-center gap-2 lg:w-4/5",children:e.jsxs("div",{className:` bg-neutral-50  dark:bg-[#262626] relative w-full max-w-[48rem] p-1 backdrop-blur-lg duration-100 border border-gray-300 rounded-t-xl  dark:border-gray-600
          `,children:[e.jsxs("div",{className:`border-b border-gray-200 dark:border-gray-600 relative ${s.values.image.length===0?"hidden":"block"}`,children:[e.jsx("button",{type:"button",onClick:()=>{s.setFieldValue("image","")},className:"absolute top-1 left-1 flex items-center justify-center z-10 bg-white dark:bg-[#262626] p-0.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-600 text-black dark:text-gray-100",children:e.jsx(Y,{className:"h-4 w-4"})})," ",e.jsx(ce,{src:s.values.image,alt:"Uploaded Image",preview:!1,className:"rounded-md max-h-32"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex",children:e.jsxs("form",{onSubmit:s.onSubmit(async t=>{if(!C||C.length===0){s.setFieldError("message",n("formError.noModel"));return}if(f==="rag"&&!await B()&&j){s.setFieldError("message",n("formError.noEmbeddingModel"));return}if(W){const u=await B(),E=await J();if(!u&&!E){s.setFieldError("message",n("formError.noEmbeddingModel"));return}}await g(),!(t.message.trim().length===0&&t.image.length===0)&&(s.reset(),b(),await Z({image:t.image,message:t.message.trim()}))}),className:"shrink-0 flex-grow  flex flex-col items-center ",children:[e.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",ref:m,accept:"image/*",multiple:!1,onChange:S}),e.jsxs("div",{className:"w-full  flex flex-col px-1",children:[e.jsx("textarea",{onKeyDown:t=>F(t),ref:l,className:"px-2 py-2 w-full resize-none bg-transparent focus-within:outline-none focus:ring-0 focus-visible:ring-0 ring-0 dark:ring-0 border-0 dark:text-gray-100",onPaste:x,rows:1,style:{minHeight:"60px"},tabIndex:0,onCompositionStart:()=>{},onCompositionEnd:()=>{},placeholder:n("form.textarea.placeholder"),...s.getInputProps("message")}),e.jsxs("div",{className:"flex mt-4 justify-end gap-3",children:[f!=="vision"&&e.jsx(M,{title:n("tooltip.searchInternet"),children:e.jsx("button",{type:"button",onClick:()=>q(!W),className:`inline-flex items-center gap-2   ${f==="rag"?"hidden":"block"}`,children:W?e.jsx(ze,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}):e.jsx(Ae,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})})}),e.jsx(de,{}),c&&e.jsx(M,{title:n("tooltip.speechToText"),children:e.jsx("button",{type:"button",onClick:async()=>{a?g():(k(),p({continuous:!0,lang:re}))},className:"flex items-center justify-center dark:text-gray-300",children:a?e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-3 w-3 rounded-full bg-red-400 opacity-75"}),e.jsx(X,{className:"h-5 w-5"})]}):e.jsx(X,{className:"h-5 w-5"})})}),e.jsx(M,{title:n("tooltip.vision"),children:e.jsx("button",{type:"button",onClick:()=>{O(f==="vision"?"normal":"vision")},disabled:f==="rag",className:`flex items-center justify-center dark:text-gray-300 ${f==="rag"?"hidden":"block"} disabled:opacity-50`,children:f==="vision"?e.jsx(Ye,{className:"h-5 w-5"}):e.jsx(Ge,{className:"h-5 w-5"})})}),e.jsx(M,{title:n("tooltip.uploadImage"),children:e.jsx("button",{type:"button",onClick:()=>{var t;(t=m.current)==null||t.click()},disabled:f==="vision",className:`flex items-center justify-center disabled:opacity-50 dark:text-gray-300 ${f==="rag"?"hidden":"block"}`,children:e.jsx(me,{className:"h-5 w-5"})})}),se?e.jsx(M,{title:n("tooltip.stopStreaming"),children:e.jsx("button",{type:"button",onClick:H,className:"text-gray-800 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md p-1",children:e.jsx(Ve,{className:"h-6 w-6"})})}):e.jsx(ge.Button,{htmlType:"submit",disabled:G,className:"!justify-end !w-auto",icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})}),menu:{items:[{key:1,label:e.jsx($,{checked:h,onChange:t=>v(t.target.checked),children:n("sendWhenEnter")})},{key:2,label:e.jsx($,{checked:f==="rag",onChange:t=>{O(t.target.checked?"rag":"normal")},children:n("common:chatWithCurrentPage")})},{key:3,label:e.jsx($,{checked:ne,onChange:t=>le(t.target.checked),children:n("useOCR")})}]},children:e.jsxs("div",{className:"inline-flex gap-2",children:[h?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"h-5 w-5",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M9 10L4 15 9 20"}),e.jsx("path",{d:"M20 4v7a4 4 0 01-4 4H4"})]}):null,n("common:submit")]})})]})]})]})}),s.errors.message&&e.jsx("div",{className:"text-red-500 text-center text-sm mt-1",children:s.errors.message})]})]})})})})},at=()=>{const[r]=K("hideCurrentChatModelSettings",!1),{clearChat:l,isEmbedding:m,messages:h,streaming:v,selectedSystemPrompt:i,setSelectedSystemPrompt:y,setSelectedQuickPrompt:n,setMessages:j,setHistory:s,setHistoryId:w,setSelectedModel:a,historyId:k,history:p}=P(),{t:o}=D(["sidepanel","common","option"]),[c,g]=d.useState(!1),[S,b]=d.useState(!1);return e.jsxs("div",{className:" px-3 justify-between bg-white dark:bg-[#171717] border-b border-gray-300 dark:border-gray-700 py-4 items-center absolute top-0 z-10 flex h-14 w-full",children:[e.jsxs("div",{className:"focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-700 flex items-center dark:text-white",children:[e.jsx("img",{className:"h-6 w-auto",src:_e,alt:o("common:pageAssist")}),e.jsx("span",{className:"ml-1 text-sm ",children:o("common:pageAssist")})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[m?e.jsx(M,{title:o("tooltip.embed"),children:e.jsx(Ze,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 animate-bounce animate-infinite"})}):null,h.length>0&&!v&&e.jsx("button",{title:o("option:newChat"),onClick:()=>{l()},className:"flex items-center space-x-1 focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-700",children:e.jsx(Xe,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),p.length>0&&e.jsx("button",{title:o("tooltip.clearContext"),onClick:()=>{s([])},className:"flex items-center space-x-1 focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-700",children:e.jsx(ue,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),e.jsx(M,{title:o("tooltip.history"),children:e.jsx("button",{onClick:()=>{b(!0)},className:"flex items-center space-x-1 focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-700",children:e.jsx(Je,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})}),e.jsx(xe,{selectedSystemPrompt:i,setSelectedSystemPrompt:y,setSelectedQuickPrompt:n,className:"text-gray-500 dark:text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors"}),!r&&e.jsx(M,{title:o("common:currentChatModelSettings"),children:e.jsx("button",{onClick:()=>g(!0),className:"text-gray-500 dark:text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:e.jsx(he,{className:"w-5 h-5"})})}),e.jsx(Fe,{to:"/settings",children:e.jsx(fe,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]}),e.jsx(pe,{open:c,setOpen:g}),e.jsx(ye,{title:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center justify-between",children:o("tooltip.history")}),e.jsx("button",{onClick:()=>b(!1),children:e.jsx(Y,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]}),placement:"left",closeIcon:null,onClose:()=>b(!1),open:S,children:e.jsx(be,{isOpen:S,onClose:()=>b(!1),setMessages:j,setHistory:s,setHistoryId:w,setSelectedModel:a,setSelectedSystemPrompt:y,clearChat:l,historyId:k,setSystemPrompt:F=>{},temporaryChat:!1,history:p})})]})},rt=()=>{const r=d.useRef(null),[l,m]=d.useState(),{t:h}=D(["playground"]),[v,i]=d.useState("idle"),{chatMode:y,streaming:n,onSubmit:j,messages:s,setHistory:w,setHistoryId:a,setMessages:k,selectedModel:p}=P(),o=$e(),c=async()=>{if(await Ie()&&s.length===0){const g=await je();g&&(a(g.history.id),w(ke(g.messages)),k(we(g.messages)))}};return d.useEffect(()=>{if(!r.current)return;const g=x=>{x.preventDefault(),x.stopPropagation()},S=x=>{var C,f;if(x.preventDefault(),x.stopPropagation(),i("idle"),!Array.from(((C=x.dataTransfer)==null?void 0:C.files)||[]).every(H=>H.type.startsWith("image/"))){i("error");return}const R=Array.from(((f=x.dataTransfer)==null?void 0:f.files)||[]).slice(0,1);R.length>0&&m(R[0])},b=x=>{x.preventDefault(),x.stopPropagation(),i("dragging")},F=x=>{x.preventDefault(),x.stopPropagation(),i("idle")};return r.current.addEventListener("dragover",g),r.current.addEventListener("drop",S),r.current.addEventListener("dragenter",b),r.current.addEventListener("dragleave",F),()=>{r.current&&(r.current.removeEventListener("dragover",g),r.current.removeEventListener("drop",S),r.current.removeEventListener("dragenter",b),r.current.removeEventListener("dragleave",F))}},[]),d.useEffect(()=>{c()},[]),d.useEffect(()=>{o&&!n&&(p?j({message:o.text,messageType:o.type,image:""}):ve.error({message:h("formError.noModel")}))},[o]),e.jsx("div",{className:"flex h-full w-full",children:e.jsxs("main",{className:"relative h-dvh w-full",children:[e.jsx("div",{className:"relative z-10 w-full",children:e.jsx(at,{})}),e.jsxs("div",{ref:r,className:`relative flex h-full flex-col items-center ${v==="dragging"?"bg-gray-100 dark:bg-gray-800":""} bg-white dark:bg-[#171717]`,children:[e.jsx("div",{className:"custom-scrollbar  flex h-full w-full flex-col items-center overflow-x-hidden overflow-y-auto px-5",children:e.jsx(tt,{})}),e.jsx("div",{className:"absolute bottom-0 w-full",children:e.jsx(st,{dropedFile:l})})]})]})})};export{rt as default};
