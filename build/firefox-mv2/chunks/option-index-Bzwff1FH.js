import{a as V,j as e,R as x,f as R,e as de,r as N}from"./FontSizeProvider-D3enan1E.js";import{B as U,O as me}from"./Layout-_1TcQUPd.js";import"./pdfjs-Dk_2IB0p.js";import{c as ge,u as Q,d as ue,e as xe,h as X,n as fe,g as he,i as pe,s as Y,a as be,x as ye}from"./SaveButton-DmOKJM4n.js";import{a as je,u as ve,g as ke,b as we,d as G,S as Ne,t as J,h as Se,P as Ee,M as Ce}from"./key-down-h5u4x3bU.js";import{h as P,D as Z,g as ee,X as Le,I as Re,E as Ie,a as Te,i as Fe,j as Me,f as De,e as Pe,k as Be,l as Ke}from"./Sidebar-BePlkV0h.js";import{g as Oe}from"./knowledge-VAlMBNOu.js";import{T as S}from"./browser-polyfill-0iagK1yo.js";import{u as He}from"./use-form-CoJzCIEa.js";import{C as te}from"./index-zywBqqSA.js";import{R as Ve}from"./rotate-ccw-CbPYOZAi.js";import{T as We}from"./Trans-BZF7cJyC.js";import"./index-FcDqmjI2.js";import"./chevron-right-CQkEQ8H0.js";import"./elevenlabs-DyuDyElx.js";import"./color-Vokuk9CD.js";import"./index-Ci6F2mfP.js";/**
* @license lucide-react v0.350.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const _e=ge("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Ae=()=>{const{t:s}=V("playground"),{setSelectedKnowledge:r,selectedKnowledge:a}=P(),{data:l}=Q({queryKey:["getAllKnowledge"],queryFn:async()=>await Oe("finished"),refetchInterval:1e3});return e.jsx(e.Fragment,{children:l&&l.length>0&&e.jsx(Z,{menu:{items:(l==null?void 0:l.map(o=>({key:o.id,label:e.jsxs("div",{className:"w-52 gap-2 text-lg truncate inline-flex line-clamp-3  items-center  dark:border-gray-700",children:[e.jsx("div",{children:e.jsx(U,{className:"h-6 w-6 text-gray-400"})}),o.title]}),onClick:()=>{const i=l==null?void 0:l.find(d=>d.id===o.id);(a==null?void 0:a.id)===o.id?r(null):r(i)}})))||[],style:{maxHeight:500,overflowY:"scroll"},className:"no-scrollbar",activeKey:a==null?void 0:a.id},placement:"topLeft",trigger:["click"],children:e.jsx(S,{title:s("tooltip.knowledge"),children:e.jsx("button",{type:"button",className:"dark:text-gray-300",children:e.jsx(U,{className:"h-6 w-6"})})})})})},qe=({dropedFile:s})=>{const{t:r}=V(["playground","common"]),a=x.useRef(null),[l,o]=x.useState(!1),[i]=R("checkWideMode",!1),{onSubmit:d,selectedModel:f,chatMode:u,speechToTextLanguage:j,stopStreamingRequest:w,streaming:k,webSearch:n,setWebSearch:v,selectedQuickPrompt:y,textareaRef:g,setSelectedQuickPrompt:B,selectedKnowledge:h,temporaryChat:p,useOCR:I,setUseOCR:T,defaultInternetSearchOn:m,setHistory:F,history:M}=P(),[E]=R("autoSubmitVoiceMessage",!1),[K]=R("autoStopTimeout",2e3),se=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),C=()=>{g.current&&g.current.selectionStart===g.current.selectionEnd&&(se()?g.current.blur():g.current.focus())},c=He({initialValues:{message:"",image:""}});x.useEffect(()=>{C(),m&&v(!0)},[]),x.useEffect(()=>{m&&v(!0)},[m]);const O=async t=>{if(t instanceof File){const b=await J(t);c.setFieldValue("image",b)}else if(t.target.files){const b=await J(t.target.files[0]);c.setFieldValue("image",b)}},re=t=>{t.clipboardData.files.length>0&&O(t.clipboardData.files[0])};x.useEffect(()=>{s&&O(s)},[s]),je(g,c.values.message,300);const{transcript:W,isListening:D,resetTranscript:ae,start:ne,stop:_,supported:le}=ve({autoStop:E,autoStopTimeout:K,onEnd:async()=>{E&&q()}}),{sendWhenEnter:H,setSendWhenEnter:ie}=ue();x.useEffect(()=>{D&&c.setFieldValue("message",W)},[W]),x.useEffect(()=>{var t;if(y){const b=ke(y);if(c.setFieldValue("message",y),b){(t=g.current)==null||t.focus();const L=setTimeout(()=>{var $;($=g.current)==null||$.setSelectionRange(b.start,b.end),B(null)},100);return()=>{clearInterval(L)}}}},[y]);const oe=de(),{mutateAsync:A}=xe({mutationFn:d,onSuccess:()=>{C(),oe.invalidateQueries({queryKey:["fetchChatHistory"]})},onError:t=>{C()}}),q=()=>{c.onSubmit(async t=>{if(!(t.message.trim().length===0&&t.image.length===0)){if(!f||f.length===0){c.setFieldError("message",r("formError.noModel"));return}if(n){const b=await X(),L=await ee();if(!b&&!L){c.setFieldError("message",r("formError.noEmbeddingModel"));return}}c.reset(),C(),await A({image:t.image,message:t.message.trim()})}})()},ce=t=>{Se({e:t,sendWhenEnter:H,typing:l,isSending:k})&&(t.preventDefault(),z(),q())},z=async()=>{D&&_()};return e.jsx("div",{className:"flex w-full flex-col items-center px-2",children:e.jsx("div",{className:"relative z-10 flex w-full flex-col items-center justify-center gap-2 text-base",children:e.jsx("div",{className:"relative flex w-full flex-row justify-center gap-2 lg:w-3/5",children:e.jsxs("div",{className:` bg-neutral-50  dark:bg-[#2D2D2D] relative w-full max-w-[48rem] p-1 backdrop-blur-lg duration-100 border border-gray-300 rounded-t-xl  dark:border-gray-600
            ${p?"!bg-gray-200 dark:!bg-black ":""}
            ${i?"max-w-none ":""}
            `,children:[e.jsxs("div",{className:`border-b border-gray-200 dark:border-gray-600 relative ${c.values.image.length===0?"hidden":"block"}`,children:[e.jsx("button",{type:"button",onClick:()=>{c.setFieldValue("image","")},className:"absolute top-1 left-1 flex items-center justify-center z-10 bg-white dark:bg-[#2D2D2D] p-0.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-600 text-black dark:text-gray-100",children:e.jsx(Le,{className:"h-4 w-4"})})," ",e.jsx(Re,{src:c.values.image,alt:"Uploaded Image",preview:!1,className:"rounded-md max-h-32"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex  bg-transparent ",children:e.jsxs("form",{onSubmit:c.onSubmit(async t=>{if(z(),!f||f.length===0){c.setFieldError("message",r("formError.noModel"));return}if(n){const b=await X(),L=await ee();if(!b&&!L){c.setFieldError("message",r("formError.noEmbeddingModel"));return}}t.message.trim().length===0&&t.image.length===0||(c.reset(),C(),await A({image:t.image,message:t.message.trim()}))}),className:"shrink-0 flex-grow  flex flex-col items-center ",children:[e.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",ref:a,accept:"image/*",multiple:!1,onChange:O}),e.jsxs("div",{className:"w-full  flex flex-col dark:border-gray-600  px-2 pt-2",children:[e.jsx("textarea",{id:"textarea-message",onCompositionStart:()=>{},onCompositionEnd:()=>{},onKeyDown:t=>ce(t),ref:g,className:"px-2 py-2 w-full resize-none bg-transparent focus-within:outline-none focus:ring-0 focus-visible:ring-0 ring-0 dark:ring-0 border-0 dark:text-gray-100",onPaste:re,rows:1,style:{minHeight:"35px"},tabIndex:0,placeholder:r("form.textarea.placeholder"),...c.getInputProps("message")}),e.jsxs("div",{className:"mt-2 flex justify-between items-center",children:[e.jsx("div",{className:"flex",children:!h&&e.jsx(S,{title:r("tooltip.searchInternet"),children:e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5 dark:text-gray-300 "}),e.jsx(fe,{value:n,onChange:t=>v(t),checkedChildren:r("form.webSearch.on"),unCheckedChildren:r("form.webSearch.off")})]})})}),e.jsxs("div",{className:"flex !justify-end gap-3",children:[M.length>0&&e.jsx(S,{title:r("tooltip.clearContext"),children:e.jsx("button",{type:"button",onClick:()=>{F([])},className:`flex items-center justify-center dark:text-gray-300 ${u==="rag"?"hidden":"block"}`,children:e.jsx(Ie,{className:"h-5 w-5"})})}),!h&&e.jsx(S,{title:r("tooltip.uploadImage"),children:e.jsx("button",{type:"button",onClick:()=>{var t;(t=a.current)==null||t.click()},className:`flex items-center justify-center dark:text-gray-300 ${u==="rag"?"hidden":"block"}`,children:e.jsx(Te,{className:"h-5 w-5"})})}),le&&e.jsx(S,{title:r("tooltip.speechToText"),children:e.jsx("button",{type:"button",onClick:async()=>{D?_():(ae(),ne({continuous:!0,lang:j}))},className:"flex items-center justify-center dark:text-gray-300",children:D?e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-3 w-3 rounded-full bg-red-400 opacity-75"}),e.jsx(G,{className:"h-5 w-5"})]}):e.jsx(G,{className:"h-5 w-5"})})}),e.jsx(Ae,{}),k?e.jsxs(S,{title:r("tooltip.stopStreaming"),children:[e.jsx("button",{type:"button",onClick:w,className:"text-gray-800 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md p-1",children:e.jsx(Ne,{className:"size-5"})})," "]}):e.jsx(Z.Button,{htmlType:"submit",disabled:k,className:"!justify-end !w-auto",icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})}),menu:{items:[{key:1,label:e.jsx(te,{checked:H,onChange:t=>ie(t.target.checked),children:r("sendWhenEnter")})},{key:2,label:e.jsx(te,{checked:I,onChange:t=>T(t.target.checked),children:r("useOCR")})}]},children:e.jsxs("div",{className:"inline-flex gap-2",children:[H?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"h-5 w-5",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M9 10L4 15 9 20"}),e.jsx("path",{d:"M20 4v7a4 4 0 01-4 4H4"})]}):null,r("common:submit")]})})]})]})]})]})}),c.errors.message&&e.jsx("div",{className:"text-red-500 text-center text-sm mt-1",children:c.errors.message})]})]})})})})},ze=()=>{const[s,r]=N.useState(""),{t:a}=V(["playground","common"]),[l]=R("checkOllamaStatus",!0),{data:o,status:i,refetch:d,isRefetching:f}=Q({queryKey:["ollamaStatus"],queryFn:async()=>{const u=await he(),j=await pe();return u&&Y(u),{isOk:j,ollamaURL:u}},enabled:l});return N.useEffect(()=>{o!=null&&o.ollamaURL&&r(o.ollamaURL)},[o]),l?e.jsx("div",{className:"mx-auto sm:max-w-xl px-4 mt-10",children:e.jsxs("div",{className:"rounded-lg justify-center items-center flex flex-col border p-8 bg-gray-50 dark:bg-[#262626]  dark:border-gray-600",children:[(i==="pending"||f)&&e.jsxs("div",{className:"inline-flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),e.jsx("p",{className:"dark:text-gray-400 text-gray-900",children:a("ollamaState.searching")})]}),!f&&i==="success"?o.isOk?e.jsxs("div",{className:"inline-flex  items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsx("p",{className:"dark:text-gray-400 text-gray-900",children:a("ollamaState.running")})]}):e.jsxs("div",{className:"flex flex-col space-y-2 justify-center items-center",children:[e.jsxs("div",{className:"inline-flex  space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx("p",{className:"dark:text-gray-400 text-gray-900",children:a("ollamaState.notRunning")})]}),e.jsx("input",{className:"bg-gray-100 dark:bg-[#262626] dark:text-gray-100 rounded-md px-4 py-2 mt-2 w-full",type:"url",value:s,onChange:u=>r(u.target.value)}),e.jsxs("button",{onClick:()=>{Y(s),d()},className:"inline-flex mt-4 items-center rounded-md border border-transparent bg-black px-2 py-2 text-sm font-medium leading-4 text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:bg-white dark:text-gray-800 dark:hover:bg-gray-100 dark:focus:ring-gray-500 dark:focus:ring-offset-gray-100 disabled:opacity-50 ",children:[e.jsx(Ve,{className:"h-4 w-4 mr-3"}),a("common:retry")]}),s&&be(s)!=="http://127.0.0.1:11434"&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-4 text-center",children:e.jsx(We,{i18nKey:"playground:ollamaState.connectionError",components:{anchor:e.jsx("a",{href:"https://github.com/n4ze3m/page-assist/blob/main/docs/connection-issue.md",target:"__blank",className:"text-blue-600 dark:text-blue-400"})}})})]}):null]})}):e.jsx("div",{className:"mx-auto sm:max-w-xl px-4 mt-10",children:e.jsx("div",{className:"rounded-lg justify-center items-center flex flex-col border p-8 bg-gray-50 dark:bg-[#262626] dark:border-gray-600",children:e.jsxs("h1",{className:"text-sm  font-medium text-center text-gray-500 dark:text-gray-400 flex gap-3 items-center justify-center",children:[e.jsx("span",{children:"\u{1F44B}"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:a("welcome")})]})})})},$e=()=>{const{messages:s,streaming:r,regenerateLastMessage:a,isSearchingInternet:l,editMessage:o,ttsEnabled:i,onSubmit:d}=P(),[f,u]=x.useState(!1),[j,w]=x.useState(null),[k]=R("openReasoning",!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative flex w-full flex-col items-center pt-16 pb-4",children:[s.length===0&&e.jsx("div",{className:"mt-32 w-full",children:e.jsx(ze,{})}),s.map((n,v)=>e.jsx(Ee,{isBot:n.isBot,message:n.message,name:n.name,images:n.images||[],currentMessageIndex:v,totalMessages:s.length,onRengerate:a,isProcessing:r,isSearchingInternet:l,sources:n.sources,onEditFormSubmit:(y,g)=>{o(v,y,!n.isBot,g)},onSourceClick:y=>{w(y),u(!0)},isTTSEnabled:i,generationInfo:n==null?void 0:n.generationInfo,isStreaming:r,reasoningTimeTaken:n==null?void 0:n.reasoning_time_taken,openReasoning:k,modelImage:n==null?void 0:n.modelImage,modelName:n==null?void 0:n.modelName,onContinue:()=>{d({image:"",message:"",isContinue:!0})}},v))]}),e.jsx("div",{className:"w-full pb-[157px]"}),e.jsx(Ce,{open:f,setOpen:u,source:j})]})},Ue=(s,r)=>{const a=N.useRef(null),[l,o]=N.useState(!0);return N.useEffect(()=>{const i=a.current;if(!i)return;const d=()=>{const{scrollTop:f,scrollHeight:u,clientHeight:j}=i;o(u-f-j<50)};return i.addEventListener("scroll",d),()=>i.removeEventListener("scroll",d)},[]),N.useEffect(()=>{var i;if(s.length===0){o(!0);return}if(l&&a.current){const d=r?{behavior:"smooth",block:"end"}:{behavior:"auto",block:"end"};(i=a.current.lastElementChild)==null||i.scrollIntoView(d)}},[s,r,l]),{containerRef:a,isAtBottom:l,scrollToBottom:()=>{var i,d;(d=(i=a.current)==null?void 0:i.lastElementChild)==null||d.scrollIntoView({behavior:"smooth",block:"end"})}}},Qe=()=>{const s=x.useRef(null),[r,a]=x.useState(),{selectedKnowledge:l,messages:o,setHistoryId:i,setHistory:d,setMessages:f,setSelectedSystemPrompt:u,streaming:j}=P(),{setSystemPrompt:w}=Fe(),{containerRef:k,isAtBottom:n,scrollToBottom:v}=Ue(o,j),[y,g]=x.useState("idle");x.useEffect(()=>{if(l||!s.current)return;const h=m=>{m.preventDefault(),m.stopPropagation()},p=m=>{var M,E;if(m.preventDefault(),m.stopPropagation(),g("idle"),!Array.from(((M=m.dataTransfer)==null?void 0:M.files)||[]).every(K=>K.type.startsWith("image/"))){g("error");return}const F=Array.from(((E=m.dataTransfer)==null?void 0:E.files)||[]).slice(0,1);F.length>0&&a(F[0])},I=m=>{m.preventDefault(),m.stopPropagation(),g("dragging")},T=m=>{m.preventDefault(),m.stopPropagation(),g("idle")};return s.current.addEventListener("dragover",h),s.current.addEventListener("drop",p),s.current.addEventListener("dragenter",I),s.current.addEventListener("dragleave",T),()=>{s.current&&(s.current.removeEventListener("dragover",h),s.current.removeEventListener("drop",p),s.current.removeEventListener("dragenter",I),s.current.removeEventListener("dragleave",T))}},[l]);const B=async()=>{if(await ye()&&o.length===0){const h=await Me();if(h){i(h.history.id),d(De(h.messages)),f(Pe(h.messages));const p=await Be(h.history.id);p&&(p.prompt_id&&await Ke(p.prompt_id)&&(u(p.prompt_id),w(p.prompt_content)),w(p.prompt_content))}}};return x.useEffect(()=>{B()},[]),e.jsxs("div",{ref:s,className:`relative flex h-full flex-col items-center ${y==="dragging"?"bg-gray-100 dark:bg-gray-800":""} bg-white dark:bg-[#171717]`,children:[e.jsx("div",{ref:k,className:"custom-scrollbar flex h-full w-full flex-col items-center overflow-x-hidden overflow-y-auto px-5",children:e.jsx($e,{})}),e.jsxs("div",{className:"absolute bottom-0 w-full",children:[!n&&e.jsx("div",{className:"fixed bottom-28 z-20 left-0 right-0 flex justify-center",children:e.jsx("button",{onClick:v,className:"bg-gray-50 shadow border border-gray-200 dark:border-none dark:bg-white/20 p-1.5 rounded-full pointer-events-auto",children:e.jsx(_e,{className:"size-4 text-gray-600 dark:text-gray-300"})})}),e.jsx(qe,{dropedFile:r})]})]})},Xe=()=>e.jsx(me,{children:e.jsx(Qe,{})});export{Xe as default};
