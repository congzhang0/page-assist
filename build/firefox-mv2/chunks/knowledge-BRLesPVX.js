var E=Object.defineProperty;var f=(c,s,a)=>s in c?E(c,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[s]=a;var n=(c,s,a)=>(f(c,typeof s!="symbol"?s+"":s,a),a);import{af as _,ag as A,__tla as P}from"./Sidebar-uBkE2MHz.js";let m,u,w,h,y,g,x,b,d,k=Promise.all([(()=>{try{return P}catch{}})()]).then(async()=>{const c=()=>"pa_knowledge_xxxx-xxxx-xxx-xxxx".replace(/[x]/g,()=>Math.floor(Math.random()*16).toString(16));class s{constructor(){n(this,"db");n(this,"getAll",async()=>new Promise((t,e)=>{this.db.get(null,r=>{if(chrome.runtime.lastError)e(chrome.runtime.lastError);else{const o=Object.keys(r).map(i=>r[i]);t(o)}})}));n(this,"getById",async t=>new Promise((e,r)=>{this.db.get(t,o=>{chrome.runtime.lastError?r(chrome.runtime.lastError):e(o[t])})}));n(this,"create",async t=>new Promise((e,r)=>{this.db.set({[t.id]:t},()=>{chrome.runtime.lastError?r(chrome.runtime.lastError):e()})}));n(this,"update",async t=>new Promise((e,r)=>{this.db.set({[t.id]:t},()=>{chrome.runtime.lastError?r(chrome.runtime.lastError):e()})}));n(this,"delete",async t=>new Promise((e,r)=>{this.db.remove(t,()=>{chrome.runtime.lastError?r(chrome.runtime.lastError):e()})}));n(this,"deleteSource",async(t,e)=>new Promise((r,o)=>{this.db.get(t,i=>{if(chrome.runtime.lastError)o(chrome.runtime.lastError);else{const l=i[t];l.source=l.source.filter(p=>p.source_id!==e),this.db.set({[t]:l},()=>{chrome.runtime.lastError?o(chrome.runtime.lastError):r()})}})}));this.db=chrome.storage.local}}w=async({source:a,title:t,embedding_model:e})=>{const r=new s,o={id:c(),title:t,db_type:"knowledge",source:a,status:"pending",knownledge:{},embedding_model:e,createdAt:Date.now()};return await r.create(o),o},m=async a=>new s().getById(a),d=async(a,t)=>{var o;const e=new s,r=await e.getById(a);t==="finished"&&(r.source=(o=r==null?void 0:r.source)==null?void 0:o.map(i=>({...i,content:void 0}))),await e.update({...r,status:t})},u=async(a,t)=>{await d(a,"processing");const e=new s,r=await e.getById(a);await e.update({...r,source:[...r.source,...t]})},x=async a=>{const t=await new s().getAll();return a?t.filter(e=>(e==null?void 0:e.db_type)==="knowledge").filter(e=>(e==null?void 0:e.status)===a).map(e=>(e.source.forEach(r=>{delete r.content}),e)).sort((e,r)=>r.createdAt-e.createdAt):t.filter(e=>(e==null?void 0:e.db_type)==="knowledge").map(e=>(e==null||e.source.forEach(r=>{delete r.content}),e)).sort((e,r)=>r.createdAt-e.createdAt)},g=async a=>{await new s().delete(a),await A(`vector:${a}`)},h=async(a,t)=>{await new s().deleteSource(a,t),await _(`vector:${a}`,t)},y=async()=>await new s().getAll(),b=async a=>{const t=new s;for(const e of a)await t.create(e)}});export{k as __tla,m as a,u as b,w as c,h as d,y as e,g as f,x as g,b as i,d as u};
