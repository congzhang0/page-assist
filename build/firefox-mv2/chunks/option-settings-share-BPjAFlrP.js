import{e as w,a as S,f as k,j as e}from"./FontSizeProvider-D3enan1E.js";import{S as v}from"./SettingsOptionLayout-s4bKEO4h.js";import{O as N}from"./Layout-_1TcQUPd.js";import"./pdfjs-Dk_2IB0p.js";import{Y as m,a as _,u as I,e as c,S as T,F as n,k as q,n as E,T as F,Z as K,_ as h}from"./SaveButton-DmOKJM4n.js";import{$ as C,a0 as O,a1 as P}from"./Sidebar-BePlkV0h.js";import{T as $}from"./Trans-BZF7cJyC.js";import{I as Q,T as z}from"./browser-polyfill-0iagK1yo.js";import{T as M}from"./Table-BtJuQl0B.js";import{s as i}from"./index-FcDqmjI2.js";import"./chevron-right-CQkEQ8H0.js";import"./index-zywBqqSA.js";import"./index-Ci6F2mfP.js";import"./index-C5awg_Th.js";import"./index-AkKl93ew.js";const U=async t=>{const a=await m(`${_(t)}/api/v1/ping`);if(!a.ok)throw new Error("Unable to verify page share");return await a.text()==="pong"},D=()=>{const t=w(),{t:a}=S(["settings"]),[l,u]=k("shareMode",!1),{status:o,data:d}=I({queryKey:["fetchShareInfo"],queryFn:async()=>{const[r,s]=await Promise.all([K(),C()]);return{url:r,shares:s}}}),x=async r=>{l?await U(r.url)&&await h(r.url):await h(r.url)},g=async({api_url:r,share_id:s,id:j})=>{const y=await O();if(!(await m(`${r}/api/v1/share/delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({share_id:s,owner_id:y})})).ok)throw new Error("Failed to delete share link");return await P(j),"ok"},{mutate:b,isPending:p}=c({mutationFn:x,onSuccess:()=>{t.invalidateQueries({queryKey:["fetchShareInfo"]}),i.success(a("manageShare.notification.pageShareSuccess"))},onError:r=>{i.error((r==null?void 0:r.message)||a("manageShare.notification.someError"))}}),{mutate:f}=c({mutationFn:g,onSuccess:()=>{t.invalidateQueries({queryKey:["fetchShareInfo"]}),i.success(a("manageShare.notification.webShareDeleteSuccess"))},onError:r=>{i.error((r==null?void 0:r.message)||a("manageShare.notification.someError"))}});return e.jsxs("div",{className:"flex flex-col space-y-3",children:[o==="pending"&&e.jsx(T,{paragraph:{rows:4},active:!0}),o==="success"&&e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold leading-7 text-gray-900 dark:text-white",children:a("manageShare.heading")}),e.jsx("div",{className:"border border-b border-gray-200 dark:border-gray-600 mt-3 mb-6"})]}),e.jsxs(n,{layout:"vertical",onFinish:b,initialValues:{url:d.url},children:[e.jsx(n.Item,{name:"url",help:e.jsx($,{i18nKey:"settings:manageShare.form.url.help",components:{anchor:e.jsx("a",{href:"https://github.com/n4ze3m/page-assist/blob/main/page-share.md",target:"__blank",className:"text-blue-600 dark:text-blue-400"})}}),rules:[{required:!0,message:a("manageShare.form.url.required")}],label:a("manageShare.form.url.label"),children:e.jsx(Q,{placeholder:a("manageShare.form.url.placeholder"),size:"large"})}),e.jsx(n.Item,{children:e.jsx("div",{className:"flex justify-end",children:e.jsx(q,{disabled:p,btnType:"submit"})})})]}),e.jsxs("div",{className:"space-y-2 flex mb-4 flex-row items-center justify-between rounded-lg  dark:border-gray-600 ",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{className:"text-sm font-semibold leading-5 text-gray-900 dark:text-white",children:a("manageShare.webshare.label")}),e.jsx("p",{className:"text-sm font-normal leading-5 text-gray-700 dark:text-gray-400",children:a("manageShare.webshare.description")})]}),e.jsx(E,{checked:l,onChange:u})]})]}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold leading-7 text-gray-900 dark:text-white",children:a("manageShare.webshare.heading")}),e.jsx("div",{className:"border border-b border-gray-200 dark:border-gray-600 mt-3 mb-6"})]}),e.jsx("div",{children:e.jsx(M,{dataSource:d.shares,columns:[{title:a("manageShare.webshare.columns.title"),dataIndex:"title",key:"title"},{title:a("manageShare.webshare.columns.url"),dataIndex:"url",key:"url",render:r=>e.jsx("a",{href:r,target:"__blank",className:"text-blue-600 dark:text-blue-400",children:r})},{title:a("manageShare.webshare.columns.actions"),render:(r,s)=>e.jsx(z,{title:a("manageShare.webshare.tooltip.delete"),children:e.jsx("button",{onClick:()=>{window.confirm(a("manageShare.webshare.confirm.delete"))&&f({id:s.id,share_id:s.share_id,api_url:s.api_url})},className:"text-red-500 dark:text-red-400",children:e.jsx(F,{className:"w-5 h-5"})})})}]})})]})]})]})},J=()=>e.jsx(N,{children:e.jsx(v,{children:e.jsx(D,{})})});export{J as default};
