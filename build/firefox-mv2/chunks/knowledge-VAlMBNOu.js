var m=Object.defineProperty;var u=(a,r,e)=>r in a?m(a,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[r]=e;var n=(a,r,e)=>(u(a,typeof r!="symbol"?r+"":r,e),e);import{a9 as w,aa as h}from"./Sidebar-BePlkV0h.js";const g=()=>"pa_knowledge_xxxx-xxxx-xxx-xxxx".replace(/[x]/g,()=>Math.floor(Math.random()*16).toString(16));class o{constructor(){n(this,"db");n(this,"getAll",async()=>new Promise((r,e)=>{this.db.get(null,t=>{if(chrome.runtime.lastError)e(chrome.runtime.lastError);else{const s=Object.keys(t).map(c=>t[c]);r(s)}})}));n(this,"getById",async r=>new Promise((e,t)=>{this.db.get(r,s=>{chrome.runtime.lastError?t(chrome.runtime.lastError):e(s[r])})}));n(this,"create",async r=>new Promise((e,t)=>{this.db.set({[r.id]:r},()=>{chrome.runtime.lastError?t(chrome.runtime.lastError):e()})}));n(this,"update",async r=>new Promise((e,t)=>{this.db.set({[r.id]:r},()=>{chrome.runtime.lastError?t(chrome.runtime.lastError):e()})}));n(this,"delete",async r=>new Promise((e,t)=>{this.db.remove(r,()=>{chrome.runtime.lastError?t(chrome.runtime.lastError):e()})}));n(this,"deleteSource",async(r,e)=>new Promise((t,s)=>{this.db.get(r,c=>{if(chrome.runtime.lastError)s(chrome.runtime.lastError);else{const i=c[r];i.source=i.source.filter(l=>l.source_id!==e),this.db.set({[r]:i},()=>{chrome.runtime.lastError?s(chrome.runtime.lastError):t()})}})}));this.db=chrome.storage.local}}const y=async({source:a,title:r,embedding_model:e})=>{const t=new o,s={id:g(),title:r,db_type:"knowledge",source:a,status:"pending",knownledge:{},embedding_model:e,createdAt:Date.now()};return await t.create(s),s},x=async a=>new o().getById(a),d=async(a,r)=>{var s;const e=new o,t=await e.getById(a);r==="finished"&&(t.source=(s=t==null?void 0:t.source)==null?void 0:s.map(c=>({...c,content:void 0}))),await e.update({...t,status:r})},b=async(a,r)=>{await d(a,"processing");const e=new o,t=await e.getById(a);await e.update({...t,source:[...t.source,...r]})},p=async a=>{const r=await new o().getAll();return a?r.filter(e=>(e==null?void 0:e.db_type)==="knowledge").filter(e=>(e==null?void 0:e.status)===a).map(e=>(e.source.forEach(t=>{delete t.content}),e)).sort((e,t)=>t.createdAt-e.createdAt):r.filter(e=>(e==null?void 0:e.db_type)==="knowledge").map(e=>(e==null||e.source.forEach(t=>{delete t.content}),e)).sort((e,t)=>t.createdAt-e.createdAt)},E=async a=>{await new o().delete(a),await h(`vector:${a}`)},f=async(a,r)=>{await new o().deleteSource(a,r),await w(`vector:${a}`,r)},A=async()=>await new o().getAll(),_=async a=>{const r=new o;for(const e of a)await r.create(e)};export{x as a,b,y as c,f as d,A as e,E as f,p as g,_ as i,d as u};
