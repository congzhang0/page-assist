import{e as k,a as v,f as N,j as e,__tla as I}from"./FontSizeProvider-D4Gh80tw.js";import{S as q,__tla as E}from"./SettingsOptionLayout-gi-p9doQ.js";import{O as F,__tla as T}from"./Layout-B2rmxZ24.js";import{a2 as m,a as K,u as P,e as u,k as C,F as n,D as O,l as D,o as Q,T as z,G as M,a3 as U,a4 as x}from"./SaveButton-Dir2VHfX.js";import{a1 as $,a2 as G,a3 as J,__tla as L}from"./Sidebar-uBkE2MHz.js";import{T as R}from"./Trans-BJZsQOvU.js";import{T as V,__tla as A}from"./Table-IhjToR31.js";import{s as i}from"./chevron-right-CDZTKm5_.js";import"./index-B2Ick9Fr.js";import"./index-DZCUgEun.js";import"./index-Bbm-Nfcp.js";let g,B=Promise.all([(()=>{try{return I}catch{}})(),(()=>{try{return E}catch{}})(),(()=>{try{return T}catch{}})(),(()=>{try{return L}catch{}})(),(()=>{try{return A}catch{}})()]).then(async()=>{let l,o;l=async t=>{const a=await m(`${K(t)}/api/v1/ping`);if(!a.ok)throw new Error("Unable to verify page share");return await a.text()==="pong"},o=()=>{const t=k(),{t:a}=v(["settings"]),[d,b]=N("shareMode",!1),{status:c,data:h}=P({queryKey:["fetchShareInfo"],queryFn:async()=>{const[r,s]=await Promise.all([U(),$()]);return{url:r,shares:s}}}),f=async r=>{d?await l(r.url)&&await x(r.url):await x(r.url)},p=async({api_url:r,share_id:s,id:w})=>{const S=await G();if(!(await m(`${r}/api/v1/share/delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({share_id:s,owner_id:S})})).ok)throw new Error("Failed to delete share link");return await J(w),"ok"},{mutate:y,isPending:_}=u({mutationFn:f,onSuccess:()=>{t.invalidateQueries({queryKey:["fetchShareInfo"]}),i.success(a("manageShare.notification.pageShareSuccess"))},onError:r=>{i.error((r==null?void 0:r.message)||a("manageShare.notification.someError"))}}),{mutate:j}=u({mutationFn:p,onSuccess:()=>{t.invalidateQueries({queryKey:["fetchShareInfo"]}),i.success(a("manageShare.notification.webShareDeleteSuccess"))},onError:r=>{i.error((r==null?void 0:r.message)||a("manageShare.notification.someError"))}});return e.jsxs("div",{className:"flex flex-col space-y-3",children:[c==="pending"&&e.jsx(C,{paragraph:{rows:4},active:!0}),c==="success"&&e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold leading-7 text-gray-900 dark:text-white",children:a("manageShare.heading")}),e.jsx("div",{className:"border border-b border-gray-200 dark:border-gray-600 mt-3 mb-6"})]}),e.jsxs(n,{layout:"vertical",onFinish:y,initialValues:{url:h.url},children:[e.jsx(n.Item,{name:"url",help:e.jsx(R,{i18nKey:"settings:manageShare.form.url.help",components:{anchor:e.jsx("a",{href:"https://github.com/n4ze3m/page-assist/blob/main/page-share.md",target:"__blank",className:"text-blue-600 dark:text-blue-400"})}}),rules:[{required:!0,message:a("manageShare.form.url.required")}],label:a("manageShare.form.url.label"),children:e.jsx(O,{placeholder:a("manageShare.form.url.placeholder"),size:"large"})}),e.jsx(n.Item,{children:e.jsx("div",{className:"flex justify-end",children:e.jsx(D,{disabled:_,btnType:"submit"})})})]}),e.jsxs("div",{className:"space-y-2 flex mb-4 flex-row items-center justify-between rounded-lg  dark:border-gray-600 ",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{className:"text-sm font-semibold leading-5 text-gray-900 dark:text-white",children:a("manageShare.webshare.label")}),e.jsx("p",{className:"text-sm font-normal leading-5 text-gray-700 dark:text-gray-400",children:a("manageShare.webshare.description")})]}),e.jsx(Q,{checked:d,onChange:b})]})]}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold leading-7 text-gray-900 dark:text-white",children:a("manageShare.webshare.heading")}),e.jsx("div",{className:"border border-b border-gray-200 dark:border-gray-600 mt-3 mb-6"})]}),e.jsx("div",{children:e.jsx(V,{dataSource:h.shares,columns:[{title:a("manageShare.webshare.columns.title"),dataIndex:"title",key:"title"},{title:a("manageShare.webshare.columns.url"),dataIndex:"url",key:"url",render:r=>e.jsx("a",{href:r,target:"__blank",className:"text-blue-600 dark:text-blue-400",children:r})},{title:a("manageShare.webshare.columns.actions"),render:(r,s)=>e.jsx(z,{title:a("manageShare.webshare.tooltip.delete"),children:e.jsx("button",{onClick:()=>{window.confirm(a("manageShare.webshare.confirm.delete"))&&j({id:s.id,share_id:s.share_id,api_url:s.api_url})},className:"text-red-500 dark:text-red-400",children:e.jsx(M,{className:"w-5 h-5"})})})}]})})]})]})]})},g=()=>e.jsx(F,{children:e.jsx(q,{children:e.jsx(o,{})})})});export{B as __tla,g as default};
