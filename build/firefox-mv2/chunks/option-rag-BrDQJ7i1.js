import{u as S,R as O,g as b,j as e}from"./FontSizeProvider-BQs3lYNB.js";import{S as R}from"./SettingsOptionLayout-B_5QFEQC.js";import{O as K}from"./Layout-D-T_rSeo.js";import{u as j,S as u,a as N}from"./SaveButton-_URAgOyg.js";import{k as w,F as l,r as z,I as n,t as I,v as B,w as E,x as U,y as v,j as c,z as D,A as T,B as A,C,E as G,G as M,H as Q,J as V,K as H}from"./get-screenshot-dbUggNeo.js";import{R as x}from"./index-DbEmuGSy.js";import{S as L}from"./sidepanel-rag-CCvCXQdo.js";import{A as J,P as W}from"./Sidebar-ChItARQ9.js";import"./Ollama-CeSCS9zP.js";import"./blocks-D1BmLOQx.js";import"./index-DemEzR4a.js";import"./chevron-right-BwZdsrtl.js";import"./index-BfGcxbaB.js";const X=()=>{const{t:a}=S("settings"),[i,d]=O.useState("rag"),p=b(),{status:t,data:o}=j({queryKey:["fetchRagPrompt"],queryFn:async()=>{const[s,g,m]=await Promise.all([B(),E(),U()]);return{prompt:s,webSearchPrompt:g,webSearchFollowUpPrompt:m}}});return e.jsxs("div",{className:"flex flex-col gap-3",children:[t==="pending"&&e.jsx(w,{paragraph:{rows:4},active:!0}),t==="success"&&e.jsxs("div",{children:[e.jsx("div",{className:"my-3 flex justify-end",children:e.jsxs(x.Group,{defaultValue:i,onChange:s=>d(s.target.value),children:[e.jsx(x.Button,{value:"rag",children:"RAG"}),e.jsx(x.Button,{value:"web",children:a("rag.prompt.option2")})]})}),i==="rag"&&e.jsxs(l,{layout:"vertical",onFinish:s=>{z((s==null?void 0:s.systemPrompt)||"",(s==null?void 0:s.questionPrompt)||""),p.invalidateQueries({queryKey:["fetchRagPrompt"]})},initialValues:{systemPrompt:o.prompt.ragPrompt,questionPrompt:o.prompt.ragQuestionPrompt},children:[e.jsx(l.Item,{label:a("managePrompts.systemPrompt"),name:"systemPrompt",rules:[{required:!0,message:"Enter a prompt."}],children:e.jsx(n.TextArea,{value:o.webSearchPrompt,rows:5,placeholder:"Enter a prompt."})}),e.jsx(l.Item,{label:a("managePrompts.questionPrompt"),name:"questionPrompt",rules:[{required:!0,message:"Enter a follow up prompt."}],children:e.jsx(n.TextArea,{value:o.webSearchFollowUpPrompt,rows:5,placeholder:a("rag.prompt.webSearchFollowUpPromptPlaceholder")})}),e.jsxs(l.Item,{children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(u,{btnType:"submit"})})," "]})]}),i==="web"&&e.jsxs(l,{layout:"vertical",onFinish:s=>{I((s==null?void 0:s.webSearchPrompt)||"",(s==null?void 0:s.webSearchFollowUpPrompt)||""),p.invalidateQueries({queryKey:["fetchRagPrompt"]})},initialValues:{webSearchPrompt:o.webSearchPrompt,webSearchFollowUpPrompt:o.webSearchFollowUpPrompt},children:[e.jsx(l.Item,{label:a("rag.prompt.webSearchPrompt"),name:"webSearchPrompt",help:a("rag.prompt.webSearchPromptHelp"),rules:[{required:!0,message:a("rag.prompt.webSearchPromptError")}],children:e.jsx(n.TextArea,{value:o.webSearchPrompt,rows:5,placeholder:a("rag.prompt.webSearchPromptPlaceholder")})}),e.jsx(l.Item,{label:a("rag.prompt.webSearchFollowUpPrompt"),name:"webSearchFollowUpPrompt",help:a("rag.prompt.webSearchFollowUpPromptHelp"),rules:[{required:!0,message:a("rag.prompt.webSearchFollowUpPromptError")}],children:e.jsx(n.TextArea,{value:o.webSearchFollowUpPrompt,rows:5,placeholder:a("rag.prompt.webSearchFollowUpPromptPlaceholder")})}),e.jsxs(l.Item,{children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(u,{btnType:"submit"})})," "]})]})]})]})},Y=()=>{var m;const{t:a}=S("settings"),[i]=l.useForm(),d=l.useWatch("splittingStrategy",i),p=b(),{data:t,status:o}=j({queryKey:["fetchRAGSettings"],queryFn:async()=>{const[r,h,y,P,f,F,q,k]=await Promise.all([T({returnEmpty:!0}),A(),C(),G(),M(),Q(),V(),H()]);return{models:r,chunkOverlap:h,chunkSize:y,defaultEM:P,totalFilePerKB:f,noOfRetrievedDocs:F,splittingStrategy:q,splittingSeparator:k}}}),{mutate:s,isPending:g}=N({mutationFn:async r=>(await D(r.model,r.chunkSize,r.overlap,r.totalFilePerKB,r.noOfRetrievedDocs,r.strategy,r.separator),!0),onSuccess:()=>{p.invalidateQueries({queryKey:["fetchRAGSettings"]})}});return e.jsxs("div",{className:"flex flex-col space-y-3",children:[o==="pending"&&e.jsx(w,{paragraph:{rows:4},active:!0}),o==="success"&&e.jsxs("div",{className:"flex flex-col space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold leading-7 text-gray-900 dark:text-white",children:a("rag.ragSettings.label")}),e.jsx("div",{className:"border border-b border-gray-200 dark:border-gray-600 mt-3 mb-6"})]}),e.jsxs(l,{form:i,layout:"vertical",onFinish:r=>{s({model:r.defaultEM,chunkSize:r.chunkSize,overlap:r.chunkOverlap,totalFilePerKB:r.totalFilePerKB,noOfRetrievedDocs:r.noOfRetrievedDocs,separator:r.splittingSeparator,strategy:r.splittingStrategy})},initialValues:{chunkSize:t==null?void 0:t.chunkSize,chunkOverlap:t==null?void 0:t.chunkOverlap,defaultEM:t==null?void 0:t.defaultEM,totalFilePerKB:t==null?void 0:t.totalFilePerKB,noOfRetrievedDocs:t==null?void 0:t.noOfRetrievedDocs,splittingStrategy:t==null?void 0:t.splittingStrategy,splittingSeparator:t==null?void 0:t.splittingSeparator},children:[e.jsx(l.Item,{name:"defaultEM",label:a("rag.ragSettings.model.label"),help:a("rag.ragSettings.model.help"),rules:[{required:!0,message:a("rag.ragSettings.model.required")}],children:e.jsx(v,{size:"large",showSearch:!0,placeholder:a("rag.ragSettings.model.placeholder"),style:{width:"100%"},className:"mt-4",filterOption:(r,h)=>h.label.key.toLowerCase().indexOf(r.toLowerCase())>=0,options:(m=t.models)==null?void 0:m.map(r=>({label:e.jsxs("span",{className:"flex flex-row gap-3 items-center truncate",children:[r!=null&&r.avatar?e.jsx(J,{src:r.avatar,alt:r.name,size:"small"}):e.jsx(W,{provider:r==null?void 0:r.provider,className:"w-5 h-5"}),e.jsx("span",{className:"truncate",children:(r==null?void 0:r.nickname)||(r==null?void 0:r.name)})]},r.model),value:r.model}))})}),e.jsx(l.Item,{name:"splittingStrategy",label:a("rag.ragSettings.splittingStrategy.label"),rules:[{required:!0,message:a("rag.ragSettings.model.required")}],children:e.jsx(v,{size:"large",showSearch:!0,style:{width:"100%"},className:"mt-4",options:["RecursiveCharacterTextSplitter","CharacterTextSplitter"].map(r=>({label:r,value:r}))})}),d!=="RecursiveCharacterTextSplitter"&&e.jsx(l.Item,{name:"splittingSeparator",label:a("rag.ragSettings.splittingSeparator.label"),rules:[{required:!0,message:a("rag.ragSettings.splittingSeparator.required")}],children:e.jsx(n,{size:"large",style:{width:"100%"},placeholder:a("rag.ragSettings.splittingSeparator.placeholder")})}),e.jsx(l.Item,{name:"chunkSize",label:a("rag.ragSettings.chunkSize.label"),rules:[{required:!0,message:a("rag.ragSettings.chunkSize.required")}],children:e.jsx(c,{style:{width:"100%"},placeholder:a("rag.ragSettings.chunkSize.placeholder")})}),e.jsx(l.Item,{name:"chunkOverlap",label:a("rag.ragSettings.chunkOverlap.label"),rules:[{required:!0,message:a("rag.ragSettings.chunkOverlap.required")}],children:e.jsx(c,{style:{width:"100%"},placeholder:a("rag.ragSettings.chunkOverlap.placeholder")})}),e.jsx(l.Item,{name:"noOfRetrievedDocs",label:a("rag.ragSettings.noOfRetrievedDocs.label"),rules:[{required:!0,message:a("rag.ragSettings.noOfRetrievedDocs.required")}],children:e.jsx(c,{style:{width:"100%"},placeholder:a("rag.ragSettings.noOfRetrievedDocs.placeholder")})}),e.jsx(l.Item,{name:"totalFilePerKB",label:a("rag.ragSettings.totalFilePerKB.label"),rules:[{required:!0,message:a("rag.ragSettings.totalFilePerKB.required")}],children:e.jsx(c,{style:{width:"100%"},min:1,placeholder:a("rag.ragSettings.totalFilePerKB.placeholder")})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(u,{disabled:g,btnType:"submit"})})]})]}),e.jsx(L,{}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold leading-7 text-gray-900 dark:text-white",children:a("rag.prompt.label")}),e.jsx("div",{className:"border border-b border-gray-200 dark:border-gray-600 mt-3 mb-6"})]}),e.jsx(X,{})]})]})]})},Z=()=>e.jsx(K,{children:e.jsx(R,{children:e.jsx(Y,{})})});export{Z as default};
