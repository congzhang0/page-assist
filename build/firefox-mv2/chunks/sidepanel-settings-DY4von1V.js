import{u as J,r as l,j as e,R as p,a as X,h as oe,g as ce}from"./FontSizeProvider-BQs3lYNB.js";import{u as ge,a as xe,S as q}from"./SaveButton-_URAgOyg.js";import{I as f,L as me,T as B,N as w,l as R,O as he,M as se,k as A,P as ue,r as be,Q as pe,R as je,F as I,y as Y,j as re,S as te,z as ve,U as ke,V as ye,v as fe,A as we,B as Ne,C as Se,E as Ce,G as Pe,W as Le}from"./get-screenshot-dbUggNeo.js";import{R as ze,L as Z,E as Me,a as le,T as Oe,g as Te,b as Ee,d as Fe,u as qe,S as Be}from"./SyncSettings-7Tfhbtm7.js";import{D as Re}from"./messages-Vk3juZ78.js";import{P as Ae}from"./index-BYRLfKhV.js";import{s as N}from"./index-DemEzR4a.js";import{u as Ie,S as Ke,a as Qe,T as De,b as _e,M as Ge}from"./sst-settings-IGjlxpiM.js";import{A as Ue}from"./AdvanceOllamaSettings-D-ydLmic.js";import{S as Ve}from"./sidepanel-rag-CCvCXQdo.js";import{R as $}from"./index-DbEmuGSy.js";import{T as He}from"./Trans-Cksffvqj.js";import{l as We}from"./icon-BmsVQuvA.js";import{C as Je,a as Xe}from"./chevron-right-BwZdsrtl.js";import"./elevenlabs-fNYKL-lh.js";import"./use-form-jBR82XuI.js";import"./index-BfGcxbaB.js";const ee=5,Ye=()=>{const{t:a}=J(),[o,x]=l.useState([]),[S,m]=l.useState(!0),[h,u]=l.useState(1),[C,P]=l.useState(0),[b,K]=l.useState(""),[n,L]=l.useState([]),[Q,D]=l.useState([]),[_,j]=l.useState(!1),[z,M]=l.useState(null),[O,T]=l.useState(""),[c,v]=l.useState([]),[d,k]=l.useState(""),[E,F]=l.useState(0),[g,r]=l.useState(""),t=async()=>{try{m(!0);const s=await Te({searchText:b||void 0,tags:n.length>0?n:void 0});P(s.length);const i=(h-1)*ee,ne=i+ee;x(s.slice(i,ne)),m(!1)}catch(s){console.error(a("savedPages.errors.loadFailed","\u52A0\u8F7D\u9875\u9762\u5931\u8D25:"),s),N.error(a("savedPages.messages.loadFailed","\u52A0\u8F7D\u9875\u9762\u5931\u8D25")),m(!1)}},y=async()=>{try{const s=await Ee();D(s)}catch(s){console.error(a("savedPages.errors.loadTagsFailed","\u52A0\u8F7D\u6807\u7B7E\u5931\u8D25:"),s)}};l.useEffect(()=>{t(),y()},[]),l.useEffect(()=>{t()},[b,n,h]);const G=s=>{K(s),u(1)},U=s=>{n.includes(s)?L(n.filter(i=>i!==s)):L([...n,s]),u(1)},V=async s=>{se.confirm({title:a("savedPages.deleteConfirm.title","\u786E\u8BA4\u5220\u9664"),content:a("savedPages.deleteConfirm.content","\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u4FDD\u5B58\u7684\u9875\u9762\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u590D\u3002"),okText:a("savedPages.deleteConfirm.okText","\u5220\u9664"),okType:"danger",cancelText:a("savedPages.deleteConfirm.cancelText","\u53D6\u6D88"),onOk:async()=>{try{await Fe(s),N.success(a("savedPages.messages.deleted","\u9875\u9762\u5DF2\u5220\u9664")),t()}catch(i){console.error(a("savedPages.errors.deleteFailed","\u5220\u9664\u9875\u9762\u5931\u8D25:"),i),N.error(a("savedPages.messages.deleteFailed","\u5220\u9664\u9875\u9762\u5931\u8D25"))}}})},H=s=>{M(s),T(s.title),v(s.tags),k(s.notes||""),F(s.rating||0),j(!0)},W=async()=>{if(z)try{await qe(z.id,{title:O,tags:c,notes:d,rating:E}),N.success(a("savedPages.messages.updated","\u9875\u9762\u5DF2\u66F4\u65B0")),j(!1),t(),y()}catch(s){console.error(a("savedPages.errors.updateFailed","\u66F4\u65B0\u9875\u9762\u5931\u8D25:"),s),N.error(a("savedPages.messages.updateFailed","\u66F4\u65B0\u9875\u9762\u5931\u8D25"))}},ae=()=>{g.trim()&&(c.includes(g)||v([...c,g]),r(""))},de=s=>{v(c.filter(i=>i!==s))},ie=s=>{window.open(s.url,"_blank")};return e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(f.Search,{placeholder:a("savedPages.search.placeholder","\u641C\u7D22\u6807\u9898\u6216\u5185\u5BB9"),allowClear:!0,enterButton:e.jsx(me,{}),onSearch:G,className:"flex-1",size:"small"}),e.jsx(B,{title:a("savedPages.buttons.refresh","\u5237\u65B0"),children:e.jsx(w,{icon:e.jsx(ze,{}),size:"small",className:"ml-1",onClick:()=>t()})})]}),e.jsxs("div",{className:"mt-2 max-h-20 overflow-y-auto",children:[e.jsx("span",{className:"mr-2 text-xs",children:a("savedPages.tagFilter.label","\u6807\u7B7E\u7B5B\u9009:")}),Q.map(s=>e.jsx(R,{color:n.includes(s)?"blue":void 0,className:"cursor-pointer mb-1 text-xs",onClick:()=>U(s),children:s},s))]})]}),e.jsx(Z,{size:"small",loading:S,dataSource:o,renderItem:s=>e.jsx(Z.Item,{className:"border-b border-gray-200 dark:border-gray-700 py-2",actions:[e.jsx(B,{title:a("savedPages.actions.viewOriginal","\u67E5\u770B\u539F\u9875\u9762"),children:e.jsx(w,{size:"small",icon:e.jsx(he,{}),onClick:()=>ie(s)})}),e.jsx(B,{title:a("savedPages.actions.edit","\u7F16\u8F91"),children:e.jsx(w,{size:"small",icon:e.jsx(Me,{}),onClick:()=>H(s)})}),e.jsx(B,{title:a("savedPages.actions.delete","\u5220\u9664"),children:e.jsx(w,{size:"small",danger:!0,icon:e.jsx(Re,{}),onClick:()=>V(s.id)})})],children:e.jsx(Z.Item.Meta,{title:e.jsxs("div",{className:"flex items-center",children:[e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm font-medium truncate max-w-[180px] inline-block",children:s.title}),s.rating>0&&e.jsx(le,{disabled:!0,value:s.rating,className:"ml-1",style:{fontSize:"10px"}})]}),description:e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"text-gray-500 mb-1 truncate max-w-[200px]",children:s.url}),s.summary&&e.jsx("div",{className:"text-gray-700 mb-1 line-clamp-2 text-xs",children:s.summary}),e.jsxs("div",{className:"mb-1 flex flex-wrap",children:[s.tags.slice(0,3).map(i=>e.jsx(R,{color:"blue",className:"mr-1 mb-1 text-xs",children:i},i)),s.tags.length>3&&e.jsxs(R,{className:"text-xs",children:["+",s.tags.length-3]})]}),e.jsx("div",{className:"text-gray-400 text-xs",children:a("savedPages.savedAt","\u4FDD\u5B58\u4E8E {{date}}",{date:new Date(s.createdAt).toLocaleDateString()})})]}),avatar:s.favicon?e.jsx("img",{src:s.favicon,alt:"favicon",className:"w-4 h-4"}):null})},s.id),pagination:!1}),e.jsx("div",{className:"mt-3 flex justify-center",children:e.jsx(Ae,{current:h,pageSize:ee,total:C,onChange:u,size:"small"})}),e.jsxs(se,{title:a("savedPages.editModal.title","\u7F16\u8F91\u9875\u9762\u4FE1\u606F"),open:_,onOk:W,onCancel:()=>j(!1),okText:a("savedPages.editModal.okText","\u4FDD\u5B58"),cancelText:a("savedPages.editModal.cancelText","\u53D6\u6D88"),children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block mb-1 text-sm",children:a("savedPages.editModal.titleLabel","\u6807\u9898")}),e.jsx(f,{value:O,onChange:s=>T(s.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block mb-1 text-sm",children:a("savedPages.editModal.ratingLabel","\u8BC4\u5206")}),e.jsx(le,{value:E,onChange:F})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block mb-1 text-sm",children:a("savedPages.editModal.tagsLabel","\u6807\u7B7E")}),e.jsx("div",{className:"mb-2",children:c.map(s=>e.jsx(R,{closable:!0,onClose:()=>de(s),className:"mb-1",children:s},s))}),e.jsxs(f.Group,{compact:!0,children:[e.jsx(f,{style:{width:"calc(100% - 60px)"},value:g,onChange:s=>r(s.target.value),onPressEnter:ae,placeholder:a("savedPages.editModal.addTagPlaceholder","\u6DFB\u52A0\u6807\u7B7E")}),e.jsx(w,{icon:e.jsx(Oe,{}),onClick:ae})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block mb-1 text-sm",children:a("savedPages.editModal.notesLabel","\u5907\u6CE8")}),e.jsx(f.TextArea,{value:d,onChange:s=>k(s.target.value),rows:3})]})]})]})},Ze=()=>{var g;const{t:a}=J("settings"),[o,x]=p.useState(""),[S,m]=p.useState(""),[h,u]=p.useState(""),[C,P]=p.useState(""),[b,K]=p.useState("normal"),[n,L]=X("copilotResumeLastChat",!1),[Q,D]=X("hideCurrentChatModelSettings",!1),[_,j]=X("speechToTextLanguage","en-US"),{mode:z,toggleDarkMode:M}=oe(),O=ce(),{changeLocale:T,locale:c,supportLanguage:v}=Ie(),{data:d,status:k}=ge({queryKey:["sidebarSettings"],queryFn:async()=>{const[r,t,y,G,U,V,H,W]=await Promise.all([ke(),ye(),fe(),we({returnEmpty:!0}),Ne(),Se(),Ce(),Pe()]);return{url:r,normalSystemPrompt:t,ragSystemPrompt:y.ragPrompt,ragQuestionPrompt:y.ragQuestionPrompt,models:G,chunkOverlap:U,chunkSize:V,defaultEM:H,totalFilePerKB:W}}}),{mutate:E,isPending:F}=xe({mutationFn:async r=>{await ve(r.model,r.chunkSize,r.overlap,d.totalFilePerKB),await O.invalidateQueries({queryKey:["sidebarSettings"]})}});return p.useEffect(()=>{d&&(x(d.url),m(d.normalSystemPrompt),u(d.ragSystemPrompt),P(d.ragQuestionPrompt))},[d]),k==="pending"?e.jsxs("div",{className:"flex flex-col gap-4 p-4",children:[e.jsx(A,{active:!0}),e.jsx(A,{active:!0}),e.jsx(A,{active:!0}),e.jsx(A,{active:!0})]}):k==="error"?e.jsx("div",{children:"Error"}):e.jsxs("div",{className:"flex flex-col gap-4 p-4 max-w-2xl mx-auto lg:max-w-3xl xl:max-w-4xl 2xl:max-w-5xl",children:[e.jsxs("div",{className:"border border-gray-300 dark:border-gray-700 rounded p-4 bg-white dark:bg-[#171717]",children:[e.jsx("h2",{className:"text-md font-semibold dark:text-white",children:a("managePrompts.title")}),e.jsx("div",{className:"my-3 flex justify-end",children:e.jsxs($.Group,{defaultValue:b,onChange:r=>K(r.target.value),children:[e.jsx($.Button,{value:"normal",children:a("managePrompts.option1")}),e.jsx($.Button,{value:"rag",children:a("managePrompts.option2")})]})}),b==="normal"&&e.jsxs("div",{children:[e.jsx("span",{className:"text-md font-thin text-gray-500 dark:text-gray-400",children:a("managePrompts.systemPrompt")}),e.jsx("textarea",{className:"w-full border border-gray-300 dark:border-gray-700 rounded p-2 dark:bg-[#171717] dark:text-white dark:placeholder-gray-400",value:S,onChange:r=>m(r.target.value)}),e.jsx("div",{className:"flex justify-end",children:e.jsx(q,{onClick:()=>{ue(S)}})})]}),b==="rag"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-md font-thin text-gray-500 dark:text-gray-400",children:a("managePrompts.systemPrompt")}),e.jsx("textarea",{className:"w-full border border-gray-300 dark:border-gray-700 rounded p-2 dark:bg-[#171717] dark:text-white dark:placeholder-gray-400",value:h,onChange:r=>u(r.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-md  font-thin text-gray-500 dark:text-gray-400",children:a("managePrompts.questionPrompt")}),e.jsx("textarea",{className:"w-full border border-gray-300 dark:border-gray-700 rounded p-2 dark:bg-[#171717] dark:text-white dark:placeholder-gray-400",value:C,onChange:r=>P(r.target.value)})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(q,{onClick:()=>{be(h,C)}})})]})]}),e.jsx("div",{className:"border border-gray-300 dark:border-gray-700 rounded p-4 bg-white dark:bg-[#171717]",children:e.jsx(Ve,{hideBorder:!0})}),e.jsxs("div",{className:"border flex flex-col gap-4 border-gray-300 dark:border-gray-700 rounded p-4 bg-white dark:bg-[#171717]",children:[e.jsx("h2",{className:"text-md font-semibold dark:text-white",children:a("ollamaSettings.heading")}),e.jsx("input",{className:"w-full border border-gray-300 dark:border-gray-700 rounded p-2 dark:bg-[#171717] dark:text-white dark:placeholder-gray-400",value:o,type:"url",onChange:r=>x(r.target.value),placeholder:a("ollamaSettings.settings.ollamaUrl.placeholder")}),e.jsx(pe,{size:"small",items:[{key:"1",label:e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold leading-7 text-gray-900 dark:text-white",children:a("ollamaSettings.settings.advanced.label")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-4",children:e.jsx(He,{i18nKey:"settings:ollamaSettings.settings.advanced.help",components:{anchor:e.jsx("a",{href:"https://github.com/n4ze3m/page-assist/blob/main/docs/connection-issue.md#solutions",target:"__blank",className:"text-blue-600 dark:text-blue-400"})}})})]}),children:e.jsx(Ue,{})}]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(q,{onClick:()=>{je(o)}})})]}),e.jsxs("div",{className:"border border-gray-300 dark:border-gray-700 rounded p-4 bg-white dark:bg-[#171717]",children:[e.jsx("h2",{className:"text-md mb-4 font-semibold dark:text-white",children:a("rag.ragSettings.label")}),e.jsxs(I,{onFinish:r=>{E({model:r.defaultEM,chunkSize:r.chunkSize,overlap:r.chunkOverlap})},initialValues:{chunkSize:d.chunkSize,chunkOverlap:d.chunkOverlap,defaultEM:d.defaultEM},children:[e.jsx(I.Item,{name:"defaultEM",label:a("rag.ragSettings.model.label"),help:a("rag.ragSettings.model.help"),rules:[{required:!0,message:a("rag.ragSettings.model.required")}],children:e.jsx(Y,{size:"large",filterOption:(r,t)=>t.label.toLowerCase().indexOf(r.toLowerCase())>=0||t.value.toLowerCase().indexOf(r.toLowerCase())>=0,showSearch:!0,placeholder:"Select a model",style:{width:"100%"},className:"mt-4",options:(g=d.models)==null?void 0:g.map(r=>({label:r.name,value:r.model}))})}),e.jsx(I.Item,{name:"chunkSize",label:a("rag.ragSettings.chunkSize.label"),rules:[{required:!0,message:a("rag.ragSettings.chunkSize.required")}],children:e.jsx(re,{style:{width:"100%"},placeholder:a("rag.ragSettings.chunkSize.placeholder")})}),e.jsx(I.Item,{name:"chunkOverlap",label:a("rag.ragSettings.chunkOverlap.label"),rules:[{required:!0,message:a("rag.ragSettings.chunkOverlap.required")}],children:e.jsx(re,{style:{width:"100%"},placeholder:a("rag.ragSettings.chunkOverlap.placeholder")})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(q,{disabled:F,btnType:"submit"})})]})]}),e.jsxs("div",{className:"border space-y-3 w-full border-gray-300 dark:border-gray-700 rounded p-4 bg-white dark:bg-[#171717]",children:[e.jsx("h2",{className:"text-base mb-4 font-semibold leading-7 text-gray-900 dark:text-white",children:a("generalSettings.title")}),e.jsxs("div",{className:"flex flex-col  space-y-4",children:[e.jsx("span",{className:"text-gray-500   dark:text-neutral-50",children:a("generalSettings.settings.copilotResumeLastChat.label")}),e.jsx("div",{children:e.jsx(te,{checked:n,onChange:r=>L(r)})})]}),e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx("div",{className:"inline-flex items-center gap-2",children:e.jsx("span",{className:"text-gray-500   dark:text-neutral-50",children:a("generalSettings.settings.hideCurrentChatModelSettings.label")})}),e.jsx("div",{children:e.jsx(te,{checked:Q,onChange:r=>D(r)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs mb-2  dark:text-white",children:[a("generalSettings.settings.speechRecognitionLang.label")," "]}),e.jsx(Y,{placeholder:a("generalSettings.settings.speechRecognitionLang.placeholder"),allowClear:!0,showSearch:!0,options:Ke,value:_,filterOption:(r,t)=>t.label.toLowerCase().indexOf(r.toLowerCase())>=0||t.value.toLowerCase().indexOf(r.toLowerCase())>=0,onChange:r=>{j(r)},style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs mb-2  dark:text-white",children:[a("generalSettings.settings.language.label")," "]}),e.jsx(Y,{placeholder:a("generalSettings.settings.language.placeholder"),showSearch:!0,options:v,value:c,filterOption:(r,t)=>t.label.toLowerCase().indexOf(r.toLowerCase())>=0||t.value.toLowerCase().indexOf(r.toLowerCase())>=0,onChange:r=>{T(r)},style:{width:"100%"}})]})]}),e.jsx("div",{className:"border border-gray-300 dark:border-gray-700 rounded p-4 bg-white dark:bg-[#171717]",children:e.jsx(Qe,{hideBorder:!0})}),e.jsx("div",{className:"border border-gray-300 dark:border-gray-700 rounded p-4 bg-white dark:bg-[#171717]",children:e.jsx(De,{hideBorder:!0})}),e.jsx("div",{className:"border border-gray-300 dark:border-gray-700 rounded p-4 bg-white dark:bg-[#171717]",children:e.jsx(Be,{})}),e.jsxs("div",{className:"border border-gray-300 dark:border-gray-700 rounded p-4 bg-white dark:bg-[#171717]",children:[e.jsx("h2",{className:"text-md mb-4 font-semibold dark:text-white",children:"\u5DF2\u4FDD\u5B58\u7684\u9875\u9762"}),e.jsx(Ye,{})]}),e.jsxs("div",{className:"border border-gray-300 dark:border-gray-700 rounded p-4 bg-white dark:bg-[#171717]",children:[e.jsxs("h2",{className:"text-md mb-4 font-semibold dark:text-white",children:[a("generalSettings.settings.darkMode.label")," "]}),z==="dark"?e.jsxs("button",{onClick:M,className:"select-none inline-flex text-center w-full rounded-lg border border-gray-900 py-3 px-6 justify-center font-sans text-xs font-bold uppercase text-gray-900 transition-all hover:opacity-75 focus:ring focus:ring-gray-300 active:opacity-[0.85] disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none dark:border-gray-100 dark:text-white dark:hover:opacity-75 dark:focus:ring-dark dark:active:opacity-75 dark:disabled:pointer-events-none dark:disabled:opacity-50 dark:disabled:shadow-none",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),a("generalSettings.settings.darkMode.options.light")]}):e.jsxs("button",{onClick:M,className:"select-none inline-flex text-center w-full rounded-lg border border-gray-900 py-3 px-6 justify-center font-sans text-xs font-bold uppercase text-gray-900 transition-all hover:opacity-75 focus:ring focus:ring-gray-300 active:opacity-[0.85] disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none dark:border-gray-100 dark:text-white dark:hover:opacity-75 dark:focus:ring-dark dark:active:opacity-75 dark:disabled:pointer-events-none dark:disabled:opacity-50 dark:disabled:shadow-none",children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),a("generalSettings.settings.darkMode.options.dark")]})]})]})},$e=()=>{const{t:a,i18n:o}=J("common"),x=(o==null?void 0:o.dir())==="rtl";return e.jsxs("div",{className:"flex px-3 justify-start gap-3 bg-white dark:bg-[#171717] border-b border-gray-300 dark:border-gray-700  py-4 items-center",children:[e.jsx(Le,{to:"/",children:x?e.jsx(Je,{className:"h-5 w-5 text-gray-500"}):e.jsx(Xe,{className:"h-5 w-5 text-gray-500"})}),e.jsxs("div",{className:"focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-700 flex items-center dark:text-white",children:[e.jsx("img",{className:"h-6 w-auto",src:We,alt:a("pageAssist")}),e.jsx("span",{className:"ml-1 text-sm ",children:a("pageAssist")})]})]})},ea=()=>e.jsxs("div",{className:"flex bg-neutral-50 dark:bg-[#171717] flex-col min-h-screen mx-auto max-w-7xl",children:[e.jsx("div",{className:"sticky bg-white dark:bg-[#171717] top-0 z-10",children:e.jsx($e,{})}),e.jsx(Ze,{})]});export{ea as default};
