import{a as j,R as N,e as w,j as e,__tla as K}from"./FontSizeProvider-D4Gh80tw.js";import{S as z,__tla as I}from"./SettingsOptionLayout-gi-p9doQ.js";import{O as B,__tla as U}from"./Layout-B2rmxZ24.js";import{u as y,k as v,F as s,n as D,D as n,l as u,am as E,r as T,an as A,ao as C,e as M,S as P,I as m,p as G,t as Q,v as V,w as H,h as L,x as W,ap as J,aq as X,ar as Y}from"./SaveButton-Dir2VHfX.js";import{R as x}from"./index-Bbm-Nfcp.js";import{S as Z}from"./sidepanel-rag-CElb1OW1.js";import{A as $,ai as ee,__tla as re}from"./Sidebar-uBkE2MHz.js";import"./chevron-right-CDZTKm5_.js";import"./index-DZCUgEun.js";let f,ae=Promise.all([(()=>{try{return K}catch{}})(),(()=>{try{return I}catch{}})(),(()=>{try{return U}catch{}})(),(()=>{try{return re}catch{}})()]).then(async()=>{let S,b;S=()=>{const{t:a}=j("settings"),[i,d]=N.useState("rag"),p=w(),{status:t,data:o}=y({queryKey:["fetchRagPrompt"],queryFn:async()=>{const[l,g,c]=await Promise.all([T(),A(),C()]);return{prompt:l,webSearchPrompt:g,webSearchFollowUpPrompt:c}}});return e.jsxs("div",{className:"flex flex-col gap-3",children:[t==="pending"&&e.jsx(v,{paragraph:{rows:4},active:!0}),t==="success"&&e.jsxs("div",{children:[e.jsx("div",{className:"my-3 flex justify-end",children:e.jsxs(x.Group,{defaultValue:i,onChange:l=>d(l.target.value),children:[e.jsx(x.Button,{value:"rag",children:"RAG"}),e.jsx(x.Button,{value:"web",children:a("rag.prompt.option2")})]})}),i==="rag"&&e.jsxs(s,{layout:"vertical",onFinish:l=>{D((l==null?void 0:l.systemPrompt)||"",(l==null?void 0:l.questionPrompt)||""),p.invalidateQueries({queryKey:["fetchRagPrompt"]})},initialValues:{systemPrompt:o.prompt.ragPrompt,questionPrompt:o.prompt.ragQuestionPrompt},children:[e.jsx(s.Item,{label:a("managePrompts.systemPrompt"),name:"systemPrompt",rules:[{required:!0,message:"Enter a prompt."}],children:e.jsx(n.TextArea,{value:o.webSearchPrompt,rows:5,placeholder:"Enter a prompt."})}),e.jsx(s.Item,{label:a("managePrompts.questionPrompt"),name:"questionPrompt",rules:[{required:!0,message:"Enter a follow up prompt."}],children:e.jsx(n.TextArea,{value:o.webSearchFollowUpPrompt,rows:5,placeholder:a("rag.prompt.webSearchFollowUpPromptPlaceholder")})}),e.jsxs(s.Item,{children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(u,{btnType:"submit"})})," "]})]}),i==="web"&&e.jsxs(s,{layout:"vertical",onFinish:l=>{E((l==null?void 0:l.webSearchPrompt)||"",(l==null?void 0:l.webSearchFollowUpPrompt)||""),p.invalidateQueries({queryKey:["fetchRagPrompt"]})},initialValues:{webSearchPrompt:o.webSearchPrompt,webSearchFollowUpPrompt:o.webSearchFollowUpPrompt},children:[e.jsx(s.Item,{label:a("rag.prompt.webSearchPrompt"),name:"webSearchPrompt",help:a("rag.prompt.webSearchPromptHelp"),rules:[{required:!0,message:a("rag.prompt.webSearchPromptError")}],children:e.jsx(n.TextArea,{value:o.webSearchPrompt,rows:5,placeholder:a("rag.prompt.webSearchPromptPlaceholder")})}),e.jsx(s.Item,{label:a("rag.prompt.webSearchFollowUpPrompt"),name:"webSearchFollowUpPrompt",help:a("rag.prompt.webSearchFollowUpPromptHelp"),rules:[{required:!0,message:a("rag.prompt.webSearchFollowUpPromptError")}],children:e.jsx(n.TextArea,{value:o.webSearchFollowUpPrompt,rows:5,placeholder:a("rag.prompt.webSearchFollowUpPromptPlaceholder")})}),e.jsxs(s.Item,{children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(u,{btnType:"submit"})})," "]})]})]})]})},b=()=>{var c;const{t:a}=j("settings"),[i]=s.useForm(),d=s.useWatch("splittingStrategy",i),p=w(),{data:t,status:o}=y({queryKey:["fetchRAGSettings"],queryFn:async()=>{const[r,h,q,F,k,_,O,R]=await Promise.all([Q({returnEmpty:!0}),V(),H(),L(),W(),J(),X(),Y()]);return{models:r,chunkOverlap:h,chunkSize:q,defaultEM:F,totalFilePerKB:k,noOfRetrievedDocs:_,splittingStrategy:O,splittingSeparator:R}}}),{mutate:l,isPending:g}=M({mutationFn:async r=>(await G(r.model,r.chunkSize,r.overlap,r.totalFilePerKB,r.noOfRetrievedDocs,r.strategy,r.separator),!0),onSuccess:()=>{p.invalidateQueries({queryKey:["fetchRAGSettings"]})}});return e.jsxs("div",{className:"flex flex-col space-y-3",children:[o==="pending"&&e.jsx(v,{paragraph:{rows:4},active:!0}),o==="success"&&e.jsxs("div",{className:"flex flex-col space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold leading-7 text-gray-900 dark:text-white",children:a("rag.ragSettings.label")}),e.jsx("div",{className:"border border-b border-gray-200 dark:border-gray-600 mt-3 mb-6"})]}),e.jsxs(s,{form:i,layout:"vertical",onFinish:r=>{l({model:r.defaultEM,chunkSize:r.chunkSize,overlap:r.chunkOverlap,totalFilePerKB:r.totalFilePerKB,noOfRetrievedDocs:r.noOfRetrievedDocs,separator:r.splittingSeparator,strategy:r.splittingStrategy})},initialValues:{chunkSize:t==null?void 0:t.chunkSize,chunkOverlap:t==null?void 0:t.chunkOverlap,defaultEM:t==null?void 0:t.defaultEM,totalFilePerKB:t==null?void 0:t.totalFilePerKB,noOfRetrievedDocs:t==null?void 0:t.noOfRetrievedDocs,splittingStrategy:t==null?void 0:t.splittingStrategy,splittingSeparator:t==null?void 0:t.splittingSeparator},children:[e.jsx(s.Item,{name:"defaultEM",label:a("rag.ragSettings.model.label"),help:a("rag.ragSettings.model.help"),rules:[{required:!0,message:a("rag.ragSettings.model.required")}],children:e.jsx(P,{size:"large",showSearch:!0,placeholder:a("rag.ragSettings.model.placeholder"),style:{width:"100%"},className:"mt-4",filterOption:(r,h)=>h.label.key.toLowerCase().indexOf(r.toLowerCase())>=0,options:(c=t.models)==null?void 0:c.map(r=>({label:e.jsxs("span",{className:"flex flex-row gap-3 items-center truncate",children:[r!=null&&r.avatar?e.jsx($,{src:r.avatar,alt:r.name,size:"small"}):e.jsx(ee,{provider:r==null?void 0:r.provider,className:"w-5 h-5"}),e.jsx("span",{className:"truncate",children:(r==null?void 0:r.nickname)||(r==null?void 0:r.name)})]},r.model),value:r.model}))})}),e.jsx(s.Item,{name:"splittingStrategy",label:a("rag.ragSettings.splittingStrategy.label"),rules:[{required:!0,message:a("rag.ragSettings.model.required")}],children:e.jsx(P,{size:"large",showSearch:!0,style:{width:"100%"},className:"mt-4",options:["RecursiveCharacterTextSplitter","CharacterTextSplitter"].map(r=>({label:r,value:r}))})}),d!=="RecursiveCharacterTextSplitter"&&e.jsx(s.Item,{name:"splittingSeparator",label:a("rag.ragSettings.splittingSeparator.label"),rules:[{required:!0,message:a("rag.ragSettings.splittingSeparator.required")}],children:e.jsx(n,{size:"large",style:{width:"100%"},placeholder:a("rag.ragSettings.splittingSeparator.placeholder")})}),e.jsx(s.Item,{name:"chunkSize",label:a("rag.ragSettings.chunkSize.label"),rules:[{required:!0,message:a("rag.ragSettings.chunkSize.required")}],children:e.jsx(m,{style:{width:"100%"},placeholder:a("rag.ragSettings.chunkSize.placeholder")})}),e.jsx(s.Item,{name:"chunkOverlap",label:a("rag.ragSettings.chunkOverlap.label"),rules:[{required:!0,message:a("rag.ragSettings.chunkOverlap.required")}],children:e.jsx(m,{style:{width:"100%"},placeholder:a("rag.ragSettings.chunkOverlap.placeholder")})}),e.jsx(s.Item,{name:"noOfRetrievedDocs",label:a("rag.ragSettings.noOfRetrievedDocs.label"),rules:[{required:!0,message:a("rag.ragSettings.noOfRetrievedDocs.required")}],children:e.jsx(m,{style:{width:"100%"},placeholder:a("rag.ragSettings.noOfRetrievedDocs.placeholder")})}),e.jsx(s.Item,{name:"totalFilePerKB",label:a("rag.ragSettings.totalFilePerKB.label"),rules:[{required:!0,message:a("rag.ragSettings.totalFilePerKB.required")}],children:e.jsx(m,{style:{width:"100%"},min:1,placeholder:a("rag.ragSettings.totalFilePerKB.placeholder")})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(u,{disabled:g,btnType:"submit"})})]})]}),e.jsx(Z,{}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold leading-7 text-gray-900 dark:text-white",children:a("rag.prompt.label")}),e.jsx("div",{className:"border border-b border-gray-200 dark:border-gray-600 mt-3 mb-6"})]}),e.jsx(S,{})]})]})]})},f=()=>e.jsx(B,{children:e.jsx(z,{children:e.jsx(b,{})})})});export{ae as __tla,f as default};
