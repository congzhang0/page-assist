var _background=function(){"use strict";function _mergeNamespaces(e,t){for(var s=0;s<t.length;s++){const n=t[s];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in e)){const r=Object.getOwnPropertyDescriptor(n,i);r&&Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}function defineBackground(e){return e==null||typeof e=="function"?{main:e}:e}let currentLogLevel=1;const setLogLevel=e=>{currentLogLevel=e},formatLogMessage=(e,t,s)=>{const i=`[${new Date().toISOString()}] [${e}] [Page-Assist]`;if(s!==void 0)try{const r=typeof s=="object"?JSON.stringify(s):String(s);return`${i} ${t} - ${r}`}catch{return`${i} ${t} - [无法序列化的数据]`}return`${i} ${t}`},debug=(e,t)=>{currentLogLevel<=0&&console.debug(formatLogMessage("DEBUG",e,t))},info=(e,t)=>{currentLogLevel<=1&&console.info(formatLogMessage("INFO",e,t))},warn=(e,t)=>{currentLogLevel<=2&&console.warn(formatLogMessage("WARN",e,t))},error=(e,t)=>{currentLogLevel<=3&&(t instanceof Error?console.error(formatLogMessage("ERROR",e,{message:t.message,stack:t.stack,name:t.name})):console.error(formatLogMessage("ERROR",e,t)))},performance=(e,t)=>{currentLogLevel<=0&&(t==="start"?console.time(`⏱️ ${e}`):console.timeEnd(`⏱️ ${e}`))};setLogLevel(2);const logger$1={debug,info,warn,error,performance,setLogLevel};var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var s=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};s.prototype=t.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(s,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),s}var browserPolyfill={exports:{}};(function(e,t){(function(s,n){n(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:commonjsGlobal,function(s){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)s.exports=globalThis.browser;else{const n="The message port closed before a response was received.",i=r=>{const d={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(d).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class f extends WeakMap{constructor(F,H=void 0){super(H),this.createItem=F}get(F){return this.has(F)||this.set(F,this.createItem(F)),super.get(F)}}const m=y=>y&&typeof y=="object"&&typeof y.then=="function",u=(y,F)=>(...H)=>{r.runtime.lastError?y.reject(new Error(r.runtime.lastError.message)):F.singleCallbackArg||H.length<=1&&F.singleCallbackArg!==!1?y.resolve(H[0]):y.resolve(H)},a=y=>y==1?"argument":"arguments",c=(y,F)=>function(U,...Y){if(Y.length<F.minArgs)throw new Error(`Expected at least ${F.minArgs} ${a(F.minArgs)} for ${y}(), got ${Y.length}`);if(Y.length>F.maxArgs)throw new Error(`Expected at most ${F.maxArgs} ${a(F.maxArgs)} for ${y}(), got ${Y.length}`);return new Promise((V,ie)=>{if(F.fallbackToNoCallback)try{U[y](...Y,u({resolve:V,reject:ie},F))}catch(J){console.warn(`${y} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,J),U[y](...Y),F.fallbackToNoCallback=!1,F.noCallback=!0,V()}else F.noCallback?(U[y](...Y),V()):U[y](...Y,u({resolve:V,reject:ie},F))})},T=(y,F,H)=>new Proxy(F,{apply(U,Y,V){return H.call(Y,y,...V)}});let p=Function.call.bind(Object.prototype.hasOwnProperty);const h=(y,F={},H={})=>{let U=Object.create(null),Y={has(ie,J){return J in y||J in U},get(ie,J,ne){if(J in U)return U[J];if(!(J in y))return;let ae=y[J];if(typeof ae=="function")if(typeof F[J]=="function")ae=T(y,y[J],F[J]);else if(p(H,J)){let te=c(J,H[J]);ae=T(y,y[J],te)}else ae=ae.bind(y);else if(typeof ae=="object"&&ae!==null&&(p(F,J)||p(H,J)))ae=h(ae,F[J],H[J]);else if(p(H,"*"))ae=h(ae,F[J],H["*"]);else return Object.defineProperty(U,J,{configurable:!0,enumerable:!0,get(){return y[J]},set(te){y[J]=te}}),ae;return U[J]=ae,ae},set(ie,J,ne,ae){return J in U?U[J]=ne:y[J]=ne,!0},defineProperty(ie,J,ne){return Reflect.defineProperty(U,J,ne)},deleteProperty(ie,J){return Reflect.deleteProperty(U,J)}},V=Object.create(y);return new Proxy(V,Y)},_=y=>({addListener(F,H,...U){F.addListener(y.get(H),...U)},hasListener(F,H){return F.hasListener(y.get(H))},removeListener(F,H){F.removeListener(y.get(H))}}),I=new f(y=>typeof y!="function"?y:function(H){const U=h(H,{},{getContent:{minArgs:0,maxArgs:0}});y(U)}),A=new f(y=>typeof y!="function"?y:function(H,U,Y){let V=!1,ie,J=new Promise(G=>{ie=function(N){V=!0,G(N)}}),ne;try{ne=y(H,U,ie)}catch(G){ne=Promise.reject(G)}const ae=ne!==!0&&m(ne);if(ne!==!0&&!ae&&!V)return!1;const te=G=>{G.then(N=>{Y(N)},N=>{let b;N&&(N instanceof Error||typeof N.message=="string")?b=N.message:b="An unexpected error occurred",Y({__mozWebExtensionPolyfillReject__:!0,message:b})}).catch(N=>{console.error("Failed to send onMessage rejected reply",N)})};return te(ae?ne:J),!0}),O=({reject:y,resolve:F},H)=>{r.runtime.lastError?r.runtime.lastError.message===n?F():y(new Error(r.runtime.lastError.message)):H&&H.__mozWebExtensionPolyfillReject__?y(new Error(H.message)):F(H)},w=(y,F,H,...U)=>{if(U.length<F.minArgs)throw new Error(`Expected at least ${F.minArgs} ${a(F.minArgs)} for ${y}(), got ${U.length}`);if(U.length>F.maxArgs)throw new Error(`Expected at most ${F.maxArgs} ${a(F.maxArgs)} for ${y}(), got ${U.length}`);return new Promise((Y,V)=>{const ie=O.bind(null,{resolve:Y,reject:V});U.push(ie),H.sendMessage(...U)})},P={devtools:{network:{onRequestFinished:_(I)}},runtime:{onMessage:_(A),onMessageExternal:_(A),sendMessage:w.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:w.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},C={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return d.privacy={network:{"*":C},services:{"*":C},websites:{"*":C}},h(r,P,d)};s.exports=i(chrome)}})})(browserPolyfill);var browserPolyfillExports=browserPolyfill.exports;const originalBrowser=getDefaultExportFromCjs(browserPolyfillExports),browser=originalBrowser,setTitle=({title:e})=>{browser.browserAction.setTitle({title:e})},setBadgeBackgroundColor=({color:e})=>{browser.browserAction.setBadgeBackgroundColor({color:e})},setBadgeText=({text:e})=>{browser.browserAction.setBadgeText({text:e})},processFunction=(e,t,s,n)=>function(...i){const r=t.promiseModule;return new r((d,f)=>{t.multiArgs?i.push((...u)=>{t.errorFirst?u[0]?f(u):(u.shift(),d(u)):d(u)}):t.errorFirst?i.push((u,a)=>{u?f(u):d(a)}):i.push(d),Reflect.apply(e,this===s?n:this,i)})},filterCache=new WeakMap;function pify(e,t){t={exclude:[/.+(?:Sync|Stream)$/],errorFirst:!0,promiseModule:Promise,...t};const s=typeof e;if(!(e!==null&&(s==="object"||s==="function")))throw new TypeError(`Expected \`input\` to be a \`Function\` or \`Object\`, got \`${e===null?"null":s}\``);const n=(d,f)=>{let m=filterCache.get(d);if(m||(m={},filterCache.set(d,m)),f in m)return m[f];const u=h=>typeof h=="string"||typeof f=="symbol"?f===h:h.test(f),a=Reflect.getOwnPropertyDescriptor(d,f),c=a===void 0||a.writable||a.configurable,p=(t.include?t.include.some(h=>u(h)):!t.exclude.some(h=>u(h)))&&c;return m[f]=p,p},i=new WeakMap,r=new Proxy(e,{apply(d,f,m){const u=i.get(d);if(u)return Reflect.apply(u,f,m);const a=t.excludeMain?d:processFunction(d,t,r,d);return i.set(d,a),Reflect.apply(a,f,m)},get(d,f){const m=d[f];if(!n(d,f)||m===Function.prototype[f])return m;const u=i.get(m);if(u)return u;if(typeof m=="function"){const a=processFunction(m,t,r,d);return i.set(m,a),a}return m}});return r}var l=()=>{try{let e=(globalThis.navigator?.userAgent).match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(e[1]==="Chrome")return parseInt(e[2])<100||globalThis.chrome.runtime?.getManifest()?.manifest_version===2}catch{return!1}return!1},o=class{#e;#t;get primaryClient(){return this.#t}#s;get secondaryClient(){return this.#s}#n;get area(){return this.#n}get hasWebApi(){try{return typeof window<"u"&&!!window.localStorage}catch(e){return console.error(e),!1}}#a=new Map;#o;get copiedKeySet(){return this.#o}isCopied=e=>this.hasWebApi&&(this.allCopied||this.copiedKeySet.has(e));#r=!1;get allCopied(){return this.#r}getExtStorageApi=()=>globalThis.browser?.storage||globalThis.chrome?.storage;get hasExtensionApi(){try{return!!this.getExtStorageApi()}catch(e){return console.error(e),!1}}isWatchSupported=()=>this.hasExtensionApi;keyNamespace="";isValidKey=e=>e.startsWith(this.keyNamespace);getNamespacedKey=e=>`${this.keyNamespace}${e}`;getUnnamespacedKey=e=>e.slice(this.keyNamespace.length);constructor({area:e="sync",allCopied:t=!1,copiedKeyList:s=[]}={}){this.setCopiedKeySet(s),this.#n=e,this.#r=t;try{this.hasWebApi&&(t||s.length>0)&&(this.#s=window.localStorage)}catch{}try{this.hasExtensionApi&&(this.#e=this.getExtStorageApi(),l()?this.#t=pify(this.#e[this.area],{exclude:["getBytesInUse"],errorFirst:!1}):this.#t=this.#e[this.area])}catch{}}setCopiedKeySet(e){this.#o=new Set(e)}rawGetAll=()=>this.#t?.get();getAll=async()=>{let e=await this.rawGetAll();return Object.entries(e).filter(([t])=>this.isValidKey(t)).reduce((t,[s,n])=>(t[this.getUnnamespacedKey(s)]=n,t),{})};copy=async e=>{let t=e===void 0;if(!t&&!this.copiedKeySet.has(e)||!this.allCopied||!this.hasExtensionApi)return!1;let s=this.allCopied?await this.rawGetAll():await this.#t.get((t?[...this.copiedKeySet]:[e]).map(this.getNamespacedKey));if(!s)return!1;let n=!1;for(let i in s){let r=s[i],d=this.#s?.getItem(i);this.#s?.setItem(i,r),n||=r!==d}return n};rawGet=async e=>this.hasExtensionApi?(await this.#t.get(e))[e]:this.isCopied(e)?this.#s?.getItem(e):null;rawSet=async(e,t)=>(this.isCopied(e)&&this.#s?.setItem(e,t),this.hasExtensionApi&&await this.#t.set({[e]:t}),null);clear=async(e=!1)=>{e&&this.#s?.clear(),await this.#t.clear()};rawRemove=async e=>{this.isCopied(e)&&this.#s?.removeItem(e),this.hasExtensionApi&&await this.#t.remove(e)};removeAll=async()=>{let e=await this.rawGetAll(),t=Object.keys(e);await Promise.all(t.map(this.rawRemove))};watch=e=>{let t=this.isWatchSupported();return t&&this.#u(e),t};#u=e=>{for(let t in e){let s=this.getNamespacedKey(t),n=this.#a.get(s)?.callbackSet||new Set;if(n.add(e[t]),n.size>1)continue;let i=(r,d)=>{if(d!==this.area||!r[s])return;let f=this.#a.get(s);if(!f)throw new Error(`Storage comms does not exist for nsKey: ${s}`);Promise.all([this.parseValue(r[s].newValue),this.parseValue(r[s].oldValue)]).then(([m,u])=>{for(let a of f.callbackSet)a({newValue:m,oldValue:u},d)})};this.#e.onChanged.addListener(i),this.#a.set(s,{callbackSet:n,listener:i})}};unwatch=e=>{let t=this.isWatchSupported();return t&&this.#c(e),t};#c(e){for(let t in e){let s=this.getNamespacedKey(t),n=e[t],i=this.#a.get(s);i&&(i.callbackSet.delete(n),i.callbackSet.size===0&&(this.#a.delete(s),this.#e.onChanged.removeListener(i.listener)))}}unwatchAll=()=>this.#i();#i(){this.#a.forEach(({listener:e})=>this.#e.onChanged.removeListener(e)),this.#a.clear()}async getItem(e){return this.get(e)}async setItem(e,t){await this.set(e,t)}async removeItem(e){return this.remove(e)}},g=class extends o{get=async e=>{let t=this.getNamespacedKey(e),s=await this.rawGet(t);return this.parseValue(s)};set=async(e,t)=>{let s=this.getNamespacedKey(e),n=JSON.stringify(t);return this.rawSet(s,n)};remove=async e=>{let t=this.getNamespacedKey(e);return this.rawRemove(t)};setNamespace=e=>{this.keyNamespace=e};parseValue=async e=>{try{if(e!==void 0)return JSON.parse(e)}catch(t){console.error(t)}}};const cleanUrl=e=>e.endsWith("/")?e.slice(0,-1):e,storage$2=new g,storage2=new g({area:"local"}),DEFAULT_URL_REWRITE_URL="http://127.0.0.1:11434",isUrlRewriteEnabled=async()=>await storage$2.get("urlRewriteEnabled")??!1,getIsAutoCORSFix=async()=>{try{return await storage2.get("autoCORSFix")??!0}catch{return!0}},getRewriteUrl=async()=>{const e=await storage$2.get("rewriteUrl");return!e||e.trim()===""?DEFAULT_URL_REWRITE_URL:e},getAdvancedOllamaSettings=async()=>{const[e,t,s]=await Promise.all([isUrlRewriteEnabled(),getRewriteUrl(),getIsAutoCORSFix()]);return{isEnableRewriteUrl:e,rewriteUrl:t,autoCORSFix:s}},customOllamaHeaders=async()=>{const e=await storage$2.get("customOllamaHeaders");return e||[]},getCustomOllamaHeaders=async()=>{const e=await customOllamaHeaders(),t={};for(const s of e)t[s.key]=s.value;return t},urlRewriteRuntime=async function(e,t="ollama"){if(browser.runtime&&browser.runtime.id){const{isEnableRewriteUrl:s,rewriteUrl:n,autoCORSFix:i}=await getAdvancedOllamaSettings();if(!i){try{browser.webRequest.onBeforeSendHeaders.removeListener(()=>{})}catch{}return}{const r=new URL(e),d=[`*://${r.hostname}/*`];browser.webRequest.onBeforeSendHeaders.addListener(f=>{let m=`${r.protocol}//${r.hostname}`;s&&n&&t==="ollama"&&(m=n);for(let u=0;u<f.requestHeaders.length;u++)f.requestHeaders[u].name==="Origin"&&(f.requestHeaders[u].value=m);return{requestHeaders:f.requestHeaders}},{urls:d},["blocking","requestHeaders"])}}};new g;const fetcher=async(e,t)=>{const s={...t},n=await getCustomOllamaHeaders();return s.headers={...n,...s?.headers},fetch(e,s)},storage$1=new g;new g({area:"local"});const DEFAULT_OLLAMA_URL="http://127.0.0.1:11434",getOllamaURL=async()=>{const e=await storage$1.get("ollamaURL");return!e||e.length===0?(await urlRewriteRuntime(DEFAULT_OLLAMA_URL),DEFAULT_OLLAMA_URL):(await urlRewriteRuntime(cleanUrl(e)),e)},isOllamaRunning=async()=>{try{const e=await getOllamaURL(),t=await fetcher(`${cleanUrl(e)}`);if(!t.ok)throw new Error(t.statusText);return!0}catch(e){return console.error(e),!1}},progressHuman=(e,t)=>(e/t*100).toFixed(0)+"%",clearBadge=()=>{setBadgeText({text:""}),setTitle({title:""})},streamDownload=async(e,t)=>{e+="/api/pull";const n=(await fetcher(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:t,stream:!0})})).body?.getReader(),i=new TextDecoder;let r=!0;for(;n;){const{done:d,value:f}=await n.read();if(d)break;const m=i.decode(f);try{const u=JSON.parse(m.trim());u.total&&u.completed?(setBadgeText({text:progressHuman(u.completed,u.total)}),setBadgeBackgroundColor({color:"#0000FF"})):(setBadgeText({text:"🏋️‍♂️"}),setBadgeBackgroundColor({color:"#FFFFFF"})),setTitle({title:u.status}),u.status==="success"&&(r=!0)}catch(u){console.error(u)}}r?(setBadgeText({text:"✅"}),setBadgeBackgroundColor({color:"#00FF00"}),setTitle({title:"Model pulled successfully"})):(setBadgeText({text:"❌"}),setBadgeBackgroundColor({color:"#FF0000"}),setTitle({title:"Model pull failed"})),setTimeout(()=>{clearBadge()},5e3)},storage=new g({area:"local"}),getInitialConfig=async()=>{const e=await storage.get("actionIconClick"),t=await storage.get("contextMenuClick");return{actionIconClick:e||"webui",contextMenuClick:t||"sidePanel"}},defaultOpts$2={xml:!1,decodeEntities:!0},xmlModeDefault={_useHtmlParser2:!0,xmlMode:!0};function flatten(e){return e?.xml?typeof e.xml=="boolean"?xmlModeDefault:{...xmlModeDefault,...e.xml}:e??void 0}var ElementType;(function(e){e.Root="root",e.Text="text",e.Directive="directive",e.Comment="comment",e.Script="script",e.Style="style",e.Tag="tag",e.CDATA="cdata",e.Doctype="doctype"})(ElementType||(ElementType={}));function isTag$1(e){return e.type===ElementType.Tag||e.type===ElementType.Script||e.type===ElementType.Style}const Root=ElementType.Root,Text$1=ElementType.Text,Directive=ElementType.Directive,Comment$1=ElementType.Comment,Script=ElementType.Script,Style=ElementType.Style,Tag=ElementType.Tag,CDATA$1=ElementType.CDATA,Doctype=ElementType.Doctype;let Node$1=class{constructor(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}get parentNode(){return this.parent}set parentNode(t){this.parent=t}get previousSibling(){return this.prev}set previousSibling(t){this.prev=t}get nextSibling(){return this.next}set nextSibling(t){this.next=t}cloneNode(t=!1){return cloneNode(this,t)}};class DataNode extends Node$1{constructor(t){super(),this.data=t}get nodeValue(){return this.data}set nodeValue(t){this.data=t}}class Text extends DataNode{constructor(){super(...arguments),this.type=ElementType.Text}get nodeType(){return 3}}class Comment extends DataNode{constructor(){super(...arguments),this.type=ElementType.Comment}get nodeType(){return 8}}class ProcessingInstruction extends DataNode{constructor(t,s){super(s),this.name=t,this.type=ElementType.Directive}get nodeType(){return 1}}class NodeWithChildren extends Node$1{constructor(t){super(),this.children=t}get firstChild(){var t;return(t=this.children[0])!==null&&t!==void 0?t:null}get lastChild(){return this.children.length>0?this.children[this.children.length-1]:null}get childNodes(){return this.children}set childNodes(t){this.children=t}}class CDATA extends NodeWithChildren{constructor(){super(...arguments),this.type=ElementType.CDATA}get nodeType(){return 4}}class Document extends NodeWithChildren{constructor(){super(...arguments),this.type=ElementType.Root}get nodeType(){return 9}}class Element extends NodeWithChildren{constructor(t,s,n=[],i=t==="script"?ElementType.Script:t==="style"?ElementType.Style:ElementType.Tag){super(n),this.name=t,this.attribs=s,this.type=i}get nodeType(){return 1}get tagName(){return this.name}set tagName(t){this.name=t}get attributes(){return Object.keys(this.attribs).map(t=>{var s,n;return{name:t,value:this.attribs[t],namespace:(s=this["x-attribsNamespace"])===null||s===void 0?void 0:s[t],prefix:(n=this["x-attribsPrefix"])===null||n===void 0?void 0:n[t]}})}}function isTag(e){return isTag$1(e)}function isCDATA(e){return e.type===ElementType.CDATA}function isText(e){return e.type===ElementType.Text}function isComment(e){return e.type===ElementType.Comment}function isDirective(e){return e.type===ElementType.Directive}function isDocument(e){return e.type===ElementType.Root}function hasChildren(e){return Object.prototype.hasOwnProperty.call(e,"children")}function cloneNode(e,t=!1){let s;if(isText(e))s=new Text(e.data);else if(isComment(e))s=new Comment(e.data);else if(isTag(e)){const n=t?cloneChildren(e.children):[],i=new Element(e.name,{...e.attribs},n);n.forEach(r=>r.parent=i),e.namespace!=null&&(i.namespace=e.namespace),e["x-attribsNamespace"]&&(i["x-attribsNamespace"]={...e["x-attribsNamespace"]}),e["x-attribsPrefix"]&&(i["x-attribsPrefix"]={...e["x-attribsPrefix"]}),s=i}else if(isCDATA(e)){const n=t?cloneChildren(e.children):[],i=new CDATA(n);n.forEach(r=>r.parent=i),s=i}else if(isDocument(e)){const n=t?cloneChildren(e.children):[],i=new Document(n);n.forEach(r=>r.parent=i),e["x-mode"]&&(i["x-mode"]=e["x-mode"]),s=i}else if(isDirective(e)){const n=new ProcessingInstruction(e.name,e.data);e["x-name"]!=null&&(n["x-name"]=e["x-name"],n["x-publicId"]=e["x-publicId"],n["x-systemId"]=e["x-systemId"]),s=n}else throw new Error(`Not implemented yet: ${e.type}`);return s.startIndex=e.startIndex,s.endIndex=e.endIndex,e.sourceCodeLocation!=null&&(s.sourceCodeLocation=e.sourceCodeLocation),s}function cloneChildren(e){const t=e.map(s=>cloneNode(s,!0));for(let s=1;s<t.length;s++)t[s].prev=t[s-1],t[s-1].next=t[s];return t}const defaultOpts$1={withStartIndices:!1,withEndIndices:!1,xmlMode:!1};class DomHandler{constructor(t,s,n){this.dom=[],this.root=new Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof s=="function"&&(n=s,s=defaultOpts$1),typeof t=="object"&&(s=t,t=void 0),this.callback=t??null,this.options=s??defaultOpts$1,this.elementCB=n??null}onparserinit(t){this.parser=t}onreset(){this.dom=[],this.root=new Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null}onend(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))}onerror(t){this.handleCallback(t)}onclosetag(){this.lastNode=null;const t=this.tagStack.pop();this.options.withEndIndices&&(t.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(t)}onopentag(t,s){const n=this.options.xmlMode?ElementType.Tag:void 0,i=new Element(t,s,void 0,n);this.addNode(i),this.tagStack.push(i)}ontext(t){const{lastNode:s}=this;if(s&&s.type===ElementType.Text)s.data+=t,this.options.withEndIndices&&(s.endIndex=this.parser.endIndex);else{const n=new Text(t);this.addNode(n),this.lastNode=n}}oncomment(t){if(this.lastNode&&this.lastNode.type===ElementType.Comment){this.lastNode.data+=t;return}const s=new Comment(t);this.addNode(s),this.lastNode=s}oncommentend(){this.lastNode=null}oncdatastart(){const t=new Text(""),s=new CDATA([t]);this.addNode(s),t.parent=s,this.lastNode=t}oncdataend(){this.lastNode=null}onprocessinginstruction(t,s){const n=new ProcessingInstruction(t,s);this.addNode(n)}handleCallback(t){if(typeof this.callback=="function")this.callback(t,this.dom);else if(t)throw t}addNode(t){const s=this.tagStack[this.tagStack.length-1],n=s.children[s.children.length-1];this.options.withStartIndices&&(t.startIndex=this.parser.startIndex),this.options.withEndIndices&&(t.endIndex=this.parser.endIndex),s.children.push(t),n&&(t.prev=n,n.next=t),t.parent=s,this.lastNode=null}}const htmlDecodeTree=new Uint16Array('ᵁ<Õıʊҝջאٵ۞ޢߖࠏ੊ઑඡ๭༉༦჊ረዡᐕᒝᓃᓟᔥ\0\0\0\0\0\0ᕫᛍᦍᰒᷝ὾⁠↰⊍⏀⏻⑂⠤⤒ⴈ⹈⿎〖㊺㘹㞬㣾㨨㩱㫠㬮ࠀEMabcfglmnoprstu\\bfms¦³¹ÈÏlig耻Æ䃆P耻&䀦cute耻Á䃁reve;䄂Āiyx}rc耻Â䃂;䐐r;쀀𝔄rave耻À䃀pha;䎑acr;䄀d;橓Āgp¡on;䄄f;쀀𝔸plyFunction;恡ing耻Å䃅Ācs¾Ãr;쀀𝒜ign;扔ilde耻Ã䃃ml耻Ä䃄ЀaceforsuåûþėĜĢħĪĀcrêòkslash;或Ŷöø;櫧ed;挆y;䐑ƀcrtąċĔause;戵noullis;愬a;䎒r;쀀𝔅pf;쀀𝔹eve;䋘còēmpeq;扎܀HOacdefhilorsuōőŖƀƞƢƵƷƺǜȕɳɸɾcy;䐧PY耻©䂩ƀcpyŝŢźute;䄆Ā;iŧŨ拒talDifferentialD;慅leys;愭ȀaeioƉƎƔƘron;䄌dil耻Ç䃇rc;䄈nint;戰ot;䄊ĀdnƧƭilla;䂸terDot;䂷òſi;䎧rcleȀDMPTǇǋǑǖot;抙inus;抖lus;投imes;抗oĀcsǢǸkwiseContourIntegral;戲eCurlyĀDQȃȏoubleQuote;思uote;怙ȀlnpuȞȨɇɕonĀ;eȥȦ户;橴ƀgitȯȶȺruent;扡nt;戯ourIntegral;戮ĀfrɌɎ;愂oduct;成nterClockwiseContourIntegral;戳oss;樯cr;쀀𝒞pĀ;Cʄʅ拓ap;才րDJSZacefiosʠʬʰʴʸˋ˗ˡ˦̳ҍĀ;oŹʥtrahd;椑cy;䐂cy;䐅cy;䐏ƀgrsʿ˄ˇger;怡r;憡hv;櫤Āayː˕ron;䄎;䐔lĀ;t˝˞戇a;䎔r;쀀𝔇Āaf˫̧Ācm˰̢riticalȀADGT̖̜̀̆cute;䂴oŴ̋̍;䋙bleAcute;䋝rave;䁠ilde;䋜ond;拄ferentialD;慆Ѱ̽\0\0\0͔͂\0Ѕf;쀀𝔻ƀ;DE͈͉͍䂨ot;惜qual;扐blèCDLRUVͣͲ΂ϏϢϸontourIntegraìȹoɴ͹\0\0ͻ»͉nArrow;懓Āeo·ΤftƀARTΐΖΡrrow;懐ightArrow;懔eåˊngĀLRΫτeftĀARγιrrow;柸ightArrow;柺ightArrow;柹ightĀATϘϞrrow;懒ee;抨pɁϩ\0\0ϯrrow;懑ownArrow;懕erticalBar;戥ǹABLRTaВЪаўѿͼrrowƀ;BUНОТ憓ar;椓pArrow;懵reve;䌑eft˒к\0ц\0ѐightVector;楐eeVector;楞ectorĀ;Bљњ憽ar;楖ightǔѧ\0ѱeeVector;楟ectorĀ;BѺѻ懁ar;楗eeĀ;A҆҇护rrow;憧ĀctҒҗr;쀀𝒟rok;䄐ࠀNTacdfglmopqstuxҽӀӄӋӞӢӧӮӵԡԯԶՒ՝ՠեG;䅊H耻Ð䃐cute耻É䃉ƀaiyӒӗӜron;䄚rc耻Ê䃊;䐭ot;䄖r;쀀𝔈rave耻È䃈ement;戈ĀapӺӾcr;䄒tyɓԆ\0\0ԒmallSquare;旻erySmallSquare;斫ĀgpԦԪon;䄘f;쀀𝔼silon;䎕uĀaiԼՉlĀ;TՂՃ橵ilde;扂librium;懌Āci՗՚r;愰m;橳a;䎗ml耻Ë䃋Āipժկsts;戃onentialE;慇ʀcfiosօֈ֍ֲ׌y;䐤r;쀀𝔉lledɓ֗\0\0֣mallSquare;旼erySmallSquare;斪Ͱֺ\0ֿ\0\0ׄf;쀀𝔽All;戀riertrf;愱cò׋؀JTabcdfgorstר׬ׯ׺؀ؒؖ؛؝أ٬ٲcy;䐃耻>䀾mmaĀ;d׷׸䎓;䏜reve;䄞ƀeiy؇،ؐdil;䄢rc;䄜;䐓ot;䄠r;쀀𝔊;拙pf;쀀𝔾eater̀EFGLSTصلَٖٛ٦qualĀ;Lؾؿ扥ess;招ullEqual;执reater;檢ess;扷lantEqual;橾ilde;扳cr;쀀𝒢;扫ЀAacfiosuڅڋږڛڞڪھۊRDcy;䐪Āctڐڔek;䋇;䁞irc;䄤r;愌lbertSpace;愋ǰگ\0ڲf;愍izontalLine;攀Āctۃۅòکrok;䄦mpńېۘownHumðįqual;扏܀EJOacdfgmnostuۺ۾܃܇܎ܚܞܡܨ݄ݸދޏޕcy;䐕lig;䄲cy;䐁cute耻Í䃍Āiyܓܘrc耻Î䃎;䐘ot;䄰r;愑rave耻Ì䃌ƀ;apܠܯܿĀcgܴܷr;䄪inaryI;慈lieóϝǴ݉\0ݢĀ;eݍݎ戬Āgrݓݘral;戫section;拂isibleĀCTݬݲomma;恣imes;恢ƀgptݿރވon;䄮f;쀀𝕀a;䎙cr;愐ilde;䄨ǫޚ\0ޞcy;䐆l耻Ï䃏ʀcfosuެ޷޼߂ߐĀiyޱ޵rc;䄴;䐙r;쀀𝔍pf;쀀𝕁ǣ߇\0ߌr;쀀𝒥rcy;䐈kcy;䐄΀HJacfosߤߨ߽߬߱ࠂࠈcy;䐥cy;䐌ppa;䎚Āey߶߻dil;䄶;䐚r;쀀𝔎pf;쀀𝕂cr;쀀𝒦րJTaceflmostࠥࠩࠬࡐࡣ঳সে্਷ੇcy;䐉耻<䀼ʀcmnpr࠷࠼ࡁࡄࡍute;䄹bda;䎛g;柪lacetrf;愒r;憞ƀaeyࡗ࡜ࡡron;䄽dil;䄻;䐛Āfsࡨ॰tԀACDFRTUVarࡾࢩࢱࣦ࣠ࣼयज़ΐ४Ānrࢃ࢏gleBracket;柨rowƀ;BR࢙࢚࢞憐ar;懤ightArrow;懆eiling;挈oǵࢷ\0ࣃbleBracket;柦nǔࣈ\0࣒eeVector;楡ectorĀ;Bࣛࣜ懃ar;楙loor;挊ightĀAV࣯ࣵrrow;憔ector;楎Āerँगeƀ;AVउऊऐ抣rrow;憤ector;楚iangleƀ;BEतथऩ抲ar;槏qual;抴pƀDTVषूौownVector;楑eeVector;楠ectorĀ;Bॖॗ憿ar;楘ectorĀ;B॥०憼ar;楒ightáΜs̀EFGLSTॾঋকঝঢভqualGreater;拚ullEqual;扦reater;扶ess;檡lantEqual;橽ilde;扲r;쀀𝔏Ā;eঽা拘ftarrow;懚idot;䄿ƀnpw৔ਖਛgȀLRlr৞৷ਂਐeftĀAR০৬rrow;柵ightArrow;柷ightArrow;柶eftĀarγਊightáοightáϊf;쀀𝕃erĀLRਢਬeftArrow;憙ightArrow;憘ƀchtਾੀੂòࡌ;憰rok;䅁;扪Ѐacefiosuਗ਼੝੠੷੼અઋ઎p;椅y;䐜Ādl੥੯iumSpace;恟lintrf;愳r;쀀𝔐nusPlus;戓pf;쀀𝕄cò੶;䎜ҀJacefostuણધભીଔଙඑ඗ඞcy;䐊cute;䅃ƀaey઴હાron;䅇dil;䅅;䐝ƀgswે૰଎ativeƀMTV૓૟૨ediumSpace;怋hiĀcn૦૘ë૙eryThiî૙tedĀGL૸ଆreaterGreateòٳessLesóੈLine;䀊r;쀀𝔑ȀBnptଢନଷ଺reak;恠BreakingSpace;䂠f;愕ڀ;CDEGHLNPRSTV୕ୖ୪୼஡௫ఄ౞಄ದ೘ൡඅ櫬Āou୛୤ngruent;扢pCap;扭oubleVerticalBar;戦ƀlqxஃஊ஛ement;戉ualĀ;Tஒஓ扠ilde;쀀≂̸ists;戄reater΀;EFGLSTஶஷ஽௉௓௘௥扯qual;扱ullEqual;쀀≧̸reater;쀀≫̸ess;批lantEqual;쀀⩾̸ilde;扵umpń௲௽ownHump;쀀≎̸qual;쀀≏̸eĀfsఊధtTriangleƀ;BEచఛడ拪ar;쀀⧏̸qual;括s̀;EGLSTవశ఼ౄోౘ扮qual;扰reater;扸ess;쀀≪̸lantEqual;쀀⩽̸ilde;扴estedĀGL౨౹reaterGreater;쀀⪢̸essLess;쀀⪡̸recedesƀ;ESಒಓಛ技qual;쀀⪯̸lantEqual;拠ĀeiಫಹverseElement;戌ghtTriangleƀ;BEೋೌ೒拫ar;쀀⧐̸qual;拭ĀquೝഌuareSuĀbp೨೹setĀ;E೰ೳ쀀⊏̸qual;拢ersetĀ;Eഃആ쀀⊐̸qual;拣ƀbcpഓതൎsetĀ;Eഛഞ쀀⊂⃒qual;抈ceedsȀ;ESTലള഻െ抁qual;쀀⪰̸lantEqual;拡ilde;쀀≿̸ersetĀ;E൘൛쀀⊃⃒qual;抉ildeȀ;EFT൮൯൵ൿ扁qual;扄ullEqual;扇ilde;扉erticalBar;戤cr;쀀𝒩ilde耻Ñ䃑;䎝܀Eacdfgmoprstuvලෂ෉෕ෛ෠෧෼ขภยา฿ไlig;䅒cute耻Ó䃓Āiy෎ීrc耻Ô䃔;䐞blac;䅐r;쀀𝔒rave耻Ò䃒ƀaei෮ෲ෶cr;䅌ga;䎩cron;䎟pf;쀀𝕆enCurlyĀDQฎบoubleQuote;怜uote;怘;橔Āclวฬr;쀀𝒪ash耻Ø䃘iŬื฼de耻Õ䃕es;樷ml耻Ö䃖erĀBP๋๠Āar๐๓r;怾acĀek๚๜;揞et;掴arenthesis;揜Ҁacfhilors๿ງຊຏຒດຝະ໼rtialD;戂y;䐟r;쀀𝔓i;䎦;䎠usMinus;䂱Āipຢອncareplanåڝf;愙Ȁ;eio຺ູ໠໤檻cedesȀ;EST່້໏໚扺qual;檯lantEqual;扼ilde;找me;怳Ādp໩໮uct;戏ortionĀ;aȥ໹l;戝Āci༁༆r;쀀𝒫;䎨ȀUfos༑༖༛༟OT耻"䀢r;쀀𝔔pf;愚cr;쀀𝒬؀BEacefhiorsu༾གྷཇའཱིྦྷྪྭ႖ႩႴႾarr;椐G耻®䂮ƀcnrཎནབute;䅔g;柫rĀ;tཛྷཝ憠l;椖ƀaeyཧཬཱron;䅘dil;䅖;䐠Ā;vླྀཹ愜erseĀEUྂྙĀlq྇ྎement;戋uilibrium;懋pEquilibrium;楯r»ཹo;䎡ghtЀACDFTUVa࿁࿫࿳ဢဨၛႇϘĀnr࿆࿒gleBracket;柩rowƀ;BL࿜࿝࿡憒ar;懥eftArrow;懄eiling;按oǵ࿹\0စbleBracket;柧nǔည\0နeeVector;楝ectorĀ;Bဝသ懂ar;楕loor;挋Āerိ၃eƀ;AVဵံြ抢rrow;憦ector;楛iangleƀ;BEၐၑၕ抳ar;槐qual;抵pƀDTVၣၮၸownVector;楏eeVector;楜ectorĀ;Bႂႃ憾ar;楔ectorĀ;B႑႒懀ar;楓Āpuႛ႞f;愝ndImplies;楰ightarrow;懛ĀchႹႼr;愛;憱leDelayed;槴ڀHOacfhimoqstuფჱჷჽᄙᄞᅑᅖᅡᅧᆵᆻᆿĀCcჩხHcy;䐩y;䐨FTcy;䐬cute;䅚ʀ;aeiyᄈᄉᄎᄓᄗ檼ron;䅠dil;䅞rc;䅜;䐡r;쀀𝔖ortȀDLRUᄪᄴᄾᅉownArrow»ОeftArrow»࢚ightArrow»࿝pArrow;憑gma;䎣allCircle;战pf;쀀𝕊ɲᅭ\0\0ᅰt;戚areȀ;ISUᅻᅼᆉᆯ斡ntersection;抓uĀbpᆏᆞsetĀ;Eᆗᆘ抏qual;抑ersetĀ;Eᆨᆩ抐qual;抒nion;抔cr;쀀𝒮ar;拆ȀbcmpᇈᇛሉላĀ;sᇍᇎ拐etĀ;Eᇍᇕqual;抆ĀchᇠህeedsȀ;ESTᇭᇮᇴᇿ扻qual;檰lantEqual;扽ilde;承Tháྌ;我ƀ;esሒሓሣ拑rsetĀ;Eሜም抃qual;抇et»ሓրHRSacfhiorsሾቄ቉ቕ቞ቱቶኟዂወዑORN耻Þ䃞ADE;愢ĀHc቎ቒcy;䐋y;䐦Ābuቚቜ;䀉;䎤ƀaeyብቪቯron;䅤dil;䅢;䐢r;쀀𝔗Āeiቻ኉ǲኀ\0ኇefore;戴a;䎘Ācn኎ኘkSpace;쀀  Space;怉ldeȀ;EFTካኬኲኼ戼qual;扃ullEqual;扅ilde;扈pf;쀀𝕋ipleDot;惛Āctዖዛr;쀀𝒯rok;䅦ૡዷጎጚጦ\0ጬጱ\0\0\0\0\0ጸጽ፷ᎅ\0᏿ᐄᐊᐐĀcrዻጁute耻Ú䃚rĀ;oጇገ憟cir;楉rǣጓ\0጖y;䐎ve;䅬Āiyጞጣrc耻Û䃛;䐣blac;䅰r;쀀𝔘rave耻Ù䃙acr;䅪Ādiፁ፩erĀBPፈ፝Āarፍፐr;䁟acĀekፗፙ;揟et;掵arenthesis;揝onĀ;P፰፱拃lus;抎Āgp፻፿on;䅲f;쀀𝕌ЀADETadps᎕ᎮᎸᏄϨᏒᏗᏳrrowƀ;BDᅐᎠᎤar;椒ownArrow;懅ownArrow;憕quilibrium;楮eeĀ;AᏋᏌ报rrow;憥ownáϳerĀLRᏞᏨeftArrow;憖ightArrow;憗iĀ;lᏹᏺ䏒on;䎥ing;䅮cr;쀀𝒰ilde;䅨ml耻Ü䃜ҀDbcdefosvᐧᐬᐰᐳᐾᒅᒊᒐᒖash;披ar;櫫y;䐒ashĀ;lᐻᐼ抩;櫦Āerᑃᑅ;拁ƀbtyᑌᑐᑺar;怖Ā;iᑏᑕcalȀBLSTᑡᑥᑪᑴar;戣ine;䁼eparator;杘ilde;所ThinSpace;怊r;쀀𝔙pf;쀀𝕍cr;쀀𝒱dash;抪ʀcefosᒧᒬᒱᒶᒼirc;䅴dge;拀r;쀀𝔚pf;쀀𝕎cr;쀀𝒲Ȁfiosᓋᓐᓒᓘr;쀀𝔛;䎞pf;쀀𝕏cr;쀀𝒳ҀAIUacfosuᓱᓵᓹᓽᔄᔏᔔᔚᔠcy;䐯cy;䐇cy;䐮cute耻Ý䃝Āiyᔉᔍrc;䅶;䐫r;쀀𝔜pf;쀀𝕐cr;쀀𝒴ml;䅸ЀHacdefosᔵᔹᔿᕋᕏᕝᕠᕤcy;䐖cute;䅹Āayᕄᕉron;䅽;䐗ot;䅻ǲᕔ\0ᕛoWidtè૙a;䎖r;愨pf;愤cr;쀀𝒵௡ᖃᖊᖐ\0ᖰᖶᖿ\0\0\0\0ᗆᗛᗫᙟ᙭\0ᚕ᚛ᚲᚹ\0ᚾcute耻á䃡reve;䄃̀;Ediuyᖜᖝᖡᖣᖨᖭ戾;쀀∾̳;房rc耻â䃢te肻´̆;䐰lig耻æ䃦Ā;r²ᖺ;쀀𝔞rave耻à䃠ĀepᗊᗖĀfpᗏᗔsym;愵èᗓha;䎱ĀapᗟcĀclᗤᗧr;䄁g;樿ɤᗰ\0\0ᘊʀ;adsvᗺᗻᗿᘁᘇ戧nd;橕;橜lope;橘;橚΀;elmrszᘘᘙᘛᘞᘿᙏᙙ戠;榤e»ᘙsdĀ;aᘥᘦ戡ѡᘰᘲᘴᘶᘸᘺᘼᘾ;榨;榩;榪;榫;榬;榭;榮;榯tĀ;vᙅᙆ戟bĀ;dᙌᙍ抾;榝Āptᙔᙗh;戢»¹arr;捼Āgpᙣᙧon;䄅f;쀀𝕒΀;Eaeiop዁ᙻᙽᚂᚄᚇᚊ;橰cir;橯;扊d;手s;䀧roxĀ;e዁ᚒñᚃing耻å䃥ƀctyᚡᚦᚨr;쀀𝒶;䀪mpĀ;e዁ᚯñʈilde耻ã䃣ml耻ä䃤Āciᛂᛈoninôɲnt;樑ࠀNabcdefiklnoprsu᛭ᛱᜰ᜼ᝃᝈ᝸᝽០៦ᠹᡐᜍ᤽᥈ᥰot;櫭Ācrᛶ᜞kȀcepsᜀᜅᜍᜓong;扌psilon;䏶rime;怵imĀ;e᜚᜛戽q;拍Ŷᜢᜦee;抽edĀ;gᜬᜭ挅e»ᜭrkĀ;t፜᜷brk;掶Āoyᜁᝁ;䐱quo;怞ʀcmprtᝓ᝛ᝡᝤᝨausĀ;eĊĉptyv;榰séᜌnoõēƀahwᝯ᝱ᝳ;䎲;愶een;扬r;쀀𝔟g΀costuvwឍឝឳេ៕៛៞ƀaiuបពរðݠrc;旯p»፱ƀdptឤឨឭot;樀lus;樁imes;樂ɱឹ\0\0ើcup;樆ar;昅riangleĀdu៍្own;施p;斳plus;樄eåᑄåᒭarow;植ƀako៭ᠦᠵĀcn៲ᠣkƀlst៺֫᠂ozenge;槫riangleȀ;dlr᠒᠓᠘᠝斴own;斾eft;旂ight;斸k;搣Ʊᠫ\0ᠳƲᠯ\0ᠱ;斒;斑4;斓ck;斈ĀeoᠾᡍĀ;qᡃᡆ쀀=⃥uiv;쀀≡⃥t;挐Ȁptwxᡙᡞᡧᡬf;쀀𝕓Ā;tᏋᡣom»Ꮜtie;拈؀DHUVbdhmptuvᢅᢖᢪᢻᣗᣛᣬ᣿ᤅᤊᤐᤡȀLRlrᢎᢐᢒᢔ;敗;敔;敖;敓ʀ;DUduᢡᢢᢤᢦᢨ敐;敦;敩;敤;敧ȀLRlrᢳᢵᢷᢹ;敝;敚;敜;教΀;HLRhlrᣊᣋᣍᣏᣑᣓᣕ救;敬;散;敠;敫;敢;敟ox;槉ȀLRlrᣤᣦᣨᣪ;敕;敒;攐;攌ʀ;DUduڽ᣷᣹᣻᣽;敥;敨;攬;攴inus;抟lus;択imes;抠ȀLRlrᤙᤛᤝ᤟;敛;敘;攘;攔΀;HLRhlrᤰᤱᤳᤵᤷ᤻᤹攂;敪;敡;敞;攼;攤;攜Āevģ᥂bar耻¦䂦Ȁceioᥑᥖᥚᥠr;쀀𝒷mi;恏mĀ;e᜚᜜lƀ;bhᥨᥩᥫ䁜;槅sub;柈Ŭᥴ᥾lĀ;e᥹᥺怢t»᥺pƀ;Eeįᦅᦇ;檮Ā;qۜۛೡᦧ\0᧨ᨑᨕᨲ\0ᨷᩐ\0\0᪴\0\0᫁\0\0ᬡᬮ᭍᭒\0᯽\0ᰌƀcpr᦭ᦲ᧝ute;䄇̀;abcdsᦿᧀᧄ᧊᧕᧙戩nd;橄rcup;橉Āau᧏᧒p;橋p;橇ot;橀;쀀∩︀Āeo᧢᧥t;恁îړȀaeiu᧰᧻ᨁᨅǰ᧵\0᧸s;橍on;䄍dil耻ç䃧rc;䄉psĀ;sᨌᨍ橌m;橐ot;䄋ƀdmnᨛᨠᨦil肻¸ƭptyv;榲t脀¢;eᨭᨮ䂢räƲr;쀀𝔠ƀceiᨽᩀᩍy;䑇ckĀ;mᩇᩈ朓ark»ᩈ;䏇r΀;Ecefms᩟᩠ᩢᩫ᪤᪪᪮旋;槃ƀ;elᩩᩪᩭ䋆q;扗eɡᩴ\0\0᪈rrowĀlr᩼᪁eft;憺ight;憻ʀRSacd᪒᪔᪖᪚᪟»ཇ;擈st;抛irc;抚ash;抝nint;樐id;櫯cir;槂ubsĀ;u᪻᪼晣it»᪼ˬ᫇᫔᫺\0ᬊonĀ;eᫍᫎ䀺Ā;qÇÆɭ᫙\0\0᫢aĀ;t᫞᫟䀬;䁀ƀ;fl᫨᫩᫫戁îᅠeĀmx᫱᫶ent»᫩eóɍǧ᫾\0ᬇĀ;dኻᬂot;橭nôɆƀfryᬐᬔᬗ;쀀𝕔oäɔ脀©;sŕᬝr;愗Āaoᬥᬩrr;憵ss;朗Ācuᬲᬷr;쀀𝒸Ābpᬼ᭄Ā;eᭁᭂ櫏;櫑Ā;eᭉᭊ櫐;櫒dot;拯΀delprvw᭠᭬᭷ᮂᮬᯔ᯹arrĀlr᭨᭪;椸;椵ɰ᭲\0\0᭵r;拞c;拟arrĀ;p᭿ᮀ憶;椽̀;bcdosᮏᮐᮖᮡᮥᮨ截rcap;橈Āauᮛᮞp;橆p;橊ot;抍r;橅;쀀∪︀Ȁalrv᮵ᮿᯞᯣrrĀ;mᮼᮽ憷;椼yƀevwᯇᯔᯘqɰᯎ\0\0ᯒreã᭳uã᭵ee;拎edge;拏en耻¤䂤earrowĀlrᯮ᯳eft»ᮀight»ᮽeäᯝĀciᰁᰇoninôǷnt;戱lcty;挭ঀAHabcdefhijlorstuwz᰸᰻᰿ᱝᱩᱵᲊᲞᲬᲷ᳻᳿ᴍᵻᶑᶫᶻ᷆᷍rò΁ar;楥Ȁglrs᱈ᱍ᱒᱔ger;怠eth;愸òᄳhĀ;vᱚᱛ怐»ऊūᱡᱧarow;椏aã̕Āayᱮᱳron;䄏;䐴ƀ;ao̲ᱼᲄĀgrʿᲁr;懊tseq;橷ƀglmᲑᲔᲘ耻°䂰ta;䎴ptyv;榱ĀirᲣᲨsht;楿;쀀𝔡arĀlrᲳᲵ»ࣜ»သʀaegsv᳂͸᳖᳜᳠mƀ;oș᳊᳔ndĀ;ș᳑uit;晦amma;䏝in;拲ƀ;io᳧᳨᳸䃷de脀÷;o᳧ᳰntimes;拇nø᳷cy;䑒cɯᴆ\0\0ᴊrn;挞op;挍ʀlptuwᴘᴝᴢᵉᵕlar;䀤f;쀀𝕕ʀ;emps̋ᴭᴷᴽᵂqĀ;d͒ᴳot;扑inus;戸lus;戔quare;抡blebarwedgåúnƀadhᄮᵝᵧownarrowóᲃarpoonĀlrᵲᵶefôᲴighôᲶŢᵿᶅkaro÷གɯᶊ\0\0ᶎrn;挟op;挌ƀcotᶘᶣᶦĀryᶝᶡ;쀀𝒹;䑕l;槶rok;䄑Ādrᶰᶴot;拱iĀ;fᶺ᠖斿Āah᷀᷃ròЩaòྦangle;榦Āci᷒ᷕy;䑟grarr;柿ऀDacdefglmnopqrstuxḁḉḙḸոḼṉṡṾấắẽỡἪἷὄ὎὚ĀDoḆᴴoôᲉĀcsḎḔute耻é䃩ter;橮ȀaioyḢḧḱḶron;䄛rĀ;cḭḮ扖耻ê䃪lon;払;䑍ot;䄗ĀDrṁṅot;扒;쀀𝔢ƀ;rsṐṑṗ檚ave耻è䃨Ā;dṜṝ檖ot;檘Ȁ;ilsṪṫṲṴ檙nters;揧;愓Ā;dṹṺ檕ot;檗ƀapsẅẉẗcr;䄓tyƀ;svẒẓẕ戅et»ẓpĀ1;ẝẤĳạả;怄;怅怃ĀgsẪẬ;䅋p;怂ĀgpẴẸon;䄙f;쀀𝕖ƀalsỄỎỒrĀ;sỊị拕l;槣us;橱iƀ;lvỚớở䎵on»ớ;䏵ȀcsuvỪỳἋἣĀioữḱrc»Ḯɩỹ\0\0ỻíՈantĀglἂἆtr»ṝess»Ṻƀaeiἒ἖Ἒls;䀽st;扟vĀ;DȵἠD;橸parsl;槥ĀDaἯἳot;打rr;楱ƀcdiἾὁỸr;愯oô͒ĀahὉὋ;䎷耻ð䃰Āmrὓὗl耻ë䃫o;悬ƀcipὡὤὧl;䀡sôծĀeoὬὴctatioîՙnentialåչৡᾒ\0ᾞ\0ᾡᾧ\0\0ῆῌ\0ΐ\0ῦῪ \0 ⁚llingdotseñṄy;䑄male;晀ƀilrᾭᾳ῁lig;耀ﬃɩᾹ\0\0᾽g;耀ﬀig;耀ﬄ;쀀𝔣lig;耀ﬁlig;쀀fjƀaltῙ῜ῡt;晭ig;耀ﬂns;斱of;䆒ǰ΅\0ῳf;쀀𝕗ĀakֿῷĀ;vῼ´拔;櫙artint;樍Āao‌⁕Ācs‑⁒α‚‰‸⁅⁈\0⁐β•‥‧‪‬\0‮耻½䂽;慓耻¼䂼;慕;慙;慛Ƴ‴\0‶;慔;慖ʴ‾⁁\0\0⁃耻¾䂾;慗;慜5;慘ƶ⁌\0⁎;慚;慝8;慞l;恄wn;挢cr;쀀𝒻ࢀEabcdefgijlnorstv₂₉₟₥₰₴⃰⃵⃺⃿℃ℒℸ̗ℾ⅒↞Ā;lٍ₇;檌ƀcmpₐₕ₝ute;䇵maĀ;dₜ᳚䎳;檆reve;䄟Āiy₪₮rc;䄝;䐳ot;䄡Ȁ;lqsؾق₽⃉ƀ;qsؾٌ⃄lanô٥Ȁ;cdl٥⃒⃥⃕c;檩otĀ;o⃜⃝檀Ā;l⃢⃣檂;檄Ā;e⃪⃭쀀⋛︀s;檔r;쀀𝔤Ā;gٳ؛mel;愷cy;䑓Ȁ;Eajٚℌℎℐ;檒;檥;檤ȀEaesℛℝ℩ℴ;扩pĀ;p℣ℤ檊rox»ℤĀ;q℮ℯ檈Ā;q℮ℛim;拧pf;쀀𝕘Āci⅃ⅆr;愊mƀ;el٫ⅎ⅐;檎;檐茀>;cdlqr׮ⅠⅪⅮⅳⅹĀciⅥⅧ;檧r;橺ot;拗Par;榕uest;橼ʀadelsↄⅪ←ٖ↛ǰ↉\0↎proø₞r;楸qĀlqؿ↖lesó₈ií٫Āen↣↭rtneqq;쀀≩︀Å↪ԀAabcefkosy⇄⇇⇱⇵⇺∘∝∯≨≽ròΠȀilmr⇐⇔⇗⇛rsðᒄf»․ilôکĀdr⇠⇤cy;䑊ƀ;cwࣴ⇫⇯ir;楈;憭ar;意irc;䄥ƀalr∁∎∓rtsĀ;u∉∊晥it»∊lip;怦con;抹r;쀀𝔥sĀew∣∩arow;椥arow;椦ʀamopr∺∾≃≞≣rr;懿tht;戻kĀlr≉≓eftarrow;憩ightarrow;憪f;쀀𝕙bar;怕ƀclt≯≴≸r;쀀𝒽asè⇴rok;䄧Ābp⊂⊇ull;恃hen»ᱛૡ⊣\0⊪\0⊸⋅⋎\0⋕⋳\0\0⋸⌢⍧⍢⍿\0⎆⎪⎴cute耻í䃭ƀ;iyݱ⊰⊵rc耻î䃮;䐸Ācx⊼⊿y;䐵cl耻¡䂡ĀfrΟ⋉;쀀𝔦rave耻ì䃬Ȁ;inoܾ⋝⋩⋮Āin⋢⋦nt;樌t;戭fin;槜ta;愩lig;䄳ƀaop⋾⌚⌝ƀcgt⌅⌈⌗r;䄫ƀelpܟ⌏⌓inåގarôܠh;䄱f;抷ed;䆵ʀ;cfotӴ⌬⌱⌽⍁are;愅inĀ;t⌸⌹戞ie;槝doô⌙ʀ;celpݗ⍌⍐⍛⍡al;抺Āgr⍕⍙eróᕣã⍍arhk;樗rod;樼Ȁcgpt⍯⍲⍶⍻y;䑑on;䄯f;쀀𝕚a;䎹uest耻¿䂿Āci⎊⎏r;쀀𝒾nʀ;EdsvӴ⎛⎝⎡ӳ;拹ot;拵Ā;v⎦⎧拴;拳Ā;iݷ⎮lde;䄩ǫ⎸\0⎼cy;䑖l耻ï䃯̀cfmosu⏌⏗⏜⏡⏧⏵Āiy⏑⏕rc;䄵;䐹r;쀀𝔧ath;䈷pf;쀀𝕛ǣ⏬\0⏱r;쀀𝒿rcy;䑘kcy;䑔Ѐacfghjos␋␖␢␧␭␱␵␻ppaĀ;v␓␔䎺;䏰Āey␛␠dil;䄷;䐺r;쀀𝔨reen;䄸cy;䑅cy;䑜pf;쀀𝕜cr;쀀𝓀஀ABEHabcdefghjlmnoprstuv⑰⒁⒆⒍⒑┎┽╚▀♎♞♥♹♽⚚⚲⛘❝❨➋⟀⠁⠒ƀart⑷⑺⑼rò৆òΕail;椛arr;椎Ā;gঔ⒋;檋ar;楢ॣ⒥\0⒪\0⒱\0\0\0\0\0⒵Ⓔ\0ⓆⓈⓍ\0⓹ute;䄺mptyv;榴raîࡌbda;䎻gƀ;dlࢎⓁⓃ;榑åࢎ;檅uo耻«䂫rЀ;bfhlpst࢙ⓞⓦⓩ⓫⓮⓱⓵Ā;f࢝ⓣs;椟s;椝ë≒p;憫l;椹im;楳l;憢ƀ;ae⓿─┄檫il;椙Ā;s┉┊檭;쀀⪭︀ƀabr┕┙┝rr;椌rk;杲Āak┢┬cĀek┨┪;䁻;䁛Āes┱┳;榋lĀdu┹┻;榏;榍Ȁaeuy╆╋╖╘ron;䄾Ādi═╔il;䄼ìࢰâ┩;䐻Ȁcqrs╣╦╭╽a;椶uoĀ;rนᝆĀdu╲╷har;楧shar;楋h;憲ʀ;fgqs▋▌উ◳◿扤tʀahlrt▘▤▷◂◨rrowĀ;t࢙□aé⓶arpoonĀdu▯▴own»њp»०eftarrows;懇ightƀahs◍◖◞rrowĀ;sࣴࢧarpoonó྘quigarro÷⇰hreetimes;拋ƀ;qs▋ও◺lanôবʀ;cdgsব☊☍☝☨c;檨otĀ;o☔☕橿Ā;r☚☛檁;檃Ā;e☢☥쀀⋚︀s;檓ʀadegs☳☹☽♉♋pproøⓆot;拖qĀgq♃♅ôউgtò⒌ôছiíলƀilr♕࣡♚sht;楼;쀀𝔩Ā;Eজ♣;檑š♩♶rĀdu▲♮Ā;l॥♳;楪lk;斄cy;䑙ʀ;achtੈ⚈⚋⚑⚖rò◁orneòᴈard;楫ri;旺Āio⚟⚤dot;䅀ustĀ;a⚬⚭掰che»⚭ȀEaes⚻⚽⛉⛔;扨pĀ;p⛃⛄檉rox»⛄Ā;q⛎⛏檇Ā;q⛎⚻im;拦Ѐabnoptwz⛩⛴⛷✚✯❁❇❐Ānr⛮⛱g;柬r;懽rëࣁgƀlmr⛿✍✔eftĀar০✇ightá৲apsto;柼ightá৽parrowĀlr✥✩efô⓭ight;憬ƀafl✶✹✽r;榅;쀀𝕝us;樭imes;樴š❋❏st;戗áፎƀ;ef❗❘᠀旊nge»❘arĀ;l❤❥䀨t;榓ʀachmt❳❶❼➅➇ròࢨorneòᶌarĀ;d྘➃;業;怎ri;抿̀achiqt➘➝ੀ➢➮➻quo;怹r;쀀𝓁mƀ;egল➪➬;檍;檏Ābu┪➳oĀ;rฟ➹;怚rok;䅂萀<;cdhilqrࠫ⟒☹⟜⟠⟥⟪⟰Āci⟗⟙;檦r;橹reå◲mes;拉arr;楶uest;橻ĀPi⟵⟹ar;榖ƀ;ef⠀भ᠛旃rĀdu⠇⠍shar;楊har;楦Āen⠗⠡rtneqq;쀀≨︀Å⠞܀Dacdefhilnopsu⡀⡅⢂⢎⢓⢠⢥⢨⣚⣢⣤ઃ⣳⤂Dot;戺Ȁclpr⡎⡒⡣⡽r耻¯䂯Āet⡗⡙;時Ā;e⡞⡟朠se»⡟Ā;sျ⡨toȀ;dluျ⡳⡷⡻owîҌefôएðᏑker;斮Āoy⢇⢌mma;権;䐼ash;怔asuredangle»ᘦr;쀀𝔪o;愧ƀcdn⢯⢴⣉ro耻µ䂵Ȁ;acdᑤ⢽⣀⣄sôᚧir;櫰ot肻·Ƶusƀ;bd⣒ᤃ⣓戒Ā;uᴼ⣘;横ţ⣞⣡p;櫛ò−ðઁĀdp⣩⣮els;抧f;쀀𝕞Āct⣸⣽r;쀀𝓂pos»ᖝƀ;lm⤉⤊⤍䎼timap;抸ఀGLRVabcdefghijlmoprstuvw⥂⥓⥾⦉⦘⧚⧩⨕⨚⩘⩝⪃⪕⪤⪨⬄⬇⭄⭿⮮ⰴⱧⱼ⳩Āgt⥇⥋;쀀⋙̸Ā;v⥐௏쀀≫⃒ƀelt⥚⥲⥶ftĀar⥡⥧rrow;懍ightarrow;懎;쀀⋘̸Ā;v⥻ే쀀≪⃒ightarrow;懏ĀDd⦎⦓ash;抯ash;抮ʀbcnpt⦣⦧⦬⦱⧌la»˞ute;䅄g;쀀∠⃒ʀ;Eiop඄⦼⧀⧅⧈;쀀⩰̸d;쀀≋̸s;䅉roø඄urĀ;a⧓⧔普lĀ;s⧓ସǳ⧟\0⧣p肻 ଷmpĀ;e௹ఀʀaeouy⧴⧾⨃⨐⨓ǰ⧹\0⧻;橃on;䅈dil;䅆ngĀ;dൾ⨊ot;쀀⩭̸p;橂;䐽ash;怓΀;Aadqsxஒ⨩⨭⨻⩁⩅⩐rr;懗rĀhr⨳⨶k;椤Ā;oᏲᏰot;쀀≐̸uiöୣĀei⩊⩎ar;椨í஘istĀ;s஠டr;쀀𝔫ȀEest௅⩦⩹⩼ƀ;qs஼⩭௡ƀ;qs஼௅⩴lanô௢ií௪Ā;rஶ⪁»ஷƀAap⪊⪍⪑rò⥱rr;憮ar;櫲ƀ;svྍ⪜ྌĀ;d⪡⪢拼;拺cy;䑚΀AEadest⪷⪺⪾⫂⫅⫶⫹rò⥦;쀀≦̸rr;憚r;急Ȁ;fqs఻⫎⫣⫯tĀar⫔⫙rro÷⫁ightarro÷⪐ƀ;qs఻⪺⫪lanôౕĀ;sౕ⫴»శiíౝĀ;rవ⫾iĀ;eచథiäඐĀpt⬌⬑f;쀀𝕟膀¬;in⬙⬚⬶䂬nȀ;Edvஉ⬤⬨⬮;쀀⋹̸ot;쀀⋵̸ǡஉ⬳⬵;拷;拶iĀ;vಸ⬼ǡಸ⭁⭃;拾;拽ƀaor⭋⭣⭩rȀ;ast୻⭕⭚⭟lleì୻l;쀀⫽⃥;쀀∂̸lint;樔ƀ;ceಒ⭰⭳uåಥĀ;cಘ⭸Ā;eಒ⭽ñಘȀAait⮈⮋⮝⮧rò⦈rrƀ;cw⮔⮕⮙憛;쀀⤳̸;쀀↝̸ghtarrow»⮕riĀ;eೋೖ΀chimpqu⮽⯍⯙⬄୸⯤⯯Ȁ;cerല⯆ഷ⯉uå൅;쀀𝓃ortɭ⬅\0\0⯖ará⭖mĀ;e൮⯟Ā;q൴൳suĀbp⯫⯭å೸åഋƀbcp⯶ⰑⰙȀ;Ees⯿ⰀഢⰄ抄;쀀⫅̸etĀ;eഛⰋqĀ;qണⰀcĀ;eലⰗñസȀ;EesⰢⰣൟⰧ抅;쀀⫆̸etĀ;e൘ⰮqĀ;qൠⰣȀgilrⰽⰿⱅⱇìௗlde耻ñ䃱çృiangleĀlrⱒⱜeftĀ;eచⱚñదightĀ;eೋⱥñ೗Ā;mⱬⱭ䎽ƀ;esⱴⱵⱹ䀣ro;愖p;怇ҀDHadgilrsⲏⲔⲙⲞⲣⲰⲶⳓⳣash;抭arr;椄p;쀀≍⃒ash;抬ĀetⲨⲬ;쀀≥⃒;쀀>⃒nfin;槞ƀAetⲽⳁⳅrr;椂;쀀≤⃒Ā;rⳊⳍ쀀<⃒ie;쀀⊴⃒ĀAtⳘⳜrr;椃rie;쀀⊵⃒im;쀀∼⃒ƀAan⳰⳴ⴂrr;懖rĀhr⳺⳽k;椣Ā;oᏧᏥear;椧ቓ᪕\0\0\0\0\0\0\0\0\0\0\0\0\0ⴭ\0ⴸⵈⵠⵥ⵲ⶄᬇ\0\0ⶍⶫ\0ⷈⷎ\0ⷜ⸙⸫⸾⹃Ācsⴱ᪗ute耻ó䃳ĀiyⴼⵅrĀ;c᪞ⵂ耻ô䃴;䐾ʀabios᪠ⵒⵗǈⵚlac;䅑v;樸old;榼lig;䅓Ācr⵩⵭ir;榿;쀀𝔬ͯ⵹\0\0⵼\0ⶂn;䋛ave耻ò䃲;槁Ābmⶈ෴ar;榵Ȁacitⶕ⶘ⶥⶨrò᪀Āir⶝ⶠr;榾oss;榻nå๒;槀ƀaeiⶱⶵⶹcr;䅍ga;䏉ƀcdnⷀⷅǍron;䎿;榶pf;쀀𝕠ƀaelⷔ⷗ǒr;榷rp;榹΀;adiosvⷪⷫⷮ⸈⸍⸐⸖戨rò᪆Ȁ;efmⷷⷸ⸂⸅橝rĀ;oⷾⷿ愴f»ⷿ耻ª䂪耻º䂺gof;抶r;橖lope;橗;橛ƀclo⸟⸡⸧ò⸁ash耻ø䃸l;折iŬⸯ⸴de耻õ䃵esĀ;aǛ⸺s;樶ml耻ö䃶bar;挽ૡ⹞\0⹽\0⺀⺝\0⺢⺹\0\0⻋ຜ\0⼓\0\0⼫⾼\0⿈rȀ;astЃ⹧⹲຅脀¶;l⹭⹮䂶leìЃɩ⹸\0\0⹻m;櫳;櫽y;䐿rʀcimpt⺋⺏⺓ᡥ⺗nt;䀥od;䀮il;怰enk;怱r;쀀𝔭ƀimo⺨⺰⺴Ā;v⺭⺮䏆;䏕maô੶ne;明ƀ;tv⺿⻀⻈䏀chfork»´;䏖Āau⻏⻟nĀck⻕⻝kĀ;h⇴⻛;愎ö⇴sҀ;abcdemst⻳⻴ᤈ⻹⻽⼄⼆⼊⼎䀫cir;樣ir;樢Āouᵀ⼂;樥;橲n肻±ຝim;樦wo;樧ƀipu⼙⼠⼥ntint;樕f;쀀𝕡nd耻£䂣Ԁ;Eaceinosu່⼿⽁⽄⽇⾁⾉⾒⽾⾶;檳p;檷uå໙Ā;c໎⽌̀;acens່⽙⽟⽦⽨⽾pproø⽃urlyeñ໙ñ໎ƀaes⽯⽶⽺pprox;檹qq;檵im;拨iíໟmeĀ;s⾈ຮ怲ƀEas⽸⾐⽺ð⽵ƀdfp໬⾙⾯ƀals⾠⾥⾪lar;挮ine;挒urf;挓Ā;t໻⾴ï໻rel;抰Āci⿀⿅r;쀀𝓅;䏈ncsp;怈̀fiopsu⿚⋢⿟⿥⿫⿱r;쀀𝔮pf;쀀𝕢rime;恗cr;쀀𝓆ƀaeo⿸〉〓tĀei⿾々rnionóڰnt;樖stĀ;e【】䀿ñἙô༔઀ABHabcdefhilmnoprstux぀けさすムㄎㄫㅇㅢㅲㆎ㈆㈕㈤㈩㉘㉮㉲㊐㊰㊷ƀartぇおがròႳòϝail;検aròᱥar;楤΀cdenqrtとふへみわゔヌĀeuねぱ;쀀∽̱te;䅕iãᅮmptyv;榳gȀ;del࿑らるろ;榒;榥å࿑uo耻»䂻rր;abcfhlpstw࿜ガクシスゼゾダッデナp;極Ā;f࿠ゴs;椠;椳s;椞ë≝ð✮l;楅im;楴l;憣;憝Āaiパフil;椚oĀ;nホボ戶aló༞ƀabrョリヮrò៥rk;杳ĀakンヽcĀekヹ・;䁽;䁝Āes㄂㄄;榌lĀduㄊㄌ;榎;榐Ȁaeuyㄗㄜㄧㄩron;䅙Ādiㄡㄥil;䅗ì࿲âヺ;䑀Ȁclqsㄴㄷㄽㅄa;椷dhar;楩uoĀ;rȎȍh;憳ƀacgㅎㅟངlȀ;ipsླྀㅘㅛႜnåႻarôྩt;断ƀilrㅩဣㅮsht;楽;쀀𝔯ĀaoㅷㆆrĀduㅽㅿ»ѻĀ;l႑ㆄ;楬Ā;vㆋㆌ䏁;䏱ƀgns㆕ㇹㇼht̀ahlrstㆤㆰ㇂㇘㇤㇮rrowĀ;t࿜ㆭaéトarpoonĀduㆻㆿowîㅾp»႒eftĀah㇊㇐rrowó࿪arpoonóՑightarrows;應quigarro÷ニhreetimes;拌g;䋚ingdotseñἲƀahm㈍㈐㈓rò࿪aòՑ;怏oustĀ;a㈞㈟掱che»㈟mid;櫮Ȁabpt㈲㈽㉀㉒Ānr㈷㈺g;柭r;懾rëဃƀafl㉇㉊㉎r;榆;쀀𝕣us;樮imes;樵Āap㉝㉧rĀ;g㉣㉤䀩t;榔olint;樒arò㇣Ȁachq㉻㊀Ⴜ㊅quo;怺r;쀀𝓇Ābu・㊊oĀ;rȔȓƀhir㊗㊛㊠reåㇸmes;拊iȀ;efl㊪ၙᠡ㊫方tri;槎luhar;楨;愞ൡ㋕㋛㋟㌬㌸㍱\0㍺㎤\0\0㏬㏰\0㐨㑈㑚㒭㒱㓊㓱\0㘖\0\0㘳cute;䅛quï➺Ԁ;Eaceinpsyᇭ㋳㋵㋿㌂㌋㌏㌟㌦㌩;檴ǰ㋺\0㋼;檸on;䅡uåᇾĀ;dᇳ㌇il;䅟rc;䅝ƀEas㌖㌘㌛;檶p;檺im;择olint;樓iíሄ;䑁otƀ;be㌴ᵇ㌵担;橦΀Aacmstx㍆㍊㍗㍛㍞㍣㍭rr;懘rĀhr㍐㍒ë∨Ā;oਸ਼਴t耻§䂧i;䀻war;椩mĀin㍩ðnuóñt;朶rĀ;o㍶⁕쀀𝔰Ȁacoy㎂㎆㎑㎠rp;景Āhy㎋㎏cy;䑉;䑈rtɭ㎙\0\0㎜iäᑤaraì⹯耻­䂭Āgm㎨㎴maƀ;fv㎱㎲㎲䏃;䏂Ѐ;deglnprካ㏅㏉㏎㏖㏞㏡㏦ot;橪Ā;q኱ኰĀ;E㏓㏔檞;檠Ā;E㏛㏜檝;檟e;扆lus;樤arr;楲aròᄽȀaeit㏸㐈㐏㐗Āls㏽㐄lsetmé㍪hp;樳parsl;槤Ādlᑣ㐔e;挣Ā;e㐜㐝檪Ā;s㐢㐣檬;쀀⪬︀ƀflp㐮㐳㑂tcy;䑌Ā;b㐸㐹䀯Ā;a㐾㐿槄r;挿f;쀀𝕤aĀdr㑍ЂesĀ;u㑔㑕晠it»㑕ƀcsu㑠㑹㒟Āau㑥㑯pĀ;sᆈ㑫;쀀⊓︀pĀ;sᆴ㑵;쀀⊔︀uĀbp㑿㒏ƀ;esᆗᆜ㒆etĀ;eᆗ㒍ñᆝƀ;esᆨᆭ㒖etĀ;eᆨ㒝ñᆮƀ;afᅻ㒦ְrť㒫ֱ»ᅼaròᅈȀcemt㒹㒾㓂㓅r;쀀𝓈tmîñiì㐕aræᆾĀar㓎㓕rĀ;f㓔ឿ昆Āan㓚㓭ightĀep㓣㓪psiloîỠhé⺯s»⡒ʀbcmnp㓻㕞ሉ㖋㖎Ҁ;Edemnprs㔎㔏㔑㔕㔞㔣㔬㔱㔶抂;櫅ot;檽Ā;dᇚ㔚ot;櫃ult;櫁ĀEe㔨㔪;櫋;把lus;檿arr;楹ƀeiu㔽㕒㕕tƀ;en㔎㕅㕋qĀ;qᇚ㔏eqĀ;q㔫㔨m;櫇Ābp㕚㕜;櫕;櫓c̀;acensᇭ㕬㕲㕹㕻㌦pproø㋺urlyeñᇾñᇳƀaes㖂㖈㌛pproø㌚qñ㌗g;晪ڀ123;Edehlmnps㖩㖬㖯ሜ㖲㖴㗀㗉㗕㗚㗟㗨㗭耻¹䂹耻²䂲耻³䂳;櫆Āos㖹㖼t;檾ub;櫘Ā;dሢ㗅ot;櫄sĀou㗏㗒l;柉b;櫗arr;楻ult;櫂ĀEe㗤㗦;櫌;抋lus;櫀ƀeiu㗴㘉㘌tƀ;enሜ㗼㘂qĀ;qሢ㖲eqĀ;q㗧㗤m;櫈Ābp㘑㘓;櫔;櫖ƀAan㘜㘠㘭rr;懙rĀhr㘦㘨ë∮Ā;oਫ਩war;椪lig耻ß䃟௡㙑㙝㙠ዎ㙳㙹\0㙾㛂\0\0\0\0\0㛛㜃\0㜉㝬\0\0\0㞇ɲ㙖\0\0㙛get;挖;䏄rë๟ƀaey㙦㙫㙰ron;䅥dil;䅣;䑂lrec;挕r;쀀𝔱Ȁeiko㚆㚝㚵㚼ǲ㚋\0㚑eĀ4fኄኁaƀ;sv㚘㚙㚛䎸ym;䏑Ācn㚢㚲kĀas㚨㚮pproø዁im»ኬsðኞĀas㚺㚮ð዁rn耻þ䃾Ǭ̟㛆⋧es膀×;bd㛏㛐㛘䃗Ā;aᤏ㛕r;樱;樰ƀeps㛡㛣㜀á⩍Ȁ;bcf҆㛬㛰㛴ot;挶ir;櫱Ā;o㛹㛼쀀𝕥rk;櫚á㍢rime;怴ƀaip㜏㜒㝤dåቈ΀adempst㜡㝍㝀㝑㝗㝜㝟ngleʀ;dlqr㜰㜱㜶㝀㝂斵own»ᶻeftĀ;e⠀㜾ñम;扜ightĀ;e㊪㝋ñၚot;旬inus;樺lus;樹b;槍ime;樻ezium;揢ƀcht㝲㝽㞁Āry㝷㝻;쀀𝓉;䑆cy;䑛rok;䅧Āio㞋㞎xô᝷headĀlr㞗㞠eftarro÷ࡏightarrow»ཝऀAHabcdfghlmoprstuw㟐㟓㟗㟤㟰㟼㠎㠜㠣㠴㡑㡝㡫㢩㣌㣒㣪㣶ròϭar;楣Ācr㟜㟢ute耻ú䃺òᅐrǣ㟪\0㟭y;䑞ve;䅭Āiy㟵㟺rc耻û䃻;䑃ƀabh㠃㠆㠋ròᎭlac;䅱aòᏃĀir㠓㠘sht;楾;쀀𝔲rave耻ù䃹š㠧㠱rĀlr㠬㠮»ॗ»ႃlk;斀Āct㠹㡍ɯ㠿\0\0㡊rnĀ;e㡅㡆挜r»㡆op;挏ri;旸Āal㡖㡚cr;䅫肻¨͉Āgp㡢㡦on;䅳f;쀀𝕦̀adhlsuᅋ㡸㡽፲㢑㢠ownáᎳarpoonĀlr㢈㢌efô㠭ighô㠯iƀ;hl㢙㢚㢜䏅»ᏺon»㢚parrows;懈ƀcit㢰㣄㣈ɯ㢶\0\0㣁rnĀ;e㢼㢽挝r»㢽op;挎ng;䅯ri;旹cr;쀀𝓊ƀdir㣙㣝㣢ot;拰lde;䅩iĀ;f㜰㣨»᠓Āam㣯㣲rò㢨l耻ü䃼angle;榧ހABDacdeflnoprsz㤜㤟㤩㤭㦵㦸㦽㧟㧤㧨㧳㧹㧽㨁㨠ròϷarĀ;v㤦㤧櫨;櫩asèϡĀnr㤲㤷grt;榜΀eknprst㓣㥆㥋㥒㥝㥤㦖appá␕othinçẖƀhir㓫⻈㥙opô⾵Ā;hᎷ㥢ïㆍĀiu㥩㥭gmá㎳Ābp㥲㦄setneqĀ;q㥽㦀쀀⊊︀;쀀⫋︀setneqĀ;q㦏㦒쀀⊋︀;쀀⫌︀Āhr㦛㦟etá㚜iangleĀlr㦪㦯eft»थight»ၑy;䐲ash»ံƀelr㧄㧒㧗ƀ;beⷪ㧋㧏ar;抻q;扚lip;拮Ābt㧜ᑨaòᑩr;쀀𝔳tré㦮suĀbp㧯㧱»ജ»൙pf;쀀𝕧roð໻tré㦴Ācu㨆㨋r;쀀𝓋Ābp㨐㨘nĀEe㦀㨖»㥾nĀEe㦒㨞»㦐igzag;榚΀cefoprs㨶㨻㩖㩛㩔㩡㩪irc;䅵Ādi㩀㩑Ābg㩅㩉ar;機eĀ;qᗺ㩏;扙erp;愘r;쀀𝔴pf;쀀𝕨Ā;eᑹ㩦atèᑹcr;쀀𝓌ૣណ㪇\0㪋\0㪐㪛\0\0㪝㪨㪫㪯\0\0㫃㫎\0㫘ៜ៟tré៑r;쀀𝔵ĀAa㪔㪗ròσrò৶;䎾ĀAa㪡㪤ròθrò৫að✓is;拻ƀdptឤ㪵㪾Āfl㪺ឩ;쀀𝕩imåឲĀAa㫇㫊ròώròਁĀcq㫒ីr;쀀𝓍Āpt៖㫜ré។Ѐacefiosu㫰㫽㬈㬌㬑㬕㬛㬡cĀuy㫶㫻te耻ý䃽;䑏Āiy㬂㬆rc;䅷;䑋n耻¥䂥r;쀀𝔶cy;䑗pf;쀀𝕪cr;쀀𝓎Ācm㬦㬩y;䑎l耻ÿ䃿Ԁacdefhiosw㭂㭈㭔㭘㭤㭩㭭㭴㭺㮀cute;䅺Āay㭍㭒ron;䅾;䐷ot;䅼Āet㭝㭡træᕟa;䎶r;쀀𝔷cy;䐶grarr;懝pf;쀀𝕫cr;쀀𝓏Ājn㮅㮇;怍j;怌'.split("").map(e=>e.charCodeAt(0))),xmlDecodeTree=new Uint16Array("Ȁaglq	\x1Bɭ\0\0p;䀦os;䀧t;䀾t;䀼uot;䀢".split("").map(e=>e.charCodeAt(0)));var _a;const decodeMap=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),fromCodePoint=(_a=String.fromCodePoint)!==null&&_a!==void 0?_a:function(e){let t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|e&1023),t+=String.fromCharCode(e),t};function replaceCodePoint(e){var t;return e>=55296&&e<=57343||e>1114111?65533:(t=decodeMap.get(e))!==null&&t!==void 0?t:e}var CharCodes$1;(function(e){e[e.NUM=35]="NUM",e[e.SEMI=59]="SEMI",e[e.EQUALS=61]="EQUALS",e[e.ZERO=48]="ZERO",e[e.NINE=57]="NINE",e[e.LOWER_A=97]="LOWER_A",e[e.LOWER_F=102]="LOWER_F",e[e.LOWER_X=120]="LOWER_X",e[e.LOWER_Z=122]="LOWER_Z",e[e.UPPER_A=65]="UPPER_A",e[e.UPPER_F=70]="UPPER_F",e[e.UPPER_Z=90]="UPPER_Z"})(CharCodes$1||(CharCodes$1={}));const TO_LOWER_BIT=32;var BinTrieFlags;(function(e){e[e.VALUE_LENGTH=49152]="VALUE_LENGTH",e[e.BRANCH_LENGTH=16256]="BRANCH_LENGTH",e[e.JUMP_TABLE=127]="JUMP_TABLE"})(BinTrieFlags||(BinTrieFlags={}));function isNumber$1(e){return e>=CharCodes$1.ZERO&&e<=CharCodes$1.NINE}function isHexadecimalCharacter(e){return e>=CharCodes$1.UPPER_A&&e<=CharCodes$1.UPPER_F||e>=CharCodes$1.LOWER_A&&e<=CharCodes$1.LOWER_F}function isAsciiAlphaNumeric$1(e){return e>=CharCodes$1.UPPER_A&&e<=CharCodes$1.UPPER_Z||e>=CharCodes$1.LOWER_A&&e<=CharCodes$1.LOWER_Z||isNumber$1(e)}function isEntityInAttributeInvalidEnd$1(e){return e===CharCodes$1.EQUALS||isAsciiAlphaNumeric$1(e)}var EntityDecoderState;(function(e){e[e.EntityStart=0]="EntityStart",e[e.NumericStart=1]="NumericStart",e[e.NumericDecimal=2]="NumericDecimal",e[e.NumericHex=3]="NumericHex",e[e.NamedEntity=4]="NamedEntity"})(EntityDecoderState||(EntityDecoderState={}));var DecodingMode;(function(e){e[e.Legacy=0]="Legacy",e[e.Strict=1]="Strict",e[e.Attribute=2]="Attribute"})(DecodingMode||(DecodingMode={}));class EntityDecoder{constructor(t,s,n){this.decodeTree=t,this.emitCodePoint=s,this.errors=n,this.state=EntityDecoderState.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=DecodingMode.Strict}startEntity(t){this.decodeMode=t,this.state=EntityDecoderState.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(t,s){switch(this.state){case EntityDecoderState.EntityStart:return t.charCodeAt(s)===CharCodes$1.NUM?(this.state=EntityDecoderState.NumericStart,this.consumed+=1,this.stateNumericStart(t,s+1)):(this.state=EntityDecoderState.NamedEntity,this.stateNamedEntity(t,s));case EntityDecoderState.NumericStart:return this.stateNumericStart(t,s);case EntityDecoderState.NumericDecimal:return this.stateNumericDecimal(t,s);case EntityDecoderState.NumericHex:return this.stateNumericHex(t,s);case EntityDecoderState.NamedEntity:return this.stateNamedEntity(t,s)}}stateNumericStart(t,s){return s>=t.length?-1:(t.charCodeAt(s)|TO_LOWER_BIT)===CharCodes$1.LOWER_X?(this.state=EntityDecoderState.NumericHex,this.consumed+=1,this.stateNumericHex(t,s+1)):(this.state=EntityDecoderState.NumericDecimal,this.stateNumericDecimal(t,s))}addToNumericResult(t,s,n,i){if(s!==n){const r=n-s;this.result=this.result*Math.pow(i,r)+parseInt(t.substr(s,r),i),this.consumed+=r}}stateNumericHex(t,s){const n=s;for(;s<t.length;){const i=t.charCodeAt(s);if(isNumber$1(i)||isHexadecimalCharacter(i))s+=1;else return this.addToNumericResult(t,n,s,16),this.emitNumericEntity(i,3)}return this.addToNumericResult(t,n,s,16),-1}stateNumericDecimal(t,s){const n=s;for(;s<t.length;){const i=t.charCodeAt(s);if(isNumber$1(i))s+=1;else return this.addToNumericResult(t,n,s,10),this.emitNumericEntity(i,2)}return this.addToNumericResult(t,n,s,10),-1}emitNumericEntity(t,s){var n;if(this.consumed<=s)return(n=this.errors)===null||n===void 0||n.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(t===CharCodes$1.SEMI)this.consumed+=1;else if(this.decodeMode===DecodingMode.Strict)return 0;return this.emitCodePoint(replaceCodePoint(this.result),this.consumed),this.errors&&(t!==CharCodes$1.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(t,s){const{decodeTree:n}=this;let i=n[this.treeIndex],r=(i&BinTrieFlags.VALUE_LENGTH)>>14;for(;s<t.length;s++,this.excess++){const d=t.charCodeAt(s);if(this.treeIndex=determineBranch(n,i,this.treeIndex+Math.max(1,r),d),this.treeIndex<0)return this.result===0||this.decodeMode===DecodingMode.Attribute&&(r===0||isEntityInAttributeInvalidEnd$1(d))?0:this.emitNotTerminatedNamedEntity();if(i=n[this.treeIndex],r=(i&BinTrieFlags.VALUE_LENGTH)>>14,r!==0){if(d===CharCodes$1.SEMI)return this.emitNamedEntityData(this.treeIndex,r,this.consumed+this.excess);this.decodeMode!==DecodingMode.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var t;const{result:s,decodeTree:n}=this,i=(n[s]&BinTrieFlags.VALUE_LENGTH)>>14;return this.emitNamedEntityData(s,i,this.consumed),(t=this.errors)===null||t===void 0||t.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(t,s,n){const{decodeTree:i}=this;return this.emitCodePoint(s===1?i[t]&~BinTrieFlags.VALUE_LENGTH:i[t+1],n),s===3&&this.emitCodePoint(i[t+2],n),n}end(){var t;switch(this.state){case EntityDecoderState.NamedEntity:return this.result!==0&&(this.decodeMode!==DecodingMode.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case EntityDecoderState.NumericDecimal:return this.emitNumericEntity(0,2);case EntityDecoderState.NumericHex:return this.emitNumericEntity(0,3);case EntityDecoderState.NumericStart:return(t=this.errors)===null||t===void 0||t.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case EntityDecoderState.EntityStart:return 0}}}function getDecoder(e){let t="";const s=new EntityDecoder(e,n=>t+=fromCodePoint(n));return function(i,r){let d=0,f=0;for(;(f=i.indexOf("&",f))>=0;){t+=i.slice(d,f),s.startEntity(r);const u=s.write(i,f+1);if(u<0){d=f+s.end();break}d=f+u,f=u===0?d+1:d}const m=t+i.slice(d);return t="",m}}function determineBranch(e,t,s,n){const i=(t&BinTrieFlags.BRANCH_LENGTH)>>7,r=t&BinTrieFlags.JUMP_TABLE;if(i===0)return r!==0&&n===r?s:-1;if(r){const m=n-r;return m<0||m>=i?-1:e[s+m]-1}let d=s,f=d+i-1;for(;d<=f;){const m=d+f>>>1,u=e[m];if(u<n)d=m+1;else if(u>n)f=m-1;else return e[m+i]}return-1}getDecoder(htmlDecodeTree),getDecoder(xmlDecodeTree);const xmlReplacer=/["&'<>$\x80-\uFFFF]/g,xmlCodeMap=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]),getCodePoint=String.prototype.codePointAt!=null?(e,t)=>e.codePointAt(t):(e,t)=>(e.charCodeAt(t)&64512)===55296?(e.charCodeAt(t)-55296)*1024+e.charCodeAt(t+1)-56320+65536:e.charCodeAt(t);function encodeXML(e){let t="",s=0,n;for(;(n=xmlReplacer.exec(e))!==null;){const i=n.index,r=e.charCodeAt(i),d=xmlCodeMap.get(r);d!==void 0?(t+=e.substring(s,i)+d,s=i+1):(t+=`${e.substring(s,i)}&#x${getCodePoint(e,i).toString(16)};`,s=xmlReplacer.lastIndex+=+((r&64512)===55296))}return t+e.substr(s)}function getEscaper(e,t){return function(n){let i,r=0,d="";for(;i=e.exec(n);)r!==i.index&&(d+=n.substring(r,i.index)),d+=t.get(i[0].charCodeAt(0)),r=i.index+1;return d+n.substring(r)}}const escapeAttribute=getEscaper(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),escapeText=getEscaper(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]])),elementNames=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(e=>[e.toLowerCase(),e])),attributeNames=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(e=>[e.toLowerCase(),e])),unencodedElements=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function replaceQuotes(e){return e.replace(/"/g,"&quot;")}function formatAttributes(e,t){var s;if(!e)return;const n=((s=t.encodeEntities)!==null&&s!==void 0?s:t.decodeEntities)===!1?replaceQuotes:t.xmlMode||t.encodeEntities!=="utf8"?encodeXML:escapeAttribute;return Object.keys(e).map(i=>{var r,d;const f=(r=e[i])!==null&&r!==void 0?r:"";return t.xmlMode==="foreign"&&(i=(d=attributeNames.get(i))!==null&&d!==void 0?d:i),!t.emptyAttrs&&!t.xmlMode&&f===""?i:`${i}="${n(f)}"`}).join(" ")}const singleTag=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function render$1(e,t={}){const s="length"in e?e:[e];let n="";for(let i=0;i<s.length;i++)n+=renderNode(s[i],t);return n}function renderNode(e,t){switch(e.type){case Root:return render$1(e.children,t);case Doctype:case Directive:return renderDirective(e);case Comment$1:return renderComment(e);case CDATA$1:return renderCdata(e);case Script:case Style:case Tag:return renderTag(e,t);case Text$1:return renderText(e,t)}}const foreignModeIntegrationPoints=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),foreignElements=new Set(["svg","math"]);function renderTag(e,t){var s;t.xmlMode==="foreign"&&(e.name=(s=elementNames.get(e.name))!==null&&s!==void 0?s:e.name,e.parent&&foreignModeIntegrationPoints.has(e.parent.name)&&(t={...t,xmlMode:!1})),!t.xmlMode&&foreignElements.has(e.name)&&(t={...t,xmlMode:"foreign"});let n=`<${e.name}`;const i=formatAttributes(e.attribs,t);return i&&(n+=` ${i}`),e.children.length===0&&(t.xmlMode?t.selfClosingTags!==!1:t.selfClosingTags&&singleTag.has(e.name))?(t.xmlMode||(n+=" "),n+="/>"):(n+=">",e.children.length>0&&(n+=render$1(e.children,t)),(t.xmlMode||!singleTag.has(e.name))&&(n+=`</${e.name}>`)),n}function renderDirective(e){return`<${e.data}>`}function renderText(e,t){var s;let n=e.data||"";return((s=t.encodeEntities)!==null&&s!==void 0?s:t.decodeEntities)!==!1&&!(!t.xmlMode&&e.parent&&unencodedElements.has(e.parent.name))&&(n=t.xmlMode||t.encodeEntities!=="utf8"?encodeXML(n):escapeText(n)),n}function renderCdata(e){return`<![CDATA[${e.children[0].data}]]>`}function renderComment(e){return`<!--${e.data}-->`}function getOuterHTML(e,t){return render$1(e,t)}function getInnerHTML(e,t){return hasChildren(e)?e.children.map(s=>getOuterHTML(s,t)).join(""):""}function getText(e){return Array.isArray(e)?e.map(getText).join(""):isTag(e)?e.name==="br"?`
`:getText(e.children):isCDATA(e)?getText(e.children):isText(e)?e.data:""}function textContent(e){return Array.isArray(e)?e.map(textContent).join(""):hasChildren(e)&&!isComment(e)?textContent(e.children):isText(e)?e.data:""}function innerText(e){return Array.isArray(e)?e.map(innerText).join(""):hasChildren(e)&&(e.type===ElementType.Tag||isCDATA(e))?innerText(e.children):isText(e)?e.data:""}function getChildren(e){return hasChildren(e)?e.children:[]}function getParent(e){return e.parent||null}function getSiblings(e){const t=getParent(e);if(t!=null)return getChildren(t);const s=[e];let{prev:n,next:i}=e;for(;n!=null;)s.unshift(n),{prev:n}=n;for(;i!=null;)s.push(i),{next:i}=i;return s}function getAttributeValue(e,t){var s;return(s=e.attribs)===null||s===void 0?void 0:s[t]}function hasAttrib(e,t){return e.attribs!=null&&Object.prototype.hasOwnProperty.call(e.attribs,t)&&e.attribs[t]!=null}function getName(e){return e.name}function nextElementSibling(e){let{next:t}=e;for(;t!==null&&!isTag(t);)({next:t}=t);return t}function prevElementSibling(e){let{prev:t}=e;for(;t!==null&&!isTag(t);)({prev:t}=t);return t}function removeElement(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){const t=e.parent.children,s=t.lastIndexOf(e);s>=0&&t.splice(s,1)}e.next=null,e.prev=null,e.parent=null}function replaceElement(e,t){const s=t.prev=e.prev;s&&(s.next=t);const n=t.next=e.next;n&&(n.prev=t);const i=t.parent=e.parent;if(i){const r=i.children;r[r.lastIndexOf(e)]=t,e.parent=null}}function appendChild(e,t){if(removeElement(t),t.next=null,t.parent=e,e.children.push(t)>1){const s=e.children[e.children.length-2];s.next=t,t.prev=s}else t.prev=null}function append$1(e,t){removeElement(t);const{parent:s}=e,n=e.next;if(t.next=n,t.prev=e,e.next=t,t.parent=s,n){if(n.prev=t,s){const i=s.children;i.splice(i.lastIndexOf(n),0,t)}}else s&&s.children.push(t)}function prependChild(e,t){if(removeElement(t),t.parent=e,t.prev=null,e.children.unshift(t)!==1){const s=e.children[1];s.prev=t,t.next=s}else t.next=null}function prepend$1(e,t){removeElement(t);const{parent:s}=e;if(s){const n=s.children;n.splice(n.indexOf(e),0,t)}e.prev&&(e.prev.next=t),t.parent=s,t.prev=e.prev,t.next=e,e.prev=t}function filter$2(e,t,s=!0,n=1/0){return find$2(e,Array.isArray(t)?t:[t],s,n)}function find$2(e,t,s,n){const i=[],r=[t],d=[0];for(;;){if(d[0]>=r[0].length){if(d.length===1)return i;r.shift(),d.shift();continue}const f=r[0][d[0]++];if(e(f)&&(i.push(f),--n<=0))return i;s&&hasChildren(f)&&f.children.length>0&&(d.unshift(0),r.unshift(f.children))}}function findOneChild(e,t){return t.find(e)}function findOne(e,t,s=!0){let n=null;for(let i=0;i<t.length&&!n;i++){const r=t[i];if(isTag(r))e(r)?n=r:s&&r.children.length>0&&(n=findOne(e,r.children,!0));else continue}return n}function existsOne(e,t){return t.some(s=>isTag(s)&&(e(s)||existsOne(e,s.children)))}function findAll(e,t){const s=[],n=[t],i=[0];for(;;){if(i[0]>=n[0].length){if(n.length===1)return s;n.shift(),i.shift();continue}const r=n[0][i[0]++];isTag(r)&&(e(r)&&s.push(r),r.children.length>0&&(i.unshift(0),n.unshift(r.children)))}}const Checks={tag_name(e){return typeof e=="function"?t=>isTag(t)&&e(t.name):e==="*"?isTag:t=>isTag(t)&&t.name===e},tag_type(e){return typeof e=="function"?t=>e(t.type):t=>t.type===e},tag_contains(e){return typeof e=="function"?t=>isText(t)&&e(t.data):t=>isText(t)&&t.data===e}};function getAttribCheck(e,t){return typeof t=="function"?s=>isTag(s)&&t(s.attribs[e]):s=>isTag(s)&&s.attribs[e]===t}function combineFuncs(e,t){return s=>e(s)||t(s)}function compileTest(e){const t=Object.keys(e).map(s=>{const n=e[s];return Object.prototype.hasOwnProperty.call(Checks,s)?Checks[s](n):getAttribCheck(s,n)});return t.length===0?null:t.reduce(combineFuncs)}function testElement(e,t){const s=compileTest(e);return s?s(t):!0}function getElements(e,t,s,n=1/0){const i=compileTest(e);return i?filter$2(i,t,s,n):[]}function getElementById(e,t,s=!0){return Array.isArray(t)||(t=[t]),findOne(getAttribCheck("id",e),t,s)}function getElementsByTagName(e,t,s=!0,n=1/0){return filter$2(Checks.tag_name(e),t,s,n)}function getElementsByTagType(e,t,s=!0,n=1/0){return filter$2(Checks.tag_type(e),t,s,n)}function removeSubsets(e){let t=e.length;for(;--t>=0;){const s=e[t];if(t>0&&e.lastIndexOf(s,t-1)>=0){e.splice(t,1);continue}for(let n=s.parent;n;n=n.parent)if(e.includes(n)){e.splice(t,1);break}}return e}var DocumentPosition;(function(e){e[e.DISCONNECTED=1]="DISCONNECTED",e[e.PRECEDING=2]="PRECEDING",e[e.FOLLOWING=4]="FOLLOWING",e[e.CONTAINS=8]="CONTAINS",e[e.CONTAINED_BY=16]="CONTAINED_BY"})(DocumentPosition||(DocumentPosition={}));function compareDocumentPosition(e,t){const s=[],n=[];if(e===t)return 0;let i=hasChildren(e)?e:e.parent;for(;i;)s.unshift(i),i=i.parent;for(i=hasChildren(t)?t:t.parent;i;)n.unshift(i),i=i.parent;const r=Math.min(s.length,n.length);let d=0;for(;d<r&&s[d]===n[d];)d++;if(d===0)return DocumentPosition.DISCONNECTED;const f=s[d-1],m=f.children,u=s[d],a=n[d];return m.indexOf(u)>m.indexOf(a)?f===t?DocumentPosition.FOLLOWING|DocumentPosition.CONTAINED_BY:DocumentPosition.FOLLOWING:f===e?DocumentPosition.PRECEDING|DocumentPosition.CONTAINS:DocumentPosition.PRECEDING}function uniqueSort(e){return e=e.filter((t,s,n)=>!n.includes(t,s+1)),e.sort((t,s)=>{const n=compareDocumentPosition(t,s);return n&DocumentPosition.PRECEDING?-1:n&DocumentPosition.FOLLOWING?1:0}),e}function getFeed(e){const t=getOneElement(isValidFeed,e);return t?t.name==="feed"?getAtomFeed(t):getRssFeed(t):null}function getAtomFeed(e){var t;const s=e.children,n={type:"atom",items:getElementsByTagName("entry",s).map(d=>{var f;const{children:m}=d,u={media:getMediaElements(m)};addConditionally(u,"id","id",m),addConditionally(u,"title","title",m);const a=(f=getOneElement("link",m))===null||f===void 0?void 0:f.attribs.href;a&&(u.link=a);const c=fetch$1("summary",m)||fetch$1("content",m);c&&(u.description=c);const T=fetch$1("updated",m);return T&&(u.pubDate=new Date(T)),u})};addConditionally(n,"id","id",s),addConditionally(n,"title","title",s);const i=(t=getOneElement("link",s))===null||t===void 0?void 0:t.attribs.href;i&&(n.link=i),addConditionally(n,"description","subtitle",s);const r=fetch$1("updated",s);return r&&(n.updated=new Date(r)),addConditionally(n,"author","email",s,!0),n}function getRssFeed(e){var t,s;const n=(s=(t=getOneElement("channel",e.children))===null||t===void 0?void 0:t.children)!==null&&s!==void 0?s:[],i={type:e.name.substr(0,3),id:"",items:getElementsByTagName("item",e.children).map(d=>{const{children:f}=d,m={media:getMediaElements(f)};addConditionally(m,"id","guid",f),addConditionally(m,"title","title",f),addConditionally(m,"link","link",f),addConditionally(m,"description","description",f);const u=fetch$1("pubDate",f)||fetch$1("dc:date",f);return u&&(m.pubDate=new Date(u)),m})};addConditionally(i,"title","title",n),addConditionally(i,"link","link",n),addConditionally(i,"description","description",n);const r=fetch$1("lastBuildDate",n);return r&&(i.updated=new Date(r)),addConditionally(i,"author","managingEditor",n,!0),i}const MEDIA_KEYS_STRING=["url","type","lang"],MEDIA_KEYS_INT=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function getMediaElements(e){return getElementsByTagName("media:content",e).map(t=>{const{attribs:s}=t,n={medium:s.medium,isDefault:!!s.isDefault};for(const i of MEDIA_KEYS_STRING)s[i]&&(n[i]=s[i]);for(const i of MEDIA_KEYS_INT)s[i]&&(n[i]=parseInt(s[i],10));return s.expression&&(n.expression=s.expression),n})}function getOneElement(e,t){return getElementsByTagName(e,t,!0,1)[0]}function fetch$1(e,t,s=!1){return textContent(getElementsByTagName(e,t,s,1)).trim()}function addConditionally(e,t,s,n,i=!1){const r=fetch$1(s,n,i);r&&(e[t]=r)}function isValidFeed(e){return e==="rss"||e==="feed"||e==="rdf:RDF"}const DomUtils=Object.freeze(Object.defineProperty({__proto__:null,get DocumentPosition(){return DocumentPosition},append:append$1,appendChild,compareDocumentPosition,existsOne,filter:filter$2,find:find$2,findAll,findOne,findOneChild,getAttributeValue,getChildren,getElementById,getElements,getElementsByTagName,getElementsByTagType,getFeed,getInnerHTML,getName,getOuterHTML,getParent,getSiblings,getText,hasAttrib,hasChildren,innerText,isCDATA,isComment,isDocument,isTag,isText,nextElementSibling,prepend:prepend$1,prependChild,prevElementSibling,removeElement,removeSubsets,replaceElement,testElement,textContent,uniqueSort},Symbol.toStringTag,{value:"Module"}));function render(e,t,s){return e?e(t??e._root.children,null,void 0,s).toString():""}function isOptions(e,t){return!t&&typeof e=="object"&&e!=null&&!("length"in e)&&!("type"in e)}function html$1(e,t){const s=isOptions(e)?(t=e,void 0):e,n={...defaultOpts$2,...this===null||this===void 0?void 0:this._options,...flatten(t??{})};return render(this,s,n)}function xml(e){const t={...this._options,xmlMode:!0};return render(this,e,t)}function text$1(e){const t=e||(this?this.root():[]);let s="";for(let n=0;n<t.length;n++)s+=textContent(t[n]);return s}function parseHTML(e,t,s=typeof t=="boolean"?t:!1){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(s=t);const n=this.load(e,defaultOpts$2,!1);return s||n("script").remove(),n.root()[0].children.slice()}function root$1(){return this(this._root)}function contains(e,t){if(t===e)return!1;let s=t;for(;s&&s!==s.parent;)if(s=s.parent,s===e)return!0;return!1}function merge(e,t){if(!isArrayLike(e)||!isArrayLike(t))return;let s=e.length;const n=+t.length;for(let i=0;i<n;i++)e[s++]=t[i];return e.length=s,e}function isArrayLike(e){if(Array.isArray(e))return!0;if(typeof e!="object"||!Object.prototype.hasOwnProperty.call(e,"length")||typeof e.length!="number"||e.length<0)return!1;for(let t=0;t<e.length;t++)if(!(t in e))return!1;return!0}const staticMethods=Object.freeze(Object.defineProperty({__proto__:null,contains,html:html$1,merge,parseHTML,root:root$1,text:text$1,xml},Symbol.toStringTag,{value:"Module"}));function isCheerio(e){return e.cheerio!=null}function camelCase(e){return e.replace(/[_.-](\w|$)/g,(t,s)=>s.toUpperCase())}function cssCase(e){return e.replace(/[A-Z]/g,"-$&").toLowerCase()}function domEach(e,t){const s=e.length;for(let n=0;n<s;n++)t(e[n],n);return e}function cloneDom(e){const t="length"in e?Array.prototype.map.call(e,n=>cloneNode(n,!0)):[cloneNode(e,!0)],s=new Document(t);return t.forEach(n=>{n.parent=s}),t}var CharacterCodes;(function(e){e[e.LowerA=97]="LowerA",e[e.LowerZ=122]="LowerZ",e[e.UpperA=65]="UpperA",e[e.UpperZ=90]="UpperZ",e[e.Exclamation=33]="Exclamation"})(CharacterCodes||(CharacterCodes={}));function isHtml(e){const t=e.indexOf("<");if(t<0||t>e.length-3)return!1;const s=e.charCodeAt(t+1);return(s>=CharacterCodes.LowerA&&s<=CharacterCodes.LowerZ||s>=CharacterCodes.UpperA&&s<=CharacterCodes.UpperZ||s===CharacterCodes.Exclamation)&&e.includes(">",t+2)}const hasOwn=Object.prototype.hasOwnProperty,rspace=/\s+/,dataAttrPrefix="data-",primitives={null:null,true:!0,false:!1},rboolean=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,rbrace=/^{[^]*}$|^\[[^]*]$/;function getAttr(e,t,s){var n;if(!(!e||!isTag(e))){if((n=e.attribs)!==null&&n!==void 0||(e.attribs={}),!t)return e.attribs;if(hasOwn.call(e.attribs,t))return!s&&rboolean.test(t)?t:e.attribs[t];if(e.name==="option"&&t==="value")return text$1(e.children);if(e.name==="input"&&(e.attribs.type==="radio"||e.attribs.type==="checkbox")&&t==="value")return"on"}}function setAttr(e,t,s){s===null?removeAttribute(e,t):e.attribs[t]=`${s}`}function attr(e,t){if(typeof e=="object"||t!==void 0){if(typeof t=="function"){if(typeof e!="string")throw new Error("Bad combination of arguments.");return domEach(this,(s,n)=>{isTag(s)&&setAttr(s,e,t.call(s,n,s.attribs[e]))})}return domEach(this,s=>{isTag(s)&&(typeof e=="object"?Object.keys(e).forEach(n=>{const i=e[n];setAttr(s,n,i)}):setAttr(s,e,t))})}return arguments.length>1?this:getAttr(this[0],e,this.options.xmlMode)}function getProp(e,t,s){return t in e?e[t]:!s&&rboolean.test(t)?getAttr(e,t,!1)!==void 0:getAttr(e,t,s)}function setProp(e,t,s,n){t in e?e[t]=s:setAttr(e,t,!n&&rboolean.test(t)?s?"":null:`${s}`)}function prop(e,t){var s;if(typeof e=="string"&&t===void 0){const n=this[0];if(!n||!isTag(n))return;switch(e){case"style":{const i=this.css(),r=Object.keys(i);return r.forEach((d,f)=>{i[f]=d}),i.length=r.length,i}case"tagName":case"nodeName":return n.name.toUpperCase();case"href":case"src":{const i=(s=n.attribs)===null||s===void 0?void 0:s[e];return typeof URL<"u"&&(e==="href"&&(n.tagName==="a"||n.name==="link")||e==="src"&&(n.tagName==="img"||n.tagName==="iframe"||n.tagName==="audio"||n.tagName==="video"||n.tagName==="source"))&&i!==void 0&&this.options.baseURI?new URL(i,this.options.baseURI).href:i}case"innerText":return innerText(n);case"textContent":return textContent(n);case"outerHTML":return this.clone().wrap("<container />").parent().html();case"innerHTML":return this.html();default:return getProp(n,e,this.options.xmlMode)}}if(typeof e=="object"||t!==void 0){if(typeof t=="function"){if(typeof e=="object")throw new Error("Bad combination of arguments.");return domEach(this,(n,i)=>{isTag(n)&&setProp(n,e,t.call(n,i,getProp(n,e,this.options.xmlMode)),this.options.xmlMode)})}return domEach(this,n=>{isTag(n)&&(typeof e=="object"?Object.keys(e).forEach(i=>{const r=e[i];setProp(n,i,r,this.options.xmlMode)}):setProp(n,e,t,this.options.xmlMode))})}}function setData(e,t,s){var n;const i=e;(n=i.data)!==null&&n!==void 0||(i.data={}),typeof t=="object"?Object.assign(i.data,t):typeof t=="string"&&s!==void 0&&(i.data[t]=s)}function readData(e,t){let s,n,i;t==null?(s=Object.keys(e.attribs).filter(r=>r.startsWith(dataAttrPrefix)),n=s.map(r=>camelCase(r.slice(dataAttrPrefix.length)))):(s=[dataAttrPrefix+cssCase(t)],n=[t]);for(let r=0;r<s.length;++r){const d=s[r],f=n[r];if(hasOwn.call(e.attribs,d)&&!hasOwn.call(e.data,f)){if(i=e.attribs[d],hasOwn.call(primitives,i))i=primitives[i];else if(i===String(Number(i)))i=Number(i);else if(rbrace.test(i))try{i=JSON.parse(i)}catch{}e.data[f]=i}}return t==null?e.data:i}function data(e,t){var s;const n=this[0];if(!n||!isTag(n))return;const i=n;return(s=i.data)!==null&&s!==void 0||(i.data={}),e?typeof e=="object"||t!==void 0?(domEach(this,r=>{isTag(r)&&(typeof e=="object"?setData(r,e):setData(r,e,t))}),this):hasOwn.call(i.data,e)?i.data[e]:readData(i,e):readData(i)}function val(e){const t=arguments.length===0,s=this[0];if(!s||!isTag(s))return t?void 0:this;switch(s.name){case"textarea":return this.text(e);case"select":{const n=this.find("option:selected");if(!t){if(this.attr("multiple")==null&&typeof e=="object")return this;this.find("option").removeAttr("selected");const i=typeof e!="object"?[e]:e;for(let r=0;r<i.length;r++)this.find(`option[value="${i[r]}"]`).attr("selected","");return this}return this.attr("multiple")?n.toArray().map(i=>text$1(i.children)):n.attr("value")}case"input":case"option":return t?this.attr("value"):this.attr("value",e)}}function removeAttribute(e,t){!e.attribs||!hasOwn.call(e.attribs,t)||delete e.attribs[t]}function splitNames(e){return e?e.trim().split(rspace):[]}function removeAttr(e){const t=splitNames(e);for(let s=0;s<t.length;s++)domEach(this,n=>{isTag(n)&&removeAttribute(n,t[s])});return this}function hasClass(e){return this.toArray().some(t=>{const s=isTag(t)&&t.attribs.class;let n=-1;if(s&&e.length)for(;(n=s.indexOf(e,n+1))>-1;){const i=n+e.length;if((n===0||rspace.test(s[n-1]))&&(i===s.length||rspace.test(s[i])))return!0}return!1})}function addClass(e){if(typeof e=="function")return domEach(this,(n,i)=>{if(isTag(n)){const r=n.attribs.class||"";addClass.call([n],e.call(n,i,r))}});if(!e||typeof e!="string")return this;const t=e.split(rspace),s=this.length;for(let n=0;n<s;n++){const i=this[n];if(!isTag(i))continue;const r=getAttr(i,"class",!1);if(!r)setAttr(i,"class",t.join(" ").trim());else{let d=` ${r} `;for(let f=0;f<t.length;f++){const m=`${t[f]} `;d.includes(` ${m}`)||(d+=m)}setAttr(i,"class",d.trim())}}return this}function removeClass(e){if(typeof e=="function")return domEach(this,(i,r)=>{isTag(i)&&removeClass.call([i],e.call(i,r,i.attribs.class||""))});const t=splitNames(e),s=t.length,n=arguments.length===0;return domEach(this,i=>{if(isTag(i))if(n)i.attribs.class="";else{const r=splitNames(i.attribs.class);let d=!1;for(let f=0;f<s;f++){const m=r.indexOf(t[f]);m>=0&&(r.splice(m,1),d=!0,f--)}d&&(i.attribs.class=r.join(" "))}})}function toggleClass(e,t){if(typeof e=="function")return domEach(this,(d,f)=>{isTag(d)&&toggleClass.call([d],e.call(d,f,d.attribs.class||"",t),t)});if(!e||typeof e!="string")return this;const s=e.split(rspace),n=s.length,i=typeof t=="boolean"?t?1:-1:0,r=this.length;for(let d=0;d<r;d++){const f=this[d];if(!isTag(f))continue;const m=splitNames(f.attribs.class);for(let u=0;u<n;u++){const a=m.indexOf(s[u]);i>=0&&a<0?m.push(s[u]):i<=0&&a>=0&&m.splice(a,1)}f.attribs.class=m.join(" ")}return this}const Attributes=Object.freeze(Object.defineProperty({__proto__:null,addClass,attr,data,hasClass,prop,removeAttr,removeClass,toggleClass,val},Symbol.toStringTag,{value:"Module"}));var SelectorType;(function(e){e.Attribute="attribute",e.Pseudo="pseudo",e.PseudoElement="pseudo-element",e.Tag="tag",e.Universal="universal",e.Adjacent="adjacent",e.Child="child",e.Descendant="descendant",e.Parent="parent",e.Sibling="sibling",e.ColumnCombinator="column-combinator"})(SelectorType||(SelectorType={}));var AttributeAction;(function(e){e.Any="any",e.Element="element",e.End="end",e.Equals="equals",e.Exists="exists",e.Hyphen="hyphen",e.Not="not",e.Start="start"})(AttributeAction||(AttributeAction={}));const reName=/^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,reEscape=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,actionTypes=new Map([[126,AttributeAction.Element],[94,AttributeAction.Start],[36,AttributeAction.End],[42,AttributeAction.Any],[33,AttributeAction.Not],[124,AttributeAction.Hyphen]]),unpackPseudos=new Set(["has","not","matches","is","where","host","host-context"]);function isTraversal$1(e){switch(e.type){case SelectorType.Adjacent:case SelectorType.Child:case SelectorType.Descendant:case SelectorType.Parent:case SelectorType.Sibling:case SelectorType.ColumnCombinator:return!0;default:return!1}}const stripQuotesFromPseudos=new Set(["contains","icontains"]);function funescape(e,t,s){const n=parseInt(t,16)-65536;return n!==n||s?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,n&1023|56320)}function unescapeCSS(e){return e.replace(reEscape,funescape)}function isQuote(e){return e===39||e===34}function isWhitespace$2(e){return e===32||e===9||e===10||e===12||e===13}function parse$4(e){const t=[],s=parseSelector(t,`${e}`,0);if(s<e.length)throw new Error(`Unmatched selector: ${e.slice(s)}`);return t}function parseSelector(e,t,s){let n=[];function i(T){const p=t.slice(s+T).match(reName);if(!p)throw new Error(`Expected name, found ${t.slice(s)}`);const[h]=p;return s+=T+h.length,unescapeCSS(h)}function r(T){for(s+=T;s<t.length&&isWhitespace$2(t.charCodeAt(s));)s++}function d(){s+=1;const T=s;let p=1;for(;p>0&&s<t.length;s++)t.charCodeAt(s)===40&&!f(s)?p++:t.charCodeAt(s)===41&&!f(s)&&p--;if(p)throw new Error("Parenthesis not matched");return unescapeCSS(t.slice(T,s-1))}function f(T){let p=0;for(;t.charCodeAt(--T)===92;)p++;return(p&1)===1}function m(){if(n.length>0&&isTraversal$1(n[n.length-1]))throw new Error("Did not expect successive traversals.")}function u(T){if(n.length>0&&n[n.length-1].type===SelectorType.Descendant){n[n.length-1].type=T;return}m(),n.push({type:T})}function a(T,p){n.push({type:SelectorType.Attribute,name:T,action:p,value:i(1),namespace:null,ignoreCase:"quirks"})}function c(){if(n.length&&n[n.length-1].type===SelectorType.Descendant&&n.pop(),n.length===0)throw new Error("Empty sub-selector");e.push(n)}if(r(0),t.length===s)return s;e:for(;s<t.length;){const T=t.charCodeAt(s);switch(T){case 32:case 9:case 10:case 12:case 13:{(n.length===0||n[0].type!==SelectorType.Descendant)&&(m(),n.push({type:SelectorType.Descendant})),r(1);break}case 62:{u(SelectorType.Child),r(1);break}case 60:{u(SelectorType.Parent),r(1);break}case 126:{u(SelectorType.Sibling),r(1);break}case 43:{u(SelectorType.Adjacent),r(1);break}case 46:{a("class",AttributeAction.Element);break}case 35:{a("id",AttributeAction.Equals);break}case 91:{r(1);let p,h=null;t.charCodeAt(s)===124?p=i(1):t.startsWith("*|",s)?(h="*",p=i(2)):(p=i(0),t.charCodeAt(s)===124&&t.charCodeAt(s+1)!==61&&(h=p,p=i(1))),r(0);let _=AttributeAction.Exists;const I=actionTypes.get(t.charCodeAt(s));if(I){if(_=I,t.charCodeAt(s+1)!==61)throw new Error("Expected `=`");r(2)}else t.charCodeAt(s)===61&&(_=AttributeAction.Equals,r(1));let A="",O=null;if(_!=="exists"){if(isQuote(t.charCodeAt(s))){const C=t.charCodeAt(s);let y=s+1;for(;y<t.length&&(t.charCodeAt(y)!==C||f(y));)y+=1;if(t.charCodeAt(y)!==C)throw new Error("Attribute value didn't end");A=unescapeCSS(t.slice(s+1,y)),s=y+1}else{const C=s;for(;s<t.length&&(!isWhitespace$2(t.charCodeAt(s))&&t.charCodeAt(s)!==93||f(s));)s+=1;A=unescapeCSS(t.slice(C,s))}r(0);const P=t.charCodeAt(s)|32;P===115?(O=!1,r(1)):P===105&&(O=!0,r(1))}if(t.charCodeAt(s)!==93)throw new Error("Attribute selector didn't terminate");s+=1;const w={type:SelectorType.Attribute,name:p,action:_,value:A,namespace:h,ignoreCase:O};n.push(w);break}case 58:{if(t.charCodeAt(s+1)===58){n.push({type:SelectorType.PseudoElement,name:i(2).toLowerCase(),data:t.charCodeAt(s)===40?d():null});continue}const p=i(1).toLowerCase();let h=null;if(t.charCodeAt(s)===40)if(unpackPseudos.has(p)){if(isQuote(t.charCodeAt(s+1)))throw new Error(`Pseudo-selector ${p} cannot be quoted`);if(h=[],s=parseSelector(h,t,s+1),t.charCodeAt(s)!==41)throw new Error(`Missing closing parenthesis in :${p} (${t})`);s+=1}else{if(h=d(),stripQuotesFromPseudos.has(p)){const _=h.charCodeAt(0);_===h.charCodeAt(h.length-1)&&isQuote(_)&&(h=h.slice(1,-1))}h=unescapeCSS(h)}n.push({type:SelectorType.Pseudo,name:p,data:h});break}case 44:{c(),n=[],r(1);break}default:{if(t.startsWith("/*",s)){const _=t.indexOf("*/",s+2);if(_<0)throw new Error("Comment was not terminated");s=_+2,n.length===0&&r(0);break}let p=null,h;if(T===42)s+=1,h="*";else if(T===124){if(h="",t.charCodeAt(s+1)===124){u(SelectorType.ColumnCombinator),r(2);break}}else if(reName.test(t.slice(s)))h=i(0);else break e;t.charCodeAt(s)===124&&t.charCodeAt(s+1)!==124&&(p=h,t.charCodeAt(s+1)===42?(h="*",s+=2):h=i(1)),n.push(h==="*"?{type:SelectorType.Universal,namespace:p}:{type:SelectorType.Tag,name:h,namespace:p})}}}return c(),s}var boolbase={trueFunc:function(){return!0},falseFunc:function(){return!1}};const boolbase$1=getDefaultExportFromCjs(boolbase),procedure=new Map([[SelectorType.Universal,50],[SelectorType.Tag,30],[SelectorType.Attribute,1],[SelectorType.Pseudo,0]]);function isTraversal(e){return!procedure.has(e.type)}const attributes=new Map([[AttributeAction.Exists,10],[AttributeAction.Equals,8],[AttributeAction.Not,7],[AttributeAction.Start,6],[AttributeAction.End,6],[AttributeAction.Any,5]]);function sortByProcedure(e){const t=e.map(getProcedure);for(let s=1;s<e.length;s++){const n=t[s];if(!(n<0))for(let i=s-1;i>=0&&n<t[i];i--){const r=e[i+1];e[i+1]=e[i],e[i]=r,t[i+1]=t[i],t[i]=n}}}function getProcedure(e){var t,s;let n=(t=procedure.get(e.type))!==null&&t!==void 0?t:-1;return e.type===SelectorType.Attribute?(n=(s=attributes.get(e.action))!==null&&s!==void 0?s:4,e.action===AttributeAction.Equals&&e.name==="id"&&(n=9),e.ignoreCase&&(n>>=1)):e.type===SelectorType.Pseudo&&(e.data?e.name==="has"||e.name==="contains"?n=0:Array.isArray(e.data)?(n=Math.min(...e.data.map(i=>Math.min(...i.map(getProcedure)))),n<0&&(n=0)):n=2:n=3),n}const reChars=/[-[\]{}()*+?.,\\^$|#\s]/g;function escapeRegex(e){return e.replace(reChars,"\\$&")}const caseInsensitiveAttributes=new Set(["accept","accept-charset","align","alink","axis","bgcolor","charset","checked","clear","codetype","color","compact","declare","defer","dir","direction","disabled","enctype","face","frame","hreflang","http-equiv","lang","language","link","media","method","multiple","nohref","noresize","noshade","nowrap","readonly","rel","rev","rules","scope","scrolling","selected","shape","target","text","type","valign","valuetype","vlink"]);function shouldIgnoreCase(e,t){return typeof e.ignoreCase=="boolean"?e.ignoreCase:e.ignoreCase==="quirks"?!!t.quirksMode:!t.xmlMode&&caseInsensitiveAttributes.has(e.name)}const attributeRules={equals(e,t,s){const{adapter:n}=s,{name:i}=t;let{value:r}=t;return shouldIgnoreCase(t,s)?(r=r.toLowerCase(),d=>{const f=n.getAttributeValue(d,i);return f!=null&&f.length===r.length&&f.toLowerCase()===r&&e(d)}):d=>n.getAttributeValue(d,i)===r&&e(d)},hyphen(e,t,s){const{adapter:n}=s,{name:i}=t;let{value:r}=t;const d=r.length;return shouldIgnoreCase(t,s)?(r=r.toLowerCase(),function(m){const u=n.getAttributeValue(m,i);return u!=null&&(u.length===d||u.charAt(d)==="-")&&u.substr(0,d).toLowerCase()===r&&e(m)}):function(m){const u=n.getAttributeValue(m,i);return u!=null&&(u.length===d||u.charAt(d)==="-")&&u.substr(0,d)===r&&e(m)}},element(e,t,s){const{adapter:n}=s,{name:i,value:r}=t;if(/\s/.test(r))return boolbase$1.falseFunc;const d=new RegExp(`(?:^|\\s)${escapeRegex(r)}(?:$|\\s)`,shouldIgnoreCase(t,s)?"i":"");return function(m){const u=n.getAttributeValue(m,i);return u!=null&&u.length>=r.length&&d.test(u)&&e(m)}},exists(e,{name:t},{adapter:s}){return n=>s.hasAttrib(n,t)&&e(n)},start(e,t,s){const{adapter:n}=s,{name:i}=t;let{value:r}=t;const d=r.length;return d===0?boolbase$1.falseFunc:shouldIgnoreCase(t,s)?(r=r.toLowerCase(),f=>{const m=n.getAttributeValue(f,i);return m!=null&&m.length>=d&&m.substr(0,d).toLowerCase()===r&&e(f)}):f=>{var m;return!!(!((m=n.getAttributeValue(f,i))===null||m===void 0)&&m.startsWith(r))&&e(f)}},end(e,t,s){const{adapter:n}=s,{name:i}=t;let{value:r}=t;const d=-r.length;return d===0?boolbase$1.falseFunc:shouldIgnoreCase(t,s)?(r=r.toLowerCase(),f=>{var m;return((m=n.getAttributeValue(f,i))===null||m===void 0?void 0:m.substr(d).toLowerCase())===r&&e(f)}):f=>{var m;return!!(!((m=n.getAttributeValue(f,i))===null||m===void 0)&&m.endsWith(r))&&e(f)}},any(e,t,s){const{adapter:n}=s,{name:i,value:r}=t;if(r==="")return boolbase$1.falseFunc;if(shouldIgnoreCase(t,s)){const d=new RegExp(escapeRegex(r),"i");return function(m){const u=n.getAttributeValue(m,i);return u!=null&&u.length>=r.length&&d.test(u)&&e(m)}}return d=>{var f;return!!(!((f=n.getAttributeValue(d,i))===null||f===void 0)&&f.includes(r))&&e(d)}},not(e,t,s){const{adapter:n}=s,{name:i}=t;let{value:r}=t;return r===""?d=>!!n.getAttributeValue(d,i)&&e(d):shouldIgnoreCase(t,s)?(r=r.toLowerCase(),d=>{const f=n.getAttributeValue(d,i);return(f==null||f.length!==r.length||f.toLowerCase()!==r)&&e(d)}):d=>n.getAttributeValue(d,i)!==r&&e(d)}},whitespace=new Set([9,10,12,13,32]),ZERO=48,NINE=57;function parse$3(e){if(e=e.trim().toLowerCase(),e==="even")return[2,0];if(e==="odd")return[2,1];let t=0,s=0,n=r(),i=d();if(t<e.length&&e.charAt(t)==="n"&&(t++,s=n*(i??1),f(),t<e.length?(n=r(),f(),i=d()):n=i=0),i===null||t<e.length)throw new Error(`n-th rule couldn't be parsed ('${e}')`);return[s,n*i];function r(){return e.charAt(t)==="-"?(t++,-1):(e.charAt(t)==="+"&&t++,1)}function d(){const m=t;let u=0;for(;t<e.length&&e.charCodeAt(t)>=ZERO&&e.charCodeAt(t)<=NINE;)u=u*10+(e.charCodeAt(t)-ZERO),t++;return t===m?null:u}function f(){for(;t<e.length&&whitespace.has(e.charCodeAt(t));)t++}}function compile(e){const t=e[0],s=e[1]-1;if(s<0&&t<=0)return boolbase$1.falseFunc;if(t===-1)return r=>r<=s;if(t===0)return r=>r===s;if(t===1)return s<0?boolbase$1.trueFunc:r=>r>=s;const n=Math.abs(t),i=(s%n+n)%n;return t>1?r=>r>=s&&r%n===i:r=>r<=s&&r%n===i}function nthCheck(e){return compile(parse$3(e))}function getChildFunc(e,t){return s=>{const n=t.getParent(s);return n!=null&&t.isTag(n)&&e(s)}}const filters={contains(e,t,{adapter:s}){return function(i){return e(i)&&s.getText(i).includes(t)}},icontains(e,t,{adapter:s}){const n=t.toLowerCase();return function(r){return e(r)&&s.getText(r).toLowerCase().includes(n)}},"nth-child"(e,t,{adapter:s,equals:n}){const i=nthCheck(t);return i===boolbase$1.falseFunc?boolbase$1.falseFunc:i===boolbase$1.trueFunc?getChildFunc(e,s):function(d){const f=s.getSiblings(d);let m=0;for(let u=0;u<f.length&&!n(d,f[u]);u++)s.isTag(f[u])&&m++;return i(m)&&e(d)}},"nth-last-child"(e,t,{adapter:s,equals:n}){const i=nthCheck(t);return i===boolbase$1.falseFunc?boolbase$1.falseFunc:i===boolbase$1.trueFunc?getChildFunc(e,s):function(d){const f=s.getSiblings(d);let m=0;for(let u=f.length-1;u>=0&&!n(d,f[u]);u--)s.isTag(f[u])&&m++;return i(m)&&e(d)}},"nth-of-type"(e,t,{adapter:s,equals:n}){const i=nthCheck(t);return i===boolbase$1.falseFunc?boolbase$1.falseFunc:i===boolbase$1.trueFunc?getChildFunc(e,s):function(d){const f=s.getSiblings(d);let m=0;for(let u=0;u<f.length;u++){const a=f[u];if(n(d,a))break;s.isTag(a)&&s.getName(a)===s.getName(d)&&m++}return i(m)&&e(d)}},"nth-last-of-type"(e,t,{adapter:s,equals:n}){const i=nthCheck(t);return i===boolbase$1.falseFunc?boolbase$1.falseFunc:i===boolbase$1.trueFunc?getChildFunc(e,s):function(d){const f=s.getSiblings(d);let m=0;for(let u=f.length-1;u>=0;u--){const a=f[u];if(n(d,a))break;s.isTag(a)&&s.getName(a)===s.getName(d)&&m++}return i(m)&&e(d)}},root(e,t,{adapter:s}){return n=>{const i=s.getParent(n);return(i==null||!s.isTag(i))&&e(n)}},scope(e,t,s,n){const{equals:i}=s;return!n||n.length===0?filters.root(e,t,s):n.length===1?r=>i(n[0],r)&&e(r):r=>n.includes(r)&&e(r)},hover:dynamicStatePseudo("isHovered"),visited:dynamicStatePseudo("isVisited"),active:dynamicStatePseudo("isActive")};function dynamicStatePseudo(e){return function(s,n,{adapter:i}){const r=i[e];return typeof r!="function"?boolbase$1.falseFunc:function(f){return r(f)&&s(f)}}}const pseudos={empty(e,{adapter:t}){return!t.getChildren(e).some(s=>t.isTag(s)||t.getText(s)!=="")},"first-child"(e,{adapter:t,equals:s}){if(t.prevElementSibling)return t.prevElementSibling(e)==null;const n=t.getSiblings(e).find(i=>t.isTag(i));return n!=null&&s(e,n)},"last-child"(e,{adapter:t,equals:s}){const n=t.getSiblings(e);for(let i=n.length-1;i>=0;i--){if(s(e,n[i]))return!0;if(t.isTag(n[i]))break}return!1},"first-of-type"(e,{adapter:t,equals:s}){const n=t.getSiblings(e),i=t.getName(e);for(let r=0;r<n.length;r++){const d=n[r];if(s(e,d))return!0;if(t.isTag(d)&&t.getName(d)===i)break}return!1},"last-of-type"(e,{adapter:t,equals:s}){const n=t.getSiblings(e),i=t.getName(e);for(let r=n.length-1;r>=0;r--){const d=n[r];if(s(e,d))return!0;if(t.isTag(d)&&t.getName(d)===i)break}return!1},"only-of-type"(e,{adapter:t,equals:s}){const n=t.getName(e);return t.getSiblings(e).every(i=>s(e,i)||!t.isTag(i)||t.getName(i)!==n)},"only-child"(e,{adapter:t,equals:s}){return t.getSiblings(e).every(n=>s(e,n)||!t.isTag(n))}};function verifyPseudoArgs(e,t,s,n){if(s===null){if(e.length>n)throw new Error(`Pseudo-class :${t} requires an argument`)}else if(e.length===n)throw new Error(`Pseudo-class :${t} doesn't have any arguments`)}const aliases={"any-link":":is(a, area, link)[href]",link:":any-link:not(:visited)",disabled:`:is(
        :is(button, input, select, textarea, optgroup, option)[disabled],
        optgroup[disabled] > option,
        fieldset[disabled]:not(fieldset[disabled] legend:first-of-type *)
    )`,enabled:":not(:disabled)",checked:":is(:is(input[type=radio], input[type=checkbox])[checked], option:selected)",required:":is(input, select, textarea)[required]",optional:":is(input, select, textarea):not([required])",selected:"option:is([selected], select:not([multiple]):not(:has(> option[selected])) > :first-of-type)",checkbox:"[type=checkbox]",file:"[type=file]",password:"[type=password]",radio:"[type=radio]",reset:"[type=reset]",image:"[type=image]",submit:"[type=submit]",parent:":not(:empty)",header:":is(h1, h2, h3, h4, h5, h6)",button:":is(button, input[type=button])",input:":is(input, textarea, select, button)",text:"input:is(:not([type!='']), [type=text])"},PLACEHOLDER_ELEMENT={};function ensureIsTag(e,t){return e===boolbase$1.falseFunc?boolbase$1.falseFunc:s=>t.isTag(s)&&e(s)}function getNextSiblings(e,t){const s=t.getSiblings(e);if(s.length<=1)return[];const n=s.indexOf(e);return n<0||n===s.length-1?[]:s.slice(n+1).filter(t.isTag)}function copyOptions(e){return{xmlMode:!!e.xmlMode,lowerCaseAttributeNames:!!e.lowerCaseAttributeNames,lowerCaseTags:!!e.lowerCaseTags,quirksMode:!!e.quirksMode,cacheResults:!!e.cacheResults,pseudos:e.pseudos,adapter:e.adapter,equals:e.equals}}const is$3=(e,t,s,n,i)=>{const r=i(t,copyOptions(s),n);return r===boolbase$1.trueFunc?e:r===boolbase$1.falseFunc?boolbase$1.falseFunc:d=>r(d)&&e(d)},subselects={is:is$3,matches:is$3,where:is$3,not(e,t,s,n,i){const r=i(t,copyOptions(s),n);return r===boolbase$1.falseFunc?e:r===boolbase$1.trueFunc?boolbase$1.falseFunc:d=>!r(d)&&e(d)},has(e,t,s,n,i){const{adapter:r}=s,d=copyOptions(s);d.relativeSelector=!0;const f=t.some(a=>a.some(isTraversal))?[PLACEHOLDER_ELEMENT]:void 0,m=i(t,d,f);if(m===boolbase$1.falseFunc)return boolbase$1.falseFunc;const u=ensureIsTag(m,r);if(f&&m!==boolbase$1.trueFunc){const{shouldTestNextSiblings:a=!1}=m;return c=>{if(!e(c))return!1;f[0]=c;const T=r.getChildren(c),p=a?[...T,...getNextSiblings(c,r)]:T;return r.existsOne(u,p)}}return a=>e(a)&&r.existsOne(u,r.getChildren(a))}};function compilePseudoSelector(e,t,s,n,i){var r;const{name:d,data:f}=t;if(Array.isArray(f)){if(!(d in subselects))throw new Error(`Unknown pseudo-class :${d}(${f})`);return subselects[d](e,f,s,n,i)}const m=(r=s.pseudos)===null||r===void 0?void 0:r[d],u=typeof m=="string"?m:aliases[d];if(typeof u=="string"){if(f!=null)throw new Error(`Pseudo ${d} doesn't have any arguments`);const a=parse$4(u);return subselects.is(e,a,s,n,i)}if(typeof m=="function")return verifyPseudoArgs(m,d,f,1),a=>m(a,f)&&e(a);if(d in filters)return filters[d](e,f,s,n);if(d in pseudos){const a=pseudos[d];return verifyPseudoArgs(a,d,f,2),c=>a(c,s,f)&&e(c)}throw new Error(`Unknown pseudo-class :${d}`)}function getElementParent(e,t){const s=t.getParent(e);return s&&t.isTag(s)?s:null}function compileGeneralSelector(e,t,s,n,i){const{adapter:r,equals:d}=s;switch(t.type){case SelectorType.PseudoElement:throw new Error("Pseudo-elements are not supported by css-select");case SelectorType.ColumnCombinator:throw new Error("Column combinators are not yet supported by css-select");case SelectorType.Attribute:{if(t.namespace!=null)throw new Error("Namespaced attributes are not yet supported by css-select");return(!s.xmlMode||s.lowerCaseAttributeNames)&&(t.name=t.name.toLowerCase()),attributeRules[t.action](e,t,s)}case SelectorType.Pseudo:return compilePseudoSelector(e,t,s,n,i);case SelectorType.Tag:{if(t.namespace!=null)throw new Error("Namespaced tag names are not yet supported by css-select");let{name:f}=t;return(!s.xmlMode||s.lowerCaseTags)&&(f=f.toLowerCase()),function(u){return r.getName(u)===f&&e(u)}}case SelectorType.Descendant:{if(s.cacheResults===!1||typeof WeakSet>"u")return function(u){let a=u;for(;a=getElementParent(a,r);)if(e(a))return!0;return!1};const f=new WeakSet;return function(u){let a=u;for(;a=getElementParent(a,r);)if(!f.has(a)){if(r.isTag(a)&&e(a))return!0;f.add(a)}return!1}}case"_flexibleDescendant":return function(m){let u=m;do if(e(u))return!0;while(u=getElementParent(u,r));return!1};case SelectorType.Parent:return function(m){return r.getChildren(m).some(u=>r.isTag(u)&&e(u))};case SelectorType.Child:return function(m){const u=r.getParent(m);return u!=null&&r.isTag(u)&&e(u)};case SelectorType.Sibling:return function(m){const u=r.getSiblings(m);for(let a=0;a<u.length;a++){const c=u[a];if(d(m,c))break;if(r.isTag(c)&&e(c))return!0}return!1};case SelectorType.Adjacent:return r.prevElementSibling?function(m){const u=r.prevElementSibling(m);return u!=null&&e(u)}:function(m){const u=r.getSiblings(m);let a;for(let c=0;c<u.length;c++){const T=u[c];if(d(m,T))break;r.isTag(T)&&(a=T)}return!!a&&e(a)};case SelectorType.Universal:{if(t.namespace!=null&&t.namespace!=="*")throw new Error("Namespaced universal selectors are not yet supported by css-select");return e}}}function includesScopePseudo(e){return e.type===SelectorType.Pseudo&&(e.name==="scope"||Array.isArray(e.data)&&e.data.some(t=>t.some(includesScopePseudo)))}const DESCENDANT_TOKEN={type:SelectorType.Descendant},FLEXIBLE_DESCENDANT_TOKEN={type:"_flexibleDescendant"},SCOPE_TOKEN={type:SelectorType.Pseudo,name:"scope",data:null};function absolutize(e,{adapter:t},s){const n=!!s?.every(i=>{const r=t.isTag(i)&&t.getParent(i);return i===PLACEHOLDER_ELEMENT||r&&t.isTag(r)});for(const i of e){if(!(i.length>0&&isTraversal(i[0])&&i[0].type!==SelectorType.Descendant))if(n&&!i.some(includesScopePseudo))i.unshift(DESCENDANT_TOKEN);else continue;i.unshift(SCOPE_TOKEN)}}function compileToken(e,t,s){var n;e.forEach(sortByProcedure),s=(n=t.context)!==null&&n!==void 0?n:s;const i=Array.isArray(s),r=s&&(Array.isArray(s)?s:[s]);if(t.relativeSelector!==!1)absolutize(e,t,r);else if(e.some(m=>m.length>0&&isTraversal(m[0])))throw new Error("Relative selectors are not allowed when the `relativeSelector` option is disabled");let d=!1;const f=e.map(m=>{if(m.length>=2){const[u,a]=m;u.type!==SelectorType.Pseudo||u.name!=="scope"||(i&&a.type===SelectorType.Descendant?m[1]=FLEXIBLE_DESCENDANT_TOKEN:(a.type===SelectorType.Adjacent||a.type===SelectorType.Sibling)&&(d=!0))}return compileRules(m,t,r)}).reduce(reduceRules,boolbase$1.falseFunc);return f.shouldTestNextSiblings=d,f}function compileRules(e,t,s){var n;return e.reduce((i,r)=>i===boolbase$1.falseFunc?boolbase$1.falseFunc:compileGeneralSelector(i,r,t,s,compileToken),(n=t.rootFunc)!==null&&n!==void 0?n:boolbase$1.trueFunc)}function reduceRules(e,t){return t===boolbase$1.falseFunc||e===boolbase$1.trueFunc?e:e===boolbase$1.falseFunc||t===boolbase$1.trueFunc?t:function(n){return e(n)||t(n)}}const defaultEquals=(e,t)=>e===t,defaultOptions={adapter:DomUtils,equals:defaultEquals};function convertOptionFormats(e){var t,s,n,i;const r=e??defaultOptions;return(t=r.adapter)!==null&&t!==void 0||(r.adapter=DomUtils),(s=r.equals)!==null&&s!==void 0||(r.equals=(i=(n=r.adapter)===null||n===void 0?void 0:n.equals)!==null&&i!==void 0?i:defaultEquals),r}function wrapCompile(e){return function(s,n,i){const r=convertOptionFormats(n);return e(s,r,i)}}const _compileToken=wrapCompile(compileToken);function prepareContext(e,t,s=!1){return s&&(e=appendNextSiblings(e,t)),Array.isArray(e)?t.removeSubsets(e):t.getChildren(e)}function appendNextSiblings(e,t){const s=Array.isArray(e)?e.slice(0):[e],n=s.length;for(let i=0;i<n;i++){const r=getNextSiblings(s[i],t);s.push(...r)}return s}const filterNames=new Set(["first","last","eq","gt","nth","lt","even","odd"]);function isFilter(e){return e.type!=="pseudo"?!1:filterNames.has(e.name)?!0:e.name==="not"&&Array.isArray(e.data)?e.data.some(t=>t.some(isFilter)):!1}function getLimit(e,t,s){const n=t!=null?parseInt(t,10):NaN;switch(e){case"first":return 1;case"nth":case"eq":return isFinite(n)?n>=0?n+1:1/0:0;case"lt":return isFinite(n)?n>=0?Math.min(n,s):1/0:0;case"gt":return isFinite(n)?1/0:0;case"odd":return 2*s;case"even":return 2*s-1;case"last":case"not":return 1/0}}function getDocumentRoot(e){for(;e.parent;)e=e.parent;return e}function groupSelectors(e){const t=[],s=[];for(const n of e)n.some(isFilter)?t.push(n):s.push(n);return[s,t]}const UNIVERSAL_SELECTOR={type:SelectorType.Universal,namespace:null},SCOPE_PSEUDO={type:SelectorType.Pseudo,name:"scope",data:null};function is$2(e,t,s={}){return some([e],t,s)}function some(e,t,s={}){if(typeof t=="function")return e.some(t);const[n,i]=groupSelectors(parse$4(t));return n.length>0&&e.some(_compileToken(n,s))||i.some(r=>filterBySelector(r,e,s).length>0)}function filterByPosition(e,t,s,n){const i=typeof s=="string"?parseInt(s,10):NaN;switch(e){case"first":case"lt":return t;case"last":return t.length>0?[t[t.length-1]]:t;case"nth":case"eq":return isFinite(i)&&Math.abs(i)<t.length?[i<0?t[t.length+i]:t[i]]:[];case"gt":return isFinite(i)?t.slice(i+1):[];case"even":return t.filter((r,d)=>d%2===0);case"odd":return t.filter((r,d)=>d%2===1);case"not":{const r=new Set(filterParsed(s,t,n));return t.filter(d=>!r.has(d))}}}function filter$1(e,t,s={}){return filterParsed(parse$4(e),t,s)}function filterParsed(e,t,s){if(t.length===0)return[];const[n,i]=groupSelectors(e);let r;if(n.length){const d=filterElements(t,n,s);if(i.length===0)return d;d.length&&(r=new Set(d))}for(let d=0;d<i.length&&r?.size!==t.length;d++){const f=i[d];if((r?t.filter(a=>isTag(a)&&!r.has(a)):t).length===0)break;const u=filterBySelector(f,t,s);if(u.length)if(r)u.forEach(a=>r.add(a));else{if(d===i.length-1)return u;r=new Set(u)}}return typeof r<"u"?r.size===t.length?t:t.filter(d=>r.has(d)):[]}function filterBySelector(e,t,s){var n;if(e.some(isTraversal$1)){const i=(n=s.root)!==null&&n!==void 0?n:getDocumentRoot(t[0]),r={...s,context:t,relativeSelector:!1};return e.push(SCOPE_PSEUDO),findFilterElements(i,e,r,!0,t.length)}return findFilterElements(t,e,s,!1,t.length)}function select(e,t,s={},n=1/0){if(typeof e=="function")return find$1(t,e);const[i,r]=groupSelectors(parse$4(e)),d=r.map(f=>findFilterElements(t,f,s,!0,n));return i.length&&d.push(findElements(t,i,s,n)),d.length===0?[]:d.length===1?d[0]:uniqueSort(d.reduce((f,m)=>[...f,...m]))}function findFilterElements(e,t,s,n,i){const r=t.findIndex(isFilter),d=t.slice(0,r),f=t[r],m=t.length-1===r?i:1/0,u=getLimit(f.name,f.data,m);if(u===0)return[];const c=(d.length===0&&!Array.isArray(e)?getChildren(e).filter(isTag):d.length===0?(Array.isArray(e)?e:[e]).filter(isTag):n||d.some(isTraversal$1)?findElements(e,[d],s,u):filterElements(e,[d],s)).slice(0,u);let T=filterByPosition(f.name,c,f.data,s);if(T.length===0||t.length===r+1)return T;const p=t.slice(r+1),h=p.some(isTraversal$1);if(h){if(isTraversal$1(p[0])){const{type:_}=p[0];(_===SelectorType.Sibling||_===SelectorType.Adjacent)&&(T=prepareContext(T,DomUtils,!0)),p.unshift(UNIVERSAL_SELECTOR)}s={...s,relativeSelector:!1,rootFunc:_=>T.includes(_)}}else s.rootFunc&&s.rootFunc!==boolbase.trueFunc&&(s={...s,rootFunc:boolbase.trueFunc});return p.some(isFilter)?findFilterElements(T,p,s,!1,i):h?findElements(T,[p],s,i):filterElements(T,[p],s)}function findElements(e,t,s,n){const i=_compileToken(t,s,e);return find$1(e,i,n)}function find$1(e,t,s=1/0){const n=prepareContext(e,DomUtils,t.shouldTestNextSiblings);return find$2(i=>isTag(i)&&t(i),n,!0,s)}function filterElements(e,t,s){const n=(Array.isArray(e)?e:[e]).filter(isTag);if(n.length===0)return n;const i=_compileToken(t,s);return i===boolbase.trueFunc?n:n.filter(i)}const reSiblingSelector=/^\s*[~+]/;function find(e){var t;if(!e)return this._make([]);const s=this.toArray();if(typeof e!="string"){const r=isCheerio(e)?e.toArray():[e];return this._make(r.filter(d=>s.some(f=>contains(f,d))))}const n=reSiblingSelector.test(e)?s:this.children().toArray(),i={context:s,root:(t=this._root)===null||t===void 0?void 0:t[0],xmlMode:this.options.xmlMode,lowerCaseTags:this.options.lowerCaseTags,lowerCaseAttributeNames:this.options.lowerCaseAttributeNames,pseudos:this.options.pseudos,quirksMode:this.options.quirksMode};return this._make(select(e,n,i))}function _getMatcher(e){return function(t,...s){return function(n){var i;let r=e(t,this);return n&&(r=filterArray(r,n,this.options.xmlMode,(i=this._root)===null||i===void 0?void 0:i[0])),this._make(this.length>1&&r.length>1?s.reduce((d,f)=>f(d),r):r)}}}const _matcher=_getMatcher((e,t)=>{const s=[];for(let n=0;n<t.length;n++){const i=e(t[n]);s.push(i)}return new Array().concat(...s)}),_singleMatcher=_getMatcher((e,t)=>{const s=[];for(let n=0;n<t.length;n++){const i=e(t[n]);i!==null&&s.push(i)}return s});function _matchUntil(e,...t){let s=null;const n=_getMatcher((i,r)=>{const d=[];return domEach(r,f=>{for(let m;(m=i(f))&&!s?.(m,d.length);f=m)d.push(m)}),d})(e,...t);return function(i,r){s=typeof i=="string"?f=>is$2(f,i,this.options):i?getFilterFn(i):null;const d=n.call(this,r);return s=null,d}}function _removeDuplicates(e){return Array.from(new Set(e))}const parent=_singleMatcher(({parent:e})=>e&&!isDocument(e)?e:null,_removeDuplicates),parents=_matcher(e=>{const t=[];for(;e.parent&&!isDocument(e.parent);)t.push(e.parent),e=e.parent;return t},uniqueSort,e=>e.reverse()),parentsUntil=_matchUntil(({parent:e})=>e&&!isDocument(e)?e:null,uniqueSort,e=>e.reverse());function closest(e){var t;const s=[];if(!e)return this._make(s);const n={xmlMode:this.options.xmlMode,root:(t=this._root)===null||t===void 0?void 0:t[0]},i=typeof e=="string"?r=>is$2(r,e,n):getFilterFn(e);return domEach(this,r=>{for(;r&&isTag(r);){if(i(r,0)){s.includes(r)||s.push(r);break}r=r.parent}}),this._make(s)}const next$1=_singleMatcher(e=>nextElementSibling(e)),nextAll=_matcher(e=>{const t=[];for(;e.next;)e=e.next,isTag(e)&&t.push(e);return t},_removeDuplicates),nextUntil=_matchUntil(e=>nextElementSibling(e),_removeDuplicates),prev=_singleMatcher(e=>prevElementSibling(e)),prevAll=_matcher(e=>{const t=[];for(;e.prev;)e=e.prev,isTag(e)&&t.push(e);return t},_removeDuplicates),prevUntil=_matchUntil(e=>prevElementSibling(e),_removeDuplicates),siblings=_matcher(e=>getSiblings(e).filter(t=>isTag(t)&&t!==e),uniqueSort),children=_matcher(e=>getChildren(e).filter(isTag),_removeDuplicates);function contents(){const e=this.toArray().reduce((t,s)=>hasChildren(s)?t.concat(s.children):t,[]);return this._make(e)}function each(e){let t=0;const s=this.length;for(;t<s&&e.call(this[t],t,this[t])!==!1;)++t;return this}function map(e){let t=[];for(let s=0;s<this.length;s++){const n=this[s],i=e.call(n,s,n);i!=null&&(t=t.concat(i))}return this._make(t)}function getFilterFn(e){return typeof e=="function"?(t,s)=>e.call(t,s,t):isCheerio(e)?t=>Array.prototype.includes.call(e,t):function(t){return e===t}}function filter(e){var t;return this._make(filterArray(this.toArray(),e,this.options.xmlMode,(t=this._root)===null||t===void 0?void 0:t[0]))}function filterArray(e,t,s,n){return typeof t=="string"?filter$1(t,e,{xmlMode:s,root:n}):e.filter(getFilterFn(t))}function is$1(e){const t=this.toArray();return typeof e=="string"?some(t.filter(isTag),e,this.options):e?t.some(getFilterFn(e)):!1}function not(e){let t=this.toArray();if(typeof e=="string"){const s=new Set(filter$1(e,t,this.options));t=t.filter(n=>!s.has(n))}else{const s=getFilterFn(e);t=t.filter((n,i)=>!s(n,i))}return this._make(t)}function has$1(e){return this.filter(typeof e=="string"?`:has(${e})`:(t,s)=>this._make(s).find(e).length>0)}function first(){return this.length>1?this._make(this[0]):this}function last(){return this.length>0?this._make(this[this.length-1]):this}function eq(e){var t;return e=+e,e===0&&this.length<=1?this:(e<0&&(e=this.length+e),this._make((t=this[e])!==null&&t!==void 0?t:[]))}function get(e){return e==null?this.toArray():this[e<0?this.length+e:e]}function toArray(){return Array.prototype.slice.call(this)}function index(e){let t,s;return e==null?(t=this.parent().children(),s=this[0]):typeof e=="string"?(t=this._make(e),s=this[0]):(t=this,s=isCheerio(e)?e[0]:e),Array.prototype.indexOf.call(t,s)}function slice(e,t){return this._make(Array.prototype.slice.call(this,e,t))}function end(){var e;return(e=this.prevObject)!==null&&e!==void 0?e:this._make([])}function add(e,t){const s=this._make(e,t),n=uniqueSort([...this.get(),...s.get()]);return this._make(n)}function addBack(e){return this.prevObject?this.add(e?this.prevObject.filter(e):this.prevObject):this}const Traversing=Object.freeze(Object.defineProperty({__proto__:null,add,addBack,children,closest,contents,each,end,eq,filter,filterArray,find,first,get,has:has$1,index,is:is$1,last,map,next:next$1,nextAll,nextUntil,not,parent,parents,parentsUntil,prev,prevAll,prevUntil,siblings,slice,toArray},Symbol.toStringTag,{value:"Module"}));function getParse(e){return function(s,n,i,r){if(typeof Buffer<"u"&&Buffer.isBuffer(s)&&(s=s.toString()),typeof s=="string")return e(s,n,i,r);const d=s;if(!Array.isArray(d)&&isDocument(d))return d;const f=new Document([]);return update(d,f),f}}function update(e,t){const s=Array.isArray(e)?e:[e];t?t.children=s:t=null;for(let n=0;n<s.length;n++){const i=s[n];i.parent&&i.parent.children!==s&&removeElement(i),t?(i.prev=s[n-1]||null,i.next=s[n+1]||null):i.prev=i.next=null,i.parent=t}return t}function _makeDomArray(e,t){return e==null?[]:isCheerio(e)?t?cloneDom(e.get()):e.get():Array.isArray(e)?e.reduce((s,n)=>s.concat(this._makeDomArray(n,t)),[]):typeof e=="string"?this._parse(e,this.options,!1,null).children:t?cloneDom([e]):[e]}function _insert(e){return function(...t){const s=this.length-1;return domEach(this,(n,i)=>{if(!hasChildren(n))return;const r=typeof t[0]=="function"?t[0].call(n,i,this._render(n.children)):t,d=this._makeDomArray(r,i<s);e(d,n.children,n)})}}function uniqueSplice(e,t,s,n,i){var r,d;const f=[t,s,...n],m=t===0?null:e[t-1],u=t+s>=e.length?null:e[t+s];for(let a=0;a<n.length;++a){const c=n[a],T=c.parent;if(T){const h=T.children.indexOf(c);h>-1&&(T.children.splice(h,1),i===T&&t>h&&f[0]--)}c.parent=i,c.prev&&(c.prev.next=(r=c.next)!==null&&r!==void 0?r:null),c.next&&(c.next.prev=(d=c.prev)!==null&&d!==void 0?d:null),c.prev=a===0?m:n[a-1],c.next=a===n.length-1?u:n[a+1]}return m&&(m.next=n[0]),u&&(u.prev=n[n.length-1]),e.splice(...f)}function appendTo(e){return(isCheerio(e)?e:this._make(e)).append(this),this}function prependTo(e){return(isCheerio(e)?e:this._make(e)).prepend(this),this}const append=_insert((e,t,s)=>{uniqueSplice(t,t.length,0,e,s)}),prepend=_insert((e,t,s)=>{uniqueSplice(t,0,0,e,s)});function _wrap(e){return function(t){const s=this.length-1,n=this.parents().last();for(let i=0;i<this.length;i++){const r=this[i],d=typeof t=="function"?t.call(r,i,r):typeof t=="string"&&!isHtml(t)?n.find(t).clone():t,[f]=this._makeDomArray(d,i<s);if(!f||!hasChildren(f))continue;let m=f,u=0;for(;u<m.children.length;){const a=m.children[u];isTag(a)?(m=a,u=0):u++}e(r,m,[f])}return this}}const wrap=_wrap((e,t,s)=>{const{parent:n}=e;if(!n)return;const i=n.children,r=i.indexOf(e);update([e],t),uniqueSplice(i,r,0,s,n)}),wrapInner=_wrap((e,t,s)=>{hasChildren(e)&&(update(e.children,t),update(s,e))});function unwrap(e){return this.parent(e).not("body").each((t,s)=>{this._make(s).replaceWith(s.children)}),this}function wrapAll(e){const t=this[0];if(t){const s=this._make(typeof e=="function"?e.call(t,0,t):e).insertBefore(t);let n;for(let r=0;r<s.length;r++)s[r].type==="tag"&&(n=s[r]);let i=0;for(;n&&i<n.children.length;){const r=n.children[i];r.type==="tag"?(n=r,i=0):i++}n&&this._make(n).append(this)}return this}function after(...e){const t=this.length-1;return domEach(this,(s,n)=>{const{parent:i}=s;if(!hasChildren(s)||!i)return;const r=i.children,d=r.indexOf(s);if(d<0)return;const f=typeof e[0]=="function"?e[0].call(s,n,this._render(s.children)):e,m=this._makeDomArray(f,n<t);uniqueSplice(r,d+1,0,m,i)})}function insertAfter(e){typeof e=="string"&&(e=this._make(e)),this.remove();const t=[];return this._makeDomArray(e).forEach(s=>{const n=this.clone().toArray(),{parent:i}=s;if(!i)return;const r=i.children,d=r.indexOf(s);d<0||(uniqueSplice(r,d+1,0,n,i),t.push(...n))}),this._make(t)}function before(...e){const t=this.length-1;return domEach(this,(s,n)=>{const{parent:i}=s;if(!hasChildren(s)||!i)return;const r=i.children,d=r.indexOf(s);if(d<0)return;const f=typeof e[0]=="function"?e[0].call(s,n,this._render(s.children)):e,m=this._makeDomArray(f,n<t);uniqueSplice(r,d,0,m,i)})}function insertBefore(e){const t=this._make(e);this.remove();const s=[];return domEach(t,n=>{const i=this.clone().toArray(),{parent:r}=n;if(!r)return;const d=r.children,f=d.indexOf(n);f<0||(uniqueSplice(d,f,0,i,r),s.push(...i))}),this._make(s)}function remove$1(e){const t=e?this.filter(e):this;return domEach(t,s=>{removeElement(s),s.prev=s.next=s.parent=null}),this}function replaceWith(e){return domEach(this,(t,s)=>{const{parent:n}=t;if(!n)return;const i=n.children,r=typeof e=="function"?e.call(t,s,t):e,d=this._makeDomArray(r);update(d,null);const f=i.indexOf(t);uniqueSplice(i,f,1,d,n),d.includes(t)||(t.parent=t.prev=t.next=null)})}function empty(){return domEach(this,e=>{hasChildren(e)&&(e.children.forEach(t=>{t.next=t.prev=t.parent=null}),e.children.length=0)})}function html(e){if(e===void 0){const t=this[0];return!t||!hasChildren(t)?null:this._render(t.children)}return domEach(this,t=>{if(!hasChildren(t))return;t.children.forEach(n=>{n.next=n.prev=n.parent=null});const s=isCheerio(e)?e.toArray():this._parse(`${e}`,this.options,!1,t).children;update(s,t)})}function toString(){return this._render(this)}function text(e){return e===void 0?text$1(this):typeof e=="function"?domEach(this,(t,s)=>this._make(t).text(e.call(t,s,text$1([t])))):domEach(this,t=>{if(!hasChildren(t))return;t.children.forEach(n=>{n.next=n.prev=n.parent=null});const s=new Text(`${e}`);update(s,t)})}function clone(){return this._make(cloneDom(this.get()))}const Manipulation=Object.freeze(Object.defineProperty({__proto__:null,_makeDomArray,after,append,appendTo,before,clone,empty,html,insertAfter,insertBefore,prepend,prependTo,remove:remove$1,replaceWith,text,toString,unwrap,wrap,wrapAll,wrapInner},Symbol.toStringTag,{value:"Module"}));function css(e,t){if(e!=null&&t!=null||typeof e=="object"&&!Array.isArray(e))return domEach(this,(s,n)=>{isTag(s)&&setCss(s,e,t,n)});if(this.length!==0)return getCss(this[0],e)}function setCss(e,t,s,n){if(typeof t=="string"){const i=getCss(e),r=typeof s=="function"?s.call(e,n,i[t]):s;r===""?delete i[t]:r!=null&&(i[t]=r),e.attribs.style=stringify(i)}else typeof t=="object"&&Object.keys(t).forEach((i,r)=>{setCss(e,i,t[i],r)})}function getCss(e,t){if(!e||!isTag(e))return;const s=parse$2(e.attribs.style);if(typeof t=="string")return s[t];if(Array.isArray(t)){const n={};return t.forEach(i=>{s[i]!=null&&(n[i]=s[i])}),n}return s}function stringify(e){return Object.keys(e).reduce((t,s)=>`${t}${t?" ":""}${s}: ${e[s]};`,"")}function parse$2(e){if(e=(e||"").trim(),!e)return{};const t={};let s;for(const n of e.split(";")){const i=n.indexOf(":");if(i<1||i===n.length-1){const r=n.trimEnd();r.length>0&&s!==void 0&&(t[s]+=`;${r}`)}else s=n.slice(0,i).trim(),t[s]=n.slice(i+1).trim()}return t}const Css=Object.freeze(Object.defineProperty({__proto__:null,css},Symbol.toStringTag,{value:"Module"})),submittableSelector="input,select,textarea,keygen",r20=/%20/g,rCRLF=/\r?\n/g;function serialize(){return this.serializeArray().map(s=>`${encodeURIComponent(s.name)}=${encodeURIComponent(s.value)}`).join("&").replace(r20,"+")}function serializeArray(){return this.map((e,t)=>{const s=this._make(t);return isTag(t)&&t.name==="form"?s.find(submittableSelector).toArray():s.filter(submittableSelector).toArray()}).filter('[name!=""]:enabled:not(:submit, :button, :image, :reset, :file):matches([checked], :not(:checkbox, :radio))').map((e,t)=>{var s;const n=this._make(t),i=n.attr("name"),r=(s=n.val())!==null&&s!==void 0?s:"";return Array.isArray(r)?r.map(d=>({name:i,value:d.replace(rCRLF,`\r
`)})):{name:i,value:r.replace(rCRLF,`\r
`)}}).toArray()}const Forms=Object.freeze(Object.defineProperty({__proto__:null,serialize,serializeArray},Symbol.toStringTag,{value:"Module"}));class Cheerio{constructor(t,s,n){if(this.length=0,this.options=n,this._root=s,t){for(let i=0;i<t.length;i++)this[i]=t[i];this.length=t.length}}}Cheerio.prototype.cheerio="[cheerio object]",Cheerio.prototype.splice=Array.prototype.splice,Cheerio.prototype[Symbol.iterator]=Array.prototype[Symbol.iterator],Object.assign(Cheerio.prototype,Attributes,Traversing,Manipulation,Css,Forms);function getLoad(e,t){return function s(n,i,r=!0){if(n==null)throw new Error("cheerio.load() expects a string");const d={...defaultOpts$2,...flatten(i)},f=e(n,d,r,null);class m extends Cheerio{_make(c,T){const p=u(c,T);return p.prevObject=this,p}_parse(c,T,p,h){return e(c,T,p,h)}_render(c){return t(c,this.options)}}function u(a,c,T=f,p){if(a&&isCheerio(a))return a;const h={...d,...flatten(p)},_=typeof T=="string"?[e(T,h,!1,null)]:"length"in T?T:[T],I=isCheerio(_)?_:new m(_,null,h);if(I._root=I,!a)return new m(void 0,I,h);const A=typeof a=="string"&&isHtml(a)?e(a,h,!1,null).children:isNode(a)?[a]:Array.isArray(a)?a:void 0,O=new m(A,I,h);if(A)return O;if(typeof a!="string")throw new Error("Unexpected type of selector");let w=a;const P=c?typeof c=="string"?isHtml(c)?new m([e(c,h,!1,null)],I,h):(w=`${c} ${w}`,I):isCheerio(c)?c:new m(Array.isArray(c)?c:[c],I,h):I;return P?P.find(w):O}return Object.assign(u,staticMethods,{load:s,_root:f,_options:d,fn:m.prototype,prototype:m.prototype}),u}}function isNode(e){return!!e.name||e.type==="root"||e.type==="text"||e.type==="comment"}const UNDEFINED_CODE_POINTS=new Set([65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111]),REPLACEMENT_CHARACTER="�";var CODE_POINTS;(function(e){e[e.EOF=-1]="EOF",e[e.NULL=0]="NULL",e[e.TABULATION=9]="TABULATION",e[e.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",e[e.LINE_FEED=10]="LINE_FEED",e[e.FORM_FEED=12]="FORM_FEED",e[e.SPACE=32]="SPACE",e[e.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",e[e.QUOTATION_MARK=34]="QUOTATION_MARK",e[e.NUMBER_SIGN=35]="NUMBER_SIGN",e[e.AMPERSAND=38]="AMPERSAND",e[e.APOSTROPHE=39]="APOSTROPHE",e[e.HYPHEN_MINUS=45]="HYPHEN_MINUS",e[e.SOLIDUS=47]="SOLIDUS",e[e.DIGIT_0=48]="DIGIT_0",e[e.DIGIT_9=57]="DIGIT_9",e[e.SEMICOLON=59]="SEMICOLON",e[e.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",e[e.EQUALS_SIGN=61]="EQUALS_SIGN",e[e.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",e[e.QUESTION_MARK=63]="QUESTION_MARK",e[e.LATIN_CAPITAL_A=65]="LATIN_CAPITAL_A",e[e.LATIN_CAPITAL_F=70]="LATIN_CAPITAL_F",e[e.LATIN_CAPITAL_X=88]="LATIN_CAPITAL_X",e[e.LATIN_CAPITAL_Z=90]="LATIN_CAPITAL_Z",e[e.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",e[e.GRAVE_ACCENT=96]="GRAVE_ACCENT",e[e.LATIN_SMALL_A=97]="LATIN_SMALL_A",e[e.LATIN_SMALL_F=102]="LATIN_SMALL_F",e[e.LATIN_SMALL_X=120]="LATIN_SMALL_X",e[e.LATIN_SMALL_Z=122]="LATIN_SMALL_Z",e[e.REPLACEMENT_CHARACTER=65533]="REPLACEMENT_CHARACTER"})(CODE_POINTS=CODE_POINTS||(CODE_POINTS={}));const SEQUENCES={DASH_DASH:"--",CDATA_START:"[CDATA[",DOCTYPE:"doctype",SCRIPT:"script",PUBLIC:"public",SYSTEM:"system"};function isSurrogate(e){return e>=55296&&e<=57343}function isSurrogatePair(e){return e>=56320&&e<=57343}function getSurrogatePairCodePoint(e,t){return(e-55296)*1024+9216+t}function isControlCodePoint(e){return e!==32&&e!==10&&e!==13&&e!==9&&e!==12&&e>=1&&e<=31||e>=127&&e<=159}function isUndefinedCodePoint(e){return e>=64976&&e<=65007||UNDEFINED_CODE_POINTS.has(e)}var ERR;(function(e){e.controlCharacterInInputStream="control-character-in-input-stream",e.noncharacterInInputStream="noncharacter-in-input-stream",e.surrogateInInputStream="surrogate-in-input-stream",e.nonVoidHtmlElementStartTagWithTrailingSolidus="non-void-html-element-start-tag-with-trailing-solidus",e.endTagWithAttributes="end-tag-with-attributes",e.endTagWithTrailingSolidus="end-tag-with-trailing-solidus",e.unexpectedSolidusInTag="unexpected-solidus-in-tag",e.unexpectedNullCharacter="unexpected-null-character",e.unexpectedQuestionMarkInsteadOfTagName="unexpected-question-mark-instead-of-tag-name",e.invalidFirstCharacterOfTagName="invalid-first-character-of-tag-name",e.unexpectedEqualsSignBeforeAttributeName="unexpected-equals-sign-before-attribute-name",e.missingEndTagName="missing-end-tag-name",e.unexpectedCharacterInAttributeName="unexpected-character-in-attribute-name",e.unknownNamedCharacterReference="unknown-named-character-reference",e.missingSemicolonAfterCharacterReference="missing-semicolon-after-character-reference",e.unexpectedCharacterAfterDoctypeSystemIdentifier="unexpected-character-after-doctype-system-identifier",e.unexpectedCharacterInUnquotedAttributeValue="unexpected-character-in-unquoted-attribute-value",e.eofBeforeTagName="eof-before-tag-name",e.eofInTag="eof-in-tag",e.missingAttributeValue="missing-attribute-value",e.missingWhitespaceBetweenAttributes="missing-whitespace-between-attributes",e.missingWhitespaceAfterDoctypePublicKeyword="missing-whitespace-after-doctype-public-keyword",e.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers="missing-whitespace-between-doctype-public-and-system-identifiers",e.missingWhitespaceAfterDoctypeSystemKeyword="missing-whitespace-after-doctype-system-keyword",e.missingQuoteBeforeDoctypePublicIdentifier="missing-quote-before-doctype-public-identifier",e.missingQuoteBeforeDoctypeSystemIdentifier="missing-quote-before-doctype-system-identifier",e.missingDoctypePublicIdentifier="missing-doctype-public-identifier",e.missingDoctypeSystemIdentifier="missing-doctype-system-identifier",e.abruptDoctypePublicIdentifier="abrupt-doctype-public-identifier",e.abruptDoctypeSystemIdentifier="abrupt-doctype-system-identifier",e.cdataInHtmlContent="cdata-in-html-content",e.incorrectlyOpenedComment="incorrectly-opened-comment",e.eofInScriptHtmlCommentLikeText="eof-in-script-html-comment-like-text",e.eofInDoctype="eof-in-doctype",e.nestedComment="nested-comment",e.abruptClosingOfEmptyComment="abrupt-closing-of-empty-comment",e.eofInComment="eof-in-comment",e.incorrectlyClosedComment="incorrectly-closed-comment",e.eofInCdata="eof-in-cdata",e.absenceOfDigitsInNumericCharacterReference="absence-of-digits-in-numeric-character-reference",e.nullCharacterReference="null-character-reference",e.surrogateCharacterReference="surrogate-character-reference",e.characterReferenceOutsideUnicodeRange="character-reference-outside-unicode-range",e.controlCharacterReference="control-character-reference",e.noncharacterCharacterReference="noncharacter-character-reference",e.missingWhitespaceBeforeDoctypeName="missing-whitespace-before-doctype-name",e.missingDoctypeName="missing-doctype-name",e.invalidCharacterSequenceAfterDoctypeName="invalid-character-sequence-after-doctype-name",e.duplicateAttribute="duplicate-attribute",e.nonConformingDoctype="non-conforming-doctype",e.missingDoctype="missing-doctype",e.misplacedDoctype="misplaced-doctype",e.endTagWithoutMatchingOpenElement="end-tag-without-matching-open-element",e.closingOfElementWithOpenChildElements="closing-of-element-with-open-child-elements",e.disallowedContentInNoscriptInHead="disallowed-content-in-noscript-in-head",e.openElementsLeftAfterEof="open-elements-left-after-eof",e.abandonedHeadElementChild="abandoned-head-element-child",e.misplacedStartTagForHeadElement="misplaced-start-tag-for-head-element",e.nestedNoscriptInHead="nested-noscript-in-head",e.eofInElementThatCanContainOnlyText="eof-in-element-that-can-contain-only-text"})(ERR=ERR||(ERR={}));const DEFAULT_BUFFER_WATERLINE=65536;class Preprocessor{constructor(t){this.handler=t,this.html="",this.pos=-1,this.lastGapPos=-2,this.gapStack=[],this.skipNextNewLine=!1,this.lastChunkWritten=!1,this.endOfChunkHit=!1,this.bufferWaterline=DEFAULT_BUFFER_WATERLINE,this.isEol=!1,this.lineStartPos=0,this.droppedBufferSize=0,this.line=1,this.lastErrOffset=-1}get col(){return this.pos-this.lineStartPos+ +(this.lastGapPos!==this.pos)}get offset(){return this.droppedBufferSize+this.pos}getError(t){const{line:s,col:n,offset:i}=this;return{code:t,startLine:s,endLine:s,startCol:n,endCol:n,startOffset:i,endOffset:i}}_err(t){this.handler.onParseError&&this.lastErrOffset!==this.offset&&(this.lastErrOffset=this.offset,this.handler.onParseError(this.getError(t)))}_addGap(){this.gapStack.push(this.lastGapPos),this.lastGapPos=this.pos}_processSurrogate(t){if(this.pos!==this.html.length-1){const s=this.html.charCodeAt(this.pos+1);if(isSurrogatePair(s))return this.pos++,this._addGap(),getSurrogatePairCodePoint(t,s)}else if(!this.lastChunkWritten)return this.endOfChunkHit=!0,CODE_POINTS.EOF;return this._err(ERR.surrogateInInputStream),t}willDropParsedChunk(){return this.pos>this.bufferWaterline}dropParsedChunk(){this.willDropParsedChunk()&&(this.html=this.html.substring(this.pos),this.lineStartPos-=this.pos,this.droppedBufferSize+=this.pos,this.pos=0,this.lastGapPos=-2,this.gapStack.length=0)}write(t,s){this.html.length>0?this.html+=t:this.html=t,this.endOfChunkHit=!1,this.lastChunkWritten=s}insertHtmlAtCurrentPos(t){this.html=this.html.substring(0,this.pos+1)+t+this.html.substring(this.pos+1),this.endOfChunkHit=!1}startsWith(t,s){if(this.pos+t.length>this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,!1;if(s)return this.html.startsWith(t,this.pos);for(let n=0;n<t.length;n++)if((this.html.charCodeAt(this.pos+n)|32)!==t.charCodeAt(n))return!1;return!0}peek(t){const s=this.pos+t;if(s>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,CODE_POINTS.EOF;const n=this.html.charCodeAt(s);return n===CODE_POINTS.CARRIAGE_RETURN?CODE_POINTS.LINE_FEED:n}advance(){if(this.pos++,this.isEol&&(this.isEol=!1,this.line++,this.lineStartPos=this.pos),this.pos>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,CODE_POINTS.EOF;let t=this.html.charCodeAt(this.pos);return t===CODE_POINTS.CARRIAGE_RETURN?(this.isEol=!0,this.skipNextNewLine=!0,CODE_POINTS.LINE_FEED):t===CODE_POINTS.LINE_FEED&&(this.isEol=!0,this.skipNextNewLine)?(this.line--,this.skipNextNewLine=!1,this._addGap(),this.advance()):(this.skipNextNewLine=!1,isSurrogate(t)&&(t=this._processSurrogate(t)),this.handler.onParseError===null||t>31&&t<127||t===CODE_POINTS.LINE_FEED||t===CODE_POINTS.CARRIAGE_RETURN||t>159&&t<64976||this._checkForProblematicCharacters(t),t)}_checkForProblematicCharacters(t){isControlCodePoint(t)?this._err(ERR.controlCharacterInInputStream):isUndefinedCodePoint(t)&&this._err(ERR.noncharacterInInputStream)}retreat(t){for(this.pos-=t;this.pos<this.lastGapPos;)this.lastGapPos=this.gapStack.pop(),this.pos--;this.isEol=!1}}var TokenType;(function(e){e[e.CHARACTER=0]="CHARACTER",e[e.NULL_CHARACTER=1]="NULL_CHARACTER",e[e.WHITESPACE_CHARACTER=2]="WHITESPACE_CHARACTER",e[e.START_TAG=3]="START_TAG",e[e.END_TAG=4]="END_TAG",e[e.COMMENT=5]="COMMENT",e[e.DOCTYPE=6]="DOCTYPE",e[e.EOF=7]="EOF",e[e.HIBERNATION=8]="HIBERNATION"})(TokenType=TokenType||(TokenType={}));function getTokenAttr(e,t){for(let s=e.attrs.length-1;s>=0;s--)if(e.attrs[s].name===t)return e.attrs[s].value;return null}var NS;(function(e){e.HTML="http://www.w3.org/1999/xhtml",e.MATHML="http://www.w3.org/1998/Math/MathML",e.SVG="http://www.w3.org/2000/svg",e.XLINK="http://www.w3.org/1999/xlink",e.XML="http://www.w3.org/XML/1998/namespace",e.XMLNS="http://www.w3.org/2000/xmlns/"})(NS=NS||(NS={}));var ATTRS;(function(e){e.TYPE="type",e.ACTION="action",e.ENCODING="encoding",e.PROMPT="prompt",e.NAME="name",e.COLOR="color",e.FACE="face",e.SIZE="size"})(ATTRS=ATTRS||(ATTRS={}));var DOCUMENT_MODE;(function(e){e.NO_QUIRKS="no-quirks",e.QUIRKS="quirks",e.LIMITED_QUIRKS="limited-quirks"})(DOCUMENT_MODE=DOCUMENT_MODE||(DOCUMENT_MODE={}));var TAG_NAMES;(function(e){e.A="a",e.ADDRESS="address",e.ANNOTATION_XML="annotation-xml",e.APPLET="applet",e.AREA="area",e.ARTICLE="article",e.ASIDE="aside",e.B="b",e.BASE="base",e.BASEFONT="basefont",e.BGSOUND="bgsound",e.BIG="big",e.BLOCKQUOTE="blockquote",e.BODY="body",e.BR="br",e.BUTTON="button",e.CAPTION="caption",e.CENTER="center",e.CODE="code",e.COL="col",e.COLGROUP="colgroup",e.DD="dd",e.DESC="desc",e.DETAILS="details",e.DIALOG="dialog",e.DIR="dir",e.DIV="div",e.DL="dl",e.DT="dt",e.EM="em",e.EMBED="embed",e.FIELDSET="fieldset",e.FIGCAPTION="figcaption",e.FIGURE="figure",e.FONT="font",e.FOOTER="footer",e.FOREIGN_OBJECT="foreignObject",e.FORM="form",e.FRAME="frame",e.FRAMESET="frameset",e.H1="h1",e.H2="h2",e.H3="h3",e.H4="h4",e.H5="h5",e.H6="h6",e.HEAD="head",e.HEADER="header",e.HGROUP="hgroup",e.HR="hr",e.HTML="html",e.I="i",e.IMG="img",e.IMAGE="image",e.INPUT="input",e.IFRAME="iframe",e.KEYGEN="keygen",e.LABEL="label",e.LI="li",e.LINK="link",e.LISTING="listing",e.MAIN="main",e.MALIGNMARK="malignmark",e.MARQUEE="marquee",e.MATH="math",e.MENU="menu",e.META="meta",e.MGLYPH="mglyph",e.MI="mi",e.MO="mo",e.MN="mn",e.MS="ms",e.MTEXT="mtext",e.NAV="nav",e.NOBR="nobr",e.NOFRAMES="noframes",e.NOEMBED="noembed",e.NOSCRIPT="noscript",e.OBJECT="object",e.OL="ol",e.OPTGROUP="optgroup",e.OPTION="option",e.P="p",e.PARAM="param",e.PLAINTEXT="plaintext",e.PRE="pre",e.RB="rb",e.RP="rp",e.RT="rt",e.RTC="rtc",e.RUBY="ruby",e.S="s",e.SCRIPT="script",e.SECTION="section",e.SELECT="select",e.SOURCE="source",e.SMALL="small",e.SPAN="span",e.STRIKE="strike",e.STRONG="strong",e.STYLE="style",e.SUB="sub",e.SUMMARY="summary",e.SUP="sup",e.TABLE="table",e.TBODY="tbody",e.TEMPLATE="template",e.TEXTAREA="textarea",e.TFOOT="tfoot",e.TD="td",e.TH="th",e.THEAD="thead",e.TITLE="title",e.TR="tr",e.TRACK="track",e.TT="tt",e.U="u",e.UL="ul",e.SVG="svg",e.VAR="var",e.WBR="wbr",e.XMP="xmp"})(TAG_NAMES=TAG_NAMES||(TAG_NAMES={}));var TAG_ID;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.A=1]="A",e[e.ADDRESS=2]="ADDRESS",e[e.ANNOTATION_XML=3]="ANNOTATION_XML",e[e.APPLET=4]="APPLET",e[e.AREA=5]="AREA",e[e.ARTICLE=6]="ARTICLE",e[e.ASIDE=7]="ASIDE",e[e.B=8]="B",e[e.BASE=9]="BASE",e[e.BASEFONT=10]="BASEFONT",e[e.BGSOUND=11]="BGSOUND",e[e.BIG=12]="BIG",e[e.BLOCKQUOTE=13]="BLOCKQUOTE",e[e.BODY=14]="BODY",e[e.BR=15]="BR",e[e.BUTTON=16]="BUTTON",e[e.CAPTION=17]="CAPTION",e[e.CENTER=18]="CENTER",e[e.CODE=19]="CODE",e[e.COL=20]="COL",e[e.COLGROUP=21]="COLGROUP",e[e.DD=22]="DD",e[e.DESC=23]="DESC",e[e.DETAILS=24]="DETAILS",e[e.DIALOG=25]="DIALOG",e[e.DIR=26]="DIR",e[e.DIV=27]="DIV",e[e.DL=28]="DL",e[e.DT=29]="DT",e[e.EM=30]="EM",e[e.EMBED=31]="EMBED",e[e.FIELDSET=32]="FIELDSET",e[e.FIGCAPTION=33]="FIGCAPTION",e[e.FIGURE=34]="FIGURE",e[e.FONT=35]="FONT",e[e.FOOTER=36]="FOOTER",e[e.FOREIGN_OBJECT=37]="FOREIGN_OBJECT",e[e.FORM=38]="FORM",e[e.FRAME=39]="FRAME",e[e.FRAMESET=40]="FRAMESET",e[e.H1=41]="H1",e[e.H2=42]="H2",e[e.H3=43]="H3",e[e.H4=44]="H4",e[e.H5=45]="H5",e[e.H6=46]="H6",e[e.HEAD=47]="HEAD",e[e.HEADER=48]="HEADER",e[e.HGROUP=49]="HGROUP",e[e.HR=50]="HR",e[e.HTML=51]="HTML",e[e.I=52]="I",e[e.IMG=53]="IMG",e[e.IMAGE=54]="IMAGE",e[e.INPUT=55]="INPUT",e[e.IFRAME=56]="IFRAME",e[e.KEYGEN=57]="KEYGEN",e[e.LABEL=58]="LABEL",e[e.LI=59]="LI",e[e.LINK=60]="LINK",e[e.LISTING=61]="LISTING",e[e.MAIN=62]="MAIN",e[e.MALIGNMARK=63]="MALIGNMARK",e[e.MARQUEE=64]="MARQUEE",e[e.MATH=65]="MATH",e[e.MENU=66]="MENU",e[e.META=67]="META",e[e.MGLYPH=68]="MGLYPH",e[e.MI=69]="MI",e[e.MO=70]="MO",e[e.MN=71]="MN",e[e.MS=72]="MS",e[e.MTEXT=73]="MTEXT",e[e.NAV=74]="NAV",e[e.NOBR=75]="NOBR",e[e.NOFRAMES=76]="NOFRAMES",e[e.NOEMBED=77]="NOEMBED",e[e.NOSCRIPT=78]="NOSCRIPT",e[e.OBJECT=79]="OBJECT",e[e.OL=80]="OL",e[e.OPTGROUP=81]="OPTGROUP",e[e.OPTION=82]="OPTION",e[e.P=83]="P",e[e.PARAM=84]="PARAM",e[e.PLAINTEXT=85]="PLAINTEXT",e[e.PRE=86]="PRE",e[e.RB=87]="RB",e[e.RP=88]="RP",e[e.RT=89]="RT",e[e.RTC=90]="RTC",e[e.RUBY=91]="RUBY",e[e.S=92]="S",e[e.SCRIPT=93]="SCRIPT",e[e.SECTION=94]="SECTION",e[e.SELECT=95]="SELECT",e[e.SOURCE=96]="SOURCE",e[e.SMALL=97]="SMALL",e[e.SPAN=98]="SPAN",e[e.STRIKE=99]="STRIKE",e[e.STRONG=100]="STRONG",e[e.STYLE=101]="STYLE",e[e.SUB=102]="SUB",e[e.SUMMARY=103]="SUMMARY",e[e.SUP=104]="SUP",e[e.TABLE=105]="TABLE",e[e.TBODY=106]="TBODY",e[e.TEMPLATE=107]="TEMPLATE",e[e.TEXTAREA=108]="TEXTAREA",e[e.TFOOT=109]="TFOOT",e[e.TD=110]="TD",e[e.TH=111]="TH",e[e.THEAD=112]="THEAD",e[e.TITLE=113]="TITLE",e[e.TR=114]="TR",e[e.TRACK=115]="TRACK",e[e.TT=116]="TT",e[e.U=117]="U",e[e.UL=118]="UL",e[e.SVG=119]="SVG",e[e.VAR=120]="VAR",e[e.WBR=121]="WBR",e[e.XMP=122]="XMP"})(TAG_ID=TAG_ID||(TAG_ID={}));const TAG_NAME_TO_ID=new Map([[TAG_NAMES.A,TAG_ID.A],[TAG_NAMES.ADDRESS,TAG_ID.ADDRESS],[TAG_NAMES.ANNOTATION_XML,TAG_ID.ANNOTATION_XML],[TAG_NAMES.APPLET,TAG_ID.APPLET],[TAG_NAMES.AREA,TAG_ID.AREA],[TAG_NAMES.ARTICLE,TAG_ID.ARTICLE],[TAG_NAMES.ASIDE,TAG_ID.ASIDE],[TAG_NAMES.B,TAG_ID.B],[TAG_NAMES.BASE,TAG_ID.BASE],[TAG_NAMES.BASEFONT,TAG_ID.BASEFONT],[TAG_NAMES.BGSOUND,TAG_ID.BGSOUND],[TAG_NAMES.BIG,TAG_ID.BIG],[TAG_NAMES.BLOCKQUOTE,TAG_ID.BLOCKQUOTE],[TAG_NAMES.BODY,TAG_ID.BODY],[TAG_NAMES.BR,TAG_ID.BR],[TAG_NAMES.BUTTON,TAG_ID.BUTTON],[TAG_NAMES.CAPTION,TAG_ID.CAPTION],[TAG_NAMES.CENTER,TAG_ID.CENTER],[TAG_NAMES.CODE,TAG_ID.CODE],[TAG_NAMES.COL,TAG_ID.COL],[TAG_NAMES.COLGROUP,TAG_ID.COLGROUP],[TAG_NAMES.DD,TAG_ID.DD],[TAG_NAMES.DESC,TAG_ID.DESC],[TAG_NAMES.DETAILS,TAG_ID.DETAILS],[TAG_NAMES.DIALOG,TAG_ID.DIALOG],[TAG_NAMES.DIR,TAG_ID.DIR],[TAG_NAMES.DIV,TAG_ID.DIV],[TAG_NAMES.DL,TAG_ID.DL],[TAG_NAMES.DT,TAG_ID.DT],[TAG_NAMES.EM,TAG_ID.EM],[TAG_NAMES.EMBED,TAG_ID.EMBED],[TAG_NAMES.FIELDSET,TAG_ID.FIELDSET],[TAG_NAMES.FIGCAPTION,TAG_ID.FIGCAPTION],[TAG_NAMES.FIGURE,TAG_ID.FIGURE],[TAG_NAMES.FONT,TAG_ID.FONT],[TAG_NAMES.FOOTER,TAG_ID.FOOTER],[TAG_NAMES.FOREIGN_OBJECT,TAG_ID.FOREIGN_OBJECT],[TAG_NAMES.FORM,TAG_ID.FORM],[TAG_NAMES.FRAME,TAG_ID.FRAME],[TAG_NAMES.FRAMESET,TAG_ID.FRAMESET],[TAG_NAMES.H1,TAG_ID.H1],[TAG_NAMES.H2,TAG_ID.H2],[TAG_NAMES.H3,TAG_ID.H3],[TAG_NAMES.H4,TAG_ID.H4],[TAG_NAMES.H5,TAG_ID.H5],[TAG_NAMES.H6,TAG_ID.H6],[TAG_NAMES.HEAD,TAG_ID.HEAD],[TAG_NAMES.HEADER,TAG_ID.HEADER],[TAG_NAMES.HGROUP,TAG_ID.HGROUP],[TAG_NAMES.HR,TAG_ID.HR],[TAG_NAMES.HTML,TAG_ID.HTML],[TAG_NAMES.I,TAG_ID.I],[TAG_NAMES.IMG,TAG_ID.IMG],[TAG_NAMES.IMAGE,TAG_ID.IMAGE],[TAG_NAMES.INPUT,TAG_ID.INPUT],[TAG_NAMES.IFRAME,TAG_ID.IFRAME],[TAG_NAMES.KEYGEN,TAG_ID.KEYGEN],[TAG_NAMES.LABEL,TAG_ID.LABEL],[TAG_NAMES.LI,TAG_ID.LI],[TAG_NAMES.LINK,TAG_ID.LINK],[TAG_NAMES.LISTING,TAG_ID.LISTING],[TAG_NAMES.MAIN,TAG_ID.MAIN],[TAG_NAMES.MALIGNMARK,TAG_ID.MALIGNMARK],[TAG_NAMES.MARQUEE,TAG_ID.MARQUEE],[TAG_NAMES.MATH,TAG_ID.MATH],[TAG_NAMES.MENU,TAG_ID.MENU],[TAG_NAMES.META,TAG_ID.META],[TAG_NAMES.MGLYPH,TAG_ID.MGLYPH],[TAG_NAMES.MI,TAG_ID.MI],[TAG_NAMES.MO,TAG_ID.MO],[TAG_NAMES.MN,TAG_ID.MN],[TAG_NAMES.MS,TAG_ID.MS],[TAG_NAMES.MTEXT,TAG_ID.MTEXT],[TAG_NAMES.NAV,TAG_ID.NAV],[TAG_NAMES.NOBR,TAG_ID.NOBR],[TAG_NAMES.NOFRAMES,TAG_ID.NOFRAMES],[TAG_NAMES.NOEMBED,TAG_ID.NOEMBED],[TAG_NAMES.NOSCRIPT,TAG_ID.NOSCRIPT],[TAG_NAMES.OBJECT,TAG_ID.OBJECT],[TAG_NAMES.OL,TAG_ID.OL],[TAG_NAMES.OPTGROUP,TAG_ID.OPTGROUP],[TAG_NAMES.OPTION,TAG_ID.OPTION],[TAG_NAMES.P,TAG_ID.P],[TAG_NAMES.PARAM,TAG_ID.PARAM],[TAG_NAMES.PLAINTEXT,TAG_ID.PLAINTEXT],[TAG_NAMES.PRE,TAG_ID.PRE],[TAG_NAMES.RB,TAG_ID.RB],[TAG_NAMES.RP,TAG_ID.RP],[TAG_NAMES.RT,TAG_ID.RT],[TAG_NAMES.RTC,TAG_ID.RTC],[TAG_NAMES.RUBY,TAG_ID.RUBY],[TAG_NAMES.S,TAG_ID.S],[TAG_NAMES.SCRIPT,TAG_ID.SCRIPT],[TAG_NAMES.SECTION,TAG_ID.SECTION],[TAG_NAMES.SELECT,TAG_ID.SELECT],[TAG_NAMES.SOURCE,TAG_ID.SOURCE],[TAG_NAMES.SMALL,TAG_ID.SMALL],[TAG_NAMES.SPAN,TAG_ID.SPAN],[TAG_NAMES.STRIKE,TAG_ID.STRIKE],[TAG_NAMES.STRONG,TAG_ID.STRONG],[TAG_NAMES.STYLE,TAG_ID.STYLE],[TAG_NAMES.SUB,TAG_ID.SUB],[TAG_NAMES.SUMMARY,TAG_ID.SUMMARY],[TAG_NAMES.SUP,TAG_ID.SUP],[TAG_NAMES.TABLE,TAG_ID.TABLE],[TAG_NAMES.TBODY,TAG_ID.TBODY],[TAG_NAMES.TEMPLATE,TAG_ID.TEMPLATE],[TAG_NAMES.TEXTAREA,TAG_ID.TEXTAREA],[TAG_NAMES.TFOOT,TAG_ID.TFOOT],[TAG_NAMES.TD,TAG_ID.TD],[TAG_NAMES.TH,TAG_ID.TH],[TAG_NAMES.THEAD,TAG_ID.THEAD],[TAG_NAMES.TITLE,TAG_ID.TITLE],[TAG_NAMES.TR,TAG_ID.TR],[TAG_NAMES.TRACK,TAG_ID.TRACK],[TAG_NAMES.TT,TAG_ID.TT],[TAG_NAMES.U,TAG_ID.U],[TAG_NAMES.UL,TAG_ID.UL],[TAG_NAMES.SVG,TAG_ID.SVG],[TAG_NAMES.VAR,TAG_ID.VAR],[TAG_NAMES.WBR,TAG_ID.WBR],[TAG_NAMES.XMP,TAG_ID.XMP]]);function getTagID(e){var t;return(t=TAG_NAME_TO_ID.get(e))!==null&&t!==void 0?t:TAG_ID.UNKNOWN}const $=TAG_ID,SPECIAL_ELEMENTS={[NS.HTML]:new Set([$.ADDRESS,$.APPLET,$.AREA,$.ARTICLE,$.ASIDE,$.BASE,$.BASEFONT,$.BGSOUND,$.BLOCKQUOTE,$.BODY,$.BR,$.BUTTON,$.CAPTION,$.CENTER,$.COL,$.COLGROUP,$.DD,$.DETAILS,$.DIR,$.DIV,$.DL,$.DT,$.EMBED,$.FIELDSET,$.FIGCAPTION,$.FIGURE,$.FOOTER,$.FORM,$.FRAME,$.FRAMESET,$.H1,$.H2,$.H3,$.H4,$.H5,$.H6,$.HEAD,$.HEADER,$.HGROUP,$.HR,$.HTML,$.IFRAME,$.IMG,$.INPUT,$.LI,$.LINK,$.LISTING,$.MAIN,$.MARQUEE,$.MENU,$.META,$.NAV,$.NOEMBED,$.NOFRAMES,$.NOSCRIPT,$.OBJECT,$.OL,$.P,$.PARAM,$.PLAINTEXT,$.PRE,$.SCRIPT,$.SECTION,$.SELECT,$.SOURCE,$.STYLE,$.SUMMARY,$.TABLE,$.TBODY,$.TD,$.TEMPLATE,$.TEXTAREA,$.TFOOT,$.TH,$.THEAD,$.TITLE,$.TR,$.TRACK,$.UL,$.WBR,$.XMP]),[NS.MATHML]:new Set([$.MI,$.MO,$.MN,$.MS,$.MTEXT,$.ANNOTATION_XML]),[NS.SVG]:new Set([$.TITLE,$.FOREIGN_OBJECT,$.DESC]),[NS.XLINK]:new Set,[NS.XML]:new Set,[NS.XMLNS]:new Set};function isNumberedHeader(e){return e===$.H1||e===$.H2||e===$.H3||e===$.H4||e===$.H5||e===$.H6}const UNESCAPED_TEXT=new Set([TAG_NAMES.STYLE,TAG_NAMES.SCRIPT,TAG_NAMES.XMP,TAG_NAMES.IFRAME,TAG_NAMES.NOEMBED,TAG_NAMES.NOFRAMES,TAG_NAMES.PLAINTEXT]);function hasUnescapedText(e,t){return UNESCAPED_TEXT.has(e)||t&&e===TAG_NAMES.NOSCRIPT}const C1_CONTROLS_REFERENCE_REPLACEMENTS=new Map([[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);var State$1;(function(e){e[e.DATA=0]="DATA",e[e.RCDATA=1]="RCDATA",e[e.RAWTEXT=2]="RAWTEXT",e[e.SCRIPT_DATA=3]="SCRIPT_DATA",e[e.PLAINTEXT=4]="PLAINTEXT",e[e.TAG_OPEN=5]="TAG_OPEN",e[e.END_TAG_OPEN=6]="END_TAG_OPEN",e[e.TAG_NAME=7]="TAG_NAME",e[e.RCDATA_LESS_THAN_SIGN=8]="RCDATA_LESS_THAN_SIGN",e[e.RCDATA_END_TAG_OPEN=9]="RCDATA_END_TAG_OPEN",e[e.RCDATA_END_TAG_NAME=10]="RCDATA_END_TAG_NAME",e[e.RAWTEXT_LESS_THAN_SIGN=11]="RAWTEXT_LESS_THAN_SIGN",e[e.RAWTEXT_END_TAG_OPEN=12]="RAWTEXT_END_TAG_OPEN",e[e.RAWTEXT_END_TAG_NAME=13]="RAWTEXT_END_TAG_NAME",e[e.SCRIPT_DATA_LESS_THAN_SIGN=14]="SCRIPT_DATA_LESS_THAN_SIGN",e[e.SCRIPT_DATA_END_TAG_OPEN=15]="SCRIPT_DATA_END_TAG_OPEN",e[e.SCRIPT_DATA_END_TAG_NAME=16]="SCRIPT_DATA_END_TAG_NAME",e[e.SCRIPT_DATA_ESCAPE_START=17]="SCRIPT_DATA_ESCAPE_START",e[e.SCRIPT_DATA_ESCAPE_START_DASH=18]="SCRIPT_DATA_ESCAPE_START_DASH",e[e.SCRIPT_DATA_ESCAPED=19]="SCRIPT_DATA_ESCAPED",e[e.SCRIPT_DATA_ESCAPED_DASH=20]="SCRIPT_DATA_ESCAPED_DASH",e[e.SCRIPT_DATA_ESCAPED_DASH_DASH=21]="SCRIPT_DATA_ESCAPED_DASH_DASH",e[e.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN=22]="SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN",e[e.SCRIPT_DATA_ESCAPED_END_TAG_OPEN=23]="SCRIPT_DATA_ESCAPED_END_TAG_OPEN",e[e.SCRIPT_DATA_ESCAPED_END_TAG_NAME=24]="SCRIPT_DATA_ESCAPED_END_TAG_NAME",e[e.SCRIPT_DATA_DOUBLE_ESCAPE_START=25]="SCRIPT_DATA_DOUBLE_ESCAPE_START",e[e.SCRIPT_DATA_DOUBLE_ESCAPED=26]="SCRIPT_DATA_DOUBLE_ESCAPED",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_DASH=27]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH=28]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN=29]="SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN",e[e.SCRIPT_DATA_DOUBLE_ESCAPE_END=30]="SCRIPT_DATA_DOUBLE_ESCAPE_END",e[e.BEFORE_ATTRIBUTE_NAME=31]="BEFORE_ATTRIBUTE_NAME",e[e.ATTRIBUTE_NAME=32]="ATTRIBUTE_NAME",e[e.AFTER_ATTRIBUTE_NAME=33]="AFTER_ATTRIBUTE_NAME",e[e.BEFORE_ATTRIBUTE_VALUE=34]="BEFORE_ATTRIBUTE_VALUE",e[e.ATTRIBUTE_VALUE_DOUBLE_QUOTED=35]="ATTRIBUTE_VALUE_DOUBLE_QUOTED",e[e.ATTRIBUTE_VALUE_SINGLE_QUOTED=36]="ATTRIBUTE_VALUE_SINGLE_QUOTED",e[e.ATTRIBUTE_VALUE_UNQUOTED=37]="ATTRIBUTE_VALUE_UNQUOTED",e[e.AFTER_ATTRIBUTE_VALUE_QUOTED=38]="AFTER_ATTRIBUTE_VALUE_QUOTED",e[e.SELF_CLOSING_START_TAG=39]="SELF_CLOSING_START_TAG",e[e.BOGUS_COMMENT=40]="BOGUS_COMMENT",e[e.MARKUP_DECLARATION_OPEN=41]="MARKUP_DECLARATION_OPEN",e[e.COMMENT_START=42]="COMMENT_START",e[e.COMMENT_START_DASH=43]="COMMENT_START_DASH",e[e.COMMENT=44]="COMMENT",e[e.COMMENT_LESS_THAN_SIGN=45]="COMMENT_LESS_THAN_SIGN",e[e.COMMENT_LESS_THAN_SIGN_BANG=46]="COMMENT_LESS_THAN_SIGN_BANG",e[e.COMMENT_LESS_THAN_SIGN_BANG_DASH=47]="COMMENT_LESS_THAN_SIGN_BANG_DASH",e[e.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH=48]="COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH",e[e.COMMENT_END_DASH=49]="COMMENT_END_DASH",e[e.COMMENT_END=50]="COMMENT_END",e[e.COMMENT_END_BANG=51]="COMMENT_END_BANG",e[e.DOCTYPE=52]="DOCTYPE",e[e.BEFORE_DOCTYPE_NAME=53]="BEFORE_DOCTYPE_NAME",e[e.DOCTYPE_NAME=54]="DOCTYPE_NAME",e[e.AFTER_DOCTYPE_NAME=55]="AFTER_DOCTYPE_NAME",e[e.AFTER_DOCTYPE_PUBLIC_KEYWORD=56]="AFTER_DOCTYPE_PUBLIC_KEYWORD",e[e.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER=57]="BEFORE_DOCTYPE_PUBLIC_IDENTIFIER",e[e.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED=58]="DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED",e[e.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED=59]="DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED",e[e.AFTER_DOCTYPE_PUBLIC_IDENTIFIER=60]="AFTER_DOCTYPE_PUBLIC_IDENTIFIER",e[e.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS=61]="BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS",e[e.AFTER_DOCTYPE_SYSTEM_KEYWORD=62]="AFTER_DOCTYPE_SYSTEM_KEYWORD",e[e.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER=63]="BEFORE_DOCTYPE_SYSTEM_IDENTIFIER",e[e.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED=64]="DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED",e[e.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED=65]="DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED",e[e.AFTER_DOCTYPE_SYSTEM_IDENTIFIER=66]="AFTER_DOCTYPE_SYSTEM_IDENTIFIER",e[e.BOGUS_DOCTYPE=67]="BOGUS_DOCTYPE",e[e.CDATA_SECTION=68]="CDATA_SECTION",e[e.CDATA_SECTION_BRACKET=69]="CDATA_SECTION_BRACKET",e[e.CDATA_SECTION_END=70]="CDATA_SECTION_END",e[e.CHARACTER_REFERENCE=71]="CHARACTER_REFERENCE",e[e.NAMED_CHARACTER_REFERENCE=72]="NAMED_CHARACTER_REFERENCE",e[e.AMBIGUOUS_AMPERSAND=73]="AMBIGUOUS_AMPERSAND",e[e.NUMERIC_CHARACTER_REFERENCE=74]="NUMERIC_CHARACTER_REFERENCE",e[e.HEXADEMICAL_CHARACTER_REFERENCE_START=75]="HEXADEMICAL_CHARACTER_REFERENCE_START",e[e.HEXADEMICAL_CHARACTER_REFERENCE=76]="HEXADEMICAL_CHARACTER_REFERENCE",e[e.DECIMAL_CHARACTER_REFERENCE=77]="DECIMAL_CHARACTER_REFERENCE",e[e.NUMERIC_CHARACTER_REFERENCE_END=78]="NUMERIC_CHARACTER_REFERENCE_END"})(State$1||(State$1={}));const TokenizerMode={DATA:State$1.DATA,RCDATA:State$1.RCDATA,RAWTEXT:State$1.RAWTEXT,SCRIPT_DATA:State$1.SCRIPT_DATA,PLAINTEXT:State$1.PLAINTEXT,CDATA_SECTION:State$1.CDATA_SECTION};function isAsciiDigit(e){return e>=CODE_POINTS.DIGIT_0&&e<=CODE_POINTS.DIGIT_9}function isAsciiUpper(e){return e>=CODE_POINTS.LATIN_CAPITAL_A&&e<=CODE_POINTS.LATIN_CAPITAL_Z}function isAsciiLower(e){return e>=CODE_POINTS.LATIN_SMALL_A&&e<=CODE_POINTS.LATIN_SMALL_Z}function isAsciiLetter(e){return isAsciiLower(e)||isAsciiUpper(e)}function isAsciiAlphaNumeric(e){return isAsciiLetter(e)||isAsciiDigit(e)}function isAsciiUpperHexDigit(e){return e>=CODE_POINTS.LATIN_CAPITAL_A&&e<=CODE_POINTS.LATIN_CAPITAL_F}function isAsciiLowerHexDigit(e){return e>=CODE_POINTS.LATIN_SMALL_A&&e<=CODE_POINTS.LATIN_SMALL_F}function isAsciiHexDigit(e){return isAsciiDigit(e)||isAsciiUpperHexDigit(e)||isAsciiLowerHexDigit(e)}function toAsciiLower(e){return e+32}function isWhitespace$1(e){return e===CODE_POINTS.SPACE||e===CODE_POINTS.LINE_FEED||e===CODE_POINTS.TABULATION||e===CODE_POINTS.FORM_FEED}function isEntityInAttributeInvalidEnd(e){return e===CODE_POINTS.EQUALS_SIGN||isAsciiAlphaNumeric(e)}function isScriptDataDoubleEscapeSequenceEnd(e){return isWhitespace$1(e)||e===CODE_POINTS.SOLIDUS||e===CODE_POINTS.GREATER_THAN_SIGN}let Tokenizer$1=class{constructor(t,s){this.options=t,this.handler=s,this.paused=!1,this.inLoop=!1,this.inForeignNode=!1,this.lastStartTagName="",this.active=!1,this.state=State$1.DATA,this.returnState=State$1.DATA,this.charRefCode=-1,this.consumedAfterSnapshot=-1,this.currentCharacterToken=null,this.currentToken=null,this.currentAttr={name:"",value:""},this.preprocessor=new Preprocessor(s),this.currentLocation=this.getCurrentLocation(-1)}_err(t){var s,n;(n=(s=this.handler).onParseError)===null||n===void 0||n.call(s,this.preprocessor.getError(t))}getCurrentLocation(t){return this.options.sourceCodeLocationInfo?{startLine:this.preprocessor.line,startCol:this.preprocessor.col-t,startOffset:this.preprocessor.offset-t,endLine:-1,endCol:-1,endOffset:-1}:null}_runParsingLoop(){if(!this.inLoop){for(this.inLoop=!0;this.active&&!this.paused;){this.consumedAfterSnapshot=0;const t=this._consume();this._ensureHibernation()||this._callState(t)}this.inLoop=!1}}pause(){this.paused=!0}resume(t){if(!this.paused)throw new Error("Parser was already resumed");this.paused=!1,!this.inLoop&&(this._runParsingLoop(),this.paused||t?.())}write(t,s,n){this.active=!0,this.preprocessor.write(t,s),this._runParsingLoop(),this.paused||n?.()}insertHtmlAtCurrentPos(t){this.active=!0,this.preprocessor.insertHtmlAtCurrentPos(t),this._runParsingLoop()}_ensureHibernation(){return this.preprocessor.endOfChunkHit?(this._unconsume(this.consumedAfterSnapshot),this.active=!1,!0):!1}_consume(){return this.consumedAfterSnapshot++,this.preprocessor.advance()}_unconsume(t){this.consumedAfterSnapshot-=t,this.preprocessor.retreat(t)}_reconsumeInState(t,s){this.state=t,this._callState(s)}_advanceBy(t){this.consumedAfterSnapshot+=t;for(let s=0;s<t;s++)this.preprocessor.advance()}_consumeSequenceIfMatch(t,s){return this.preprocessor.startsWith(t,s)?(this._advanceBy(t.length-1),!0):!1}_createStartTagToken(){this.currentToken={type:TokenType.START_TAG,tagName:"",tagID:TAG_ID.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(1)}}_createEndTagToken(){this.currentToken={type:TokenType.END_TAG,tagName:"",tagID:TAG_ID.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(2)}}_createCommentToken(t){this.currentToken={type:TokenType.COMMENT,data:"",location:this.getCurrentLocation(t)}}_createDoctypeToken(t){this.currentToken={type:TokenType.DOCTYPE,name:t,forceQuirks:!1,publicId:null,systemId:null,location:this.currentLocation}}_createCharacterToken(t,s){this.currentCharacterToken={type:t,chars:s,location:this.currentLocation}}_createAttr(t){this.currentAttr={name:t,value:""},this.currentLocation=this.getCurrentLocation(0)}_leaveAttrName(){var t,s;const n=this.currentToken;if(getTokenAttr(n,this.currentAttr.name)===null){if(n.attrs.push(this.currentAttr),n.location&&this.currentLocation){const i=(t=(s=n.location).attrs)!==null&&t!==void 0?t:s.attrs=Object.create(null);i[this.currentAttr.name]=this.currentLocation,this._leaveAttrValue()}}else this._err(ERR.duplicateAttribute)}_leaveAttrValue(){this.currentLocation&&(this.currentLocation.endLine=this.preprocessor.line,this.currentLocation.endCol=this.preprocessor.col,this.currentLocation.endOffset=this.preprocessor.offset)}prepareToken(t){this._emitCurrentCharacterToken(t.location),this.currentToken=null,t.location&&(t.location.endLine=this.preprocessor.line,t.location.endCol=this.preprocessor.col+1,t.location.endOffset=this.preprocessor.offset+1),this.currentLocation=this.getCurrentLocation(-1)}emitCurrentTagToken(){const t=this.currentToken;this.prepareToken(t),t.tagID=getTagID(t.tagName),t.type===TokenType.START_TAG?(this.lastStartTagName=t.tagName,this.handler.onStartTag(t)):(t.attrs.length>0&&this._err(ERR.endTagWithAttributes),t.selfClosing&&this._err(ERR.endTagWithTrailingSolidus),this.handler.onEndTag(t)),this.preprocessor.dropParsedChunk()}emitCurrentComment(t){this.prepareToken(t),this.handler.onComment(t),this.preprocessor.dropParsedChunk()}emitCurrentDoctype(t){this.prepareToken(t),this.handler.onDoctype(t),this.preprocessor.dropParsedChunk()}_emitCurrentCharacterToken(t){if(this.currentCharacterToken){switch(t&&this.currentCharacterToken.location&&(this.currentCharacterToken.location.endLine=t.startLine,this.currentCharacterToken.location.endCol=t.startCol,this.currentCharacterToken.location.endOffset=t.startOffset),this.currentCharacterToken.type){case TokenType.CHARACTER:{this.handler.onCharacter(this.currentCharacterToken);break}case TokenType.NULL_CHARACTER:{this.handler.onNullCharacter(this.currentCharacterToken);break}case TokenType.WHITESPACE_CHARACTER:{this.handler.onWhitespaceCharacter(this.currentCharacterToken);break}}this.currentCharacterToken=null}}_emitEOFToken(){const t=this.getCurrentLocation(0);t&&(t.endLine=t.startLine,t.endCol=t.startCol,t.endOffset=t.startOffset),this._emitCurrentCharacterToken(t),this.handler.onEof({type:TokenType.EOF,location:t}),this.active=!1}_appendCharToCurrentCharacterToken(t,s){if(this.currentCharacterToken)if(this.currentCharacterToken.type!==t)this.currentLocation=this.getCurrentLocation(0),this._emitCurrentCharacterToken(this.currentLocation),this.preprocessor.dropParsedChunk();else{this.currentCharacterToken.chars+=s;return}this._createCharacterToken(t,s)}_emitCodePoint(t){const s=isWhitespace$1(t)?TokenType.WHITESPACE_CHARACTER:t===CODE_POINTS.NULL?TokenType.NULL_CHARACTER:TokenType.CHARACTER;this._appendCharToCurrentCharacterToken(s,String.fromCodePoint(t))}_emitChars(t){this._appendCharToCurrentCharacterToken(TokenType.CHARACTER,t)}_matchNamedCharacterReference(t){let s=null,n=0,i=!1;for(let r=0,d=htmlDecodeTree[0];r>=0&&(r=determineBranch(htmlDecodeTree,d,r+1,t),!(r<0));t=this._consume()){n+=1,d=htmlDecodeTree[r];const f=d&BinTrieFlags.VALUE_LENGTH;if(f){const m=(f>>14)-1;if(t!==CODE_POINTS.SEMICOLON&&this._isCharacterReferenceInAttribute()&&isEntityInAttributeInvalidEnd(this.preprocessor.peek(1))?(s=[CODE_POINTS.AMPERSAND],r+=m):(s=m===0?[htmlDecodeTree[r]&~BinTrieFlags.VALUE_LENGTH]:m===1?[htmlDecodeTree[++r]]:[htmlDecodeTree[++r],htmlDecodeTree[++r]],n=0,i=t!==CODE_POINTS.SEMICOLON),m===0){this._consume();break}}}return this._unconsume(n),i&&!this.preprocessor.endOfChunkHit&&this._err(ERR.missingSemicolonAfterCharacterReference),this._unconsume(1),s}_isCharacterReferenceInAttribute(){return this.returnState===State$1.ATTRIBUTE_VALUE_DOUBLE_QUOTED||this.returnState===State$1.ATTRIBUTE_VALUE_SINGLE_QUOTED||this.returnState===State$1.ATTRIBUTE_VALUE_UNQUOTED}_flushCodePointConsumedAsCharacterReference(t){this._isCharacterReferenceInAttribute()?this.currentAttr.value+=String.fromCodePoint(t):this._emitCodePoint(t)}_callState(t){switch(this.state){case State$1.DATA:{this._stateData(t);break}case State$1.RCDATA:{this._stateRcdata(t);break}case State$1.RAWTEXT:{this._stateRawtext(t);break}case State$1.SCRIPT_DATA:{this._stateScriptData(t);break}case State$1.PLAINTEXT:{this._statePlaintext(t);break}case State$1.TAG_OPEN:{this._stateTagOpen(t);break}case State$1.END_TAG_OPEN:{this._stateEndTagOpen(t);break}case State$1.TAG_NAME:{this._stateTagName(t);break}case State$1.RCDATA_LESS_THAN_SIGN:{this._stateRcdataLessThanSign(t);break}case State$1.RCDATA_END_TAG_OPEN:{this._stateRcdataEndTagOpen(t);break}case State$1.RCDATA_END_TAG_NAME:{this._stateRcdataEndTagName(t);break}case State$1.RAWTEXT_LESS_THAN_SIGN:{this._stateRawtextLessThanSign(t);break}case State$1.RAWTEXT_END_TAG_OPEN:{this._stateRawtextEndTagOpen(t);break}case State$1.RAWTEXT_END_TAG_NAME:{this._stateRawtextEndTagName(t);break}case State$1.SCRIPT_DATA_LESS_THAN_SIGN:{this._stateScriptDataLessThanSign(t);break}case State$1.SCRIPT_DATA_END_TAG_OPEN:{this._stateScriptDataEndTagOpen(t);break}case State$1.SCRIPT_DATA_END_TAG_NAME:{this._stateScriptDataEndTagName(t);break}case State$1.SCRIPT_DATA_ESCAPE_START:{this._stateScriptDataEscapeStart(t);break}case State$1.SCRIPT_DATA_ESCAPE_START_DASH:{this._stateScriptDataEscapeStartDash(t);break}case State$1.SCRIPT_DATA_ESCAPED:{this._stateScriptDataEscaped(t);break}case State$1.SCRIPT_DATA_ESCAPED_DASH:{this._stateScriptDataEscapedDash(t);break}case State$1.SCRIPT_DATA_ESCAPED_DASH_DASH:{this._stateScriptDataEscapedDashDash(t);break}case State$1.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataEscapedLessThanSign(t);break}case State$1.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:{this._stateScriptDataEscapedEndTagOpen(t);break}case State$1.SCRIPT_DATA_ESCAPED_END_TAG_NAME:{this._stateScriptDataEscapedEndTagName(t);break}case State$1.SCRIPT_DATA_DOUBLE_ESCAPE_START:{this._stateScriptDataDoubleEscapeStart(t);break}case State$1.SCRIPT_DATA_DOUBLE_ESCAPED:{this._stateScriptDataDoubleEscaped(t);break}case State$1.SCRIPT_DATA_DOUBLE_ESCAPED_DASH:{this._stateScriptDataDoubleEscapedDash(t);break}case State$1.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH:{this._stateScriptDataDoubleEscapedDashDash(t);break}case State$1.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataDoubleEscapedLessThanSign(t);break}case State$1.SCRIPT_DATA_DOUBLE_ESCAPE_END:{this._stateScriptDataDoubleEscapeEnd(t);break}case State$1.BEFORE_ATTRIBUTE_NAME:{this._stateBeforeAttributeName(t);break}case State$1.ATTRIBUTE_NAME:{this._stateAttributeName(t);break}case State$1.AFTER_ATTRIBUTE_NAME:{this._stateAfterAttributeName(t);break}case State$1.BEFORE_ATTRIBUTE_VALUE:{this._stateBeforeAttributeValue(t);break}case State$1.ATTRIBUTE_VALUE_DOUBLE_QUOTED:{this._stateAttributeValueDoubleQuoted(t);break}case State$1.ATTRIBUTE_VALUE_SINGLE_QUOTED:{this._stateAttributeValueSingleQuoted(t);break}case State$1.ATTRIBUTE_VALUE_UNQUOTED:{this._stateAttributeValueUnquoted(t);break}case State$1.AFTER_ATTRIBUTE_VALUE_QUOTED:{this._stateAfterAttributeValueQuoted(t);break}case State$1.SELF_CLOSING_START_TAG:{this._stateSelfClosingStartTag(t);break}case State$1.BOGUS_COMMENT:{this._stateBogusComment(t);break}case State$1.MARKUP_DECLARATION_OPEN:{this._stateMarkupDeclarationOpen(t);break}case State$1.COMMENT_START:{this._stateCommentStart(t);break}case State$1.COMMENT_START_DASH:{this._stateCommentStartDash(t);break}case State$1.COMMENT:{this._stateComment(t);break}case State$1.COMMENT_LESS_THAN_SIGN:{this._stateCommentLessThanSign(t);break}case State$1.COMMENT_LESS_THAN_SIGN_BANG:{this._stateCommentLessThanSignBang(t);break}case State$1.COMMENT_LESS_THAN_SIGN_BANG_DASH:{this._stateCommentLessThanSignBangDash(t);break}case State$1.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:{this._stateCommentLessThanSignBangDashDash(t);break}case State$1.COMMENT_END_DASH:{this._stateCommentEndDash(t);break}case State$1.COMMENT_END:{this._stateCommentEnd(t);break}case State$1.COMMENT_END_BANG:{this._stateCommentEndBang(t);break}case State$1.DOCTYPE:{this._stateDoctype(t);break}case State$1.BEFORE_DOCTYPE_NAME:{this._stateBeforeDoctypeName(t);break}case State$1.DOCTYPE_NAME:{this._stateDoctypeName(t);break}case State$1.AFTER_DOCTYPE_NAME:{this._stateAfterDoctypeName(t);break}case State$1.AFTER_DOCTYPE_PUBLIC_KEYWORD:{this._stateAfterDoctypePublicKeyword(t);break}case State$1.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateBeforeDoctypePublicIdentifier(t);break}case State$1.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypePublicIdentifierDoubleQuoted(t);break}case State$1.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypePublicIdentifierSingleQuoted(t);break}case State$1.AFTER_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateAfterDoctypePublicIdentifier(t);break}case State$1.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS:{this._stateBetweenDoctypePublicAndSystemIdentifiers(t);break}case State$1.AFTER_DOCTYPE_SYSTEM_KEYWORD:{this._stateAfterDoctypeSystemKeyword(t);break}case State$1.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateBeforeDoctypeSystemIdentifier(t);break}case State$1.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypeSystemIdentifierDoubleQuoted(t);break}case State$1.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypeSystemIdentifierSingleQuoted(t);break}case State$1.AFTER_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateAfterDoctypeSystemIdentifier(t);break}case State$1.BOGUS_DOCTYPE:{this._stateBogusDoctype(t);break}case State$1.CDATA_SECTION:{this._stateCdataSection(t);break}case State$1.CDATA_SECTION_BRACKET:{this._stateCdataSectionBracket(t);break}case State$1.CDATA_SECTION_END:{this._stateCdataSectionEnd(t);break}case State$1.CHARACTER_REFERENCE:{this._stateCharacterReference(t);break}case State$1.NAMED_CHARACTER_REFERENCE:{this._stateNamedCharacterReference(t);break}case State$1.AMBIGUOUS_AMPERSAND:{this._stateAmbiguousAmpersand(t);break}case State$1.NUMERIC_CHARACTER_REFERENCE:{this._stateNumericCharacterReference(t);break}case State$1.HEXADEMICAL_CHARACTER_REFERENCE_START:{this._stateHexademicalCharacterReferenceStart(t);break}case State$1.HEXADEMICAL_CHARACTER_REFERENCE:{this._stateHexademicalCharacterReference(t);break}case State$1.DECIMAL_CHARACTER_REFERENCE:{this._stateDecimalCharacterReference(t);break}case State$1.NUMERIC_CHARACTER_REFERENCE_END:{this._stateNumericCharacterReferenceEnd(t);break}default:throw new Error("Unknown state")}}_stateData(t){switch(t){case CODE_POINTS.LESS_THAN_SIGN:{this.state=State$1.TAG_OPEN;break}case CODE_POINTS.AMPERSAND:{this.returnState=State$1.DATA,this.state=State$1.CHARACTER_REFERENCE;break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),this._emitCodePoint(t);break}case CODE_POINTS.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateRcdata(t){switch(t){case CODE_POINTS.AMPERSAND:{this.returnState=State$1.RCDATA,this.state=State$1.CHARACTER_REFERENCE;break}case CODE_POINTS.LESS_THAN_SIGN:{this.state=State$1.RCDATA_LESS_THAN_SIGN;break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),this._emitChars(REPLACEMENT_CHARACTER);break}case CODE_POINTS.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateRawtext(t){switch(t){case CODE_POINTS.LESS_THAN_SIGN:{this.state=State$1.RAWTEXT_LESS_THAN_SIGN;break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),this._emitChars(REPLACEMENT_CHARACTER);break}case CODE_POINTS.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptData(t){switch(t){case CODE_POINTS.LESS_THAN_SIGN:{this.state=State$1.SCRIPT_DATA_LESS_THAN_SIGN;break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),this._emitChars(REPLACEMENT_CHARACTER);break}case CODE_POINTS.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_statePlaintext(t){switch(t){case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),this._emitChars(REPLACEMENT_CHARACTER);break}case CODE_POINTS.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateTagOpen(t){if(isAsciiLetter(t))this._createStartTagToken(),this.state=State$1.TAG_NAME,this._stateTagName(t);else switch(t){case CODE_POINTS.EXCLAMATION_MARK:{this.state=State$1.MARKUP_DECLARATION_OPEN;break}case CODE_POINTS.SOLIDUS:{this.state=State$1.END_TAG_OPEN;break}case CODE_POINTS.QUESTION_MARK:{this._err(ERR.unexpectedQuestionMarkInsteadOfTagName),this._createCommentToken(1),this.state=State$1.BOGUS_COMMENT,this._stateBogusComment(t);break}case CODE_POINTS.EOF:{this._err(ERR.eofBeforeTagName),this._emitChars("<"),this._emitEOFToken();break}default:this._err(ERR.invalidFirstCharacterOfTagName),this._emitChars("<"),this.state=State$1.DATA,this._stateData(t)}}_stateEndTagOpen(t){if(isAsciiLetter(t))this._createEndTagToken(),this.state=State$1.TAG_NAME,this._stateTagName(t);else switch(t){case CODE_POINTS.GREATER_THAN_SIGN:{this._err(ERR.missingEndTagName),this.state=State$1.DATA;break}case CODE_POINTS.EOF:{this._err(ERR.eofBeforeTagName),this._emitChars("</"),this._emitEOFToken();break}default:this._err(ERR.invalidFirstCharacterOfTagName),this._createCommentToken(2),this.state=State$1.BOGUS_COMMENT,this._stateBogusComment(t)}}_stateTagName(t){const s=this.currentToken;switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:{this.state=State$1.BEFORE_ATTRIBUTE_NAME;break}case CODE_POINTS.SOLIDUS:{this.state=State$1.SELF_CLOSING_START_TAG;break}case CODE_POINTS.GREATER_THAN_SIGN:{this.state=State$1.DATA,this.emitCurrentTagToken();break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),s.tagName+=REPLACEMENT_CHARACTER;break}case CODE_POINTS.EOF:{this._err(ERR.eofInTag),this._emitEOFToken();break}default:s.tagName+=String.fromCodePoint(isAsciiUpper(t)?toAsciiLower(t):t)}}_stateRcdataLessThanSign(t){t===CODE_POINTS.SOLIDUS?this.state=State$1.RCDATA_END_TAG_OPEN:(this._emitChars("<"),this.state=State$1.RCDATA,this._stateRcdata(t))}_stateRcdataEndTagOpen(t){isAsciiLetter(t)?(this.state=State$1.RCDATA_END_TAG_NAME,this._stateRcdataEndTagName(t)):(this._emitChars("</"),this.state=State$1.RCDATA,this._stateRcdata(t))}handleSpecialEndTag(t){if(!this.preprocessor.startsWith(this.lastStartTagName,!1))return!this._ensureHibernation();this._createEndTagToken();const s=this.currentToken;switch(s.tagName=this.lastStartTagName,this.preprocessor.peek(this.lastStartTagName.length)){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:return this._advanceBy(this.lastStartTagName.length),this.state=State$1.BEFORE_ATTRIBUTE_NAME,!1;case CODE_POINTS.SOLIDUS:return this._advanceBy(this.lastStartTagName.length),this.state=State$1.SELF_CLOSING_START_TAG,!1;case CODE_POINTS.GREATER_THAN_SIGN:return this._advanceBy(this.lastStartTagName.length),this.emitCurrentTagToken(),this.state=State$1.DATA,!1;default:return!this._ensureHibernation()}}_stateRcdataEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=State$1.RCDATA,this._stateRcdata(t))}_stateRawtextLessThanSign(t){t===CODE_POINTS.SOLIDUS?this.state=State$1.RAWTEXT_END_TAG_OPEN:(this._emitChars("<"),this.state=State$1.RAWTEXT,this._stateRawtext(t))}_stateRawtextEndTagOpen(t){isAsciiLetter(t)?(this.state=State$1.RAWTEXT_END_TAG_NAME,this._stateRawtextEndTagName(t)):(this._emitChars("</"),this.state=State$1.RAWTEXT,this._stateRawtext(t))}_stateRawtextEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=State$1.RAWTEXT,this._stateRawtext(t))}_stateScriptDataLessThanSign(t){switch(t){case CODE_POINTS.SOLIDUS:{this.state=State$1.SCRIPT_DATA_END_TAG_OPEN;break}case CODE_POINTS.EXCLAMATION_MARK:{this.state=State$1.SCRIPT_DATA_ESCAPE_START,this._emitChars("<!");break}default:this._emitChars("<"),this.state=State$1.SCRIPT_DATA,this._stateScriptData(t)}}_stateScriptDataEndTagOpen(t){isAsciiLetter(t)?(this.state=State$1.SCRIPT_DATA_END_TAG_NAME,this._stateScriptDataEndTagName(t)):(this._emitChars("</"),this.state=State$1.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=State$1.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscapeStart(t){t===CODE_POINTS.HYPHEN_MINUS?(this.state=State$1.SCRIPT_DATA_ESCAPE_START_DASH,this._emitChars("-")):(this.state=State$1.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscapeStartDash(t){t===CODE_POINTS.HYPHEN_MINUS?(this.state=State$1.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-")):(this.state=State$1.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscaped(t){switch(t){case CODE_POINTS.HYPHEN_MINUS:{this.state=State$1.SCRIPT_DATA_ESCAPED_DASH,this._emitChars("-");break}case CODE_POINTS.LESS_THAN_SIGN:{this.state=State$1.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),this._emitChars(REPLACEMENT_CHARACTER);break}case CODE_POINTS.EOF:{this._err(ERR.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptDataEscapedDash(t){switch(t){case CODE_POINTS.HYPHEN_MINUS:{this.state=State$1.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-");break}case CODE_POINTS.LESS_THAN_SIGN:{this.state=State$1.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),this.state=State$1.SCRIPT_DATA_ESCAPED,this._emitChars(REPLACEMENT_CHARACTER);break}case CODE_POINTS.EOF:{this._err(ERR.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=State$1.SCRIPT_DATA_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataEscapedDashDash(t){switch(t){case CODE_POINTS.HYPHEN_MINUS:{this._emitChars("-");break}case CODE_POINTS.LESS_THAN_SIGN:{this.state=State$1.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case CODE_POINTS.GREATER_THAN_SIGN:{this.state=State$1.SCRIPT_DATA,this._emitChars(">");break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),this.state=State$1.SCRIPT_DATA_ESCAPED,this._emitChars(REPLACEMENT_CHARACTER);break}case CODE_POINTS.EOF:{this._err(ERR.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=State$1.SCRIPT_DATA_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataEscapedLessThanSign(t){t===CODE_POINTS.SOLIDUS?this.state=State$1.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:isAsciiLetter(t)?(this._emitChars("<"),this.state=State$1.SCRIPT_DATA_DOUBLE_ESCAPE_START,this._stateScriptDataDoubleEscapeStart(t)):(this._emitChars("<"),this.state=State$1.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataEscapedEndTagOpen(t){isAsciiLetter(t)?(this.state=State$1.SCRIPT_DATA_ESCAPED_END_TAG_NAME,this._stateScriptDataEscapedEndTagName(t)):(this._emitChars("</"),this.state=State$1.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataEscapedEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=State$1.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataDoubleEscapeStart(t){if(this.preprocessor.startsWith(SEQUENCES.SCRIPT,!1)&&isScriptDataDoubleEscapeSequenceEnd(this.preprocessor.peek(SEQUENCES.SCRIPT.length))){this._emitCodePoint(t);for(let s=0;s<SEQUENCES.SCRIPT.length;s++)this._emitCodePoint(this._consume());this.state=State$1.SCRIPT_DATA_DOUBLE_ESCAPED}else this._ensureHibernation()||(this.state=State$1.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataDoubleEscaped(t){switch(t){case CODE_POINTS.HYPHEN_MINUS:{this.state=State$1.SCRIPT_DATA_DOUBLE_ESCAPED_DASH,this._emitChars("-");break}case CODE_POINTS.LESS_THAN_SIGN:{this.state=State$1.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),this._emitChars(REPLACEMENT_CHARACTER);break}case CODE_POINTS.EOF:{this._err(ERR.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedDash(t){switch(t){case CODE_POINTS.HYPHEN_MINUS:{this.state=State$1.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH,this._emitChars("-");break}case CODE_POINTS.LESS_THAN_SIGN:{this.state=State$1.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),this.state=State$1.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(REPLACEMENT_CHARACTER);break}case CODE_POINTS.EOF:{this._err(ERR.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=State$1.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedDashDash(t){switch(t){case CODE_POINTS.HYPHEN_MINUS:{this._emitChars("-");break}case CODE_POINTS.LESS_THAN_SIGN:{this.state=State$1.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case CODE_POINTS.GREATER_THAN_SIGN:{this.state=State$1.SCRIPT_DATA,this._emitChars(">");break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),this.state=State$1.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(REPLACEMENT_CHARACTER);break}case CODE_POINTS.EOF:{this._err(ERR.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=State$1.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedLessThanSign(t){t===CODE_POINTS.SOLIDUS?(this.state=State$1.SCRIPT_DATA_DOUBLE_ESCAPE_END,this._emitChars("/")):(this.state=State$1.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(t))}_stateScriptDataDoubleEscapeEnd(t){if(this.preprocessor.startsWith(SEQUENCES.SCRIPT,!1)&&isScriptDataDoubleEscapeSequenceEnd(this.preprocessor.peek(SEQUENCES.SCRIPT.length))){this._emitCodePoint(t);for(let s=0;s<SEQUENCES.SCRIPT.length;s++)this._emitCodePoint(this._consume());this.state=State$1.SCRIPT_DATA_ESCAPED}else this._ensureHibernation()||(this.state=State$1.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(t))}_stateBeforeAttributeName(t){switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:break;case CODE_POINTS.SOLIDUS:case CODE_POINTS.GREATER_THAN_SIGN:case CODE_POINTS.EOF:{this.state=State$1.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(t);break}case CODE_POINTS.EQUALS_SIGN:{this._err(ERR.unexpectedEqualsSignBeforeAttributeName),this._createAttr("="),this.state=State$1.ATTRIBUTE_NAME;break}default:this._createAttr(""),this.state=State$1.ATTRIBUTE_NAME,this._stateAttributeName(t)}}_stateAttributeName(t){switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:case CODE_POINTS.SOLIDUS:case CODE_POINTS.GREATER_THAN_SIGN:case CODE_POINTS.EOF:{this._leaveAttrName(),this.state=State$1.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(t);break}case CODE_POINTS.EQUALS_SIGN:{this._leaveAttrName(),this.state=State$1.BEFORE_ATTRIBUTE_VALUE;break}case CODE_POINTS.QUOTATION_MARK:case CODE_POINTS.APOSTROPHE:case CODE_POINTS.LESS_THAN_SIGN:{this._err(ERR.unexpectedCharacterInAttributeName),this.currentAttr.name+=String.fromCodePoint(t);break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),this.currentAttr.name+=REPLACEMENT_CHARACTER;break}default:this.currentAttr.name+=String.fromCodePoint(isAsciiUpper(t)?toAsciiLower(t):t)}}_stateAfterAttributeName(t){switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:break;case CODE_POINTS.SOLIDUS:{this.state=State$1.SELF_CLOSING_START_TAG;break}case CODE_POINTS.EQUALS_SIGN:{this.state=State$1.BEFORE_ATTRIBUTE_VALUE;break}case CODE_POINTS.GREATER_THAN_SIGN:{this.state=State$1.DATA,this.emitCurrentTagToken();break}case CODE_POINTS.EOF:{this._err(ERR.eofInTag),this._emitEOFToken();break}default:this._createAttr(""),this.state=State$1.ATTRIBUTE_NAME,this._stateAttributeName(t)}}_stateBeforeAttributeValue(t){switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:break;case CODE_POINTS.QUOTATION_MARK:{this.state=State$1.ATTRIBUTE_VALUE_DOUBLE_QUOTED;break}case CODE_POINTS.APOSTROPHE:{this.state=State$1.ATTRIBUTE_VALUE_SINGLE_QUOTED;break}case CODE_POINTS.GREATER_THAN_SIGN:{this._err(ERR.missingAttributeValue),this.state=State$1.DATA,this.emitCurrentTagToken();break}default:this.state=State$1.ATTRIBUTE_VALUE_UNQUOTED,this._stateAttributeValueUnquoted(t)}}_stateAttributeValueDoubleQuoted(t){switch(t){case CODE_POINTS.QUOTATION_MARK:{this.state=State$1.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case CODE_POINTS.AMPERSAND:{this.returnState=State$1.ATTRIBUTE_VALUE_DOUBLE_QUOTED,this.state=State$1.CHARACTER_REFERENCE;break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),this.currentAttr.value+=REPLACEMENT_CHARACTER;break}case CODE_POINTS.EOF:{this._err(ERR.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAttributeValueSingleQuoted(t){switch(t){case CODE_POINTS.APOSTROPHE:{this.state=State$1.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case CODE_POINTS.AMPERSAND:{this.returnState=State$1.ATTRIBUTE_VALUE_SINGLE_QUOTED,this.state=State$1.CHARACTER_REFERENCE;break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),this.currentAttr.value+=REPLACEMENT_CHARACTER;break}case CODE_POINTS.EOF:{this._err(ERR.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAttributeValueUnquoted(t){switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:{this._leaveAttrValue(),this.state=State$1.BEFORE_ATTRIBUTE_NAME;break}case CODE_POINTS.AMPERSAND:{this.returnState=State$1.ATTRIBUTE_VALUE_UNQUOTED,this.state=State$1.CHARACTER_REFERENCE;break}case CODE_POINTS.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=State$1.DATA,this.emitCurrentTagToken();break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),this.currentAttr.value+=REPLACEMENT_CHARACTER;break}case CODE_POINTS.QUOTATION_MARK:case CODE_POINTS.APOSTROPHE:case CODE_POINTS.LESS_THAN_SIGN:case CODE_POINTS.EQUALS_SIGN:case CODE_POINTS.GRAVE_ACCENT:{this._err(ERR.unexpectedCharacterInUnquotedAttributeValue),this.currentAttr.value+=String.fromCodePoint(t);break}case CODE_POINTS.EOF:{this._err(ERR.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAfterAttributeValueQuoted(t){switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:{this._leaveAttrValue(),this.state=State$1.BEFORE_ATTRIBUTE_NAME;break}case CODE_POINTS.SOLIDUS:{this._leaveAttrValue(),this.state=State$1.SELF_CLOSING_START_TAG;break}case CODE_POINTS.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=State$1.DATA,this.emitCurrentTagToken();break}case CODE_POINTS.EOF:{this._err(ERR.eofInTag),this._emitEOFToken();break}default:this._err(ERR.missingWhitespaceBetweenAttributes),this.state=State$1.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(t)}}_stateSelfClosingStartTag(t){switch(t){case CODE_POINTS.GREATER_THAN_SIGN:{const s=this.currentToken;s.selfClosing=!0,this.state=State$1.DATA,this.emitCurrentTagToken();break}case CODE_POINTS.EOF:{this._err(ERR.eofInTag),this._emitEOFToken();break}default:this._err(ERR.unexpectedSolidusInTag),this.state=State$1.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(t)}}_stateBogusComment(t){const s=this.currentToken;switch(t){case CODE_POINTS.GREATER_THAN_SIGN:{this.state=State$1.DATA,this.emitCurrentComment(s);break}case CODE_POINTS.EOF:{this.emitCurrentComment(s),this._emitEOFToken();break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),s.data+=REPLACEMENT_CHARACTER;break}default:s.data+=String.fromCodePoint(t)}}_stateMarkupDeclarationOpen(t){this._consumeSequenceIfMatch(SEQUENCES.DASH_DASH,!0)?(this._createCommentToken(SEQUENCES.DASH_DASH.length+1),this.state=State$1.COMMENT_START):this._consumeSequenceIfMatch(SEQUENCES.DOCTYPE,!1)?(this.currentLocation=this.getCurrentLocation(SEQUENCES.DOCTYPE.length+1),this.state=State$1.DOCTYPE):this._consumeSequenceIfMatch(SEQUENCES.CDATA_START,!0)?this.inForeignNode?this.state=State$1.CDATA_SECTION:(this._err(ERR.cdataInHtmlContent),this._createCommentToken(SEQUENCES.CDATA_START.length+1),this.currentToken.data="[CDATA[",this.state=State$1.BOGUS_COMMENT):this._ensureHibernation()||(this._err(ERR.incorrectlyOpenedComment),this._createCommentToken(2),this.state=State$1.BOGUS_COMMENT,this._stateBogusComment(t))}_stateCommentStart(t){switch(t){case CODE_POINTS.HYPHEN_MINUS:{this.state=State$1.COMMENT_START_DASH;break}case CODE_POINTS.GREATER_THAN_SIGN:{this._err(ERR.abruptClosingOfEmptyComment),this.state=State$1.DATA;const s=this.currentToken;this.emitCurrentComment(s);break}default:this.state=State$1.COMMENT,this._stateComment(t)}}_stateCommentStartDash(t){const s=this.currentToken;switch(t){case CODE_POINTS.HYPHEN_MINUS:{this.state=State$1.COMMENT_END;break}case CODE_POINTS.GREATER_THAN_SIGN:{this._err(ERR.abruptClosingOfEmptyComment),this.state=State$1.DATA,this.emitCurrentComment(s);break}case CODE_POINTS.EOF:{this._err(ERR.eofInComment),this.emitCurrentComment(s),this._emitEOFToken();break}default:s.data+="-",this.state=State$1.COMMENT,this._stateComment(t)}}_stateComment(t){const s=this.currentToken;switch(t){case CODE_POINTS.HYPHEN_MINUS:{this.state=State$1.COMMENT_END_DASH;break}case CODE_POINTS.LESS_THAN_SIGN:{s.data+="<",this.state=State$1.COMMENT_LESS_THAN_SIGN;break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),s.data+=REPLACEMENT_CHARACTER;break}case CODE_POINTS.EOF:{this._err(ERR.eofInComment),this.emitCurrentComment(s),this._emitEOFToken();break}default:s.data+=String.fromCodePoint(t)}}_stateCommentLessThanSign(t){const s=this.currentToken;switch(t){case CODE_POINTS.EXCLAMATION_MARK:{s.data+="!",this.state=State$1.COMMENT_LESS_THAN_SIGN_BANG;break}case CODE_POINTS.LESS_THAN_SIGN:{s.data+="<";break}default:this.state=State$1.COMMENT,this._stateComment(t)}}_stateCommentLessThanSignBang(t){t===CODE_POINTS.HYPHEN_MINUS?this.state=State$1.COMMENT_LESS_THAN_SIGN_BANG_DASH:(this.state=State$1.COMMENT,this._stateComment(t))}_stateCommentLessThanSignBangDash(t){t===CODE_POINTS.HYPHEN_MINUS?this.state=State$1.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:(this.state=State$1.COMMENT_END_DASH,this._stateCommentEndDash(t))}_stateCommentLessThanSignBangDashDash(t){t!==CODE_POINTS.GREATER_THAN_SIGN&&t!==CODE_POINTS.EOF&&this._err(ERR.nestedComment),this.state=State$1.COMMENT_END,this._stateCommentEnd(t)}_stateCommentEndDash(t){const s=this.currentToken;switch(t){case CODE_POINTS.HYPHEN_MINUS:{this.state=State$1.COMMENT_END;break}case CODE_POINTS.EOF:{this._err(ERR.eofInComment),this.emitCurrentComment(s),this._emitEOFToken();break}default:s.data+="-",this.state=State$1.COMMENT,this._stateComment(t)}}_stateCommentEnd(t){const s=this.currentToken;switch(t){case CODE_POINTS.GREATER_THAN_SIGN:{this.state=State$1.DATA,this.emitCurrentComment(s);break}case CODE_POINTS.EXCLAMATION_MARK:{this.state=State$1.COMMENT_END_BANG;break}case CODE_POINTS.HYPHEN_MINUS:{s.data+="-";break}case CODE_POINTS.EOF:{this._err(ERR.eofInComment),this.emitCurrentComment(s),this._emitEOFToken();break}default:s.data+="--",this.state=State$1.COMMENT,this._stateComment(t)}}_stateCommentEndBang(t){const s=this.currentToken;switch(t){case CODE_POINTS.HYPHEN_MINUS:{s.data+="--!",this.state=State$1.COMMENT_END_DASH;break}case CODE_POINTS.GREATER_THAN_SIGN:{this._err(ERR.incorrectlyClosedComment),this.state=State$1.DATA,this.emitCurrentComment(s);break}case CODE_POINTS.EOF:{this._err(ERR.eofInComment),this.emitCurrentComment(s),this._emitEOFToken();break}default:s.data+="--!",this.state=State$1.COMMENT,this._stateComment(t)}}_stateDoctype(t){switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:{this.state=State$1.BEFORE_DOCTYPE_NAME;break}case CODE_POINTS.GREATER_THAN_SIGN:{this.state=State$1.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(t);break}case CODE_POINTS.EOF:{this._err(ERR.eofInDoctype),this._createDoctypeToken(null);const s=this.currentToken;s.forceQuirks=!0,this.emitCurrentDoctype(s),this._emitEOFToken();break}default:this._err(ERR.missingWhitespaceBeforeDoctypeName),this.state=State$1.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(t)}}_stateBeforeDoctypeName(t){if(isAsciiUpper(t))this._createDoctypeToken(String.fromCharCode(toAsciiLower(t))),this.state=State$1.DOCTYPE_NAME;else switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:break;case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),this._createDoctypeToken(REPLACEMENT_CHARACTER),this.state=State$1.DOCTYPE_NAME;break}case CODE_POINTS.GREATER_THAN_SIGN:{this._err(ERR.missingDoctypeName),this._createDoctypeToken(null);const s=this.currentToken;s.forceQuirks=!0,this.emitCurrentDoctype(s),this.state=State$1.DATA;break}case CODE_POINTS.EOF:{this._err(ERR.eofInDoctype),this._createDoctypeToken(null);const s=this.currentToken;s.forceQuirks=!0,this.emitCurrentDoctype(s),this._emitEOFToken();break}default:this._createDoctypeToken(String.fromCodePoint(t)),this.state=State$1.DOCTYPE_NAME}}_stateDoctypeName(t){const s=this.currentToken;switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:{this.state=State$1.AFTER_DOCTYPE_NAME;break}case CODE_POINTS.GREATER_THAN_SIGN:{this.state=State$1.DATA,this.emitCurrentDoctype(s);break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),s.name+=REPLACEMENT_CHARACTER;break}case CODE_POINTS.EOF:{this._err(ERR.eofInDoctype),s.forceQuirks=!0,this.emitCurrentDoctype(s),this._emitEOFToken();break}default:s.name+=String.fromCodePoint(isAsciiUpper(t)?toAsciiLower(t):t)}}_stateAfterDoctypeName(t){const s=this.currentToken;switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:break;case CODE_POINTS.GREATER_THAN_SIGN:{this.state=State$1.DATA,this.emitCurrentDoctype(s);break}case CODE_POINTS.EOF:{this._err(ERR.eofInDoctype),s.forceQuirks=!0,this.emitCurrentDoctype(s),this._emitEOFToken();break}default:this._consumeSequenceIfMatch(SEQUENCES.PUBLIC,!1)?this.state=State$1.AFTER_DOCTYPE_PUBLIC_KEYWORD:this._consumeSequenceIfMatch(SEQUENCES.SYSTEM,!1)?this.state=State$1.AFTER_DOCTYPE_SYSTEM_KEYWORD:this._ensureHibernation()||(this._err(ERR.invalidCharacterSequenceAfterDoctypeName),s.forceQuirks=!0,this.state=State$1.BOGUS_DOCTYPE,this._stateBogusDoctype(t))}}_stateAfterDoctypePublicKeyword(t){const s=this.currentToken;switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:{this.state=State$1.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER;break}case CODE_POINTS.QUOTATION_MARK:{this._err(ERR.missingWhitespaceAfterDoctypePublicKeyword),s.publicId="",this.state=State$1.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case CODE_POINTS.APOSTROPHE:{this._err(ERR.missingWhitespaceAfterDoctypePublicKeyword),s.publicId="",this.state=State$1.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case CODE_POINTS.GREATER_THAN_SIGN:{this._err(ERR.missingDoctypePublicIdentifier),s.forceQuirks=!0,this.state=State$1.DATA,this.emitCurrentDoctype(s);break}case CODE_POINTS.EOF:{this._err(ERR.eofInDoctype),s.forceQuirks=!0,this.emitCurrentDoctype(s),this._emitEOFToken();break}default:this._err(ERR.missingQuoteBeforeDoctypePublicIdentifier),s.forceQuirks=!0,this.state=State$1.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBeforeDoctypePublicIdentifier(t){const s=this.currentToken;switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:break;case CODE_POINTS.QUOTATION_MARK:{s.publicId="",this.state=State$1.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case CODE_POINTS.APOSTROPHE:{s.publicId="",this.state=State$1.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case CODE_POINTS.GREATER_THAN_SIGN:{this._err(ERR.missingDoctypePublicIdentifier),s.forceQuirks=!0,this.state=State$1.DATA,this.emitCurrentDoctype(s);break}case CODE_POINTS.EOF:{this._err(ERR.eofInDoctype),s.forceQuirks=!0,this.emitCurrentDoctype(s),this._emitEOFToken();break}default:this._err(ERR.missingQuoteBeforeDoctypePublicIdentifier),s.forceQuirks=!0,this.state=State$1.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateDoctypePublicIdentifierDoubleQuoted(t){const s=this.currentToken;switch(t){case CODE_POINTS.QUOTATION_MARK:{this.state=State$1.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),s.publicId+=REPLACEMENT_CHARACTER;break}case CODE_POINTS.GREATER_THAN_SIGN:{this._err(ERR.abruptDoctypePublicIdentifier),s.forceQuirks=!0,this.emitCurrentDoctype(s),this.state=State$1.DATA;break}case CODE_POINTS.EOF:{this._err(ERR.eofInDoctype),s.forceQuirks=!0,this.emitCurrentDoctype(s),this._emitEOFToken();break}default:s.publicId+=String.fromCodePoint(t)}}_stateDoctypePublicIdentifierSingleQuoted(t){const s=this.currentToken;switch(t){case CODE_POINTS.APOSTROPHE:{this.state=State$1.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),s.publicId+=REPLACEMENT_CHARACTER;break}case CODE_POINTS.GREATER_THAN_SIGN:{this._err(ERR.abruptDoctypePublicIdentifier),s.forceQuirks=!0,this.emitCurrentDoctype(s),this.state=State$1.DATA;break}case CODE_POINTS.EOF:{this._err(ERR.eofInDoctype),s.forceQuirks=!0,this.emitCurrentDoctype(s),this._emitEOFToken();break}default:s.publicId+=String.fromCodePoint(t)}}_stateAfterDoctypePublicIdentifier(t){const s=this.currentToken;switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:{this.state=State$1.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS;break}case CODE_POINTS.GREATER_THAN_SIGN:{this.state=State$1.DATA,this.emitCurrentDoctype(s);break}case CODE_POINTS.QUOTATION_MARK:{this._err(ERR.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),s.systemId="",this.state=State$1.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case CODE_POINTS.APOSTROPHE:{this._err(ERR.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),s.systemId="",this.state=State$1.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case CODE_POINTS.EOF:{this._err(ERR.eofInDoctype),s.forceQuirks=!0,this.emitCurrentDoctype(s),this._emitEOFToken();break}default:this._err(ERR.missingQuoteBeforeDoctypeSystemIdentifier),s.forceQuirks=!0,this.state=State$1.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBetweenDoctypePublicAndSystemIdentifiers(t){const s=this.currentToken;switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:break;case CODE_POINTS.GREATER_THAN_SIGN:{this.emitCurrentDoctype(s),this.state=State$1.DATA;break}case CODE_POINTS.QUOTATION_MARK:{s.systemId="",this.state=State$1.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case CODE_POINTS.APOSTROPHE:{s.systemId="",this.state=State$1.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case CODE_POINTS.EOF:{this._err(ERR.eofInDoctype),s.forceQuirks=!0,this.emitCurrentDoctype(s),this._emitEOFToken();break}default:this._err(ERR.missingQuoteBeforeDoctypeSystemIdentifier),s.forceQuirks=!0,this.state=State$1.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateAfterDoctypeSystemKeyword(t){const s=this.currentToken;switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:{this.state=State$1.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER;break}case CODE_POINTS.QUOTATION_MARK:{this._err(ERR.missingWhitespaceAfterDoctypeSystemKeyword),s.systemId="",this.state=State$1.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case CODE_POINTS.APOSTROPHE:{this._err(ERR.missingWhitespaceAfterDoctypeSystemKeyword),s.systemId="",this.state=State$1.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case CODE_POINTS.GREATER_THAN_SIGN:{this._err(ERR.missingDoctypeSystemIdentifier),s.forceQuirks=!0,this.state=State$1.DATA,this.emitCurrentDoctype(s);break}case CODE_POINTS.EOF:{this._err(ERR.eofInDoctype),s.forceQuirks=!0,this.emitCurrentDoctype(s),this._emitEOFToken();break}default:this._err(ERR.missingQuoteBeforeDoctypeSystemIdentifier),s.forceQuirks=!0,this.state=State$1.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBeforeDoctypeSystemIdentifier(t){const s=this.currentToken;switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:break;case CODE_POINTS.QUOTATION_MARK:{s.systemId="",this.state=State$1.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case CODE_POINTS.APOSTROPHE:{s.systemId="",this.state=State$1.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case CODE_POINTS.GREATER_THAN_SIGN:{this._err(ERR.missingDoctypeSystemIdentifier),s.forceQuirks=!0,this.state=State$1.DATA,this.emitCurrentDoctype(s);break}case CODE_POINTS.EOF:{this._err(ERR.eofInDoctype),s.forceQuirks=!0,this.emitCurrentDoctype(s),this._emitEOFToken();break}default:this._err(ERR.missingQuoteBeforeDoctypeSystemIdentifier),s.forceQuirks=!0,this.state=State$1.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateDoctypeSystemIdentifierDoubleQuoted(t){const s=this.currentToken;switch(t){case CODE_POINTS.QUOTATION_MARK:{this.state=State$1.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),s.systemId+=REPLACEMENT_CHARACTER;break}case CODE_POINTS.GREATER_THAN_SIGN:{this._err(ERR.abruptDoctypeSystemIdentifier),s.forceQuirks=!0,this.emitCurrentDoctype(s),this.state=State$1.DATA;break}case CODE_POINTS.EOF:{this._err(ERR.eofInDoctype),s.forceQuirks=!0,this.emitCurrentDoctype(s),this._emitEOFToken();break}default:s.systemId+=String.fromCodePoint(t)}}_stateDoctypeSystemIdentifierSingleQuoted(t){const s=this.currentToken;switch(t){case CODE_POINTS.APOSTROPHE:{this.state=State$1.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter),s.systemId+=REPLACEMENT_CHARACTER;break}case CODE_POINTS.GREATER_THAN_SIGN:{this._err(ERR.abruptDoctypeSystemIdentifier),s.forceQuirks=!0,this.emitCurrentDoctype(s),this.state=State$1.DATA;break}case CODE_POINTS.EOF:{this._err(ERR.eofInDoctype),s.forceQuirks=!0,this.emitCurrentDoctype(s),this._emitEOFToken();break}default:s.systemId+=String.fromCodePoint(t)}}_stateAfterDoctypeSystemIdentifier(t){const s=this.currentToken;switch(t){case CODE_POINTS.SPACE:case CODE_POINTS.LINE_FEED:case CODE_POINTS.TABULATION:case CODE_POINTS.FORM_FEED:break;case CODE_POINTS.GREATER_THAN_SIGN:{this.emitCurrentDoctype(s),this.state=State$1.DATA;break}case CODE_POINTS.EOF:{this._err(ERR.eofInDoctype),s.forceQuirks=!0,this.emitCurrentDoctype(s),this._emitEOFToken();break}default:this._err(ERR.unexpectedCharacterAfterDoctypeSystemIdentifier),this.state=State$1.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBogusDoctype(t){const s=this.currentToken;switch(t){case CODE_POINTS.GREATER_THAN_SIGN:{this.emitCurrentDoctype(s),this.state=State$1.DATA;break}case CODE_POINTS.NULL:{this._err(ERR.unexpectedNullCharacter);break}case CODE_POINTS.EOF:{this.emitCurrentDoctype(s),this._emitEOFToken();break}}}_stateCdataSection(t){switch(t){case CODE_POINTS.RIGHT_SQUARE_BRACKET:{this.state=State$1.CDATA_SECTION_BRACKET;break}case CODE_POINTS.EOF:{this._err(ERR.eofInCdata),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateCdataSectionBracket(t){t===CODE_POINTS.RIGHT_SQUARE_BRACKET?this.state=State$1.CDATA_SECTION_END:(this._emitChars("]"),this.state=State$1.CDATA_SECTION,this._stateCdataSection(t))}_stateCdataSectionEnd(t){switch(t){case CODE_POINTS.GREATER_THAN_SIGN:{this.state=State$1.DATA;break}case CODE_POINTS.RIGHT_SQUARE_BRACKET:{this._emitChars("]");break}default:this._emitChars("]]"),this.state=State$1.CDATA_SECTION,this._stateCdataSection(t)}}_stateCharacterReference(t){t===CODE_POINTS.NUMBER_SIGN?this.state=State$1.NUMERIC_CHARACTER_REFERENCE:isAsciiAlphaNumeric(t)?(this.state=State$1.NAMED_CHARACTER_REFERENCE,this._stateNamedCharacterReference(t)):(this._flushCodePointConsumedAsCharacterReference(CODE_POINTS.AMPERSAND),this._reconsumeInState(this.returnState,t))}_stateNamedCharacterReference(t){const s=this._matchNamedCharacterReference(t);if(!this._ensureHibernation())if(s){for(let n=0;n<s.length;n++)this._flushCodePointConsumedAsCharacterReference(s[n]);this.state=this.returnState}else this._flushCodePointConsumedAsCharacterReference(CODE_POINTS.AMPERSAND),this.state=State$1.AMBIGUOUS_AMPERSAND}_stateAmbiguousAmpersand(t){isAsciiAlphaNumeric(t)?this._flushCodePointConsumedAsCharacterReference(t):(t===CODE_POINTS.SEMICOLON&&this._err(ERR.unknownNamedCharacterReference),this._reconsumeInState(this.returnState,t))}_stateNumericCharacterReference(t){this.charRefCode=0,t===CODE_POINTS.LATIN_SMALL_X||t===CODE_POINTS.LATIN_CAPITAL_X?this.state=State$1.HEXADEMICAL_CHARACTER_REFERENCE_START:isAsciiDigit(t)?(this.state=State$1.DECIMAL_CHARACTER_REFERENCE,this._stateDecimalCharacterReference(t)):(this._err(ERR.absenceOfDigitsInNumericCharacterReference),this._flushCodePointConsumedAsCharacterReference(CODE_POINTS.AMPERSAND),this._flushCodePointConsumedAsCharacterReference(CODE_POINTS.NUMBER_SIGN),this._reconsumeInState(this.returnState,t))}_stateHexademicalCharacterReferenceStart(t){isAsciiHexDigit(t)?(this.state=State$1.HEXADEMICAL_CHARACTER_REFERENCE,this._stateHexademicalCharacterReference(t)):(this._err(ERR.absenceOfDigitsInNumericCharacterReference),this._flushCodePointConsumedAsCharacterReference(CODE_POINTS.AMPERSAND),this._flushCodePointConsumedAsCharacterReference(CODE_POINTS.NUMBER_SIGN),this._unconsume(2),this.state=this.returnState)}_stateHexademicalCharacterReference(t){isAsciiUpperHexDigit(t)?this.charRefCode=this.charRefCode*16+t-55:isAsciiLowerHexDigit(t)?this.charRefCode=this.charRefCode*16+t-87:isAsciiDigit(t)?this.charRefCode=this.charRefCode*16+t-48:t===CODE_POINTS.SEMICOLON?this.state=State$1.NUMERIC_CHARACTER_REFERENCE_END:(this._err(ERR.missingSemicolonAfterCharacterReference),this.state=State$1.NUMERIC_CHARACTER_REFERENCE_END,this._stateNumericCharacterReferenceEnd(t))}_stateDecimalCharacterReference(t){isAsciiDigit(t)?this.charRefCode=this.charRefCode*10+t-48:t===CODE_POINTS.SEMICOLON?this.state=State$1.NUMERIC_CHARACTER_REFERENCE_END:(this._err(ERR.missingSemicolonAfterCharacterReference),this.state=State$1.NUMERIC_CHARACTER_REFERENCE_END,this._stateNumericCharacterReferenceEnd(t))}_stateNumericCharacterReferenceEnd(t){if(this.charRefCode===CODE_POINTS.NULL)this._err(ERR.nullCharacterReference),this.charRefCode=CODE_POINTS.REPLACEMENT_CHARACTER;else if(this.charRefCode>1114111)this._err(ERR.characterReferenceOutsideUnicodeRange),this.charRefCode=CODE_POINTS.REPLACEMENT_CHARACTER;else if(isSurrogate(this.charRefCode))this._err(ERR.surrogateCharacterReference),this.charRefCode=CODE_POINTS.REPLACEMENT_CHARACTER;else if(isUndefinedCodePoint(this.charRefCode))this._err(ERR.noncharacterCharacterReference);else if(isControlCodePoint(this.charRefCode)||this.charRefCode===CODE_POINTS.CARRIAGE_RETURN){this._err(ERR.controlCharacterReference);const s=C1_CONTROLS_REFERENCE_REPLACEMENTS.get(this.charRefCode);s!==void 0&&(this.charRefCode=s)}this._flushCodePointConsumedAsCharacterReference(this.charRefCode),this._reconsumeInState(this.returnState,t)}};const IMPLICIT_END_TAG_REQUIRED=new Set([TAG_ID.DD,TAG_ID.DT,TAG_ID.LI,TAG_ID.OPTGROUP,TAG_ID.OPTION,TAG_ID.P,TAG_ID.RB,TAG_ID.RP,TAG_ID.RT,TAG_ID.RTC]),IMPLICIT_END_TAG_REQUIRED_THOROUGHLY=new Set([...IMPLICIT_END_TAG_REQUIRED,TAG_ID.CAPTION,TAG_ID.COLGROUP,TAG_ID.TBODY,TAG_ID.TD,TAG_ID.TFOOT,TAG_ID.TH,TAG_ID.THEAD,TAG_ID.TR]),SCOPING_ELEMENT_NS=new Map([[TAG_ID.APPLET,NS.HTML],[TAG_ID.CAPTION,NS.HTML],[TAG_ID.HTML,NS.HTML],[TAG_ID.MARQUEE,NS.HTML],[TAG_ID.OBJECT,NS.HTML],[TAG_ID.TABLE,NS.HTML],[TAG_ID.TD,NS.HTML],[TAG_ID.TEMPLATE,NS.HTML],[TAG_ID.TH,NS.HTML],[TAG_ID.ANNOTATION_XML,NS.MATHML],[TAG_ID.MI,NS.MATHML],[TAG_ID.MN,NS.MATHML],[TAG_ID.MO,NS.MATHML],[TAG_ID.MS,NS.MATHML],[TAG_ID.MTEXT,NS.MATHML],[TAG_ID.DESC,NS.SVG],[TAG_ID.FOREIGN_OBJECT,NS.SVG],[TAG_ID.TITLE,NS.SVG]]),NAMED_HEADERS=[TAG_ID.H1,TAG_ID.H2,TAG_ID.H3,TAG_ID.H4,TAG_ID.H5,TAG_ID.H6],TABLE_ROW_CONTEXT=[TAG_ID.TR,TAG_ID.TEMPLATE,TAG_ID.HTML],TABLE_BODY_CONTEXT=[TAG_ID.TBODY,TAG_ID.TFOOT,TAG_ID.THEAD,TAG_ID.TEMPLATE,TAG_ID.HTML],TABLE_CONTEXT=[TAG_ID.TABLE,TAG_ID.TEMPLATE,TAG_ID.HTML],TABLE_CELLS=[TAG_ID.TD,TAG_ID.TH];class OpenElementStack{get currentTmplContentOrNode(){return this._isInTemplate()?this.treeAdapter.getTemplateContent(this.current):this.current}constructor(t,s,n){this.treeAdapter=s,this.handler=n,this.items=[],this.tagIDs=[],this.stackTop=-1,this.tmplCount=0,this.currentTagId=TAG_ID.UNKNOWN,this.current=t}_indexOf(t){return this.items.lastIndexOf(t,this.stackTop)}_isInTemplate(){return this.currentTagId===TAG_ID.TEMPLATE&&this.treeAdapter.getNamespaceURI(this.current)===NS.HTML}_updateCurrentElement(){this.current=this.items[this.stackTop],this.currentTagId=this.tagIDs[this.stackTop]}push(t,s){this.stackTop++,this.items[this.stackTop]=t,this.current=t,this.tagIDs[this.stackTop]=s,this.currentTagId=s,this._isInTemplate()&&this.tmplCount++,this.handler.onItemPush(t,s,!0)}pop(){const t=this.current;this.tmplCount>0&&this._isInTemplate()&&this.tmplCount--,this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(t,!0)}replace(t,s){const n=this._indexOf(t);this.items[n]=s,n===this.stackTop&&(this.current=s)}insertAfter(t,s,n){const i=this._indexOf(t)+1;this.items.splice(i,0,s),this.tagIDs.splice(i,0,n),this.stackTop++,i===this.stackTop&&this._updateCurrentElement(),this.handler.onItemPush(this.current,this.currentTagId,i===this.stackTop)}popUntilTagNamePopped(t){let s=this.stackTop+1;do s=this.tagIDs.lastIndexOf(t,s-1);while(s>0&&this.treeAdapter.getNamespaceURI(this.items[s])!==NS.HTML);this.shortenToLength(s<0?0:s)}shortenToLength(t){for(;this.stackTop>=t;){const s=this.current;this.tmplCount>0&&this._isInTemplate()&&(this.tmplCount-=1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(s,this.stackTop<t)}}popUntilElementPopped(t){const s=this._indexOf(t);this.shortenToLength(s<0?0:s)}popUntilPopped(t,s){const n=this._indexOfTagNames(t,s);this.shortenToLength(n<0?0:n)}popUntilNumberedHeaderPopped(){this.popUntilPopped(NAMED_HEADERS,NS.HTML)}popUntilTableCellPopped(){this.popUntilPopped(TABLE_CELLS,NS.HTML)}popAllUpToHtmlElement(){this.tmplCount=0,this.shortenToLength(1)}_indexOfTagNames(t,s){for(let n=this.stackTop;n>=0;n--)if(t.includes(this.tagIDs[n])&&this.treeAdapter.getNamespaceURI(this.items[n])===s)return n;return-1}clearBackTo(t,s){const n=this._indexOfTagNames(t,s);this.shortenToLength(n+1)}clearBackToTableContext(){this.clearBackTo(TABLE_CONTEXT,NS.HTML)}clearBackToTableBodyContext(){this.clearBackTo(TABLE_BODY_CONTEXT,NS.HTML)}clearBackToTableRowContext(){this.clearBackTo(TABLE_ROW_CONTEXT,NS.HTML)}remove(t){const s=this._indexOf(t);s>=0&&(s===this.stackTop?this.pop():(this.items.splice(s,1),this.tagIDs.splice(s,1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(t,!1)))}tryPeekProperlyNestedBodyElement(){return this.stackTop>=1&&this.tagIDs[1]===TAG_ID.BODY?this.items[1]:null}contains(t){return this._indexOf(t)>-1}getCommonAncestor(t){const s=this._indexOf(t)-1;return s>=0?this.items[s]:null}isRootHtmlElementCurrent(){return this.stackTop===0&&this.tagIDs[0]===TAG_ID.HTML}hasInScope(t){for(let s=this.stackTop;s>=0;s--){const n=this.tagIDs[s],i=this.treeAdapter.getNamespaceURI(this.items[s]);if(n===t&&i===NS.HTML)return!0;if(SCOPING_ELEMENT_NS.get(n)===i)return!1}return!0}hasNumberedHeaderInScope(){for(let t=this.stackTop;t>=0;t--){const s=this.tagIDs[t],n=this.treeAdapter.getNamespaceURI(this.items[t]);if(isNumberedHeader(s)&&n===NS.HTML)return!0;if(SCOPING_ELEMENT_NS.get(s)===n)return!1}return!0}hasInListItemScope(t){for(let s=this.stackTop;s>=0;s--){const n=this.tagIDs[s],i=this.treeAdapter.getNamespaceURI(this.items[s]);if(n===t&&i===NS.HTML)return!0;if((n===TAG_ID.UL||n===TAG_ID.OL)&&i===NS.HTML||SCOPING_ELEMENT_NS.get(n)===i)return!1}return!0}hasInButtonScope(t){for(let s=this.stackTop;s>=0;s--){const n=this.tagIDs[s],i=this.treeAdapter.getNamespaceURI(this.items[s]);if(n===t&&i===NS.HTML)return!0;if(n===TAG_ID.BUTTON&&i===NS.HTML||SCOPING_ELEMENT_NS.get(n)===i)return!1}return!0}hasInTableScope(t){for(let s=this.stackTop;s>=0;s--){const n=this.tagIDs[s];if(this.treeAdapter.getNamespaceURI(this.items[s])===NS.HTML){if(n===t)return!0;if(n===TAG_ID.TABLE||n===TAG_ID.TEMPLATE||n===TAG_ID.HTML)return!1}}return!0}hasTableBodyContextInTableScope(){for(let t=this.stackTop;t>=0;t--){const s=this.tagIDs[t];if(this.treeAdapter.getNamespaceURI(this.items[t])===NS.HTML){if(s===TAG_ID.TBODY||s===TAG_ID.THEAD||s===TAG_ID.TFOOT)return!0;if(s===TAG_ID.TABLE||s===TAG_ID.HTML)return!1}}return!0}hasInSelectScope(t){for(let s=this.stackTop;s>=0;s--){const n=this.tagIDs[s];if(this.treeAdapter.getNamespaceURI(this.items[s])===NS.HTML){if(n===t)return!0;if(n!==TAG_ID.OPTION&&n!==TAG_ID.OPTGROUP)return!1}}return!0}generateImpliedEndTags(){for(;IMPLICIT_END_TAG_REQUIRED.has(this.currentTagId);)this.pop()}generateImpliedEndTagsThoroughly(){for(;IMPLICIT_END_TAG_REQUIRED_THOROUGHLY.has(this.currentTagId);)this.pop()}generateImpliedEndTagsWithExclusion(t){for(;this.currentTagId!==t&&IMPLICIT_END_TAG_REQUIRED_THOROUGHLY.has(this.currentTagId);)this.pop()}}const NOAH_ARK_CAPACITY=3;var EntryType;(function(e){e[e.Marker=0]="Marker",e[e.Element=1]="Element"})(EntryType=EntryType||(EntryType={}));const MARKER={type:EntryType.Marker};class FormattingElementList{constructor(t){this.treeAdapter=t,this.entries=[],this.bookmark=null}_getNoahArkConditionCandidates(t,s){const n=[],i=s.length,r=this.treeAdapter.getTagName(t),d=this.treeAdapter.getNamespaceURI(t);for(let f=0;f<this.entries.length;f++){const m=this.entries[f];if(m.type===EntryType.Marker)break;const{element:u}=m;if(this.treeAdapter.getTagName(u)===r&&this.treeAdapter.getNamespaceURI(u)===d){const a=this.treeAdapter.getAttrList(u);a.length===i&&n.push({idx:f,attrs:a})}}return n}_ensureNoahArkCondition(t){if(this.entries.length<NOAH_ARK_CAPACITY)return;const s=this.treeAdapter.getAttrList(t),n=this._getNoahArkConditionCandidates(t,s);if(n.length<NOAH_ARK_CAPACITY)return;const i=new Map(s.map(d=>[d.name,d.value]));let r=0;for(let d=0;d<n.length;d++){const f=n[d];f.attrs.every(m=>i.get(m.name)===m.value)&&(r+=1,r>=NOAH_ARK_CAPACITY&&this.entries.splice(f.idx,1))}}insertMarker(){this.entries.unshift(MARKER)}pushElement(t,s){this._ensureNoahArkCondition(t),this.entries.unshift({type:EntryType.Element,element:t,token:s})}insertElementAfterBookmark(t,s){const n=this.entries.indexOf(this.bookmark);this.entries.splice(n,0,{type:EntryType.Element,element:t,token:s})}removeEntry(t){const s=this.entries.indexOf(t);s>=0&&this.entries.splice(s,1)}clearToLastMarker(){const t=this.entries.indexOf(MARKER);t>=0?this.entries.splice(0,t+1):this.entries.length=0}getElementEntryInScopeWithTagName(t){const s=this.entries.find(n=>n.type===EntryType.Marker||this.treeAdapter.getTagName(n.element)===t);return s&&s.type===EntryType.Element?s:null}getElementEntry(t){return this.entries.find(s=>s.type===EntryType.Element&&s.element===t)}}function createTextNode$1(e){return{nodeName:"#text",value:e,parentNode:null}}const defaultTreeAdapter={createDocument(){return{nodeName:"#document",mode:DOCUMENT_MODE.NO_QUIRKS,childNodes:[]}},createDocumentFragment(){return{nodeName:"#document-fragment",childNodes:[]}},createElement(e,t,s){return{nodeName:e,tagName:e,attrs:s,namespaceURI:t,childNodes:[],parentNode:null}},createCommentNode(e){return{nodeName:"#comment",data:e,parentNode:null}},appendChild(e,t){e.childNodes.push(t),t.parentNode=e},insertBefore(e,t,s){const n=e.childNodes.indexOf(s);e.childNodes.splice(n,0,t),t.parentNode=e},setTemplateContent(e,t){e.content=t},getTemplateContent(e){return e.content},setDocumentType(e,t,s,n){const i=e.childNodes.find(r=>r.nodeName==="#documentType");if(i)i.name=t,i.publicId=s,i.systemId=n;else{const r={nodeName:"#documentType",name:t,publicId:s,systemId:n,parentNode:null};defaultTreeAdapter.appendChild(e,r)}},setDocumentMode(e,t){e.mode=t},getDocumentMode(e){return e.mode},detachNode(e){if(e.parentNode){const t=e.parentNode.childNodes.indexOf(e);e.parentNode.childNodes.splice(t,1),e.parentNode=null}},insertText(e,t){if(e.childNodes.length>0){const s=e.childNodes[e.childNodes.length-1];if(defaultTreeAdapter.isTextNode(s)){s.value+=t;return}}defaultTreeAdapter.appendChild(e,createTextNode$1(t))},insertTextBefore(e,t,s){const n=e.childNodes[e.childNodes.indexOf(s)-1];n&&defaultTreeAdapter.isTextNode(n)?n.value+=t:defaultTreeAdapter.insertBefore(e,createTextNode$1(t),s)},adoptAttributes(e,t){const s=new Set(e.attrs.map(n=>n.name));for(let n=0;n<t.length;n++)s.has(t[n].name)||e.attrs.push(t[n])},getFirstChild(e){return e.childNodes[0]},getChildNodes(e){return e.childNodes},getParentNode(e){return e.parentNode},getAttrList(e){return e.attrs},getTagName(e){return e.tagName},getNamespaceURI(e){return e.namespaceURI},getTextNodeContent(e){return e.value},getCommentNodeContent(e){return e.data},getDocumentTypeNodeName(e){return e.name},getDocumentTypeNodePublicId(e){return e.publicId},getDocumentTypeNodeSystemId(e){return e.systemId},isTextNode(e){return e.nodeName==="#text"},isCommentNode(e){return e.nodeName==="#comment"},isDocumentTypeNode(e){return e.nodeName==="#documentType"},isElementNode(e){return Object.prototype.hasOwnProperty.call(e,"tagName")},setNodeSourceCodeLocation(e,t){e.sourceCodeLocation=t},getNodeSourceCodeLocation(e){return e.sourceCodeLocation},updateNodeSourceCodeLocation(e,t){e.sourceCodeLocation={...e.sourceCodeLocation,...t}}},VALID_DOCTYPE_NAME="html",VALID_SYSTEM_ID="about:legacy-compat",QUIRKS_MODE_SYSTEM_ID="http://www.ibm.com/data/dtd/v11/ibmxhtml1-transitional.dtd",QUIRKS_MODE_PUBLIC_ID_PREFIXES=["+//silmaril//dtd html pro v0r11 19970101//","-//as//dtd html 3.0 aswedit + extensions//","-//advasoft ltd//dtd html 3.0 aswedit + extensions//","-//ietf//dtd html 2.0 level 1//","-//ietf//dtd html 2.0 level 2//","-//ietf//dtd html 2.0 strict level 1//","-//ietf//dtd html 2.0 strict level 2//","-//ietf//dtd html 2.0 strict//","-//ietf//dtd html 2.0//","-//ietf//dtd html 2.1e//","-//ietf//dtd html 3.0//","-//ietf//dtd html 3.2 final//","-//ietf//dtd html 3.2//","-//ietf//dtd html 3//","-//ietf//dtd html level 0//","-//ietf//dtd html level 1//","-//ietf//dtd html level 2//","-//ietf//dtd html level 3//","-//ietf//dtd html strict level 0//","-//ietf//dtd html strict level 1//","-//ietf//dtd html strict level 2//","-//ietf//dtd html strict level 3//","-//ietf//dtd html strict//","-//ietf//dtd html//","-//metrius//dtd metrius presentational//","-//microsoft//dtd internet explorer 2.0 html strict//","-//microsoft//dtd internet explorer 2.0 html//","-//microsoft//dtd internet explorer 2.0 tables//","-//microsoft//dtd internet explorer 3.0 html strict//","-//microsoft//dtd internet explorer 3.0 html//","-//microsoft//dtd internet explorer 3.0 tables//","-//netscape comm. corp.//dtd html//","-//netscape comm. corp.//dtd strict html//","-//o'reilly and associates//dtd html 2.0//","-//o'reilly and associates//dtd html extended 1.0//","-//o'reilly and associates//dtd html extended relaxed 1.0//","-//sq//dtd html 2.0 hotmetal + extensions//","-//softquad software//dtd hotmetal pro 6.0::19990601::extensions to html 4.0//","-//softquad//dtd hotmetal pro 4.0::19971010::extensions to html 4.0//","-//spyglass//dtd html 2.0 extended//","-//sun microsystems corp.//dtd hotjava html//","-//sun microsystems corp.//dtd hotjava strict html//","-//w3c//dtd html 3 1995-03-24//","-//w3c//dtd html 3.2 draft//","-//w3c//dtd html 3.2 final//","-//w3c//dtd html 3.2//","-//w3c//dtd html 3.2s draft//","-//w3c//dtd html 4.0 frameset//","-//w3c//dtd html 4.0 transitional//","-//w3c//dtd html experimental 19960712//","-//w3c//dtd html experimental 970421//","-//w3c//dtd w3 html//","-//w3o//dtd w3 html 3.0//","-//webtechs//dtd mozilla html 2.0//","-//webtechs//dtd mozilla html//"],QUIRKS_MODE_NO_SYSTEM_ID_PUBLIC_ID_PREFIXES=[...QUIRKS_MODE_PUBLIC_ID_PREFIXES,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"],QUIRKS_MODE_PUBLIC_IDS=new Set(["-//w3o//dtd w3 html strict 3.0//en//","-/w3c/dtd html 4.0 transitional/en","html"]),LIMITED_QUIRKS_PUBLIC_ID_PREFIXES=["-//w3c//dtd xhtml 1.0 frameset//","-//w3c//dtd xhtml 1.0 transitional//"],LIMITED_QUIRKS_WITH_SYSTEM_ID_PUBLIC_ID_PREFIXES=[...LIMITED_QUIRKS_PUBLIC_ID_PREFIXES,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"];function hasPrefix(e,t){return t.some(s=>e.startsWith(s))}function isConforming(e){return e.name===VALID_DOCTYPE_NAME&&e.publicId===null&&(e.systemId===null||e.systemId===VALID_SYSTEM_ID)}function getDocumentMode(e){if(e.name!==VALID_DOCTYPE_NAME)return DOCUMENT_MODE.QUIRKS;const{systemId:t}=e;if(t&&t.toLowerCase()===QUIRKS_MODE_SYSTEM_ID)return DOCUMENT_MODE.QUIRKS;let{publicId:s}=e;if(s!==null){if(s=s.toLowerCase(),QUIRKS_MODE_PUBLIC_IDS.has(s))return DOCUMENT_MODE.QUIRKS;let n=t===null?QUIRKS_MODE_NO_SYSTEM_ID_PUBLIC_ID_PREFIXES:QUIRKS_MODE_PUBLIC_ID_PREFIXES;if(hasPrefix(s,n))return DOCUMENT_MODE.QUIRKS;if(n=t===null?LIMITED_QUIRKS_PUBLIC_ID_PREFIXES:LIMITED_QUIRKS_WITH_SYSTEM_ID_PUBLIC_ID_PREFIXES,hasPrefix(s,n))return DOCUMENT_MODE.LIMITED_QUIRKS}return DOCUMENT_MODE.NO_QUIRKS}const MIME_TYPES={TEXT_HTML:"text/html",APPLICATION_XML:"application/xhtml+xml"},DEFINITION_URL_ATTR="definitionurl",ADJUSTED_DEFINITION_URL_ATTR="definitionURL",SVG_ATTRS_ADJUSTMENT_MAP=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(e=>[e.toLowerCase(),e])),XML_ATTRS_ADJUSTMENT_MAP=new Map([["xlink:actuate",{prefix:"xlink",name:"actuate",namespace:NS.XLINK}],["xlink:arcrole",{prefix:"xlink",name:"arcrole",namespace:NS.XLINK}],["xlink:href",{prefix:"xlink",name:"href",namespace:NS.XLINK}],["xlink:role",{prefix:"xlink",name:"role",namespace:NS.XLINK}],["xlink:show",{prefix:"xlink",name:"show",namespace:NS.XLINK}],["xlink:title",{prefix:"xlink",name:"title",namespace:NS.XLINK}],["xlink:type",{prefix:"xlink",name:"type",namespace:NS.XLINK}],["xml:base",{prefix:"xml",name:"base",namespace:NS.XML}],["xml:lang",{prefix:"xml",name:"lang",namespace:NS.XML}],["xml:space",{prefix:"xml",name:"space",namespace:NS.XML}],["xmlns",{prefix:"",name:"xmlns",namespace:NS.XMLNS}],["xmlns:xlink",{prefix:"xmlns",name:"xlink",namespace:NS.XMLNS}]]),SVG_TAG_NAMES_ADJUSTMENT_MAP=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(e=>[e.toLowerCase(),e])),EXITS_FOREIGN_CONTENT=new Set([TAG_ID.B,TAG_ID.BIG,TAG_ID.BLOCKQUOTE,TAG_ID.BODY,TAG_ID.BR,TAG_ID.CENTER,TAG_ID.CODE,TAG_ID.DD,TAG_ID.DIV,TAG_ID.DL,TAG_ID.DT,TAG_ID.EM,TAG_ID.EMBED,TAG_ID.H1,TAG_ID.H2,TAG_ID.H3,TAG_ID.H4,TAG_ID.H5,TAG_ID.H6,TAG_ID.HEAD,TAG_ID.HR,TAG_ID.I,TAG_ID.IMG,TAG_ID.LI,TAG_ID.LISTING,TAG_ID.MENU,TAG_ID.META,TAG_ID.NOBR,TAG_ID.OL,TAG_ID.P,TAG_ID.PRE,TAG_ID.RUBY,TAG_ID.S,TAG_ID.SMALL,TAG_ID.SPAN,TAG_ID.STRONG,TAG_ID.STRIKE,TAG_ID.SUB,TAG_ID.SUP,TAG_ID.TABLE,TAG_ID.TT,TAG_ID.U,TAG_ID.UL,TAG_ID.VAR]);function causesExit(e){const t=e.tagID;return t===TAG_ID.FONT&&e.attrs.some(({name:n})=>n===ATTRS.COLOR||n===ATTRS.SIZE||n===ATTRS.FACE)||EXITS_FOREIGN_CONTENT.has(t)}function adjustTokenMathMLAttrs(e){for(let t=0;t<e.attrs.length;t++)if(e.attrs[t].name===DEFINITION_URL_ATTR){e.attrs[t].name=ADJUSTED_DEFINITION_URL_ATTR;break}}function adjustTokenSVGAttrs(e){for(let t=0;t<e.attrs.length;t++){const s=SVG_ATTRS_ADJUSTMENT_MAP.get(e.attrs[t].name);s!=null&&(e.attrs[t].name=s)}}function adjustTokenXMLAttrs(e){for(let t=0;t<e.attrs.length;t++){const s=XML_ATTRS_ADJUSTMENT_MAP.get(e.attrs[t].name);s&&(e.attrs[t].prefix=s.prefix,e.attrs[t].name=s.name,e.attrs[t].namespace=s.namespace)}}function adjustTokenSVGTagName(e){const t=SVG_TAG_NAMES_ADJUSTMENT_MAP.get(e.tagName);t!=null&&(e.tagName=t,e.tagID=getTagID(e.tagName))}function isMathMLTextIntegrationPoint(e,t){return t===NS.MATHML&&(e===TAG_ID.MI||e===TAG_ID.MO||e===TAG_ID.MN||e===TAG_ID.MS||e===TAG_ID.MTEXT)}function isHtmlIntegrationPoint(e,t,s){if(t===NS.MATHML&&e===TAG_ID.ANNOTATION_XML){for(let n=0;n<s.length;n++)if(s[n].name===ATTRS.ENCODING){const i=s[n].value.toLowerCase();return i===MIME_TYPES.TEXT_HTML||i===MIME_TYPES.APPLICATION_XML}}return t===NS.SVG&&(e===TAG_ID.FOREIGN_OBJECT||e===TAG_ID.DESC||e===TAG_ID.TITLE)}function isIntegrationPoint(e,t,s,n){return(!n||n===NS.HTML)&&isHtmlIntegrationPoint(e,t,s)||(!n||n===NS.MATHML)&&isMathMLTextIntegrationPoint(e,t)}const HIDDEN_INPUT_TYPE="hidden",AA_OUTER_LOOP_ITER=8,AA_INNER_LOOP_ITER=3;var InsertionMode;(function(e){e[e.INITIAL=0]="INITIAL",e[e.BEFORE_HTML=1]="BEFORE_HTML",e[e.BEFORE_HEAD=2]="BEFORE_HEAD",e[e.IN_HEAD=3]="IN_HEAD",e[e.IN_HEAD_NO_SCRIPT=4]="IN_HEAD_NO_SCRIPT",e[e.AFTER_HEAD=5]="AFTER_HEAD",e[e.IN_BODY=6]="IN_BODY",e[e.TEXT=7]="TEXT",e[e.IN_TABLE=8]="IN_TABLE",e[e.IN_TABLE_TEXT=9]="IN_TABLE_TEXT",e[e.IN_CAPTION=10]="IN_CAPTION",e[e.IN_COLUMN_GROUP=11]="IN_COLUMN_GROUP",e[e.IN_TABLE_BODY=12]="IN_TABLE_BODY",e[e.IN_ROW=13]="IN_ROW",e[e.IN_CELL=14]="IN_CELL",e[e.IN_SELECT=15]="IN_SELECT",e[e.IN_SELECT_IN_TABLE=16]="IN_SELECT_IN_TABLE",e[e.IN_TEMPLATE=17]="IN_TEMPLATE",e[e.AFTER_BODY=18]="AFTER_BODY",e[e.IN_FRAMESET=19]="IN_FRAMESET",e[e.AFTER_FRAMESET=20]="AFTER_FRAMESET",e[e.AFTER_AFTER_BODY=21]="AFTER_AFTER_BODY",e[e.AFTER_AFTER_FRAMESET=22]="AFTER_AFTER_FRAMESET"})(InsertionMode||(InsertionMode={}));const BASE_LOC={startLine:-1,startCol:-1,startOffset:-1,endLine:-1,endCol:-1,endOffset:-1},TABLE_STRUCTURE_TAGS=new Set([TAG_ID.TABLE,TAG_ID.TBODY,TAG_ID.TFOOT,TAG_ID.THEAD,TAG_ID.TR]),defaultParserOptions={scriptingEnabled:!0,sourceCodeLocationInfo:!1,treeAdapter:defaultTreeAdapter,onParseError:null};let Parser$1=class{constructor(t,s,n=null,i=null){this.fragmentContext=n,this.scriptHandler=i,this.currentToken=null,this.stopped=!1,this.insertionMode=InsertionMode.INITIAL,this.originalInsertionMode=InsertionMode.INITIAL,this.headElement=null,this.formElement=null,this.currentNotInHTML=!1,this.tmplInsertionModeStack=[],this.pendingCharacterTokens=[],this.hasNonWhitespacePendingCharacterToken=!1,this.framesetOk=!0,this.skipNextNewLine=!1,this.fosterParentingEnabled=!1,this.options={...defaultParserOptions,...t},this.treeAdapter=this.options.treeAdapter,this.onParseError=this.options.onParseError,this.onParseError&&(this.options.sourceCodeLocationInfo=!0),this.document=s??this.treeAdapter.createDocument(),this.tokenizer=new Tokenizer$1(this.options,this),this.activeFormattingElements=new FormattingElementList(this.treeAdapter),this.fragmentContextID=n?getTagID(this.treeAdapter.getTagName(n)):TAG_ID.UNKNOWN,this._setContextModes(n??this.document,this.fragmentContextID),this.openElements=new OpenElementStack(this.document,this.treeAdapter,this)}static parse(t,s){const n=new this(s);return n.tokenizer.write(t,!0),n.document}static getFragmentParser(t,s){const n={...defaultParserOptions,...s};t??(t=n.treeAdapter.createElement(TAG_NAMES.TEMPLATE,NS.HTML,[]));const i=n.treeAdapter.createElement("documentmock",NS.HTML,[]),r=new this(n,i,t);return r.fragmentContextID===TAG_ID.TEMPLATE&&r.tmplInsertionModeStack.unshift(InsertionMode.IN_TEMPLATE),r._initTokenizerForFragmentParsing(),r._insertFakeRootElement(),r._resetInsertionMode(),r._findFormInFragmentContext(),r}getFragment(){const t=this.treeAdapter.getFirstChild(this.document),s=this.treeAdapter.createDocumentFragment();return this._adoptNodes(t,s),s}_err(t,s,n){var i;if(!this.onParseError)return;const r=(i=t.location)!==null&&i!==void 0?i:BASE_LOC,d={code:s,startLine:r.startLine,startCol:r.startCol,startOffset:r.startOffset,endLine:n?r.startLine:r.endLine,endCol:n?r.startCol:r.endCol,endOffset:n?r.startOffset:r.endOffset};this.onParseError(d)}onItemPush(t,s,n){var i,r;(r=(i=this.treeAdapter).onItemPush)===null||r===void 0||r.call(i,t),n&&this.openElements.stackTop>0&&this._setContextModes(t,s)}onItemPop(t,s){var n,i;if(this.options.sourceCodeLocationInfo&&this._setEndLocation(t,this.currentToken),(i=(n=this.treeAdapter).onItemPop)===null||i===void 0||i.call(n,t,this.openElements.current),s){let r,d;this.openElements.stackTop===0&&this.fragmentContext?(r=this.fragmentContext,d=this.fragmentContextID):{current:r,currentTagId:d}=this.openElements,this._setContextModes(r,d)}}_setContextModes(t,s){const n=t===this.document||this.treeAdapter.getNamespaceURI(t)===NS.HTML;this.currentNotInHTML=!n,this.tokenizer.inForeignNode=!n&&!this._isIntegrationPoint(s,t)}_switchToTextParsing(t,s){this._insertElement(t,NS.HTML),this.tokenizer.state=s,this.originalInsertionMode=this.insertionMode,this.insertionMode=InsertionMode.TEXT}switchToPlaintextParsing(){this.insertionMode=InsertionMode.TEXT,this.originalInsertionMode=InsertionMode.IN_BODY,this.tokenizer.state=TokenizerMode.PLAINTEXT}_getAdjustedCurrentElement(){return this.openElements.stackTop===0&&this.fragmentContext?this.fragmentContext:this.openElements.current}_findFormInFragmentContext(){let t=this.fragmentContext;for(;t;){if(this.treeAdapter.getTagName(t)===TAG_NAMES.FORM){this.formElement=t;break}t=this.treeAdapter.getParentNode(t)}}_initTokenizerForFragmentParsing(){if(!(!this.fragmentContext||this.treeAdapter.getNamespaceURI(this.fragmentContext)!==NS.HTML))switch(this.fragmentContextID){case TAG_ID.TITLE:case TAG_ID.TEXTAREA:{this.tokenizer.state=TokenizerMode.RCDATA;break}case TAG_ID.STYLE:case TAG_ID.XMP:case TAG_ID.IFRAME:case TAG_ID.NOEMBED:case TAG_ID.NOFRAMES:case TAG_ID.NOSCRIPT:{this.tokenizer.state=TokenizerMode.RAWTEXT;break}case TAG_ID.SCRIPT:{this.tokenizer.state=TokenizerMode.SCRIPT_DATA;break}case TAG_ID.PLAINTEXT:{this.tokenizer.state=TokenizerMode.PLAINTEXT;break}}}_setDocumentType(t){const s=t.name||"",n=t.publicId||"",i=t.systemId||"";if(this.treeAdapter.setDocumentType(this.document,s,n,i),t.location){const d=this.treeAdapter.getChildNodes(this.document).find(f=>this.treeAdapter.isDocumentTypeNode(f));d&&this.treeAdapter.setNodeSourceCodeLocation(d,t.location)}}_attachElementToTree(t,s){if(this.options.sourceCodeLocationInfo){const n=s&&{...s,startTag:s};this.treeAdapter.setNodeSourceCodeLocation(t,n)}if(this._shouldFosterParentOnInsertion())this._fosterParentElement(t);else{const n=this.openElements.currentTmplContentOrNode;this.treeAdapter.appendChild(n,t)}}_appendElement(t,s){const n=this.treeAdapter.createElement(t.tagName,s,t.attrs);this._attachElementToTree(n,t.location)}_insertElement(t,s){const n=this.treeAdapter.createElement(t.tagName,s,t.attrs);this._attachElementToTree(n,t.location),this.openElements.push(n,t.tagID)}_insertFakeElement(t,s){const n=this.treeAdapter.createElement(t,NS.HTML,[]);this._attachElementToTree(n,null),this.openElements.push(n,s)}_insertTemplate(t){const s=this.treeAdapter.createElement(t.tagName,NS.HTML,t.attrs),n=this.treeAdapter.createDocumentFragment();this.treeAdapter.setTemplateContent(s,n),this._attachElementToTree(s,t.location),this.openElements.push(s,t.tagID),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(n,null)}_insertFakeRootElement(){const t=this.treeAdapter.createElement(TAG_NAMES.HTML,NS.HTML,[]);this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(t,null),this.treeAdapter.appendChild(this.openElements.current,t),this.openElements.push(t,TAG_ID.HTML)}_appendCommentNode(t,s){const n=this.treeAdapter.createCommentNode(t.data);this.treeAdapter.appendChild(s,n),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(n,t.location)}_insertCharacters(t){let s,n;if(this._shouldFosterParentOnInsertion()?({parent:s,beforeElement:n}=this._findFosterParentingLocation(),n?this.treeAdapter.insertTextBefore(s,t.chars,n):this.treeAdapter.insertText(s,t.chars)):(s=this.openElements.currentTmplContentOrNode,this.treeAdapter.insertText(s,t.chars)),!t.location)return;const i=this.treeAdapter.getChildNodes(s),r=n?i.lastIndexOf(n):i.length,d=i[r-1];if(this.treeAdapter.getNodeSourceCodeLocation(d)){const{endLine:m,endCol:u,endOffset:a}=t.location;this.treeAdapter.updateNodeSourceCodeLocation(d,{endLine:m,endCol:u,endOffset:a})}else this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(d,t.location)}_adoptNodes(t,s){for(let n=this.treeAdapter.getFirstChild(t);n;n=this.treeAdapter.getFirstChild(t))this.treeAdapter.detachNode(n),this.treeAdapter.appendChild(s,n)}_setEndLocation(t,s){if(this.treeAdapter.getNodeSourceCodeLocation(t)&&s.location){const n=s.location,i=this.treeAdapter.getTagName(t),r=s.type===TokenType.END_TAG&&i===s.tagName?{endTag:{...n},endLine:n.endLine,endCol:n.endCol,endOffset:n.endOffset}:{endLine:n.startLine,endCol:n.startCol,endOffset:n.startOffset};this.treeAdapter.updateNodeSourceCodeLocation(t,r)}}shouldProcessStartTagTokenInForeignContent(t){if(!this.currentNotInHTML)return!1;let s,n;return this.openElements.stackTop===0&&this.fragmentContext?(s=this.fragmentContext,n=this.fragmentContextID):{current:s,currentTagId:n}=this.openElements,t.tagID===TAG_ID.SVG&&this.treeAdapter.getTagName(s)===TAG_NAMES.ANNOTATION_XML&&this.treeAdapter.getNamespaceURI(s)===NS.MATHML?!1:this.tokenizer.inForeignNode||(t.tagID===TAG_ID.MGLYPH||t.tagID===TAG_ID.MALIGNMARK)&&!this._isIntegrationPoint(n,s,NS.HTML)}_processToken(t){switch(t.type){case TokenType.CHARACTER:{this.onCharacter(t);break}case TokenType.NULL_CHARACTER:{this.onNullCharacter(t);break}case TokenType.COMMENT:{this.onComment(t);break}case TokenType.DOCTYPE:{this.onDoctype(t);break}case TokenType.START_TAG:{this._processStartTag(t);break}case TokenType.END_TAG:{this.onEndTag(t);break}case TokenType.EOF:{this.onEof(t);break}case TokenType.WHITESPACE_CHARACTER:{this.onWhitespaceCharacter(t);break}}}_isIntegrationPoint(t,s,n){const i=this.treeAdapter.getNamespaceURI(s),r=this.treeAdapter.getAttrList(s);return isIntegrationPoint(t,i,r,n)}_reconstructActiveFormattingElements(){const t=this.activeFormattingElements.entries.length;if(t){const s=this.activeFormattingElements.entries.findIndex(i=>i.type===EntryType.Marker||this.openElements.contains(i.element)),n=s<0?t-1:s-1;for(let i=n;i>=0;i--){const r=this.activeFormattingElements.entries[i];this._insertElement(r.token,this.treeAdapter.getNamespaceURI(r.element)),r.element=this.openElements.current}}}_closeTableCell(){this.openElements.generateImpliedEndTags(),this.openElements.popUntilTableCellPopped(),this.activeFormattingElements.clearToLastMarker(),this.insertionMode=InsertionMode.IN_ROW}_closePElement(){this.openElements.generateImpliedEndTagsWithExclusion(TAG_ID.P),this.openElements.popUntilTagNamePopped(TAG_ID.P)}_resetInsertionMode(){for(let t=this.openElements.stackTop;t>=0;t--)switch(t===0&&this.fragmentContext?this.fragmentContextID:this.openElements.tagIDs[t]){case TAG_ID.TR:{this.insertionMode=InsertionMode.IN_ROW;return}case TAG_ID.TBODY:case TAG_ID.THEAD:case TAG_ID.TFOOT:{this.insertionMode=InsertionMode.IN_TABLE_BODY;return}case TAG_ID.CAPTION:{this.insertionMode=InsertionMode.IN_CAPTION;return}case TAG_ID.COLGROUP:{this.insertionMode=InsertionMode.IN_COLUMN_GROUP;return}case TAG_ID.TABLE:{this.insertionMode=InsertionMode.IN_TABLE;return}case TAG_ID.BODY:{this.insertionMode=InsertionMode.IN_BODY;return}case TAG_ID.FRAMESET:{this.insertionMode=InsertionMode.IN_FRAMESET;return}case TAG_ID.SELECT:{this._resetInsertionModeForSelect(t);return}case TAG_ID.TEMPLATE:{this.insertionMode=this.tmplInsertionModeStack[0];return}case TAG_ID.HTML:{this.insertionMode=this.headElement?InsertionMode.AFTER_HEAD:InsertionMode.BEFORE_HEAD;return}case TAG_ID.TD:case TAG_ID.TH:{if(t>0){this.insertionMode=InsertionMode.IN_CELL;return}break}case TAG_ID.HEAD:{if(t>0){this.insertionMode=InsertionMode.IN_HEAD;return}break}}this.insertionMode=InsertionMode.IN_BODY}_resetInsertionModeForSelect(t){if(t>0)for(let s=t-1;s>0;s--){const n=this.openElements.tagIDs[s];if(n===TAG_ID.TEMPLATE)break;if(n===TAG_ID.TABLE){this.insertionMode=InsertionMode.IN_SELECT_IN_TABLE;return}}this.insertionMode=InsertionMode.IN_SELECT}_isElementCausesFosterParenting(t){return TABLE_STRUCTURE_TAGS.has(t)}_shouldFosterParentOnInsertion(){return this.fosterParentingEnabled&&this._isElementCausesFosterParenting(this.openElements.currentTagId)}_findFosterParentingLocation(){for(let t=this.openElements.stackTop;t>=0;t--){const s=this.openElements.items[t];switch(this.openElements.tagIDs[t]){case TAG_ID.TEMPLATE:{if(this.treeAdapter.getNamespaceURI(s)===NS.HTML)return{parent:this.treeAdapter.getTemplateContent(s),beforeElement:null};break}case TAG_ID.TABLE:{const n=this.treeAdapter.getParentNode(s);return n?{parent:n,beforeElement:s}:{parent:this.openElements.items[t-1],beforeElement:null}}}}return{parent:this.openElements.items[0],beforeElement:null}}_fosterParentElement(t){const s=this._findFosterParentingLocation();s.beforeElement?this.treeAdapter.insertBefore(s.parent,t,s.beforeElement):this.treeAdapter.appendChild(s.parent,t)}_isSpecialElement(t,s){const n=this.treeAdapter.getNamespaceURI(t);return SPECIAL_ELEMENTS[n].has(s)}onCharacter(t){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){characterInForeignContent(this,t);return}switch(this.insertionMode){case InsertionMode.INITIAL:{tokenInInitialMode(this,t);break}case InsertionMode.BEFORE_HTML:{tokenBeforeHtml(this,t);break}case InsertionMode.BEFORE_HEAD:{tokenBeforeHead(this,t);break}case InsertionMode.IN_HEAD:{tokenInHead(this,t);break}case InsertionMode.IN_HEAD_NO_SCRIPT:{tokenInHeadNoScript(this,t);break}case InsertionMode.AFTER_HEAD:{tokenAfterHead(this,t);break}case InsertionMode.IN_BODY:case InsertionMode.IN_CAPTION:case InsertionMode.IN_CELL:case InsertionMode.IN_TEMPLATE:{characterInBody(this,t);break}case InsertionMode.TEXT:case InsertionMode.IN_SELECT:case InsertionMode.IN_SELECT_IN_TABLE:{this._insertCharacters(t);break}case InsertionMode.IN_TABLE:case InsertionMode.IN_TABLE_BODY:case InsertionMode.IN_ROW:{characterInTable(this,t);break}case InsertionMode.IN_TABLE_TEXT:{characterInTableText(this,t);break}case InsertionMode.IN_COLUMN_GROUP:{tokenInColumnGroup(this,t);break}case InsertionMode.AFTER_BODY:{tokenAfterBody(this,t);break}case InsertionMode.AFTER_AFTER_BODY:{tokenAfterAfterBody(this,t);break}}}onNullCharacter(t){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){nullCharacterInForeignContent(this,t);return}switch(this.insertionMode){case InsertionMode.INITIAL:{tokenInInitialMode(this,t);break}case InsertionMode.BEFORE_HTML:{tokenBeforeHtml(this,t);break}case InsertionMode.BEFORE_HEAD:{tokenBeforeHead(this,t);break}case InsertionMode.IN_HEAD:{tokenInHead(this,t);break}case InsertionMode.IN_HEAD_NO_SCRIPT:{tokenInHeadNoScript(this,t);break}case InsertionMode.AFTER_HEAD:{tokenAfterHead(this,t);break}case InsertionMode.TEXT:{this._insertCharacters(t);break}case InsertionMode.IN_TABLE:case InsertionMode.IN_TABLE_BODY:case InsertionMode.IN_ROW:{characterInTable(this,t);break}case InsertionMode.IN_COLUMN_GROUP:{tokenInColumnGroup(this,t);break}case InsertionMode.AFTER_BODY:{tokenAfterBody(this,t);break}case InsertionMode.AFTER_AFTER_BODY:{tokenAfterAfterBody(this,t);break}}}onComment(t){if(this.skipNextNewLine=!1,this.currentNotInHTML){appendComment(this,t);return}switch(this.insertionMode){case InsertionMode.INITIAL:case InsertionMode.BEFORE_HTML:case InsertionMode.BEFORE_HEAD:case InsertionMode.IN_HEAD:case InsertionMode.IN_HEAD_NO_SCRIPT:case InsertionMode.AFTER_HEAD:case InsertionMode.IN_BODY:case InsertionMode.IN_TABLE:case InsertionMode.IN_CAPTION:case InsertionMode.IN_COLUMN_GROUP:case InsertionMode.IN_TABLE_BODY:case InsertionMode.IN_ROW:case InsertionMode.IN_CELL:case InsertionMode.IN_SELECT:case InsertionMode.IN_SELECT_IN_TABLE:case InsertionMode.IN_TEMPLATE:case InsertionMode.IN_FRAMESET:case InsertionMode.AFTER_FRAMESET:{appendComment(this,t);break}case InsertionMode.IN_TABLE_TEXT:{tokenInTableText(this,t);break}case InsertionMode.AFTER_BODY:{appendCommentToRootHtmlElement(this,t);break}case InsertionMode.AFTER_AFTER_BODY:case InsertionMode.AFTER_AFTER_FRAMESET:{appendCommentToDocument(this,t);break}}}onDoctype(t){switch(this.skipNextNewLine=!1,this.insertionMode){case InsertionMode.INITIAL:{doctypeInInitialMode(this,t);break}case InsertionMode.BEFORE_HEAD:case InsertionMode.IN_HEAD:case InsertionMode.IN_HEAD_NO_SCRIPT:case InsertionMode.AFTER_HEAD:{this._err(t,ERR.misplacedDoctype);break}case InsertionMode.IN_TABLE_TEXT:{tokenInTableText(this,t);break}}}onStartTag(t){this.skipNextNewLine=!1,this.currentToken=t,this._processStartTag(t),t.selfClosing&&!t.ackSelfClosing&&this._err(t,ERR.nonVoidHtmlElementStartTagWithTrailingSolidus)}_processStartTag(t){this.shouldProcessStartTagTokenInForeignContent(t)?startTagInForeignContent(this,t):this._startTagOutsideForeignContent(t)}_startTagOutsideForeignContent(t){switch(this.insertionMode){case InsertionMode.INITIAL:{tokenInInitialMode(this,t);break}case InsertionMode.BEFORE_HTML:{startTagBeforeHtml(this,t);break}case InsertionMode.BEFORE_HEAD:{startTagBeforeHead(this,t);break}case InsertionMode.IN_HEAD:{startTagInHead(this,t);break}case InsertionMode.IN_HEAD_NO_SCRIPT:{startTagInHeadNoScript(this,t);break}case InsertionMode.AFTER_HEAD:{startTagAfterHead(this,t);break}case InsertionMode.IN_BODY:{startTagInBody(this,t);break}case InsertionMode.IN_TABLE:{startTagInTable(this,t);break}case InsertionMode.IN_TABLE_TEXT:{tokenInTableText(this,t);break}case InsertionMode.IN_CAPTION:{startTagInCaption(this,t);break}case InsertionMode.IN_COLUMN_GROUP:{startTagInColumnGroup(this,t);break}case InsertionMode.IN_TABLE_BODY:{startTagInTableBody(this,t);break}case InsertionMode.IN_ROW:{startTagInRow(this,t);break}case InsertionMode.IN_CELL:{startTagInCell(this,t);break}case InsertionMode.IN_SELECT:{startTagInSelect(this,t);break}case InsertionMode.IN_SELECT_IN_TABLE:{startTagInSelectInTable(this,t);break}case InsertionMode.IN_TEMPLATE:{startTagInTemplate(this,t);break}case InsertionMode.AFTER_BODY:{startTagAfterBody(this,t);break}case InsertionMode.IN_FRAMESET:{startTagInFrameset(this,t);break}case InsertionMode.AFTER_FRAMESET:{startTagAfterFrameset(this,t);break}case InsertionMode.AFTER_AFTER_BODY:{startTagAfterAfterBody(this,t);break}case InsertionMode.AFTER_AFTER_FRAMESET:{startTagAfterAfterFrameset(this,t);break}}}onEndTag(t){this.skipNextNewLine=!1,this.currentToken=t,this.currentNotInHTML?endTagInForeignContent(this,t):this._endTagOutsideForeignContent(t)}_endTagOutsideForeignContent(t){switch(this.insertionMode){case InsertionMode.INITIAL:{tokenInInitialMode(this,t);break}case InsertionMode.BEFORE_HTML:{endTagBeforeHtml(this,t);break}case InsertionMode.BEFORE_HEAD:{endTagBeforeHead(this,t);break}case InsertionMode.IN_HEAD:{endTagInHead(this,t);break}case InsertionMode.IN_HEAD_NO_SCRIPT:{endTagInHeadNoScript(this,t);break}case InsertionMode.AFTER_HEAD:{endTagAfterHead(this,t);break}case InsertionMode.IN_BODY:{endTagInBody(this,t);break}case InsertionMode.TEXT:{endTagInText(this,t);break}case InsertionMode.IN_TABLE:{endTagInTable(this,t);break}case InsertionMode.IN_TABLE_TEXT:{tokenInTableText(this,t);break}case InsertionMode.IN_CAPTION:{endTagInCaption(this,t);break}case InsertionMode.IN_COLUMN_GROUP:{endTagInColumnGroup(this,t);break}case InsertionMode.IN_TABLE_BODY:{endTagInTableBody(this,t);break}case InsertionMode.IN_ROW:{endTagInRow(this,t);break}case InsertionMode.IN_CELL:{endTagInCell(this,t);break}case InsertionMode.IN_SELECT:{endTagInSelect(this,t);break}case InsertionMode.IN_SELECT_IN_TABLE:{endTagInSelectInTable(this,t);break}case InsertionMode.IN_TEMPLATE:{endTagInTemplate(this,t);break}case InsertionMode.AFTER_BODY:{endTagAfterBody(this,t);break}case InsertionMode.IN_FRAMESET:{endTagInFrameset(this,t);break}case InsertionMode.AFTER_FRAMESET:{endTagAfterFrameset(this,t);break}case InsertionMode.AFTER_AFTER_BODY:{tokenAfterAfterBody(this,t);break}}}onEof(t){switch(this.insertionMode){case InsertionMode.INITIAL:{tokenInInitialMode(this,t);break}case InsertionMode.BEFORE_HTML:{tokenBeforeHtml(this,t);break}case InsertionMode.BEFORE_HEAD:{tokenBeforeHead(this,t);break}case InsertionMode.IN_HEAD:{tokenInHead(this,t);break}case InsertionMode.IN_HEAD_NO_SCRIPT:{tokenInHeadNoScript(this,t);break}case InsertionMode.AFTER_HEAD:{tokenAfterHead(this,t);break}case InsertionMode.IN_BODY:case InsertionMode.IN_TABLE:case InsertionMode.IN_CAPTION:case InsertionMode.IN_COLUMN_GROUP:case InsertionMode.IN_TABLE_BODY:case InsertionMode.IN_ROW:case InsertionMode.IN_CELL:case InsertionMode.IN_SELECT:case InsertionMode.IN_SELECT_IN_TABLE:{eofInBody(this,t);break}case InsertionMode.TEXT:{eofInText(this,t);break}case InsertionMode.IN_TABLE_TEXT:{tokenInTableText(this,t);break}case InsertionMode.IN_TEMPLATE:{eofInTemplate(this,t);break}case InsertionMode.AFTER_BODY:case InsertionMode.IN_FRAMESET:case InsertionMode.AFTER_FRAMESET:case InsertionMode.AFTER_AFTER_BODY:case InsertionMode.AFTER_AFTER_FRAMESET:{stopParsing(this,t);break}}}onWhitespaceCharacter(t){if(this.skipNextNewLine&&(this.skipNextNewLine=!1,t.chars.charCodeAt(0)===CODE_POINTS.LINE_FEED)){if(t.chars.length===1)return;t.chars=t.chars.substr(1)}if(this.tokenizer.inForeignNode){this._insertCharacters(t);return}switch(this.insertionMode){case InsertionMode.IN_HEAD:case InsertionMode.IN_HEAD_NO_SCRIPT:case InsertionMode.AFTER_HEAD:case InsertionMode.TEXT:case InsertionMode.IN_COLUMN_GROUP:case InsertionMode.IN_SELECT:case InsertionMode.IN_SELECT_IN_TABLE:case InsertionMode.IN_FRAMESET:case InsertionMode.AFTER_FRAMESET:{this._insertCharacters(t);break}case InsertionMode.IN_BODY:case InsertionMode.IN_CAPTION:case InsertionMode.IN_CELL:case InsertionMode.IN_TEMPLATE:case InsertionMode.AFTER_BODY:case InsertionMode.AFTER_AFTER_BODY:case InsertionMode.AFTER_AFTER_FRAMESET:{whitespaceCharacterInBody(this,t);break}case InsertionMode.IN_TABLE:case InsertionMode.IN_TABLE_BODY:case InsertionMode.IN_ROW:{characterInTable(this,t);break}case InsertionMode.IN_TABLE_TEXT:{whitespaceCharacterInTableText(this,t);break}}}};function aaObtainFormattingElementEntry(e,t){let s=e.activeFormattingElements.getElementEntryInScopeWithTagName(t.tagName);return s?e.openElements.contains(s.element)?e.openElements.hasInScope(t.tagID)||(s=null):(e.activeFormattingElements.removeEntry(s),s=null):genericEndTagInBody(e,t),s}function aaObtainFurthestBlock(e,t){let s=null,n=e.openElements.stackTop;for(;n>=0;n--){const i=e.openElements.items[n];if(i===t.element)break;e._isSpecialElement(i,e.openElements.tagIDs[n])&&(s=i)}return s||(e.openElements.shortenToLength(n<0?0:n),e.activeFormattingElements.removeEntry(t)),s}function aaInnerLoop(e,t,s){let n=t,i=e.openElements.getCommonAncestor(t);for(let r=0,d=i;d!==s;r++,d=i){i=e.openElements.getCommonAncestor(d);const f=e.activeFormattingElements.getElementEntry(d),m=f&&r>=AA_INNER_LOOP_ITER;!f||m?(m&&e.activeFormattingElements.removeEntry(f),e.openElements.remove(d)):(d=aaRecreateElementFromEntry(e,f),n===t&&(e.activeFormattingElements.bookmark=f),e.treeAdapter.detachNode(n),e.treeAdapter.appendChild(d,n),n=d)}return n}function aaRecreateElementFromEntry(e,t){const s=e.treeAdapter.getNamespaceURI(t.element),n=e.treeAdapter.createElement(t.token.tagName,s,t.token.attrs);return e.openElements.replace(t.element,n),t.element=n,n}function aaInsertLastNodeInCommonAncestor(e,t,s){const n=e.treeAdapter.getTagName(t),i=getTagID(n);if(e._isElementCausesFosterParenting(i))e._fosterParentElement(s);else{const r=e.treeAdapter.getNamespaceURI(t);i===TAG_ID.TEMPLATE&&r===NS.HTML&&(t=e.treeAdapter.getTemplateContent(t)),e.treeAdapter.appendChild(t,s)}}function aaReplaceFormattingElement(e,t,s){const n=e.treeAdapter.getNamespaceURI(s.element),{token:i}=s,r=e.treeAdapter.createElement(i.tagName,n,i.attrs);e._adoptNodes(t,r),e.treeAdapter.appendChild(t,r),e.activeFormattingElements.insertElementAfterBookmark(r,i),e.activeFormattingElements.removeEntry(s),e.openElements.remove(s.element),e.openElements.insertAfter(t,r,i.tagID)}function callAdoptionAgency(e,t){for(let s=0;s<AA_OUTER_LOOP_ITER;s++){const n=aaObtainFormattingElementEntry(e,t);if(!n)break;const i=aaObtainFurthestBlock(e,n);if(!i)break;e.activeFormattingElements.bookmark=n;const r=aaInnerLoop(e,i,n.element),d=e.openElements.getCommonAncestor(n.element);e.treeAdapter.detachNode(r),d&&aaInsertLastNodeInCommonAncestor(e,d,r),aaReplaceFormattingElement(e,i,n)}}function appendComment(e,t){e._appendCommentNode(t,e.openElements.currentTmplContentOrNode)}function appendCommentToRootHtmlElement(e,t){e._appendCommentNode(t,e.openElements.items[0])}function appendCommentToDocument(e,t){e._appendCommentNode(t,e.document)}function stopParsing(e,t){if(e.stopped=!0,t.location){const s=e.fragmentContext?0:2;for(let n=e.openElements.stackTop;n>=s;n--)e._setEndLocation(e.openElements.items[n],t);if(!e.fragmentContext&&e.openElements.stackTop>=0){const n=e.openElements.items[0],i=e.treeAdapter.getNodeSourceCodeLocation(n);if(i&&!i.endTag&&(e._setEndLocation(n,t),e.openElements.stackTop>=1)){const r=e.openElements.items[1],d=e.treeAdapter.getNodeSourceCodeLocation(r);d&&!d.endTag&&e._setEndLocation(r,t)}}}}function doctypeInInitialMode(e,t){e._setDocumentType(t);const s=t.forceQuirks?DOCUMENT_MODE.QUIRKS:getDocumentMode(t);isConforming(t)||e._err(t,ERR.nonConformingDoctype),e.treeAdapter.setDocumentMode(e.document,s),e.insertionMode=InsertionMode.BEFORE_HTML}function tokenInInitialMode(e,t){e._err(t,ERR.missingDoctype,!0),e.treeAdapter.setDocumentMode(e.document,DOCUMENT_MODE.QUIRKS),e.insertionMode=InsertionMode.BEFORE_HTML,e._processToken(t)}function startTagBeforeHtml(e,t){t.tagID===TAG_ID.HTML?(e._insertElement(t,NS.HTML),e.insertionMode=InsertionMode.BEFORE_HEAD):tokenBeforeHtml(e,t)}function endTagBeforeHtml(e,t){const s=t.tagID;(s===TAG_ID.HTML||s===TAG_ID.HEAD||s===TAG_ID.BODY||s===TAG_ID.BR)&&tokenBeforeHtml(e,t)}function tokenBeforeHtml(e,t){e._insertFakeRootElement(),e.insertionMode=InsertionMode.BEFORE_HEAD,e._processToken(t)}function startTagBeforeHead(e,t){switch(t.tagID){case TAG_ID.HTML:{startTagInBody(e,t);break}case TAG_ID.HEAD:{e._insertElement(t,NS.HTML),e.headElement=e.openElements.current,e.insertionMode=InsertionMode.IN_HEAD;break}default:tokenBeforeHead(e,t)}}function endTagBeforeHead(e,t){const s=t.tagID;s===TAG_ID.HEAD||s===TAG_ID.BODY||s===TAG_ID.HTML||s===TAG_ID.BR?tokenBeforeHead(e,t):e._err(t,ERR.endTagWithoutMatchingOpenElement)}function tokenBeforeHead(e,t){e._insertFakeElement(TAG_NAMES.HEAD,TAG_ID.HEAD),e.headElement=e.openElements.current,e.insertionMode=InsertionMode.IN_HEAD,e._processToken(t)}function startTagInHead(e,t){switch(t.tagID){case TAG_ID.HTML:{startTagInBody(e,t);break}case TAG_ID.BASE:case TAG_ID.BASEFONT:case TAG_ID.BGSOUND:case TAG_ID.LINK:case TAG_ID.META:{e._appendElement(t,NS.HTML),t.ackSelfClosing=!0;break}case TAG_ID.TITLE:{e._switchToTextParsing(t,TokenizerMode.RCDATA);break}case TAG_ID.NOSCRIPT:{e.options.scriptingEnabled?e._switchToTextParsing(t,TokenizerMode.RAWTEXT):(e._insertElement(t,NS.HTML),e.insertionMode=InsertionMode.IN_HEAD_NO_SCRIPT);break}case TAG_ID.NOFRAMES:case TAG_ID.STYLE:{e._switchToTextParsing(t,TokenizerMode.RAWTEXT);break}case TAG_ID.SCRIPT:{e._switchToTextParsing(t,TokenizerMode.SCRIPT_DATA);break}case TAG_ID.TEMPLATE:{e._insertTemplate(t),e.activeFormattingElements.insertMarker(),e.framesetOk=!1,e.insertionMode=InsertionMode.IN_TEMPLATE,e.tmplInsertionModeStack.unshift(InsertionMode.IN_TEMPLATE);break}case TAG_ID.HEAD:{e._err(t,ERR.misplacedStartTagForHeadElement);break}default:tokenInHead(e,t)}}function endTagInHead(e,t){switch(t.tagID){case TAG_ID.HEAD:{e.openElements.pop(),e.insertionMode=InsertionMode.AFTER_HEAD;break}case TAG_ID.BODY:case TAG_ID.BR:case TAG_ID.HTML:{tokenInHead(e,t);break}case TAG_ID.TEMPLATE:{templateEndTagInHead(e,t);break}default:e._err(t,ERR.endTagWithoutMatchingOpenElement)}}function templateEndTagInHead(e,t){e.openElements.tmplCount>0?(e.openElements.generateImpliedEndTagsThoroughly(),e.openElements.currentTagId!==TAG_ID.TEMPLATE&&e._err(t,ERR.closingOfElementWithOpenChildElements),e.openElements.popUntilTagNamePopped(TAG_ID.TEMPLATE),e.activeFormattingElements.clearToLastMarker(),e.tmplInsertionModeStack.shift(),e._resetInsertionMode()):e._err(t,ERR.endTagWithoutMatchingOpenElement)}function tokenInHead(e,t){e.openElements.pop(),e.insertionMode=InsertionMode.AFTER_HEAD,e._processToken(t)}function startTagInHeadNoScript(e,t){switch(t.tagID){case TAG_ID.HTML:{startTagInBody(e,t);break}case TAG_ID.BASEFONT:case TAG_ID.BGSOUND:case TAG_ID.HEAD:case TAG_ID.LINK:case TAG_ID.META:case TAG_ID.NOFRAMES:case TAG_ID.STYLE:{startTagInHead(e,t);break}case TAG_ID.NOSCRIPT:{e._err(t,ERR.nestedNoscriptInHead);break}default:tokenInHeadNoScript(e,t)}}function endTagInHeadNoScript(e,t){switch(t.tagID){case TAG_ID.NOSCRIPT:{e.openElements.pop(),e.insertionMode=InsertionMode.IN_HEAD;break}case TAG_ID.BR:{tokenInHeadNoScript(e,t);break}default:e._err(t,ERR.endTagWithoutMatchingOpenElement)}}function tokenInHeadNoScript(e,t){const s=t.type===TokenType.EOF?ERR.openElementsLeftAfterEof:ERR.disallowedContentInNoscriptInHead;e._err(t,s),e.openElements.pop(),e.insertionMode=InsertionMode.IN_HEAD,e._processToken(t)}function startTagAfterHead(e,t){switch(t.tagID){case TAG_ID.HTML:{startTagInBody(e,t);break}case TAG_ID.BODY:{e._insertElement(t,NS.HTML),e.framesetOk=!1,e.insertionMode=InsertionMode.IN_BODY;break}case TAG_ID.FRAMESET:{e._insertElement(t,NS.HTML),e.insertionMode=InsertionMode.IN_FRAMESET;break}case TAG_ID.BASE:case TAG_ID.BASEFONT:case TAG_ID.BGSOUND:case TAG_ID.LINK:case TAG_ID.META:case TAG_ID.NOFRAMES:case TAG_ID.SCRIPT:case TAG_ID.STYLE:case TAG_ID.TEMPLATE:case TAG_ID.TITLE:{e._err(t,ERR.abandonedHeadElementChild),e.openElements.push(e.headElement,TAG_ID.HEAD),startTagInHead(e,t),e.openElements.remove(e.headElement);break}case TAG_ID.HEAD:{e._err(t,ERR.misplacedStartTagForHeadElement);break}default:tokenAfterHead(e,t)}}function endTagAfterHead(e,t){switch(t.tagID){case TAG_ID.BODY:case TAG_ID.HTML:case TAG_ID.BR:{tokenAfterHead(e,t);break}case TAG_ID.TEMPLATE:{templateEndTagInHead(e,t);break}default:e._err(t,ERR.endTagWithoutMatchingOpenElement)}}function tokenAfterHead(e,t){e._insertFakeElement(TAG_NAMES.BODY,TAG_ID.BODY),e.insertionMode=InsertionMode.IN_BODY,modeInBody(e,t)}function modeInBody(e,t){switch(t.type){case TokenType.CHARACTER:{characterInBody(e,t);break}case TokenType.WHITESPACE_CHARACTER:{whitespaceCharacterInBody(e,t);break}case TokenType.COMMENT:{appendComment(e,t);break}case TokenType.START_TAG:{startTagInBody(e,t);break}case TokenType.END_TAG:{endTagInBody(e,t);break}case TokenType.EOF:{eofInBody(e,t);break}}}function whitespaceCharacterInBody(e,t){e._reconstructActiveFormattingElements(),e._insertCharacters(t)}function characterInBody(e,t){e._reconstructActiveFormattingElements(),e._insertCharacters(t),e.framesetOk=!1}function htmlStartTagInBody(e,t){e.openElements.tmplCount===0&&e.treeAdapter.adoptAttributes(e.openElements.items[0],t.attrs)}function bodyStartTagInBody(e,t){const s=e.openElements.tryPeekProperlyNestedBodyElement();s&&e.openElements.tmplCount===0&&(e.framesetOk=!1,e.treeAdapter.adoptAttributes(s,t.attrs))}function framesetStartTagInBody(e,t){const s=e.openElements.tryPeekProperlyNestedBodyElement();e.framesetOk&&s&&(e.treeAdapter.detachNode(s),e.openElements.popAllUpToHtmlElement(),e._insertElement(t,NS.HTML),e.insertionMode=InsertionMode.IN_FRAMESET)}function addressStartTagInBody(e,t){e.openElements.hasInButtonScope(TAG_ID.P)&&e._closePElement(),e._insertElement(t,NS.HTML)}function numberedHeaderStartTagInBody(e,t){e.openElements.hasInButtonScope(TAG_ID.P)&&e._closePElement(),isNumberedHeader(e.openElements.currentTagId)&&e.openElements.pop(),e._insertElement(t,NS.HTML)}function preStartTagInBody(e,t){e.openElements.hasInButtonScope(TAG_ID.P)&&e._closePElement(),e._insertElement(t,NS.HTML),e.skipNextNewLine=!0,e.framesetOk=!1}function formStartTagInBody(e,t){const s=e.openElements.tmplCount>0;(!e.formElement||s)&&(e.openElements.hasInButtonScope(TAG_ID.P)&&e._closePElement(),e._insertElement(t,NS.HTML),s||(e.formElement=e.openElements.current))}function listItemStartTagInBody(e,t){e.framesetOk=!1;const s=t.tagID;for(let n=e.openElements.stackTop;n>=0;n--){const i=e.openElements.tagIDs[n];if(s===TAG_ID.LI&&i===TAG_ID.LI||(s===TAG_ID.DD||s===TAG_ID.DT)&&(i===TAG_ID.DD||i===TAG_ID.DT)){e.openElements.generateImpliedEndTagsWithExclusion(i),e.openElements.popUntilTagNamePopped(i);break}if(i!==TAG_ID.ADDRESS&&i!==TAG_ID.DIV&&i!==TAG_ID.P&&e._isSpecialElement(e.openElements.items[n],i))break}e.openElements.hasInButtonScope(TAG_ID.P)&&e._closePElement(),e._insertElement(t,NS.HTML)}function plaintextStartTagInBody(e,t){e.openElements.hasInButtonScope(TAG_ID.P)&&e._closePElement(),e._insertElement(t,NS.HTML),e.tokenizer.state=TokenizerMode.PLAINTEXT}function buttonStartTagInBody(e,t){e.openElements.hasInScope(TAG_ID.BUTTON)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(TAG_ID.BUTTON)),e._reconstructActiveFormattingElements(),e._insertElement(t,NS.HTML),e.framesetOk=!1}function aStartTagInBody(e,t){const s=e.activeFormattingElements.getElementEntryInScopeWithTagName(TAG_NAMES.A);s&&(callAdoptionAgency(e,t),e.openElements.remove(s.element),e.activeFormattingElements.removeEntry(s)),e._reconstructActiveFormattingElements(),e._insertElement(t,NS.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function bStartTagInBody(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,NS.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function nobrStartTagInBody(e,t){e._reconstructActiveFormattingElements(),e.openElements.hasInScope(TAG_ID.NOBR)&&(callAdoptionAgency(e,t),e._reconstructActiveFormattingElements()),e._insertElement(t,NS.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function appletStartTagInBody(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,NS.HTML),e.activeFormattingElements.insertMarker(),e.framesetOk=!1}function tableStartTagInBody(e,t){e.treeAdapter.getDocumentMode(e.document)!==DOCUMENT_MODE.QUIRKS&&e.openElements.hasInButtonScope(TAG_ID.P)&&e._closePElement(),e._insertElement(t,NS.HTML),e.framesetOk=!1,e.insertionMode=InsertionMode.IN_TABLE}function areaStartTagInBody(e,t){e._reconstructActiveFormattingElements(),e._appendElement(t,NS.HTML),e.framesetOk=!1,t.ackSelfClosing=!0}function isHiddenInput(e){const t=getTokenAttr(e,ATTRS.TYPE);return t!=null&&t.toLowerCase()===HIDDEN_INPUT_TYPE}function inputStartTagInBody(e,t){e._reconstructActiveFormattingElements(),e._appendElement(t,NS.HTML),isHiddenInput(t)||(e.framesetOk=!1),t.ackSelfClosing=!0}function paramStartTagInBody(e,t){e._appendElement(t,NS.HTML),t.ackSelfClosing=!0}function hrStartTagInBody(e,t){e.openElements.hasInButtonScope(TAG_ID.P)&&e._closePElement(),e._appendElement(t,NS.HTML),e.framesetOk=!1,t.ackSelfClosing=!0}function imageStartTagInBody(e,t){t.tagName=TAG_NAMES.IMG,t.tagID=TAG_ID.IMG,areaStartTagInBody(e,t)}function textareaStartTagInBody(e,t){e._insertElement(t,NS.HTML),e.skipNextNewLine=!0,e.tokenizer.state=TokenizerMode.RCDATA,e.originalInsertionMode=e.insertionMode,e.framesetOk=!1,e.insertionMode=InsertionMode.TEXT}function xmpStartTagInBody(e,t){e.openElements.hasInButtonScope(TAG_ID.P)&&e._closePElement(),e._reconstructActiveFormattingElements(),e.framesetOk=!1,e._switchToTextParsing(t,TokenizerMode.RAWTEXT)}function iframeStartTagInBody(e,t){e.framesetOk=!1,e._switchToTextParsing(t,TokenizerMode.RAWTEXT)}function noembedStartTagInBody(e,t){e._switchToTextParsing(t,TokenizerMode.RAWTEXT)}function selectStartTagInBody(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,NS.HTML),e.framesetOk=!1,e.insertionMode=e.insertionMode===InsertionMode.IN_TABLE||e.insertionMode===InsertionMode.IN_CAPTION||e.insertionMode===InsertionMode.IN_TABLE_BODY||e.insertionMode===InsertionMode.IN_ROW||e.insertionMode===InsertionMode.IN_CELL?InsertionMode.IN_SELECT_IN_TABLE:InsertionMode.IN_SELECT}function optgroupStartTagInBody(e,t){e.openElements.currentTagId===TAG_ID.OPTION&&e.openElements.pop(),e._reconstructActiveFormattingElements(),e._insertElement(t,NS.HTML)}function rbStartTagInBody(e,t){e.openElements.hasInScope(TAG_ID.RUBY)&&e.openElements.generateImpliedEndTags(),e._insertElement(t,NS.HTML)}function rtStartTagInBody(e,t){e.openElements.hasInScope(TAG_ID.RUBY)&&e.openElements.generateImpliedEndTagsWithExclusion(TAG_ID.RTC),e._insertElement(t,NS.HTML)}function mathStartTagInBody(e,t){e._reconstructActiveFormattingElements(),adjustTokenMathMLAttrs(t),adjustTokenXMLAttrs(t),t.selfClosing?e._appendElement(t,NS.MATHML):e._insertElement(t,NS.MATHML),t.ackSelfClosing=!0}function svgStartTagInBody(e,t){e._reconstructActiveFormattingElements(),adjustTokenSVGAttrs(t),adjustTokenXMLAttrs(t),t.selfClosing?e._appendElement(t,NS.SVG):e._insertElement(t,NS.SVG),t.ackSelfClosing=!0}function genericStartTagInBody(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,NS.HTML)}function startTagInBody(e,t){switch(t.tagID){case TAG_ID.I:case TAG_ID.S:case TAG_ID.B:case TAG_ID.U:case TAG_ID.EM:case TAG_ID.TT:case TAG_ID.BIG:case TAG_ID.CODE:case TAG_ID.FONT:case TAG_ID.SMALL:case TAG_ID.STRIKE:case TAG_ID.STRONG:{bStartTagInBody(e,t);break}case TAG_ID.A:{aStartTagInBody(e,t);break}case TAG_ID.H1:case TAG_ID.H2:case TAG_ID.H3:case TAG_ID.H4:case TAG_ID.H5:case TAG_ID.H6:{numberedHeaderStartTagInBody(e,t);break}case TAG_ID.P:case TAG_ID.DL:case TAG_ID.OL:case TAG_ID.UL:case TAG_ID.DIV:case TAG_ID.DIR:case TAG_ID.NAV:case TAG_ID.MAIN:case TAG_ID.MENU:case TAG_ID.ASIDE:case TAG_ID.CENTER:case TAG_ID.FIGURE:case TAG_ID.FOOTER:case TAG_ID.HEADER:case TAG_ID.HGROUP:case TAG_ID.DIALOG:case TAG_ID.DETAILS:case TAG_ID.ADDRESS:case TAG_ID.ARTICLE:case TAG_ID.SECTION:case TAG_ID.SUMMARY:case TAG_ID.FIELDSET:case TAG_ID.BLOCKQUOTE:case TAG_ID.FIGCAPTION:{addressStartTagInBody(e,t);break}case TAG_ID.LI:case TAG_ID.DD:case TAG_ID.DT:{listItemStartTagInBody(e,t);break}case TAG_ID.BR:case TAG_ID.IMG:case TAG_ID.WBR:case TAG_ID.AREA:case TAG_ID.EMBED:case TAG_ID.KEYGEN:{areaStartTagInBody(e,t);break}case TAG_ID.HR:{hrStartTagInBody(e,t);break}case TAG_ID.RB:case TAG_ID.RTC:{rbStartTagInBody(e,t);break}case TAG_ID.RT:case TAG_ID.RP:{rtStartTagInBody(e,t);break}case TAG_ID.PRE:case TAG_ID.LISTING:{preStartTagInBody(e,t);break}case TAG_ID.XMP:{xmpStartTagInBody(e,t);break}case TAG_ID.SVG:{svgStartTagInBody(e,t);break}case TAG_ID.HTML:{htmlStartTagInBody(e,t);break}case TAG_ID.BASE:case TAG_ID.LINK:case TAG_ID.META:case TAG_ID.STYLE:case TAG_ID.TITLE:case TAG_ID.SCRIPT:case TAG_ID.BGSOUND:case TAG_ID.BASEFONT:case TAG_ID.TEMPLATE:{startTagInHead(e,t);break}case TAG_ID.BODY:{bodyStartTagInBody(e,t);break}case TAG_ID.FORM:{formStartTagInBody(e,t);break}case TAG_ID.NOBR:{nobrStartTagInBody(e,t);break}case TAG_ID.MATH:{mathStartTagInBody(e,t);break}case TAG_ID.TABLE:{tableStartTagInBody(e,t);break}case TAG_ID.INPUT:{inputStartTagInBody(e,t);break}case TAG_ID.PARAM:case TAG_ID.TRACK:case TAG_ID.SOURCE:{paramStartTagInBody(e,t);break}case TAG_ID.IMAGE:{imageStartTagInBody(e,t);break}case TAG_ID.BUTTON:{buttonStartTagInBody(e,t);break}case TAG_ID.APPLET:case TAG_ID.OBJECT:case TAG_ID.MARQUEE:{appletStartTagInBody(e,t);break}case TAG_ID.IFRAME:{iframeStartTagInBody(e,t);break}case TAG_ID.SELECT:{selectStartTagInBody(e,t);break}case TAG_ID.OPTION:case TAG_ID.OPTGROUP:{optgroupStartTagInBody(e,t);break}case TAG_ID.NOEMBED:{noembedStartTagInBody(e,t);break}case TAG_ID.FRAMESET:{framesetStartTagInBody(e,t);break}case TAG_ID.TEXTAREA:{textareaStartTagInBody(e,t);break}case TAG_ID.NOSCRIPT:{e.options.scriptingEnabled?noembedStartTagInBody(e,t):genericStartTagInBody(e,t);break}case TAG_ID.PLAINTEXT:{plaintextStartTagInBody(e,t);break}case TAG_ID.COL:case TAG_ID.TH:case TAG_ID.TD:case TAG_ID.TR:case TAG_ID.HEAD:case TAG_ID.FRAME:case TAG_ID.TBODY:case TAG_ID.TFOOT:case TAG_ID.THEAD:case TAG_ID.CAPTION:case TAG_ID.COLGROUP:break;default:genericStartTagInBody(e,t)}}function bodyEndTagInBody(e,t){if(e.openElements.hasInScope(TAG_ID.BODY)&&(e.insertionMode=InsertionMode.AFTER_BODY,e.options.sourceCodeLocationInfo)){const s=e.openElements.tryPeekProperlyNestedBodyElement();s&&e._setEndLocation(s,t)}}function htmlEndTagInBody(e,t){e.openElements.hasInScope(TAG_ID.BODY)&&(e.insertionMode=InsertionMode.AFTER_BODY,endTagAfterBody(e,t))}function addressEndTagInBody(e,t){const s=t.tagID;e.openElements.hasInScope(s)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(s))}function formEndTagInBody(e){const t=e.openElements.tmplCount>0,{formElement:s}=e;t||(e.formElement=null),(s||t)&&e.openElements.hasInScope(TAG_ID.FORM)&&(e.openElements.generateImpliedEndTags(),t?e.openElements.popUntilTagNamePopped(TAG_ID.FORM):s&&e.openElements.remove(s))}function pEndTagInBody(e){e.openElements.hasInButtonScope(TAG_ID.P)||e._insertFakeElement(TAG_NAMES.P,TAG_ID.P),e._closePElement()}function liEndTagInBody(e){e.openElements.hasInListItemScope(TAG_ID.LI)&&(e.openElements.generateImpliedEndTagsWithExclusion(TAG_ID.LI),e.openElements.popUntilTagNamePopped(TAG_ID.LI))}function ddEndTagInBody(e,t){const s=t.tagID;e.openElements.hasInScope(s)&&(e.openElements.generateImpliedEndTagsWithExclusion(s),e.openElements.popUntilTagNamePopped(s))}function numberedHeaderEndTagInBody(e){e.openElements.hasNumberedHeaderInScope()&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilNumberedHeaderPopped())}function appletEndTagInBody(e,t){const s=t.tagID;e.openElements.hasInScope(s)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(s),e.activeFormattingElements.clearToLastMarker())}function brEndTagInBody(e){e._reconstructActiveFormattingElements(),e._insertFakeElement(TAG_NAMES.BR,TAG_ID.BR),e.openElements.pop(),e.framesetOk=!1}function genericEndTagInBody(e,t){const s=t.tagName,n=t.tagID;for(let i=e.openElements.stackTop;i>0;i--){const r=e.openElements.items[i],d=e.openElements.tagIDs[i];if(n===d&&(n!==TAG_ID.UNKNOWN||e.treeAdapter.getTagName(r)===s)){e.openElements.generateImpliedEndTagsWithExclusion(n),e.openElements.stackTop>=i&&e.openElements.shortenToLength(i);break}if(e._isSpecialElement(r,d))break}}function endTagInBody(e,t){switch(t.tagID){case TAG_ID.A:case TAG_ID.B:case TAG_ID.I:case TAG_ID.S:case TAG_ID.U:case TAG_ID.EM:case TAG_ID.TT:case TAG_ID.BIG:case TAG_ID.CODE:case TAG_ID.FONT:case TAG_ID.NOBR:case TAG_ID.SMALL:case TAG_ID.STRIKE:case TAG_ID.STRONG:{callAdoptionAgency(e,t);break}case TAG_ID.P:{pEndTagInBody(e);break}case TAG_ID.DL:case TAG_ID.UL:case TAG_ID.OL:case TAG_ID.DIR:case TAG_ID.DIV:case TAG_ID.NAV:case TAG_ID.PRE:case TAG_ID.MAIN:case TAG_ID.MENU:case TAG_ID.ASIDE:case TAG_ID.BUTTON:case TAG_ID.CENTER:case TAG_ID.FIGURE:case TAG_ID.FOOTER:case TAG_ID.HEADER:case TAG_ID.HGROUP:case TAG_ID.DIALOG:case TAG_ID.ADDRESS:case TAG_ID.ARTICLE:case TAG_ID.DETAILS:case TAG_ID.SECTION:case TAG_ID.SUMMARY:case TAG_ID.LISTING:case TAG_ID.FIELDSET:case TAG_ID.BLOCKQUOTE:case TAG_ID.FIGCAPTION:{addressEndTagInBody(e,t);break}case TAG_ID.LI:{liEndTagInBody(e);break}case TAG_ID.DD:case TAG_ID.DT:{ddEndTagInBody(e,t);break}case TAG_ID.H1:case TAG_ID.H2:case TAG_ID.H3:case TAG_ID.H4:case TAG_ID.H5:case TAG_ID.H6:{numberedHeaderEndTagInBody(e);break}case TAG_ID.BR:{brEndTagInBody(e);break}case TAG_ID.BODY:{bodyEndTagInBody(e,t);break}case TAG_ID.HTML:{htmlEndTagInBody(e,t);break}case TAG_ID.FORM:{formEndTagInBody(e);break}case TAG_ID.APPLET:case TAG_ID.OBJECT:case TAG_ID.MARQUEE:{appletEndTagInBody(e,t);break}case TAG_ID.TEMPLATE:{templateEndTagInHead(e,t);break}default:genericEndTagInBody(e,t)}}function eofInBody(e,t){e.tmplInsertionModeStack.length>0?eofInTemplate(e,t):stopParsing(e,t)}function endTagInText(e,t){var s;t.tagID===TAG_ID.SCRIPT&&((s=e.scriptHandler)===null||s===void 0||s.call(e,e.openElements.current)),e.openElements.pop(),e.insertionMode=e.originalInsertionMode}function eofInText(e,t){e._err(t,ERR.eofInElementThatCanContainOnlyText),e.openElements.pop(),e.insertionMode=e.originalInsertionMode,e.onEof(t)}function characterInTable(e,t){if(TABLE_STRUCTURE_TAGS.has(e.openElements.currentTagId))switch(e.pendingCharacterTokens.length=0,e.hasNonWhitespacePendingCharacterToken=!1,e.originalInsertionMode=e.insertionMode,e.insertionMode=InsertionMode.IN_TABLE_TEXT,t.type){case TokenType.CHARACTER:{characterInTableText(e,t);break}case TokenType.WHITESPACE_CHARACTER:{whitespaceCharacterInTableText(e,t);break}}else tokenInTable(e,t)}function captionStartTagInTable(e,t){e.openElements.clearBackToTableContext(),e.activeFormattingElements.insertMarker(),e._insertElement(t,NS.HTML),e.insertionMode=InsertionMode.IN_CAPTION}function colgroupStartTagInTable(e,t){e.openElements.clearBackToTableContext(),e._insertElement(t,NS.HTML),e.insertionMode=InsertionMode.IN_COLUMN_GROUP}function colStartTagInTable(e,t){e.openElements.clearBackToTableContext(),e._insertFakeElement(TAG_NAMES.COLGROUP,TAG_ID.COLGROUP),e.insertionMode=InsertionMode.IN_COLUMN_GROUP,startTagInColumnGroup(e,t)}function tbodyStartTagInTable(e,t){e.openElements.clearBackToTableContext(),e._insertElement(t,NS.HTML),e.insertionMode=InsertionMode.IN_TABLE_BODY}function tdStartTagInTable(e,t){e.openElements.clearBackToTableContext(),e._insertFakeElement(TAG_NAMES.TBODY,TAG_ID.TBODY),e.insertionMode=InsertionMode.IN_TABLE_BODY,startTagInTableBody(e,t)}function tableStartTagInTable(e,t){e.openElements.hasInTableScope(TAG_ID.TABLE)&&(e.openElements.popUntilTagNamePopped(TAG_ID.TABLE),e._resetInsertionMode(),e._processStartTag(t))}function inputStartTagInTable(e,t){isHiddenInput(t)?e._appendElement(t,NS.HTML):tokenInTable(e,t),t.ackSelfClosing=!0}function formStartTagInTable(e,t){!e.formElement&&e.openElements.tmplCount===0&&(e._insertElement(t,NS.HTML),e.formElement=e.openElements.current,e.openElements.pop())}function startTagInTable(e,t){switch(t.tagID){case TAG_ID.TD:case TAG_ID.TH:case TAG_ID.TR:{tdStartTagInTable(e,t);break}case TAG_ID.STYLE:case TAG_ID.SCRIPT:case TAG_ID.TEMPLATE:{startTagInHead(e,t);break}case TAG_ID.COL:{colStartTagInTable(e,t);break}case TAG_ID.FORM:{formStartTagInTable(e,t);break}case TAG_ID.TABLE:{tableStartTagInTable(e,t);break}case TAG_ID.TBODY:case TAG_ID.TFOOT:case TAG_ID.THEAD:{tbodyStartTagInTable(e,t);break}case TAG_ID.INPUT:{inputStartTagInTable(e,t);break}case TAG_ID.CAPTION:{captionStartTagInTable(e,t);break}case TAG_ID.COLGROUP:{colgroupStartTagInTable(e,t);break}default:tokenInTable(e,t)}}function endTagInTable(e,t){switch(t.tagID){case TAG_ID.TABLE:{e.openElements.hasInTableScope(TAG_ID.TABLE)&&(e.openElements.popUntilTagNamePopped(TAG_ID.TABLE),e._resetInsertionMode());break}case TAG_ID.TEMPLATE:{templateEndTagInHead(e,t);break}case TAG_ID.BODY:case TAG_ID.CAPTION:case TAG_ID.COL:case TAG_ID.COLGROUP:case TAG_ID.HTML:case TAG_ID.TBODY:case TAG_ID.TD:case TAG_ID.TFOOT:case TAG_ID.TH:case TAG_ID.THEAD:case TAG_ID.TR:break;default:tokenInTable(e,t)}}function tokenInTable(e,t){const s=e.fosterParentingEnabled;e.fosterParentingEnabled=!0,modeInBody(e,t),e.fosterParentingEnabled=s}function whitespaceCharacterInTableText(e,t){e.pendingCharacterTokens.push(t)}function characterInTableText(e,t){e.pendingCharacterTokens.push(t),e.hasNonWhitespacePendingCharacterToken=!0}function tokenInTableText(e,t){let s=0;if(e.hasNonWhitespacePendingCharacterToken)for(;s<e.pendingCharacterTokens.length;s++)tokenInTable(e,e.pendingCharacterTokens[s]);else for(;s<e.pendingCharacterTokens.length;s++)e._insertCharacters(e.pendingCharacterTokens[s]);e.insertionMode=e.originalInsertionMode,e._processToken(t)}const TABLE_VOID_ELEMENTS=new Set([TAG_ID.CAPTION,TAG_ID.COL,TAG_ID.COLGROUP,TAG_ID.TBODY,TAG_ID.TD,TAG_ID.TFOOT,TAG_ID.TH,TAG_ID.THEAD,TAG_ID.TR]);function startTagInCaption(e,t){const s=t.tagID;TABLE_VOID_ELEMENTS.has(s)?e.openElements.hasInTableScope(TAG_ID.CAPTION)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(TAG_ID.CAPTION),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=InsertionMode.IN_TABLE,startTagInTable(e,t)):startTagInBody(e,t)}function endTagInCaption(e,t){const s=t.tagID;switch(s){case TAG_ID.CAPTION:case TAG_ID.TABLE:{e.openElements.hasInTableScope(TAG_ID.CAPTION)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(TAG_ID.CAPTION),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=InsertionMode.IN_TABLE,s===TAG_ID.TABLE&&endTagInTable(e,t));break}case TAG_ID.BODY:case TAG_ID.COL:case TAG_ID.COLGROUP:case TAG_ID.HTML:case TAG_ID.TBODY:case TAG_ID.TD:case TAG_ID.TFOOT:case TAG_ID.TH:case TAG_ID.THEAD:case TAG_ID.TR:break;default:endTagInBody(e,t)}}function startTagInColumnGroup(e,t){switch(t.tagID){case TAG_ID.HTML:{startTagInBody(e,t);break}case TAG_ID.COL:{e._appendElement(t,NS.HTML),t.ackSelfClosing=!0;break}case TAG_ID.TEMPLATE:{startTagInHead(e,t);break}default:tokenInColumnGroup(e,t)}}function endTagInColumnGroup(e,t){switch(t.tagID){case TAG_ID.COLGROUP:{e.openElements.currentTagId===TAG_ID.COLGROUP&&(e.openElements.pop(),e.insertionMode=InsertionMode.IN_TABLE);break}case TAG_ID.TEMPLATE:{templateEndTagInHead(e,t);break}case TAG_ID.COL:break;default:tokenInColumnGroup(e,t)}}function tokenInColumnGroup(e,t){e.openElements.currentTagId===TAG_ID.COLGROUP&&(e.openElements.pop(),e.insertionMode=InsertionMode.IN_TABLE,e._processToken(t))}function startTagInTableBody(e,t){switch(t.tagID){case TAG_ID.TR:{e.openElements.clearBackToTableBodyContext(),e._insertElement(t,NS.HTML),e.insertionMode=InsertionMode.IN_ROW;break}case TAG_ID.TH:case TAG_ID.TD:{e.openElements.clearBackToTableBodyContext(),e._insertFakeElement(TAG_NAMES.TR,TAG_ID.TR),e.insertionMode=InsertionMode.IN_ROW,startTagInRow(e,t);break}case TAG_ID.CAPTION:case TAG_ID.COL:case TAG_ID.COLGROUP:case TAG_ID.TBODY:case TAG_ID.TFOOT:case TAG_ID.THEAD:{e.openElements.hasTableBodyContextInTableScope()&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=InsertionMode.IN_TABLE,startTagInTable(e,t));break}default:startTagInTable(e,t)}}function endTagInTableBody(e,t){const s=t.tagID;switch(t.tagID){case TAG_ID.TBODY:case TAG_ID.TFOOT:case TAG_ID.THEAD:{e.openElements.hasInTableScope(s)&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=InsertionMode.IN_TABLE);break}case TAG_ID.TABLE:{e.openElements.hasTableBodyContextInTableScope()&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=InsertionMode.IN_TABLE,endTagInTable(e,t));break}case TAG_ID.BODY:case TAG_ID.CAPTION:case TAG_ID.COL:case TAG_ID.COLGROUP:case TAG_ID.HTML:case TAG_ID.TD:case TAG_ID.TH:case TAG_ID.TR:break;default:endTagInTable(e,t)}}function startTagInRow(e,t){switch(t.tagID){case TAG_ID.TH:case TAG_ID.TD:{e.openElements.clearBackToTableRowContext(),e._insertElement(t,NS.HTML),e.insertionMode=InsertionMode.IN_CELL,e.activeFormattingElements.insertMarker();break}case TAG_ID.CAPTION:case TAG_ID.COL:case TAG_ID.COLGROUP:case TAG_ID.TBODY:case TAG_ID.TFOOT:case TAG_ID.THEAD:case TAG_ID.TR:{e.openElements.hasInTableScope(TAG_ID.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=InsertionMode.IN_TABLE_BODY,startTagInTableBody(e,t));break}default:startTagInTable(e,t)}}function endTagInRow(e,t){switch(t.tagID){case TAG_ID.TR:{e.openElements.hasInTableScope(TAG_ID.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=InsertionMode.IN_TABLE_BODY);break}case TAG_ID.TABLE:{e.openElements.hasInTableScope(TAG_ID.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=InsertionMode.IN_TABLE_BODY,endTagInTableBody(e,t));break}case TAG_ID.TBODY:case TAG_ID.TFOOT:case TAG_ID.THEAD:{(e.openElements.hasInTableScope(t.tagID)||e.openElements.hasInTableScope(TAG_ID.TR))&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=InsertionMode.IN_TABLE_BODY,endTagInTableBody(e,t));break}case TAG_ID.BODY:case TAG_ID.CAPTION:case TAG_ID.COL:case TAG_ID.COLGROUP:case TAG_ID.HTML:case TAG_ID.TD:case TAG_ID.TH:break;default:endTagInTable(e,t)}}function startTagInCell(e,t){const s=t.tagID;TABLE_VOID_ELEMENTS.has(s)?(e.openElements.hasInTableScope(TAG_ID.TD)||e.openElements.hasInTableScope(TAG_ID.TH))&&(e._closeTableCell(),startTagInRow(e,t)):startTagInBody(e,t)}function endTagInCell(e,t){const s=t.tagID;switch(s){case TAG_ID.TD:case TAG_ID.TH:{e.openElements.hasInTableScope(s)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(s),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=InsertionMode.IN_ROW);break}case TAG_ID.TABLE:case TAG_ID.TBODY:case TAG_ID.TFOOT:case TAG_ID.THEAD:case TAG_ID.TR:{e.openElements.hasInTableScope(s)&&(e._closeTableCell(),endTagInRow(e,t));break}case TAG_ID.BODY:case TAG_ID.CAPTION:case TAG_ID.COL:case TAG_ID.COLGROUP:case TAG_ID.HTML:break;default:endTagInBody(e,t)}}function startTagInSelect(e,t){switch(t.tagID){case TAG_ID.HTML:{startTagInBody(e,t);break}case TAG_ID.OPTION:{e.openElements.currentTagId===TAG_ID.OPTION&&e.openElements.pop(),e._insertElement(t,NS.HTML);break}case TAG_ID.OPTGROUP:{e.openElements.currentTagId===TAG_ID.OPTION&&e.openElements.pop(),e.openElements.currentTagId===TAG_ID.OPTGROUP&&e.openElements.pop(),e._insertElement(t,NS.HTML);break}case TAG_ID.INPUT:case TAG_ID.KEYGEN:case TAG_ID.TEXTAREA:case TAG_ID.SELECT:{e.openElements.hasInSelectScope(TAG_ID.SELECT)&&(e.openElements.popUntilTagNamePopped(TAG_ID.SELECT),e._resetInsertionMode(),t.tagID!==TAG_ID.SELECT&&e._processStartTag(t));break}case TAG_ID.SCRIPT:case TAG_ID.TEMPLATE:{startTagInHead(e,t);break}}}function endTagInSelect(e,t){switch(t.tagID){case TAG_ID.OPTGROUP:{e.openElements.stackTop>0&&e.openElements.currentTagId===TAG_ID.OPTION&&e.openElements.tagIDs[e.openElements.stackTop-1]===TAG_ID.OPTGROUP&&e.openElements.pop(),e.openElements.currentTagId===TAG_ID.OPTGROUP&&e.openElements.pop();break}case TAG_ID.OPTION:{e.openElements.currentTagId===TAG_ID.OPTION&&e.openElements.pop();break}case TAG_ID.SELECT:{e.openElements.hasInSelectScope(TAG_ID.SELECT)&&(e.openElements.popUntilTagNamePopped(TAG_ID.SELECT),e._resetInsertionMode());break}case TAG_ID.TEMPLATE:{templateEndTagInHead(e,t);break}}}function startTagInSelectInTable(e,t){const s=t.tagID;s===TAG_ID.CAPTION||s===TAG_ID.TABLE||s===TAG_ID.TBODY||s===TAG_ID.TFOOT||s===TAG_ID.THEAD||s===TAG_ID.TR||s===TAG_ID.TD||s===TAG_ID.TH?(e.openElements.popUntilTagNamePopped(TAG_ID.SELECT),e._resetInsertionMode(),e._processStartTag(t)):startTagInSelect(e,t)}function endTagInSelectInTable(e,t){const s=t.tagID;s===TAG_ID.CAPTION||s===TAG_ID.TABLE||s===TAG_ID.TBODY||s===TAG_ID.TFOOT||s===TAG_ID.THEAD||s===TAG_ID.TR||s===TAG_ID.TD||s===TAG_ID.TH?e.openElements.hasInTableScope(s)&&(e.openElements.popUntilTagNamePopped(TAG_ID.SELECT),e._resetInsertionMode(),e.onEndTag(t)):endTagInSelect(e,t)}function startTagInTemplate(e,t){switch(t.tagID){case TAG_ID.BASE:case TAG_ID.BASEFONT:case TAG_ID.BGSOUND:case TAG_ID.LINK:case TAG_ID.META:case TAG_ID.NOFRAMES:case TAG_ID.SCRIPT:case TAG_ID.STYLE:case TAG_ID.TEMPLATE:case TAG_ID.TITLE:{startTagInHead(e,t);break}case TAG_ID.CAPTION:case TAG_ID.COLGROUP:case TAG_ID.TBODY:case TAG_ID.TFOOT:case TAG_ID.THEAD:{e.tmplInsertionModeStack[0]=InsertionMode.IN_TABLE,e.insertionMode=InsertionMode.IN_TABLE,startTagInTable(e,t);break}case TAG_ID.COL:{e.tmplInsertionModeStack[0]=InsertionMode.IN_COLUMN_GROUP,e.insertionMode=InsertionMode.IN_COLUMN_GROUP,startTagInColumnGroup(e,t);break}case TAG_ID.TR:{e.tmplInsertionModeStack[0]=InsertionMode.IN_TABLE_BODY,e.insertionMode=InsertionMode.IN_TABLE_BODY,startTagInTableBody(e,t);break}case TAG_ID.TD:case TAG_ID.TH:{e.tmplInsertionModeStack[0]=InsertionMode.IN_ROW,e.insertionMode=InsertionMode.IN_ROW,startTagInRow(e,t);break}default:e.tmplInsertionModeStack[0]=InsertionMode.IN_BODY,e.insertionMode=InsertionMode.IN_BODY,startTagInBody(e,t)}}function endTagInTemplate(e,t){t.tagID===TAG_ID.TEMPLATE&&templateEndTagInHead(e,t)}function eofInTemplate(e,t){e.openElements.tmplCount>0?(e.openElements.popUntilTagNamePopped(TAG_ID.TEMPLATE),e.activeFormattingElements.clearToLastMarker(),e.tmplInsertionModeStack.shift(),e._resetInsertionMode(),e.onEof(t)):stopParsing(e,t)}function startTagAfterBody(e,t){t.tagID===TAG_ID.HTML?startTagInBody(e,t):tokenAfterBody(e,t)}function endTagAfterBody(e,t){var s;if(t.tagID===TAG_ID.HTML){if(e.fragmentContext||(e.insertionMode=InsertionMode.AFTER_AFTER_BODY),e.options.sourceCodeLocationInfo&&e.openElements.tagIDs[0]===TAG_ID.HTML){e._setEndLocation(e.openElements.items[0],t);const n=e.openElements.items[1];n&&!(!((s=e.treeAdapter.getNodeSourceCodeLocation(n))===null||s===void 0)&&s.endTag)&&e._setEndLocation(n,t)}}else tokenAfterBody(e,t)}function tokenAfterBody(e,t){e.insertionMode=InsertionMode.IN_BODY,modeInBody(e,t)}function startTagInFrameset(e,t){switch(t.tagID){case TAG_ID.HTML:{startTagInBody(e,t);break}case TAG_ID.FRAMESET:{e._insertElement(t,NS.HTML);break}case TAG_ID.FRAME:{e._appendElement(t,NS.HTML),t.ackSelfClosing=!0;break}case TAG_ID.NOFRAMES:{startTagInHead(e,t);break}}}function endTagInFrameset(e,t){t.tagID===TAG_ID.FRAMESET&&!e.openElements.isRootHtmlElementCurrent()&&(e.openElements.pop(),!e.fragmentContext&&e.openElements.currentTagId!==TAG_ID.FRAMESET&&(e.insertionMode=InsertionMode.AFTER_FRAMESET))}function startTagAfterFrameset(e,t){switch(t.tagID){case TAG_ID.HTML:{startTagInBody(e,t);break}case TAG_ID.NOFRAMES:{startTagInHead(e,t);break}}}function endTagAfterFrameset(e,t){t.tagID===TAG_ID.HTML&&(e.insertionMode=InsertionMode.AFTER_AFTER_FRAMESET)}function startTagAfterAfterBody(e,t){t.tagID===TAG_ID.HTML?startTagInBody(e,t):tokenAfterAfterBody(e,t)}function tokenAfterAfterBody(e,t){e.insertionMode=InsertionMode.IN_BODY,modeInBody(e,t)}function startTagAfterAfterFrameset(e,t){switch(t.tagID){case TAG_ID.HTML:{startTagInBody(e,t);break}case TAG_ID.NOFRAMES:{startTagInHead(e,t);break}}}function nullCharacterInForeignContent(e,t){t.chars=REPLACEMENT_CHARACTER,e._insertCharacters(t)}function characterInForeignContent(e,t){e._insertCharacters(t),e.framesetOk=!1}function popUntilHtmlOrIntegrationPoint(e){for(;e.treeAdapter.getNamespaceURI(e.openElements.current)!==NS.HTML&&!e._isIntegrationPoint(e.openElements.currentTagId,e.openElements.current);)e.openElements.pop()}function startTagInForeignContent(e,t){if(causesExit(t))popUntilHtmlOrIntegrationPoint(e),e._startTagOutsideForeignContent(t);else{const s=e._getAdjustedCurrentElement(),n=e.treeAdapter.getNamespaceURI(s);n===NS.MATHML?adjustTokenMathMLAttrs(t):n===NS.SVG&&(adjustTokenSVGTagName(t),adjustTokenSVGAttrs(t)),adjustTokenXMLAttrs(t),t.selfClosing?e._appendElement(t,n):e._insertElement(t,n),t.ackSelfClosing=!0}}function endTagInForeignContent(e,t){if(t.tagID===TAG_ID.P||t.tagID===TAG_ID.BR){popUntilHtmlOrIntegrationPoint(e),e._endTagOutsideForeignContent(t);return}for(let s=e.openElements.stackTop;s>0;s--){const n=e.openElements.items[s];if(e.treeAdapter.getNamespaceURI(n)===NS.HTML){e._endTagOutsideForeignContent(t);break}const i=e.treeAdapter.getTagName(n);if(i.toLowerCase()===t.tagName){t.tagName=i,e.openElements.shortenToLength(s);break}}}const VOID_ELEMENTS=new Set([TAG_NAMES.AREA,TAG_NAMES.BASE,TAG_NAMES.BASEFONT,TAG_NAMES.BGSOUND,TAG_NAMES.BR,TAG_NAMES.COL,TAG_NAMES.EMBED,TAG_NAMES.FRAME,TAG_NAMES.HR,TAG_NAMES.IMG,TAG_NAMES.INPUT,TAG_NAMES.KEYGEN,TAG_NAMES.LINK,TAG_NAMES.META,TAG_NAMES.PARAM,TAG_NAMES.SOURCE,TAG_NAMES.TRACK,TAG_NAMES.WBR]);function isVoidElement(e,t){return t.treeAdapter.isElementNode(e)&&t.treeAdapter.getNamespaceURI(e)===NS.HTML&&VOID_ELEMENTS.has(t.treeAdapter.getTagName(e))}const defaultOpts={treeAdapter:defaultTreeAdapter,scriptingEnabled:!0};function serializeOuter(e,t){const s={...defaultOpts,...t};return serializeNode(e,s)}function serializeChildNodes(e,t){let s="";const n=t.treeAdapter.isElementNode(e)&&t.treeAdapter.getTagName(e)===TAG_NAMES.TEMPLATE&&t.treeAdapter.getNamespaceURI(e)===NS.HTML?t.treeAdapter.getTemplateContent(e):e,i=t.treeAdapter.getChildNodes(n);if(i)for(const r of i)s+=serializeNode(r,t);return s}function serializeNode(e,t){return t.treeAdapter.isElementNode(e)?serializeElement(e,t):t.treeAdapter.isTextNode(e)?serializeTextNode(e,t):t.treeAdapter.isCommentNode(e)?serializeCommentNode(e,t):t.treeAdapter.isDocumentTypeNode(e)?serializeDocumentTypeNode(e,t):""}function serializeElement(e,t){const s=t.treeAdapter.getTagName(e);return`<${s}${serializeAttributes(e,t)}>${isVoidElement(e,t)?"":`${serializeChildNodes(e,t)}</${s}>`}`}function serializeAttributes(e,{treeAdapter:t}){let s="";for(const n of t.getAttrList(e)){if(s+=" ",!n.namespace)s+=n.name;else switch(n.namespace){case NS.XML:{s+=`xml:${n.name}`;break}case NS.XMLNS:{n.name!=="xmlns"&&(s+="xmlns:"),s+=n.name;break}case NS.XLINK:{s+=`xlink:${n.name}`;break}default:s+=`${n.prefix}:${n.name}`}s+=`="${escapeAttribute(n.value)}"`}return s}function serializeTextNode(e,t){const{treeAdapter:s}=t,n=s.getTextNodeContent(e),i=s.getParentNode(e),r=i&&s.isElementNode(i)&&s.getTagName(i);return r&&s.getNamespaceURI(i)===NS.HTML&&hasUnescapedText(r,t.scriptingEnabled)?n:escapeText(n)}function serializeCommentNode(e,{treeAdapter:t}){return`<!--${t.getCommentNodeContent(e)}-->`}function serializeDocumentTypeNode(e,{treeAdapter:t}){return`<!DOCTYPE ${t.getDocumentTypeNodeName(e)}>`}function parse$1(e,t){return Parser$1.parse(e,t)}function parseFragment(e,t,s){typeof e=="string"&&(s=t,t=e,e=null);const n=Parser$1.getFragmentParser(e,s);return n.tokenizer.write(t,!0),n.getFragment()}function createTextNode(e){return new Text(e)}function enquoteDoctypeId(e){const t=e.includes('"')?"'":'"';return t+e+t}function serializeDoctypeContent(e,t,s){let n="!DOCTYPE ";return e&&(n+=e),t?n+=` PUBLIC ${enquoteDoctypeId(t)}`:s&&(n+=" SYSTEM"),s&&(n+=` ${enquoteDoctypeId(s)}`),n}const adapter={isCommentNode:isComment,isElementNode:isTag,isTextNode:isText,createDocument(){const e=new Document([]);return e["x-mode"]=DOCUMENT_MODE.NO_QUIRKS,e},createDocumentFragment(){return new Document([])},createElement(e,t,s){const n=Object.create(null),i=Object.create(null),r=Object.create(null);for(let f=0;f<s.length;f++){const m=s[f].name;n[m]=s[f].value,i[m]=s[f].namespace,r[m]=s[f].prefix}const d=new Element(e,n,[]);return d.namespace=t,d["x-attribsNamespace"]=i,d["x-attribsPrefix"]=r,d},createCommentNode(e){return new Comment(e)},appendChild(e,t){const s=e.children[e.children.length-1];s&&(s.next=t,t.prev=s),e.children.push(t),t.parent=e},insertBefore(e,t,s){const n=e.children.indexOf(s),{prev:i}=s;i&&(i.next=t,t.prev=i),s.prev=t,t.next=s,e.children.splice(n,0,t),t.parent=e},setTemplateContent(e,t){adapter.appendChild(e,t)},getTemplateContent(e){return e.children[0]},setDocumentType(e,t,s,n){const i=serializeDoctypeContent(t,s,n);let r=e.children.find(d=>isDirective(d)&&d.name==="!doctype");r?r.data=i??null:(r=new ProcessingInstruction("!doctype",i),adapter.appendChild(e,r)),r["x-name"]=t??void 0,r["x-publicId"]=s??void 0,r["x-systemId"]=n??void 0},setDocumentMode(e,t){e["x-mode"]=t},getDocumentMode(e){return e["x-mode"]},detachNode(e){if(e.parent){const t=e.parent.children.indexOf(e),{prev:s,next:n}=e;e.prev=null,e.next=null,s&&(s.next=n),n&&(n.prev=s),e.parent.children.splice(t,1),e.parent=null}},insertText(e,t){const s=e.children[e.children.length-1];s&&isText(s)?s.data+=t:adapter.appendChild(e,createTextNode(t))},insertTextBefore(e,t,s){const n=e.children[e.children.indexOf(s)-1];n&&isText(n)?n.data+=t:adapter.insertBefore(e,createTextNode(t),s)},adoptAttributes(e,t){for(let s=0;s<t.length;s++){const n=t[s].name;typeof e.attribs[n]>"u"&&(e.attribs[n]=t[s].value,e["x-attribsNamespace"][n]=t[s].namespace,e["x-attribsPrefix"][n]=t[s].prefix)}},getFirstChild(e){return e.children[0]},getChildNodes(e){return e.children},getParentNode(e){return e.parent},getAttrList(e){return e.attributes},getTagName(e){return e.name},getNamespaceURI(e){return e.namespace},getTextNodeContent(e){return e.data},getCommentNodeContent(e){return e.data},getDocumentTypeNodeName(e){var t;return(t=e["x-name"])!==null&&t!==void 0?t:""},getDocumentTypeNodePublicId(e){var t;return(t=e["x-publicId"])!==null&&t!==void 0?t:""},getDocumentTypeNodeSystemId(e){var t;return(t=e["x-systemId"])!==null&&t!==void 0?t:""},isDocumentTypeNode(e){return isDirective(e)&&e.name==="!doctype"},setNodeSourceCodeLocation(e,t){t&&(e.startIndex=t.startOffset,e.endIndex=t.endOffset),e.sourceCodeLocation=t},getNodeSourceCodeLocation(e){return e.sourceCodeLocation},updateNodeSourceCodeLocation(e,t){t.endOffset!=null&&(e.endIndex=t.endOffset),e.sourceCodeLocation={...e.sourceCodeLocation,...t}}};function parseWithParse5(e,t,s,n){const i={scriptingEnabled:typeof t.scriptingEnabled=="boolean"?t.scriptingEnabled:!0,treeAdapter:adapter,sourceCodeLocationInfo:t.sourceCodeLocationInfo};return s?parse$1(e,i):parseFragment(n,e,i)}const renderOpts={treeAdapter:adapter};function renderWithParse5(e){const t="length"in e?e:[e];for(let n=0;n<t.length;n+=1){const i=t[n];isDocument(i)&&Array.prototype.splice.call(t,n,1,...i.children)}let s="";for(let n=0;n<t.length;n+=1){const i=t[n];s+=serializeOuter(i,renderOpts)}return s}var CharCodes;(function(e){e[e.Tab=9]="Tab",e[e.NewLine=10]="NewLine",e[e.FormFeed=12]="FormFeed",e[e.CarriageReturn=13]="CarriageReturn",e[e.Space=32]="Space",e[e.ExclamationMark=33]="ExclamationMark",e[e.Number=35]="Number",e[e.Amp=38]="Amp",e[e.SingleQuote=39]="SingleQuote",e[e.DoubleQuote=34]="DoubleQuote",e[e.Dash=45]="Dash",e[e.Slash=47]="Slash",e[e.Zero=48]="Zero",e[e.Nine=57]="Nine",e[e.Semi=59]="Semi",e[e.Lt=60]="Lt",e[e.Eq=61]="Eq",e[e.Gt=62]="Gt",e[e.Questionmark=63]="Questionmark",e[e.UpperA=65]="UpperA",e[e.LowerA=97]="LowerA",e[e.UpperF=70]="UpperF",e[e.LowerF=102]="LowerF",e[e.UpperZ=90]="UpperZ",e[e.LowerZ=122]="LowerZ",e[e.LowerX=120]="LowerX",e[e.OpeningSquareBracket=91]="OpeningSquareBracket"})(CharCodes||(CharCodes={}));var State;(function(e){e[e.Text=1]="Text",e[e.BeforeTagName=2]="BeforeTagName",e[e.InTagName=3]="InTagName",e[e.InSelfClosingTag=4]="InSelfClosingTag",e[e.BeforeClosingTagName=5]="BeforeClosingTagName",e[e.InClosingTagName=6]="InClosingTagName",e[e.AfterClosingTagName=7]="AfterClosingTagName",e[e.BeforeAttributeName=8]="BeforeAttributeName",e[e.InAttributeName=9]="InAttributeName",e[e.AfterAttributeName=10]="AfterAttributeName",e[e.BeforeAttributeValue=11]="BeforeAttributeValue",e[e.InAttributeValueDq=12]="InAttributeValueDq",e[e.InAttributeValueSq=13]="InAttributeValueSq",e[e.InAttributeValueNq=14]="InAttributeValueNq",e[e.BeforeDeclaration=15]="BeforeDeclaration",e[e.InDeclaration=16]="InDeclaration",e[e.InProcessingInstruction=17]="InProcessingInstruction",e[e.BeforeComment=18]="BeforeComment",e[e.CDATASequence=19]="CDATASequence",e[e.InSpecialComment=20]="InSpecialComment",e[e.InCommentLike=21]="InCommentLike",e[e.BeforeSpecialS=22]="BeforeSpecialS",e[e.SpecialStartSequence=23]="SpecialStartSequence",e[e.InSpecialTag=24]="InSpecialTag",e[e.BeforeEntity=25]="BeforeEntity",e[e.BeforeNumericEntity=26]="BeforeNumericEntity",e[e.InNamedEntity=27]="InNamedEntity",e[e.InNumericEntity=28]="InNumericEntity",e[e.InHexEntity=29]="InHexEntity"})(State||(State={}));function isWhitespace(e){return e===CharCodes.Space||e===CharCodes.NewLine||e===CharCodes.Tab||e===CharCodes.FormFeed||e===CharCodes.CarriageReturn}function isEndOfTagSection(e){return e===CharCodes.Slash||e===CharCodes.Gt||isWhitespace(e)}function isNumber(e){return e>=CharCodes.Zero&&e<=CharCodes.Nine}function isASCIIAlpha(e){return e>=CharCodes.LowerA&&e<=CharCodes.LowerZ||e>=CharCodes.UpperA&&e<=CharCodes.UpperZ}function isHexDigit(e){return e>=CharCodes.UpperA&&e<=CharCodes.UpperF||e>=CharCodes.LowerA&&e<=CharCodes.LowerF}var QuoteType;(function(e){e[e.NoValue=0]="NoValue",e[e.Unquoted=1]="Unquoted",e[e.Single=2]="Single",e[e.Double=3]="Double"})(QuoteType||(QuoteType={}));const Sequences={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])};class Tokenizer{constructor({xmlMode:t=!1,decodeEntities:s=!0},n){this.cbs=n,this.state=State.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=State.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=t,this.decodeEntities=s,this.entityTrie=t?xmlDecodeTree:htmlDecodeTree}reset(){this.state=State.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=State.Text,this.currentSequence=void 0,this.running=!0,this.offset=0}write(t){this.offset+=this.buffer.length,this.buffer=t,this.parse()}end(){this.running&&this.finish()}pause(){this.running=!1}resume(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()}getIndex(){return this.index}getSectionStart(){return this.sectionStart}stateText(t){t===CharCodes.Lt||!this.decodeEntities&&this.fastForwardTo(CharCodes.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=State.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&t===CharCodes.Amp&&(this.state=State.BeforeEntity)}stateSpecialStartSequence(t){const s=this.sequenceIndex===this.currentSequence.length;if(!(s?isEndOfTagSection(t):(t|32)===this.currentSequence[this.sequenceIndex]))this.isSpecial=!1;else if(!s){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=State.InTagName,this.stateInTagName(t)}stateInSpecialTag(t){if(this.sequenceIndex===this.currentSequence.length){if(t===CharCodes.Gt||isWhitespace(t)){const s=this.index-this.currentSequence.length;if(this.sectionStart<s){const n=this.index;this.index=s,this.cbs.ontext(this.sectionStart,s),this.index=n}this.isSpecial=!1,this.sectionStart=s+2,this.stateInClosingTagName(t);return}this.sequenceIndex=0}(t|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===Sequences.TitleEnd?this.decodeEntities&&t===CharCodes.Amp&&(this.state=State.BeforeEntity):this.fastForwardTo(CharCodes.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(t===CharCodes.Lt)}stateCDATASequence(t){t===Sequences.Cdata[this.sequenceIndex]?++this.sequenceIndex===Sequences.Cdata.length&&(this.state=State.InCommentLike,this.currentSequence=Sequences.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=State.InDeclaration,this.stateInDeclaration(t))}fastForwardTo(t){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===t)return!0;return this.index=this.buffer.length+this.offset-1,!1}stateInCommentLike(t){t===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===Sequences.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=State.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):t!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}isTagStartChar(t){return this.xmlMode?!isEndOfTagSection(t):isASCIIAlpha(t)}startSpecial(t,s){this.isSpecial=!0,this.currentSequence=t,this.sequenceIndex=s,this.state=State.SpecialStartSequence}stateBeforeTagName(t){if(t===CharCodes.ExclamationMark)this.state=State.BeforeDeclaration,this.sectionStart=this.index+1;else if(t===CharCodes.Questionmark)this.state=State.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(t)){const s=t|32;this.sectionStart=this.index,!this.xmlMode&&s===Sequences.TitleEnd[2]?this.startSpecial(Sequences.TitleEnd,3):this.state=!this.xmlMode&&s===Sequences.ScriptEnd[2]?State.BeforeSpecialS:State.InTagName}else t===CharCodes.Slash?this.state=State.BeforeClosingTagName:(this.state=State.Text,this.stateText(t))}stateInTagName(t){isEndOfTagSection(t)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateBeforeClosingTagName(t){isWhitespace(t)||(t===CharCodes.Gt?this.state=State.Text:(this.state=this.isTagStartChar(t)?State.InClosingTagName:State.InSpecialComment,this.sectionStart=this.index))}stateInClosingTagName(t){(t===CharCodes.Gt||isWhitespace(t))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=State.AfterClosingTagName,this.stateAfterClosingTagName(t))}stateAfterClosingTagName(t){(t===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.state=State.Text,this.baseState=State.Text,this.sectionStart=this.index+1)}stateBeforeAttributeName(t){t===CharCodes.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=State.InSpecialTag,this.sequenceIndex=0):this.state=State.Text,this.baseState=this.state,this.sectionStart=this.index+1):t===CharCodes.Slash?this.state=State.InSelfClosingTag:isWhitespace(t)||(this.state=State.InAttributeName,this.sectionStart=this.index)}stateInSelfClosingTag(t){t===CharCodes.Gt?(this.cbs.onselfclosingtag(this.index),this.state=State.Text,this.baseState=State.Text,this.sectionStart=this.index+1,this.isSpecial=!1):isWhitespace(t)||(this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateInAttributeName(t){(t===CharCodes.Eq||isEndOfTagSection(t))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=State.AfterAttributeName,this.stateAfterAttributeName(t))}stateAfterAttributeName(t){t===CharCodes.Eq?this.state=State.BeforeAttributeValue:t===CharCodes.Slash||t===CharCodes.Gt?(this.cbs.onattribend(QuoteType.NoValue,this.index),this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(t)):isWhitespace(t)||(this.cbs.onattribend(QuoteType.NoValue,this.index),this.state=State.InAttributeName,this.sectionStart=this.index)}stateBeforeAttributeValue(t){t===CharCodes.DoubleQuote?(this.state=State.InAttributeValueDq,this.sectionStart=this.index+1):t===CharCodes.SingleQuote?(this.state=State.InAttributeValueSq,this.sectionStart=this.index+1):isWhitespace(t)||(this.sectionStart=this.index,this.state=State.InAttributeValueNq,this.stateInAttributeValueNoQuotes(t))}handleInAttributeValue(t,s){t===s||!this.decodeEntities&&this.fastForwardTo(s)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(s===CharCodes.DoubleQuote?QuoteType.Double:QuoteType.Single,this.index),this.state=State.BeforeAttributeName):this.decodeEntities&&t===CharCodes.Amp&&(this.baseState=this.state,this.state=State.BeforeEntity)}stateInAttributeValueDoubleQuotes(t){this.handleInAttributeValue(t,CharCodes.DoubleQuote)}stateInAttributeValueSingleQuotes(t){this.handleInAttributeValue(t,CharCodes.SingleQuote)}stateInAttributeValueNoQuotes(t){isWhitespace(t)||t===CharCodes.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(QuoteType.Unquoted,this.index),this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(t)):this.decodeEntities&&t===CharCodes.Amp&&(this.baseState=this.state,this.state=State.BeforeEntity)}stateBeforeDeclaration(t){t===CharCodes.OpeningSquareBracket?(this.state=State.CDATASequence,this.sequenceIndex=0):this.state=t===CharCodes.Dash?State.BeforeComment:State.InDeclaration}stateInDeclaration(t){(t===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=State.Text,this.sectionStart=this.index+1)}stateInProcessingInstruction(t){(t===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=State.Text,this.sectionStart=this.index+1)}stateBeforeComment(t){t===CharCodes.Dash?(this.state=State.InCommentLike,this.currentSequence=Sequences.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=State.InDeclaration}stateInSpecialComment(t){(t===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=State.Text,this.sectionStart=this.index+1)}stateBeforeSpecialS(t){const s=t|32;s===Sequences.ScriptEnd[3]?this.startSpecial(Sequences.ScriptEnd,4):s===Sequences.StyleEnd[3]?this.startSpecial(Sequences.StyleEnd,4):(this.state=State.InTagName,this.stateInTagName(t))}stateBeforeEntity(t){this.entityExcess=1,this.entityResult=0,t===CharCodes.Number?this.state=State.BeforeNumericEntity:t===CharCodes.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=State.InNamedEntity,this.stateInNamedEntity(t))}stateInNamedEntity(t){if(this.entityExcess+=1,this.trieIndex=determineBranch(this.entityTrie,this.trieCurrent,this.trieIndex+1,t),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];const s=this.trieCurrent&BinTrieFlags.VALUE_LENGTH;if(s){const n=(s>>14)-1;if(!this.allowLegacyEntity()&&t!==CharCodes.Semi)this.trieIndex+=n;else{const i=this.index-this.entityExcess+1;i>this.sectionStart&&this.emitPartial(this.sectionStart,i),this.entityResult=this.trieIndex,this.trieIndex+=n,this.entityExcess=0,this.sectionStart=this.index+1,n===0&&this.emitNamedEntity()}}}emitNamedEntity(){if(this.state=this.baseState,this.entityResult===0)return;switch((this.entityTrie[this.entityResult]&BinTrieFlags.VALUE_LENGTH)>>14){case 1:{this.emitCodePoint(this.entityTrie[this.entityResult]&~BinTrieFlags.VALUE_LENGTH);break}case 2:{this.emitCodePoint(this.entityTrie[this.entityResult+1]);break}case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}stateBeforeNumericEntity(t){(t|32)===CharCodes.LowerX?(this.entityExcess++,this.state=State.InHexEntity):(this.state=State.InNumericEntity,this.stateInNumericEntity(t))}emitNumericEntity(t){const s=this.index-this.entityExcess-1;s+2+ +(this.state===State.InHexEntity)!==this.index&&(s>this.sectionStart&&this.emitPartial(this.sectionStart,s),this.sectionStart=this.index+Number(t),this.emitCodePoint(replaceCodePoint(this.entityResult))),this.state=this.baseState}stateInNumericEntity(t){t===CharCodes.Semi?this.emitNumericEntity(!0):isNumber(t)?(this.entityResult=this.entityResult*10+(t-CharCodes.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)}stateInHexEntity(t){t===CharCodes.Semi?this.emitNumericEntity(!0):isNumber(t)?(this.entityResult=this.entityResult*16+(t-CharCodes.Zero),this.entityExcess++):isHexDigit(t)?(this.entityResult=this.entityResult*16+((t|32)-CharCodes.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)}allowLegacyEntity(){return!this.xmlMode&&(this.baseState===State.Text||this.baseState===State.InSpecialTag)}cleanup(){this.running&&this.sectionStart!==this.index&&(this.state===State.Text||this.state===State.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===State.InAttributeValueDq||this.state===State.InAttributeValueSq||this.state===State.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}shouldContinue(){return this.index<this.buffer.length+this.offset&&this.running}parse(){for(;this.shouldContinue();){const t=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case State.Text:{this.stateText(t);break}case State.SpecialStartSequence:{this.stateSpecialStartSequence(t);break}case State.InSpecialTag:{this.stateInSpecialTag(t);break}case State.CDATASequence:{this.stateCDATASequence(t);break}case State.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(t);break}case State.InAttributeName:{this.stateInAttributeName(t);break}case State.InCommentLike:{this.stateInCommentLike(t);break}case State.InSpecialComment:{this.stateInSpecialComment(t);break}case State.BeforeAttributeName:{this.stateBeforeAttributeName(t);break}case State.InTagName:{this.stateInTagName(t);break}case State.InClosingTagName:{this.stateInClosingTagName(t);break}case State.BeforeTagName:{this.stateBeforeTagName(t);break}case State.AfterAttributeName:{this.stateAfterAttributeName(t);break}case State.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(t);break}case State.BeforeAttributeValue:{this.stateBeforeAttributeValue(t);break}case State.BeforeClosingTagName:{this.stateBeforeClosingTagName(t);break}case State.AfterClosingTagName:{this.stateAfterClosingTagName(t);break}case State.BeforeSpecialS:{this.stateBeforeSpecialS(t);break}case State.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(t);break}case State.InSelfClosingTag:{this.stateInSelfClosingTag(t);break}case State.InDeclaration:{this.stateInDeclaration(t);break}case State.BeforeDeclaration:{this.stateBeforeDeclaration(t);break}case State.BeforeComment:{this.stateBeforeComment(t);break}case State.InProcessingInstruction:{this.stateInProcessingInstruction(t);break}case State.InNamedEntity:{this.stateInNamedEntity(t);break}case State.BeforeEntity:{this.stateBeforeEntity(t);break}case State.InHexEntity:{this.stateInHexEntity(t);break}case State.InNumericEntity:{this.stateInNumericEntity(t);break}default:this.stateBeforeNumericEntity(t)}this.index++}this.cleanup()}finish(){this.state===State.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const t=this.buffer.length+this.offset;this.state===State.InCommentLike?this.currentSequence===Sequences.CdataEnd?this.cbs.oncdata(this.sectionStart,t,0):this.cbs.oncomment(this.sectionStart,t,0):this.state===State.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===State.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===State.InTagName||this.state===State.BeforeAttributeName||this.state===State.BeforeAttributeValue||this.state===State.AfterAttributeName||this.state===State.InAttributeName||this.state===State.InAttributeValueSq||this.state===State.InAttributeValueDq||this.state===State.InAttributeValueNq||this.state===State.InClosingTagName||this.cbs.ontext(this.sectionStart,t)}emitPartial(t,s){this.baseState!==State.Text&&this.baseState!==State.InSpecialTag?this.cbs.onattribdata(t,s):this.cbs.ontext(t,s)}emitCodePoint(t){this.baseState!==State.Text&&this.baseState!==State.InSpecialTag?this.cbs.onattribentity(t):this.cbs.ontextentity(t)}}const formTags=new Set(["input","option","optgroup","select","button","datalist","textarea"]),pTag=new Set(["p"]),tableSectionTags=new Set(["thead","tbody"]),ddtTags=new Set(["dd","dt"]),rtpTags=new Set(["rt","rp"]),openImpliesClose=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",pTag],["h1",pTag],["h2",pTag],["h3",pTag],["h4",pTag],["h5",pTag],["h6",pTag],["select",formTags],["input",formTags],["output",formTags],["button",formTags],["datalist",formTags],["textarea",formTags],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",ddtTags],["dt",ddtTags],["address",pTag],["article",pTag],["aside",pTag],["blockquote",pTag],["details",pTag],["div",pTag],["dl",pTag],["fieldset",pTag],["figcaption",pTag],["figure",pTag],["footer",pTag],["form",pTag],["header",pTag],["hr",pTag],["main",pTag],["nav",pTag],["ol",pTag],["pre",pTag],["section",pTag],["table",pTag],["ul",pTag],["rt",rtpTags],["rp",rtpTags],["tbody",tableSectionTags],["tfoot",tableSectionTags]]),voidElements$1=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),foreignContextElements=new Set(["math","svg"]),htmlIntegrationElements=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),reNameEnd=/\s|\//;class Parser{constructor(t,s={}){var n,i,r,d,f;this.options=s,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=t??{},this.lowerCaseTagNames=(n=s.lowerCaseTags)!==null&&n!==void 0?n:!s.xmlMode,this.lowerCaseAttributeNames=(i=s.lowerCaseAttributeNames)!==null&&i!==void 0?i:!s.xmlMode,this.tokenizer=new((r=s.Tokenizer)!==null&&r!==void 0?r:Tokenizer)(this.options,this),(f=(d=this.cbs).onparserinit)===null||f===void 0||f.call(d,this)}ontext(t,s){var n,i;const r=this.getSlice(t,s);this.endIndex=s-1,(i=(n=this.cbs).ontext)===null||i===void 0||i.call(n,r),this.startIndex=s}ontextentity(t){var s,n;const i=this.tokenizer.getSectionStart();this.endIndex=i-1,(n=(s=this.cbs).ontext)===null||n===void 0||n.call(s,fromCodePoint(t)),this.startIndex=i}isVoidElement(t){return!this.options.xmlMode&&voidElements$1.has(t)}onopentagname(t,s){this.endIndex=s;let n=this.getSlice(t,s);this.lowerCaseTagNames&&(n=n.toLowerCase()),this.emitOpenTag(n)}emitOpenTag(t){var s,n,i,r;this.openTagStart=this.startIndex,this.tagname=t;const d=!this.options.xmlMode&&openImpliesClose.get(t);if(d)for(;this.stack.length>0&&d.has(this.stack[this.stack.length-1]);){const f=this.stack.pop();(n=(s=this.cbs).onclosetag)===null||n===void 0||n.call(s,f,!0)}this.isVoidElement(t)||(this.stack.push(t),foreignContextElements.has(t)?this.foreignContext.push(!0):htmlIntegrationElements.has(t)&&this.foreignContext.push(!1)),(r=(i=this.cbs).onopentagname)===null||r===void 0||r.call(i,t),this.cbs.onopentag&&(this.attribs={})}endOpenTag(t){var s,n;this.startIndex=this.openTagStart,this.attribs&&((n=(s=this.cbs).onopentag)===null||n===void 0||n.call(s,this.tagname,this.attribs,t),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""}onopentagend(t){this.endIndex=t,this.endOpenTag(!1),this.startIndex=t+1}onclosetag(t,s){var n,i,r,d,f,m;this.endIndex=s;let u=this.getSlice(t,s);if(this.lowerCaseTagNames&&(u=u.toLowerCase()),(foreignContextElements.has(u)||htmlIntegrationElements.has(u))&&this.foreignContext.pop(),this.isVoidElement(u))!this.options.xmlMode&&u==="br"&&((i=(n=this.cbs).onopentagname)===null||i===void 0||i.call(n,"br"),(d=(r=this.cbs).onopentag)===null||d===void 0||d.call(r,"br",{},!0),(m=(f=this.cbs).onclosetag)===null||m===void 0||m.call(f,"br",!1));else{const a=this.stack.lastIndexOf(u);if(a!==-1)if(this.cbs.onclosetag){let c=this.stack.length-a;for(;c--;)this.cbs.onclosetag(this.stack.pop(),c!==0)}else this.stack.length=a;else!this.options.xmlMode&&u==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=s+1}onselfclosingtag(t){this.endIndex=t,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=t+1):this.onopentagend(t)}closeCurrentTag(t){var s,n;const i=this.tagname;this.endOpenTag(t),this.stack[this.stack.length-1]===i&&((n=(s=this.cbs).onclosetag)===null||n===void 0||n.call(s,i,!t),this.stack.pop())}onattribname(t,s){this.startIndex=t;const n=this.getSlice(t,s);this.attribname=this.lowerCaseAttributeNames?n.toLowerCase():n}onattribdata(t,s){this.attribvalue+=this.getSlice(t,s)}onattribentity(t){this.attribvalue+=fromCodePoint(t)}onattribend(t,s){var n,i;this.endIndex=s,(i=(n=this.cbs).onattribute)===null||i===void 0||i.call(n,this.attribname,this.attribvalue,t===QuoteType.Double?'"':t===QuoteType.Single?"'":t===QuoteType.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""}getInstructionName(t){const s=t.search(reNameEnd);let n=s<0?t:t.substr(0,s);return this.lowerCaseTagNames&&(n=n.toLowerCase()),n}ondeclaration(t,s){this.endIndex=s;const n=this.getSlice(t,s);if(this.cbs.onprocessinginstruction){const i=this.getInstructionName(n);this.cbs.onprocessinginstruction(`!${i}`,`!${n}`)}this.startIndex=s+1}onprocessinginstruction(t,s){this.endIndex=s;const n=this.getSlice(t,s);if(this.cbs.onprocessinginstruction){const i=this.getInstructionName(n);this.cbs.onprocessinginstruction(`?${i}`,`?${n}`)}this.startIndex=s+1}oncomment(t,s,n){var i,r,d,f;this.endIndex=s,(r=(i=this.cbs).oncomment)===null||r===void 0||r.call(i,this.getSlice(t,s-n)),(f=(d=this.cbs).oncommentend)===null||f===void 0||f.call(d),this.startIndex=s+1}oncdata(t,s,n){var i,r,d,f,m,u,a,c,T,p;this.endIndex=s;const h=this.getSlice(t,s-n);this.options.xmlMode||this.options.recognizeCDATA?((r=(i=this.cbs).oncdatastart)===null||r===void 0||r.call(i),(f=(d=this.cbs).ontext)===null||f===void 0||f.call(d,h),(u=(m=this.cbs).oncdataend)===null||u===void 0||u.call(m)):((c=(a=this.cbs).oncomment)===null||c===void 0||c.call(a,`[CDATA[${h}]]`),(p=(T=this.cbs).oncommentend)===null||p===void 0||p.call(T)),this.startIndex=s+1}onend(){var t,s;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(let n=this.stack.length;n>0;this.cbs.onclosetag(this.stack[--n],!0));}(s=(t=this.cbs).onend)===null||s===void 0||s.call(t)}reset(){var t,s,n,i;(s=(t=this.cbs).onreset)===null||s===void 0||s.call(t),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(i=(n=this.cbs).onparserinit)===null||i===void 0||i.call(n,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1}parseComplete(t){this.reset(),this.end(t)}getSlice(t,s){for(;t-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();let n=this.buffers[0].slice(t-this.bufferOffset,s-this.bufferOffset);for(;s-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),n+=this.buffers[0].slice(0,s-this.bufferOffset);return n}shiftBuffer(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()}write(t){var s,n;if(this.ended){(n=(s=this.cbs).onerror)===null||n===void 0||n.call(s,new Error(".write() after done!"));return}this.buffers.push(t),this.tokenizer.running&&(this.tokenizer.write(t),this.writeIndex++)}end(t){var s,n;if(this.ended){(n=(s=this.cbs).onerror)===null||n===void 0||n.call(s,new Error(".end() after done!"));return}t&&this.write(t),this.ended=!0,this.tokenizer.end()}pause(){this.tokenizer.pause()}resume(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()}parseChunk(t){this.write(t)}done(t){this.end(t)}}function parseDocument(e,t){const s=new DomHandler(void 0,t);return new Parser(s,t).end(e),s.root}const parse=getParse((e,t,s,n)=>t.xmlMode||t._useHtmlParser2?parseDocument(e,t):parseWithParse5(e,t,s,n)),load=getLoad(parse,(e,t)=>t.xmlMode||t._useHtmlParser2?render$1(e,t):renderWithParse5(e));load([]);function extend(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)s.hasOwnProperty(n)&&(e[n]=s[n])}return e}function repeat(e,t){return Array(t+1).join(e)}function trimLeadingNewlines(e){return e.replace(/^\n*/,"")}function trimTrailingNewlines(e){for(var t=e.length;t>0&&e[t-1]===`
`;)t--;return e.substring(0,t)}var blockElements=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function isBlock(e){return is(e,blockElements)}var voidElements=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function isVoid(e){return is(e,voidElements)}function hasVoid(e){return has(e,voidElements)}var meaningfulWhenBlankElements=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function isMeaningfulWhenBlank(e){return is(e,meaningfulWhenBlankElements)}function hasMeaningfulWhenBlank(e){return has(e,meaningfulWhenBlankElements)}function is(e,t){return t.indexOf(e.nodeName)>=0}function has(e,t){return e.getElementsByTagName&&t.some(function(s){return e.getElementsByTagName(s).length})}var rules={};rules.paragraph={filter:"p",replacement:function(e){return`

`+e+`

`}},rules.lineBreak={filter:"br",replacement:function(e,t,s){return s.br+`
`}},rules.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(e,t,s){var n=Number(t.nodeName.charAt(1));if(s.headingStyle==="setext"&&n<3){var i=repeat(n===1?"=":"-",e.length);return`

`+e+`
`+i+`

`}else return`

`+repeat("#",n)+" "+e+`

`}},rules.blockquote={filter:"blockquote",replacement:function(e){return e=e.replace(/^\n+|\n+$/g,""),e=e.replace(/^/gm,"> "),`

`+e+`

`}},rules.list={filter:["ul","ol"],replacement:function(e,t){var s=t.parentNode;return s.nodeName==="LI"&&s.lastElementChild===t?`
`+e:`

`+e+`

`}},rules.listItem={filter:"li",replacement:function(e,t,s){e=e.replace(/^\n+/,"").replace(/\n+$/,`
`).replace(/\n/gm,`
    `);var n=s.bulletListMarker+"   ",i=t.parentNode;if(i.nodeName==="OL"){var r=i.getAttribute("start"),d=Array.prototype.indexOf.call(i.children,t);n=(r?Number(r)+d:d+1)+".  "}return n+e+(t.nextSibling&&!/\n$/.test(e)?`
`:"")}},rules.indentedCodeBlock={filter:function(e,t){return t.codeBlockStyle==="indented"&&e.nodeName==="PRE"&&e.firstChild&&e.firstChild.nodeName==="CODE"},replacement:function(e,t,s){return`

    `+t.firstChild.textContent.replace(/\n/g,`
    `)+`

`}},rules.fencedCodeBlock={filter:function(e,t){return t.codeBlockStyle==="fenced"&&e.nodeName==="PRE"&&e.firstChild&&e.firstChild.nodeName==="CODE"},replacement:function(e,t,s){for(var n=t.firstChild.getAttribute("class")||"",i=(n.match(/language-(\S+)/)||[null,""])[1],r=t.firstChild.textContent,d=s.fence.charAt(0),f=3,m=new RegExp("^"+d+"{3,}","gm"),u;u=m.exec(r);)u[0].length>=f&&(f=u[0].length+1);var a=repeat(d,f);return`

`+a+i+`
`+r.replace(/\n$/,"")+`
`+a+`

`}},rules.horizontalRule={filter:"hr",replacement:function(e,t,s){return`

`+s.hr+`

`}},rules.inlineLink={filter:function(e,t){return t.linkStyle==="inlined"&&e.nodeName==="A"&&e.getAttribute("href")},replacement:function(e,t){var s=t.getAttribute("href"),n=cleanAttribute(t.getAttribute("title"));return n&&(n=' "'+n+'"'),"["+e+"]("+s+n+")"}},rules.referenceLink={filter:function(e,t){return t.linkStyle==="referenced"&&e.nodeName==="A"&&e.getAttribute("href")},replacement:function(e,t,s){var n=t.getAttribute("href"),i=cleanAttribute(t.getAttribute("title"));i&&(i=' "'+i+'"');var r,d;switch(s.linkReferenceStyle){case"collapsed":r="["+e+"][]",d="["+e+"]: "+n+i;break;case"shortcut":r="["+e+"]",d="["+e+"]: "+n+i;break;default:var f=this.references.length+1;r="["+e+"]["+f+"]",d="["+f+"]: "+n+i}return this.references.push(d),r},references:[],append:function(e){var t="";return this.references.length&&(t=`

`+this.references.join(`
`)+`

`,this.references=[]),t}},rules.emphasis={filter:["em","i"],replacement:function(e,t,s){return e.trim()?s.emDelimiter+e+s.emDelimiter:""}},rules.strong={filter:["strong","b"],replacement:function(e,t,s){return e.trim()?s.strongDelimiter+e+s.strongDelimiter:""}},rules.code={filter:function(e){var t=e.previousSibling||e.nextSibling,s=e.parentNode.nodeName==="PRE"&&!t;return e.nodeName==="CODE"&&!s},replacement:function(e){if(!e)return"";e=e.replace(/\r?\n|\r/g," ");for(var t=/^`|^ .*?[^ ].* $|`$/.test(e)?" ":"",s="`",n=e.match(/`+/gm)||[];n.indexOf(s)!==-1;)s=s+"`";return s+t+e+t+s}},rules.image={filter:"img",replacement:function(e,t){var s=cleanAttribute(t.getAttribute("alt")),n=t.getAttribute("src")||"",i=cleanAttribute(t.getAttribute("title")),r=i?' "'+i+'"':"";return n?"!["+s+"]("+n+r+")":""}};function cleanAttribute(e){return e?e.replace(/(\n+\s*)+/g,`
`):""}function Rules(e){this.options=e,this._keep=[],this._remove=[],this.blankRule={replacement:e.blankReplacement},this.keepReplacement=e.keepReplacement,this.defaultRule={replacement:e.defaultReplacement},this.array=[];for(var t in e.rules)this.array.push(e.rules[t])}Rules.prototype={add:function(e,t){this.array.unshift(t)},keep:function(e){this._keep.unshift({filter:e,replacement:this.keepReplacement})},remove:function(e){this._remove.unshift({filter:e,replacement:function(){return""}})},forNode:function(e){if(e.isBlank)return this.blankRule;var t;return(t=findRule(this.array,e,this.options))||(t=findRule(this._keep,e,this.options))||(t=findRule(this._remove,e,this.options))?t:this.defaultRule},forEach:function(e){for(var t=0;t<this.array.length;t++)e(this.array[t],t)}};function findRule(e,t,s){for(var n=0;n<e.length;n++){var i=e[n];if(filterValue(i,t,s))return i}}function filterValue(e,t,s){var n=e.filter;if(typeof n=="string"){if(n===t.nodeName.toLowerCase())return!0}else if(Array.isArray(n)){if(n.indexOf(t.nodeName.toLowerCase())>-1)return!0}else if(typeof n=="function"){if(n.call(e,t,s))return!0}else throw new TypeError("`filter` needs to be a string, array, or function")}function collapseWhitespace(e){var t=e.element,s=e.isBlock,n=e.isVoid,i=e.isPre||function(c){return c.nodeName==="PRE"};if(!(!t.firstChild||i(t))){for(var r=null,d=!1,f=null,m=next(f,t,i);m!==t;){if(m.nodeType===3||m.nodeType===4){var u=m.data.replace(/[ \r\n\t]+/g," ");if((!r||/ $/.test(r.data))&&!d&&u[0]===" "&&(u=u.substr(1)),!u){m=remove(m);continue}m.data=u,r=m}else if(m.nodeType===1)s(m)||m.nodeName==="BR"?(r&&(r.data=r.data.replace(/ $/,"")),r=null,d=!1):n(m)||i(m)?(r=null,d=!0):r&&(d=!1);else{m=remove(m);continue}var a=next(f,m,i);f=m,m=a}r&&(r.data=r.data.replace(/ $/,""),r.data||remove(r))}}function remove(e){var t=e.nextSibling||e.parentNode;return e.parentNode.removeChild(e),t}function next(e,t,s){return e&&e.parentNode===t||s(t)?t.nextSibling||t.parentNode:t.firstChild||t.nextSibling||t.parentNode}var root=typeof window<"u"?window:{};function canParseHTMLNatively(){var e=root.DOMParser,t=!1;try{new e().parseFromString("","text/html")&&(t=!0)}catch{}return t}function createHTMLParser(){var e=function(){};return shouldUseActiveX()?e.prototype.parseFromString=function(t){var s=new window.ActiveXObject("htmlfile");return s.designMode="on",s.open(),s.write(t),s.close(),s}:e.prototype.parseFromString=function(t){var s=document.implementation.createHTMLDocument("");return s.open(),s.write(t),s.close(),s},e}function shouldUseActiveX(){var e=!1;try{document.implementation.createHTMLDocument("").open()}catch{root.ActiveXObject&&(e=!0)}return e}var HTMLParser=canParseHTMLNatively()?root.DOMParser:createHTMLParser();function RootNode(e,t){var s;if(typeof e=="string"){var n=htmlParser().parseFromString('<x-turndown id="turndown-root">'+e+"</x-turndown>","text/html");s=n.getElementById("turndown-root")}else s=e.cloneNode(!0);return collapseWhitespace({element:s,isBlock,isVoid,isPre:t.preformattedCode?isPreOrCode:null}),s}var _htmlParser;function htmlParser(){return _htmlParser=_htmlParser||new HTMLParser,_htmlParser}function isPreOrCode(e){return e.nodeName==="PRE"||e.nodeName==="CODE"}function Node(e,t){return e.isBlock=isBlock(e),e.isCode=e.nodeName==="CODE"||e.parentNode.isCode,e.isBlank=isBlank(e),e.flankingWhitespace=flankingWhitespace(e,t),e}function isBlank(e){return!isVoid(e)&&!isMeaningfulWhenBlank(e)&&/^\s*$/i.test(e.textContent)&&!hasVoid(e)&&!hasMeaningfulWhenBlank(e)}function flankingWhitespace(e,t){if(e.isBlock||t.preformattedCode&&e.isCode)return{leading:"",trailing:""};var s=edgeWhitespace(e.textContent);return s.leadingAscii&&isFlankedByWhitespace("left",e,t)&&(s.leading=s.leadingNonAscii),s.trailingAscii&&isFlankedByWhitespace("right",e,t)&&(s.trailing=s.trailingNonAscii),{leading:s.leading,trailing:s.trailing}}function edgeWhitespace(e){var t=e.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:t[1],leadingAscii:t[2],leadingNonAscii:t[3],trailing:t[4],trailingNonAscii:t[5],trailingAscii:t[6]}}function isFlankedByWhitespace(e,t,s){var n,i,r;return e==="left"?(n=t.previousSibling,i=/ $/):(n=t.nextSibling,i=/^ /),n&&(n.nodeType===3?r=i.test(n.nodeValue):s.preformattedCode&&n.nodeName==="CODE"?r=!1:n.nodeType===1&&!isBlock(n)&&(r=i.test(n.textContent))),r}var reduce=Array.prototype.reduce,escapes=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function TurndownService(e){if(!(this instanceof TurndownService))return new TurndownService(e);var t={rules,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(s,n){return n.isBlock?`

`:""},keepReplacement:function(s,n){return n.isBlock?`

`+n.outerHTML+`

`:n.outerHTML},defaultReplacement:function(s,n){return n.isBlock?`

`+s+`

`:s}};this.options=extend({},t,e),this.rules=new Rules(this.options)}TurndownService.prototype={turndown:function(e){if(!canConvert(e))throw new TypeError(e+" is not a string, or an element/document/fragment node.");if(e==="")return"";var t=process$1.call(this,new RootNode(e,this.options));return postProcess.call(this,t)},use:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.use(e[t]);else if(typeof e=="function")e(this);else throw new TypeError("plugin must be a Function or an Array of Functions");return this},addRule:function(e,t){return this.rules.add(e,t),this},keep:function(e){return this.rules.keep(e),this},remove:function(e){return this.rules.remove(e),this},escape:function(e){return escapes.reduce(function(t,s){return t.replace(s[0],s[1])},e)}};function process$1(e){var t=this;return reduce.call(e.childNodes,function(s,n){n=new Node(n,t.options);var i="";return n.nodeType===3?i=n.isCode?n.nodeValue:t.escape(n.nodeValue):n.nodeType===1&&(i=replacementForNode.call(t,n)),join(s,i)},"")}function postProcess(e){var t=this;return this.rules.forEach(function(s){typeof s.append=="function"&&(e=join(e,s.append(t.options)))}),e.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function replacementForNode(e){var t=this.rules.forNode(e),s=process$1.call(this,e),n=e.flankingWhitespace;return(n.leading||n.trailing)&&(s=s.trim()),n.leading+t.replacement(s,e,this.options)+n.trailing}function join(e,t){var s=trimTrailingNewlines(e),n=trimLeadingNewlines(t),i=Math.max(e.length-s.length,t.length-n.length),r=`

`.substring(0,i);return s+r+n}function canConvert(e){return e!=null&&(typeof e=="string"||e.nodeType&&(e.nodeType===1||e.nodeType===9||e.nodeType===11))}var Readability$1={exports:{}};(function(e){function t(s,n){if(n&&n.documentElement)s=n,n=arguments[2];else if(!s||!s.documentElement)throw new Error("First argument to Readability constructor should be a document object.");if(n=n||{},this._doc=s,this._docJSDOMParser=this._doc.firstChild.__JSDOMParser__,this._articleTitle=null,this._articleByline=null,this._articleDir=null,this._articleSiteName=null,this._attempts=[],this._debug=!!n.debug,this._maxElemsToParse=n.maxElemsToParse||this.DEFAULT_MAX_ELEMS_TO_PARSE,this._nbTopCandidates=n.nbTopCandidates||this.DEFAULT_N_TOP_CANDIDATES,this._charThreshold=n.charThreshold||this.DEFAULT_CHAR_THRESHOLD,this._classesToPreserve=this.CLASSES_TO_PRESERVE.concat(n.classesToPreserve||[]),this._keepClasses=!!n.keepClasses,this._serializer=n.serializer||function(i){return i.innerHTML},this._disableJSONLD=!!n.disableJSONLD,this._allowedVideoRegex=n.allowedVideoRegex||this.REGEXPS.videos,this._flags=this.FLAG_STRIP_UNLIKELYS|this.FLAG_WEIGHT_CLASSES|this.FLAG_CLEAN_CONDITIONALLY,this._debug){let i=function(r){if(r.nodeType==r.TEXT_NODE)return`${r.nodeName} ("${r.textContent}")`;let d=Array.from(r.attributes||[],function(f){return`${f.name}="${f.value}"`}).join(" ");return`<${r.localName} ${d}>`};this.log=function(){if(typeof console<"u"){let d=Array.from(arguments,f=>f&&f.nodeType==this.ELEMENT_NODE?i(f):f);d.unshift("Reader: (Readability)"),console.log.apply(console,d)}else if(typeof dump<"u"){var r=Array.prototype.map.call(arguments,function(d){return d&&d.nodeName?i(d):d}).join(" ");dump("Reader: (Readability) "+r+`
`)}}}else this.log=function(){}}t.prototype={FLAG_STRIP_UNLIKELYS:1,FLAG_WEIGHT_CLASSES:2,FLAG_CLEAN_CONDITIONALLY:4,ELEMENT_NODE:1,TEXT_NODE:3,DEFAULT_MAX_ELEMS_TO_PARSE:0,DEFAULT_N_TOP_CANDIDATES:5,DEFAULT_TAGS_TO_SCORE:"section,h2,h3,h4,h5,h6,p,td,pre".toUpperCase().split(","),DEFAULT_CHAR_THRESHOLD:500,REGEXPS:{unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i,positive:/article|body|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story/i,negative:/-ad-|hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|foot|footer|footnote|gdpr|masthead|media|meta|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|tool|widget/i,extraneous:/print|archive|comment|discuss|e[\-]?mail|share|reply|all|login|sign|single|utility/i,byline:/byline|author|dateline|writtenby|p-author/i,replaceFonts:/<(\/?)font[^>]*>/gi,normalize:/\s{2,}/g,videos:/\/\/(www\.)?((dailymotion|youtube|youtube-nocookie|player\.vimeo|v\.qq)\.com|(archive|upload\.wikimedia)\.org|player\.twitch\.tv)/i,shareElements:/(\b|_)(share|sharedaddy)(\b|_)/i,nextLink:/(next|weiter|continue|>([^\|]|$)|»([^\|]|$))/i,prevLink:/(prev|earl|old|new|<|«)/i,tokenize:/\W+/g,whitespace:/^\s*$/,hasContent:/\S$/,hashUrl:/^#.+/,srcsetUrl:/(\S+)(\s+[\d.]+[xw])?(\s*(?:,|$))/g,b64DataUrl:/^data:\s*([^\s;,]+)\s*;\s*base64\s*,/i,commas:/\u002C|\u060C|\uFE50|\uFE10|\uFE11|\u2E41|\u2E34|\u2E32|\uFF0C/g,jsonLdArticleTypes:/^Article|AdvertiserContentArticle|NewsArticle|AnalysisNewsArticle|AskPublicNewsArticle|BackgroundNewsArticle|OpinionNewsArticle|ReportageNewsArticle|ReviewNewsArticle|Report|SatiricalArticle|ScholarlyArticle|MedicalScholarlyArticle|SocialMediaPosting|BlogPosting|LiveBlogPosting|DiscussionForumPosting|TechArticle|APIReference$/},UNLIKELY_ROLES:["menu","menubar","complementary","navigation","alert","alertdialog","dialog"],DIV_TO_P_ELEMS:new Set(["BLOCKQUOTE","DL","DIV","IMG","OL","P","PRE","TABLE","UL"]),ALTER_TO_DIV_EXCEPTIONS:["DIV","ARTICLE","SECTION","P"],PRESENTATIONAL_ATTRIBUTES:["align","background","bgcolor","border","cellpadding","cellspacing","frame","hspace","rules","style","valign","vspace"],DEPRECATED_SIZE_ATTRIBUTE_ELEMS:["TABLE","TH","TD","HR","PRE"],PHRASING_ELEMS:["ABBR","AUDIO","B","BDO","BR","BUTTON","CITE","CODE","DATA","DATALIST","DFN","EM","EMBED","I","IMG","INPUT","KBD","LABEL","MARK","MATH","METER","NOSCRIPT","OBJECT","OUTPUT","PROGRESS","Q","RUBY","SAMP","SCRIPT","SELECT","SMALL","SPAN","STRONG","SUB","SUP","TEXTAREA","TIME","VAR","WBR"],CLASSES_TO_PRESERVE:["page"],HTML_ESCAPE_MAP:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"},_postProcessContent:function(s){this._fixRelativeUris(s),this._simplifyNestedElements(s),this._keepClasses||this._cleanClasses(s)},_removeNodes:function(s,n){if(this._docJSDOMParser&&s._isLiveNodeList)throw new Error("Do not pass live node lists to _removeNodes");for(var i=s.length-1;i>=0;i--){var r=s[i],d=r.parentNode;d&&(!n||n.call(this,r,i,s))&&d.removeChild(r)}},_replaceNodeTags:function(s,n){if(this._docJSDOMParser&&s._isLiveNodeList)throw new Error("Do not pass live node lists to _replaceNodeTags");for(const i of s)this._setNodeTag(i,n)},_forEachNode:function(s,n){Array.prototype.forEach.call(s,n,this)},_findNode:function(s,n){return Array.prototype.find.call(s,n,this)},_someNode:function(s,n){return Array.prototype.some.call(s,n,this)},_everyNode:function(s,n){return Array.prototype.every.call(s,n,this)},_concatNodeLists:function(){var s=Array.prototype.slice,n=s.call(arguments),i=n.map(function(r){return s.call(r)});return Array.prototype.concat.apply([],i)},_getAllNodesWithTag:function(s,n){return s.querySelectorAll?s.querySelectorAll(n.join(",")):[].concat.apply([],n.map(function(i){var r=s.getElementsByTagName(i);return Array.isArray(r)?r:Array.from(r)}))},_cleanClasses:function(s){var n=this._classesToPreserve,i=(s.getAttribute("class")||"").split(/\s+/).filter(function(r){return n.indexOf(r)!=-1}).join(" ");for(i?s.setAttribute("class",i):s.removeAttribute("class"),s=s.firstElementChild;s;s=s.nextElementSibling)this._cleanClasses(s)},_fixRelativeUris:function(s){var n=this._doc.baseURI,i=this._doc.documentURI;function r(m){if(n==i&&m.charAt(0)=="#")return m;try{return new URL(m,n).href}catch{}return m}var d=this._getAllNodesWithTag(s,["a"]);this._forEachNode(d,function(m){var u=m.getAttribute("href");if(u)if(u.indexOf("javascript:")===0)if(m.childNodes.length===1&&m.childNodes[0].nodeType===this.TEXT_NODE){var a=this._doc.createTextNode(m.textContent);m.parentNode.replaceChild(a,m)}else{for(var c=this._doc.createElement("span");m.firstChild;)c.appendChild(m.firstChild);m.parentNode.replaceChild(c,m)}else m.setAttribute("href",r(u))});var f=this._getAllNodesWithTag(s,["img","picture","figure","video","audio","source"]);this._forEachNode(f,function(m){var u=m.getAttribute("src"),a=m.getAttribute("poster"),c=m.getAttribute("srcset");if(u&&m.setAttribute("src",r(u)),a&&m.setAttribute("poster",r(a)),c){var T=c.replace(this.REGEXPS.srcsetUrl,function(p,h,_,I){return r(h)+(_||"")+I});m.setAttribute("srcset",T)}})},_simplifyNestedElements:function(s){for(var n=s;n;){if(n.parentNode&&["DIV","SECTION"].includes(n.tagName)&&!(n.id&&n.id.startsWith("readability"))){if(this._isElementWithoutContent(n)){n=this._removeAndGetNext(n);continue}else if(this._hasSingleTagInsideElement(n,"DIV")||this._hasSingleTagInsideElement(n,"SECTION")){for(var i=n.children[0],r=0;r<n.attributes.length;r++)i.setAttribute(n.attributes[r].name,n.attributes[r].value);n.parentNode.replaceChild(i,n),n=i;continue}}n=this._getNextNode(n)}},_getArticleTitle:function(){var s=this._doc,n="",i="";try{n=i=s.title.trim(),typeof n!="string"&&(n=i=this._getInnerText(s.getElementsByTagName("title")[0]))}catch{}var r=!1;function d(T){return T.split(/\s+/).length}if(/ [\|\-\\\/>»] /.test(n))r=/ [\\\/>»] /.test(n),n=i.replace(/(.*)[\|\-\\\/>»] .*/gi,"$1"),d(n)<3&&(n=i.replace(/[^\|\-\\\/>»]*[\|\-\\\/>»](.*)/gi,"$1"));else if(n.indexOf(": ")!==-1){var f=this._concatNodeLists(s.getElementsByTagName("h1"),s.getElementsByTagName("h2")),m=n.trim(),u=this._someNode(f,function(T){return T.textContent.trim()===m});u||(n=i.substring(i.lastIndexOf(":")+1),d(n)<3?n=i.substring(i.indexOf(":")+1):d(i.substr(0,i.indexOf(":")))>5&&(n=i))}else if(n.length>150||n.length<15){var a=s.getElementsByTagName("h1");a.length===1&&(n=this._getInnerText(a[0]))}n=n.trim().replace(this.REGEXPS.normalize," ");var c=d(n);return c<=4&&(!r||c!=d(i.replace(/[\|\-\\\/>»]+/g,""))-1)&&(n=i),n},_prepDocument:function(){var s=this._doc;this._removeNodes(this._getAllNodesWithTag(s,["style"])),s.body&&this._replaceBrs(s.body),this._replaceNodeTags(this._getAllNodesWithTag(s,["font"]),"SPAN")},_nextNode:function(s){for(var n=s;n&&n.nodeType!=this.ELEMENT_NODE&&this.REGEXPS.whitespace.test(n.textContent);)n=n.nextSibling;return n},_replaceBrs:function(s){this._forEachNode(this._getAllNodesWithTag(s,["br"]),function(n){for(var i=n.nextSibling,r=!1;(i=this._nextNode(i))&&i.tagName=="BR";){r=!0;var d=i.nextSibling;i.parentNode.removeChild(i),i=d}if(r){var f=this._doc.createElement("p");for(n.parentNode.replaceChild(f,n),i=f.nextSibling;i;){if(i.tagName=="BR"){var m=this._nextNode(i.nextSibling);if(m&&m.tagName=="BR")break}if(!this._isPhrasingContent(i))break;var u=i.nextSibling;f.appendChild(i),i=u}for(;f.lastChild&&this._isWhitespace(f.lastChild);)f.removeChild(f.lastChild);f.parentNode.tagName==="P"&&this._setNodeTag(f.parentNode,"DIV")}})},_setNodeTag:function(s,n){if(this.log("_setNodeTag",s,n),this._docJSDOMParser)return s.localName=n.toLowerCase(),s.tagName=n.toUpperCase(),s;for(var i=s.ownerDocument.createElement(n);s.firstChild;)i.appendChild(s.firstChild);s.parentNode.replaceChild(i,s),s.readability&&(i.readability=s.readability);for(var r=0;r<s.attributes.length;r++)try{i.setAttribute(s.attributes[r].name,s.attributes[r].value)}catch{}return i},_prepArticle:function(s){this._cleanStyles(s),this._markDataTables(s),this._fixLazyImages(s),this._cleanConditionally(s,"form"),this._cleanConditionally(s,"fieldset"),this._clean(s,"object"),this._clean(s,"embed"),this._clean(s,"footer"),this._clean(s,"link"),this._clean(s,"aside");var n=this.DEFAULT_CHAR_THRESHOLD;this._forEachNode(s.children,function(i){this._cleanMatchedNodes(i,function(r,d){return this.REGEXPS.shareElements.test(d)&&r.textContent.length<n})}),this._clean(s,"iframe"),this._clean(s,"input"),this._clean(s,"textarea"),this._clean(s,"select"),this._clean(s,"button"),this._cleanHeaders(s),this._cleanConditionally(s,"table"),this._cleanConditionally(s,"ul"),this._cleanConditionally(s,"div"),this._replaceNodeTags(this._getAllNodesWithTag(s,["h1"]),"h2"),this._removeNodes(this._getAllNodesWithTag(s,["p"]),function(i){var r=i.getElementsByTagName("img").length,d=i.getElementsByTagName("embed").length,f=i.getElementsByTagName("object").length,m=i.getElementsByTagName("iframe").length,u=r+d+f+m;return u===0&&!this._getInnerText(i,!1)}),this._forEachNode(this._getAllNodesWithTag(s,["br"]),function(i){var r=this._nextNode(i.nextSibling);r&&r.tagName=="P"&&i.parentNode.removeChild(i)}),this._forEachNode(this._getAllNodesWithTag(s,["table"]),function(i){var r=this._hasSingleTagInsideElement(i,"TBODY")?i.firstElementChild:i;if(this._hasSingleTagInsideElement(r,"TR")){var d=r.firstElementChild;if(this._hasSingleTagInsideElement(d,"TD")){var f=d.firstElementChild;f=this._setNodeTag(f,this._everyNode(f.childNodes,this._isPhrasingContent)?"P":"DIV"),i.parentNode.replaceChild(f,i)}}})},_initializeNode:function(s){switch(s.readability={contentScore:0},s.tagName){case"DIV":s.readability.contentScore+=5;break;case"PRE":case"TD":case"BLOCKQUOTE":s.readability.contentScore+=3;break;case"ADDRESS":case"OL":case"UL":case"DL":case"DD":case"DT":case"LI":case"FORM":s.readability.contentScore-=3;break;case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"TH":s.readability.contentScore-=5;break}s.readability.contentScore+=this._getClassWeight(s)},_removeAndGetNext:function(s){var n=this._getNextNode(s,!0);return s.parentNode.removeChild(s),n},_getNextNode:function(s,n){if(!n&&s.firstElementChild)return s.firstElementChild;if(s.nextElementSibling)return s.nextElementSibling;do s=s.parentNode;while(s&&!s.nextElementSibling);return s&&s.nextElementSibling},_textSimilarity:function(s,n){var i=s.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean),r=n.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean);if(!i.length||!r.length)return 0;var d=r.filter(m=>!i.includes(m)),f=d.join(" ").length/r.join(" ").length;return 1-f},_checkByline:function(s,n){if(this._articleByline)return!1;if(s.getAttribute!==void 0)var i=s.getAttribute("rel"),r=s.getAttribute("itemprop");return(i==="author"||r&&r.indexOf("author")!==-1||this.REGEXPS.byline.test(n))&&this._isValidByline(s.textContent)?(this._articleByline=s.textContent.trim(),!0):!1},_getNodeAncestors:function(s,n){n=n||0;for(var i=0,r=[];s.parentNode&&(r.push(s.parentNode),!(n&&++i===n));)s=s.parentNode;return r},_grabArticle:function(s){this.log("**** grabArticle ****");var n=this._doc,i=s!==null;if(s=s||this._doc.body,!s)return this.log("No body found in document. Abort."),null;for(var r=s.innerHTML;;){this.log("Starting grabArticle loop");var d=this._flagIsActive(this.FLAG_STRIP_UNLIKELYS),f=[],m=this._doc.documentElement;let j=!0;for(;m;){m.tagName==="HTML"&&(this._articleLang=m.getAttribute("lang"));var u=m.className+" "+m.id;if(!this._isProbablyVisible(m)){this.log("Removing hidden node - "+u),m=this._removeAndGetNext(m);continue}if(m.getAttribute("aria-modal")=="true"&&m.getAttribute("role")=="dialog"){m=this._removeAndGetNext(m);continue}if(this._checkByline(m,u)){m=this._removeAndGetNext(m);continue}if(j&&this._headerDuplicatesTitle(m)){this.log("Removing header: ",m.textContent.trim(),this._articleTitle.trim()),j=!1,m=this._removeAndGetNext(m);continue}if(d){if(this.REGEXPS.unlikelyCandidates.test(u)&&!this.REGEXPS.okMaybeItsACandidate.test(u)&&!this._hasAncestorTag(m,"table")&&!this._hasAncestorTag(m,"code")&&m.tagName!=="BODY"&&m.tagName!=="A"){this.log("Removing unlikely candidate - "+u),m=this._removeAndGetNext(m);continue}if(this.UNLIKELY_ROLES.includes(m.getAttribute("role"))){this.log("Removing content with role "+m.getAttribute("role")+" - "+u),m=this._removeAndGetNext(m);continue}}if((m.tagName==="DIV"||m.tagName==="SECTION"||m.tagName==="HEADER"||m.tagName==="H1"||m.tagName==="H2"||m.tagName==="H3"||m.tagName==="H4"||m.tagName==="H5"||m.tagName==="H6")&&this._isElementWithoutContent(m)){m=this._removeAndGetNext(m);continue}if(this.DEFAULT_TAGS_TO_SCORE.indexOf(m.tagName)!==-1&&f.push(m),m.tagName==="DIV"){for(var a=null,c=m.firstChild;c;){var T=c.nextSibling;if(this._isPhrasingContent(c))a!==null?a.appendChild(c):this._isWhitespace(c)||(a=n.createElement("p"),m.replaceChild(a,c),a.appendChild(c));else if(a!==null){for(;a.lastChild&&this._isWhitespace(a.lastChild);)a.removeChild(a.lastChild);a=null}c=T}if(this._hasSingleTagInsideElement(m,"P")&&this._getLinkDensity(m)<.25){var p=m.children[0];m.parentNode.replaceChild(p,m),m=p,f.push(m)}else this._hasChildBlockElement(m)||(m=this._setNodeTag(m,"P"),f.push(m))}m=this._getNextNode(m)}var h=[];this._forEachNode(f,function(K){if(!(!K.parentNode||typeof K.parentNode.tagName>"u")){var ue=this._getInnerText(K);if(!(ue.length<25)){var Q=this._getNodeAncestors(K,5);if(Q.length!==0){var Z=0;Z+=1,Z+=ue.split(this.REGEXPS.commas).length,Z+=Math.min(Math.floor(ue.length/100),3),this._forEachNode(Q,function(ee,se){if(!(!ee.tagName||!ee.parentNode||typeof ee.parentNode.tagName>"u")){if(typeof ee.readability>"u"&&(this._initializeNode(ee),h.push(ee)),se===0)var re=1;else se===1?re=2:re=se*3;ee.readability.contentScore+=Z/re}})}}}});for(var _=[],I=0,A=h.length;I<A;I+=1){var O=h[I],w=O.readability.contentScore*(1-this._getLinkDensity(O));O.readability.contentScore=w,this.log("Candidate:",O,"with score "+w);for(var P=0;P<this._nbTopCandidates;P++){var C=_[P];if(!C||w>C.readability.contentScore){_.splice(P,0,O),_.length>this._nbTopCandidates&&_.pop();break}}}var y=_[0]||null,F=!1,H;if(y===null||y.tagName==="BODY"){for(y=n.createElement("DIV"),F=!0;s.firstChild;)this.log("Moving child out:",s.firstChild),y.appendChild(s.firstChild);s.appendChild(y),this._initializeNode(y)}else if(y){for(var U=[],Y=1;Y<_.length;Y++)_[Y].readability.contentScore/y.readability.contentScore>=.75&&U.push(this._getNodeAncestors(_[Y]));var V=3;if(U.length>=V)for(H=y.parentNode;H.tagName!=="BODY";){for(var ie=0,J=0;J<U.length&&ie<V;J++)ie+=Number(U[J].includes(H));if(ie>=V){y=H;break}H=H.parentNode}y.readability||this._initializeNode(y),H=y.parentNode;for(var ne=y.readability.contentScore,ae=ne/3;H.tagName!=="BODY";){if(!H.readability){H=H.parentNode;continue}var te=H.readability.contentScore;if(te<ae)break;if(te>ne){y=H;break}ne=H.readability.contentScore,H=H.parentNode}for(H=y.parentNode;H.tagName!="BODY"&&H.children.length==1;)y=H,H=y.parentNode;y.readability||this._initializeNode(y)}var G=n.createElement("DIV");i&&(G.id="readability-content");var N=Math.max(10,y.readability.contentScore*.2);H=y.parentNode;for(var b=H.children,S=0,R=b.length;S<R;S++){var L=b[S],B=!1;if(this.log("Looking at sibling node:",L,L.readability?"with score "+L.readability.contentScore:""),this.log("Sibling has score",L.readability?L.readability.contentScore:"Unknown"),L===y)B=!0;else{var W=0;if(L.className===y.className&&y.className!==""&&(W+=y.readability.contentScore*.2),L.readability&&L.readability.contentScore+W>=N)B=!0;else if(L.nodeName==="P"){var M=this._getLinkDensity(L),E=this._getInnerText(L),D=E.length;(D>80&&M<.25||D<80&&D>0&&M===0&&E.search(/\.( |$)/)!==-1)&&(B=!0)}}B&&(this.log("Appending node:",L),this.ALTER_TO_DIV_EXCEPTIONS.indexOf(L.nodeName)===-1&&(this.log("Altering sibling:",L,"to div."),L=this._setNodeTag(L,"DIV")),G.appendChild(L),b=H.children,S-=1,R-=1)}if(this._debug&&this.log("Article content pre-prep: "+G.innerHTML),this._prepArticle(G),this._debug&&this.log("Article content post-prep: "+G.innerHTML),F)y.id="readability-page-1",y.className="page";else{var x=n.createElement("DIV");for(x.id="readability-page-1",x.className="page";G.firstChild;)x.appendChild(G.firstChild);G.appendChild(x)}this._debug&&this.log("Article content after paging: "+G.innerHTML);var v=!0,k=this._getInnerText(G,!0).length;if(k<this._charThreshold)if(v=!1,s.innerHTML=r,this._flagIsActive(this.FLAG_STRIP_UNLIKELYS))this._removeFlag(this.FLAG_STRIP_UNLIKELYS),this._attempts.push({articleContent:G,textLength:k});else if(this._flagIsActive(this.FLAG_WEIGHT_CLASSES))this._removeFlag(this.FLAG_WEIGHT_CLASSES),this._attempts.push({articleContent:G,textLength:k});else if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY))this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY),this._attempts.push({articleContent:G,textLength:k});else{if(this._attempts.push({articleContent:G,textLength:k}),this._attempts.sort(function(K,ue){return ue.textLength-K.textLength}),!this._attempts[0].textLength)return null;G=this._attempts[0].articleContent,v=!0}if(v){var q=[H,y].concat(this._getNodeAncestors(H));return this._someNode(q,function(K){if(!K.tagName)return!1;var ue=K.getAttribute("dir");return ue?(this._articleDir=ue,!0):!1}),G}}},_isValidByline:function(s){return typeof s=="string"||s instanceof String?(s=s.trim(),s.length>0&&s.length<100):!1},_unescapeHtmlEntities:function(s){if(!s)return s;var n=this.HTML_ESCAPE_MAP;return s.replace(/&(quot|amp|apos|lt|gt);/g,function(i,r){return n[r]}).replace(/&#(?:x([0-9a-z]{1,4})|([0-9]{1,4}));/gi,function(i,r,d){var f=parseInt(r||d,r?16:10);return String.fromCharCode(f)})},_getJSONLD:function(s){var n=this._getAllNodesWithTag(s,["script"]),i;return this._forEachNode(n,function(r){if(!i&&r.getAttribute("type")==="application/ld+json")try{var d=r.textContent.replace(/^\s*<!\[CDATA\[|\]\]>\s*$/g,""),f=JSON.parse(d);if(!f["@context"]||!f["@context"].match(/^https?\:\/\/schema\.org$/)||(!f["@type"]&&Array.isArray(f["@graph"])&&(f=f["@graph"].find(function(c){return(c["@type"]||"").match(this.REGEXPS.jsonLdArticleTypes)})),!f||!f["@type"]||!f["@type"].match(this.REGEXPS.jsonLdArticleTypes)))return;if(i={},typeof f.name=="string"&&typeof f.headline=="string"&&f.name!==f.headline){var m=this._getArticleTitle(),u=this._textSimilarity(f.name,m)>.75,a=this._textSimilarity(f.headline,m)>.75;a&&!u?i.title=f.headline:i.title=f.name}else typeof f.name=="string"?i.title=f.name.trim():typeof f.headline=="string"&&(i.title=f.headline.trim());f.author&&(typeof f.author.name=="string"?i.byline=f.author.name.trim():Array.isArray(f.author)&&f.author[0]&&typeof f.author[0].name=="string"&&(i.byline=f.author.filter(function(c){return c&&typeof c.name=="string"}).map(function(c){return c.name.trim()}).join(", "))),typeof f.description=="string"&&(i.excerpt=f.description.trim()),f.publisher&&typeof f.publisher.name=="string"&&(i.siteName=f.publisher.name.trim()),typeof f.datePublished=="string"&&(i.datePublished=f.datePublished.trim());return}catch(c){this.log(c.message)}}),i||{}},_getArticleMetadata:function(s){var n={},i={},r=this._doc.getElementsByTagName("meta"),d=/\s*(article|dc|dcterm|og|twitter)\s*:\s*(author|creator|description|published_time|title|site_name)\s*/gi,f=/^\s*(?:(dc|dcterm|og|twitter|weibo:(article|webpage))\s*[\.:]\s*)?(author|creator|description|title|site_name)\s*$/i;return this._forEachNode(r,function(m){var u=m.getAttribute("name"),a=m.getAttribute("property"),c=m.getAttribute("content");if(c){var T=null,p=null;a&&(T=a.match(d),T&&(p=T[0].toLowerCase().replace(/\s/g,""),i[p]=c.trim())),!T&&u&&f.test(u)&&(p=u,c&&(p=p.toLowerCase().replace(/\s/g,"").replace(/\./g,":"),i[p]=c.trim()))}}),n.title=s.title||i["dc:title"]||i["dcterm:title"]||i["og:title"]||i["weibo:article:title"]||i["weibo:webpage:title"]||i.title||i["twitter:title"],n.title||(n.title=this._getArticleTitle()),n.byline=s.byline||i["dc:creator"]||i["dcterm:creator"]||i.author,n.excerpt=s.excerpt||i["dc:description"]||i["dcterm:description"]||i["og:description"]||i["weibo:article:description"]||i["weibo:webpage:description"]||i.description||i["twitter:description"],n.siteName=s.siteName||i["og:site_name"],n.publishedTime=s.datePublished||i["article:published_time"]||null,n.title=this._unescapeHtmlEntities(n.title),n.byline=this._unescapeHtmlEntities(n.byline),n.excerpt=this._unescapeHtmlEntities(n.excerpt),n.siteName=this._unescapeHtmlEntities(n.siteName),n.publishedTime=this._unescapeHtmlEntities(n.publishedTime),n},_isSingleImage:function(s){return s.tagName==="IMG"?!0:s.children.length!==1||s.textContent.trim()!==""?!1:this._isSingleImage(s.children[0])},_unwrapNoscriptImages:function(s){var n=Array.from(s.getElementsByTagName("img"));this._forEachNode(n,function(r){for(var d=0;d<r.attributes.length;d++){var f=r.attributes[d];switch(f.name){case"src":case"srcset":case"data-src":case"data-srcset":return}if(/\.(jpg|jpeg|png|webp)/i.test(f.value))return}r.parentNode.removeChild(r)});var i=Array.from(s.getElementsByTagName("noscript"));this._forEachNode(i,function(r){var d=s.createElement("div");if(d.innerHTML=r.innerHTML,!!this._isSingleImage(d)){var f=r.previousElementSibling;if(f&&this._isSingleImage(f)){var m=f;m.tagName!=="IMG"&&(m=f.getElementsByTagName("img")[0]);for(var u=d.getElementsByTagName("img")[0],a=0;a<m.attributes.length;a++){var c=m.attributes[a];if(c.value!==""&&(c.name==="src"||c.name==="srcset"||/\.(jpg|jpeg|png|webp)/i.test(c.value))){if(u.getAttribute(c.name)===c.value)continue;var T=c.name;u.hasAttribute(T)&&(T="data-old-"+T),u.setAttribute(T,c.value)}}r.parentNode.replaceChild(d.firstElementChild,f)}}})},_removeScripts:function(s){this._removeNodes(this._getAllNodesWithTag(s,["script","noscript"]))},_hasSingleTagInsideElement:function(s,n){return s.children.length!=1||s.children[0].tagName!==n?!1:!this._someNode(s.childNodes,function(i){return i.nodeType===this.TEXT_NODE&&this.REGEXPS.hasContent.test(i.textContent)})},_isElementWithoutContent:function(s){return s.nodeType===this.ELEMENT_NODE&&s.textContent.trim().length==0&&(s.children.length==0||s.children.length==s.getElementsByTagName("br").length+s.getElementsByTagName("hr").length)},_hasChildBlockElement:function(s){return this._someNode(s.childNodes,function(n){return this.DIV_TO_P_ELEMS.has(n.tagName)||this._hasChildBlockElement(n)})},_isPhrasingContent:function(s){return s.nodeType===this.TEXT_NODE||this.PHRASING_ELEMS.indexOf(s.tagName)!==-1||(s.tagName==="A"||s.tagName==="DEL"||s.tagName==="INS")&&this._everyNode(s.childNodes,this._isPhrasingContent)},_isWhitespace:function(s){return s.nodeType===this.TEXT_NODE&&s.textContent.trim().length===0||s.nodeType===this.ELEMENT_NODE&&s.tagName==="BR"},_getInnerText:function(s,n){n=typeof n>"u"?!0:n;var i=s.textContent.trim();return n?i.replace(this.REGEXPS.normalize," "):i},_getCharCount:function(s,n){return n=n||",",this._getInnerText(s).split(n).length-1},_cleanStyles:function(s){if(!(!s||s.tagName.toLowerCase()==="svg")){for(var n=0;n<this.PRESENTATIONAL_ATTRIBUTES.length;n++)s.removeAttribute(this.PRESENTATIONAL_ATTRIBUTES[n]);this.DEPRECATED_SIZE_ATTRIBUTE_ELEMS.indexOf(s.tagName)!==-1&&(s.removeAttribute("width"),s.removeAttribute("height"));for(var i=s.firstElementChild;i!==null;)this._cleanStyles(i),i=i.nextElementSibling}},_getLinkDensity:function(s){var n=this._getInnerText(s).length;if(n===0)return 0;var i=0;return this._forEachNode(s.getElementsByTagName("a"),function(r){var d=r.getAttribute("href"),f=d&&this.REGEXPS.hashUrl.test(d)?.3:1;i+=this._getInnerText(r).length*f}),i/n},_getClassWeight:function(s){if(!this._flagIsActive(this.FLAG_WEIGHT_CLASSES))return 0;var n=0;return typeof s.className=="string"&&s.className!==""&&(this.REGEXPS.negative.test(s.className)&&(n-=25),this.REGEXPS.positive.test(s.className)&&(n+=25)),typeof s.id=="string"&&s.id!==""&&(this.REGEXPS.negative.test(s.id)&&(n-=25),this.REGEXPS.positive.test(s.id)&&(n+=25)),n},_clean:function(s,n){var i=["object","embed","iframe"].indexOf(n)!==-1;this._removeNodes(this._getAllNodesWithTag(s,[n]),function(r){if(i){for(var d=0;d<r.attributes.length;d++)if(this._allowedVideoRegex.test(r.attributes[d].value))return!1;if(r.tagName==="object"&&this._allowedVideoRegex.test(r.innerHTML))return!1}return!0})},_hasAncestorTag:function(s,n,i,r){i=i||3,n=n.toUpperCase();for(var d=0;s.parentNode;){if(i>0&&d>i)return!1;if(s.parentNode.tagName===n&&(!r||r(s.parentNode)))return!0;s=s.parentNode,d++}return!1},_getRowAndColumnCount:function(s){for(var n=0,i=0,r=s.getElementsByTagName("tr"),d=0;d<r.length;d++){var f=r[d].getAttribute("rowspan")||0;f&&(f=parseInt(f,10)),n+=f||1;for(var m=0,u=r[d].getElementsByTagName("td"),a=0;a<u.length;a++){var c=u[a].getAttribute("colspan")||0;c&&(c=parseInt(c,10)),m+=c||1}i=Math.max(i,m)}return{rows:n,columns:i}},_markDataTables:function(s){for(var n=s.getElementsByTagName("table"),i=0;i<n.length;i++){var r=n[i],d=r.getAttribute("role");if(d=="presentation"){r._readabilityDataTable=!1;continue}var f=r.getAttribute("datatable");if(f=="0"){r._readabilityDataTable=!1;continue}var m=r.getAttribute("summary");if(m){r._readabilityDataTable=!0;continue}var u=r.getElementsByTagName("caption")[0];if(u&&u.childNodes.length>0){r._readabilityDataTable=!0;continue}var a=["col","colgroup","tfoot","thead","th"],c=function(p){return!!r.getElementsByTagName(p)[0]};if(a.some(c)){this.log("Data table because found data-y descendant"),r._readabilityDataTable=!0;continue}if(r.getElementsByTagName("table")[0]){r._readabilityDataTable=!1;continue}var T=this._getRowAndColumnCount(r);if(T.rows>=10||T.columns>4){r._readabilityDataTable=!0;continue}r._readabilityDataTable=T.rows*T.columns>10}},_fixLazyImages:function(s){this._forEachNode(this._getAllNodesWithTag(s,["img","picture","figure"]),function(n){if(n.src&&this.REGEXPS.b64DataUrl.test(n.src)){var i=this.REGEXPS.b64DataUrl.exec(n.src);if(i[1]==="image/svg+xml")return;for(var r=!1,d=0;d<n.attributes.length;d++){var f=n.attributes[d];if(f.name!=="src"&&/\.(jpg|jpeg|png|webp)/i.test(f.value)){r=!0;break}}if(r){var m=n.src.search(/base64\s*/i)+7,u=n.src.length-m;u<133&&n.removeAttribute("src")}}if(!((n.src||n.srcset&&n.srcset!="null")&&n.className.toLowerCase().indexOf("lazy")===-1)){for(var a=0;a<n.attributes.length;a++)if(f=n.attributes[a],!(f.name==="src"||f.name==="srcset"||f.name==="alt")){var c=null;if(/\.(jpg|jpeg|png|webp)\s+\d/.test(f.value)?c="srcset":/^\s*\S+\.(jpg|jpeg|png|webp)\S*\s*$/.test(f.value)&&(c="src"),c){if(n.tagName==="IMG"||n.tagName==="PICTURE")n.setAttribute(c,f.value);else if(n.tagName==="FIGURE"&&!this._getAllNodesWithTag(n,["img","picture"]).length){var T=this._doc.createElement("img");T.setAttribute(c,f.value),n.appendChild(T)}}}}})},_getTextDensity:function(s,n){var i=this._getInnerText(s,!0).length;if(i===0)return 0;var r=0,d=this._getAllNodesWithTag(s,n);return this._forEachNode(d,f=>r+=this._getInnerText(f,!0).length),r/i},_cleanConditionally:function(s,n){this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)&&this._removeNodes(this._getAllNodesWithTag(s,[n]),function(i){var r=function(H){return H._readabilityDataTable},d=n==="ul"||n==="ol";if(!d){var f=0,m=this._getAllNodesWithTag(i,["ul","ol"]);this._forEachNode(m,H=>f+=this._getInnerText(H).length),d=f/this._getInnerText(i).length>.9}if(n==="table"&&r(i)||this._hasAncestorTag(i,"table",-1,r)||this._hasAncestorTag(i,"code"))return!1;var u=this._getClassWeight(i);this.log("Cleaning Conditionally",i);var a=0;if(u+a<0)return!0;if(this._getCharCount(i,",")<10){for(var c=i.getElementsByTagName("p").length,T=i.getElementsByTagName("img").length,p=i.getElementsByTagName("li").length-100,h=i.getElementsByTagName("input").length,_=this._getTextDensity(i,["h1","h2","h3","h4","h5","h6"]),I=0,A=this._getAllNodesWithTag(i,["object","embed","iframe"]),O=0;O<A.length;O++){for(var w=0;w<A[O].attributes.length;w++)if(this._allowedVideoRegex.test(A[O].attributes[w].value))return!1;if(A[O].tagName==="object"&&this._allowedVideoRegex.test(A[O].innerHTML))return!1;I++}var P=this._getLinkDensity(i),C=this._getInnerText(i).length,y=T>1&&c/T<.5&&!this._hasAncestorTag(i,"figure")||!d&&p>c||h>Math.floor(c/3)||!d&&_<.9&&C<25&&(T===0||T>2)&&!this._hasAncestorTag(i,"figure")||!d&&u<25&&P>.2||u>=25&&P>.5||I===1&&C<75||I>1;if(d&&y){for(var F=0;F<i.children.length;F++)if(i.children[F].children.length>1)return y;let H=i.getElementsByTagName("li").length;if(T==H)return!1}return y}return!1})},_cleanMatchedNodes:function(s,n){for(var i=this._getNextNode(s,!0),r=this._getNextNode(s);r&&r!=i;)n.call(this,r,r.className+" "+r.id)?r=this._removeAndGetNext(r):r=this._getNextNode(r)},_cleanHeaders:function(s){let n=this._getAllNodesWithTag(s,["h1","h2"]);this._removeNodes(n,function(i){let r=this._getClassWeight(i)<0;return r&&this.log("Removing header with low class weight:",i),r})},_headerDuplicatesTitle:function(s){if(s.tagName!="H1"&&s.tagName!="H2")return!1;var n=this._getInnerText(s,!1);return this.log("Evaluating similarity of header:",n,this._articleTitle),this._textSimilarity(this._articleTitle,n)>.75},_flagIsActive:function(s){return(this._flags&s)>0},_removeFlag:function(s){this._flags=this._flags&~s},_isProbablyVisible:function(s){return(!s.style||s.style.display!="none")&&(!s.style||s.style.visibility!="hidden")&&!s.hasAttribute("hidden")&&(!s.hasAttribute("aria-hidden")||s.getAttribute("aria-hidden")!="true"||s.className&&s.className.indexOf&&s.className.indexOf("fallback-image")!==-1)},parse:function(){if(this._maxElemsToParse>0){var s=this._doc.getElementsByTagName("*").length;if(s>this._maxElemsToParse)throw new Error("Aborting parsing document; "+s+" elements found")}this._unwrapNoscriptImages(this._doc);var n=this._disableJSONLD?{}:this._getJSONLD(this._doc);this._removeScripts(this._doc),this._prepDocument();var i=this._getArticleMetadata(n);this._articleTitle=i.title;var r=this._grabArticle();if(!r)return null;if(this.log("Grabbed: "+r.innerHTML),this._postProcessContent(r),!i.excerpt){var d=r.getElementsByTagName("p");d.length>0&&(i.excerpt=d[0].textContent.trim())}var f=r.textContent;return{title:this._articleTitle,byline:i.byline||this._articleByline,dir:this._articleDir,lang:this._articleLang,content:this._serializer(r),textContent:f,length:f.length,excerpt:i.excerpt,siteName:i.siteName||this._articleSiteName,publishedTime:i.publishedTime}}},e.exports=t})(Readability$1);var ReadabilityExports=Readability$1.exports,ReadabilityReaderable={exports:{}};(function(e){var t={unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i};function s(i){return(!i.style||i.style.display!="none")&&!i.hasAttribute("hidden")&&(!i.hasAttribute("aria-hidden")||i.getAttribute("aria-hidden")!="true"||i.className&&i.className.indexOf&&i.className.indexOf("fallback-image")!==-1)}function n(i,r={}){typeof r=="function"&&(r={visibilityChecker:r});var d={minScore:20,minContentLength:140,visibilityChecker:s};r=Object.assign(d,r);var f=i.querySelectorAll("p, pre, article"),m=i.querySelectorAll("div > br");if(m.length){var u=new Set(f);[].forEach.call(m,function(c){u.add(c.parentNode)}),f=Array.from(u)}var a=0;return[].some.call(f,function(c){if(!r.visibilityChecker(c))return!1;var T=c.className+" "+c.id;if(t.unlikelyCandidates.test(T)&&!t.okMaybeItsACandidate.test(T)||c.matches("li p"))return!1;var p=c.textContent.trim().length;return p<r.minContentLength?!1:(a+=Math.sqrt(p-r.minContentLength),a>r.minScore)})}e.exports=n})(ReadabilityReaderable);var ReadabilityReaderableExports=ReadabilityReaderable.exports,Readability=ReadabilityExports,isProbablyReaderable=ReadabilityReaderableExports,readability={Readability,isProbablyReaderable};class SimpleDocument{content;$=null;constructor(t){this.content=t,this.$=load(t)}querySelector(t){return this.$.root().find(t).get(0)}querySelectorAll(t){return this.$.root().find(t).get()}getElementsByTagName(t){return this.$.root().find(t).get()}get documentElement(){return{getAttribute:t=>null,getBoundingClientRect:()=>({width:1024,height:768}),className:"",tagName:"HTML"}}get body(){return this.$.root().find("body").get(0)||{}}get head(){return this.$.root().find("head").get(0)||{}}get title(){return this.$.root().find("title").text()||""}get location(){return{href:""}}get documentURI(){return""}get baseURI(){return""}createTreeWalker(){return{currentNode:null,nextNode:()=>null}}createNodeIterator(){return{nextNode:()=>null}}createElement(t){return{tagName:t}}}const defaultExtractContent=e=>{logger$1.debug("开始提取页面内容");try{const t=load(e);try{logger$1.debug("尝试使用 Readability 解析页面");const r=new SimpleDocument(e);if(readability.isProbablyReaderable(r)){logger$1.debug("页面可能适合 Readability 解析");const f=new readability.Readability(r).parse();if(f&&f.content){logger$1.debug("Readability 成功解析页面",{title:f.title,contentLength:f.content.length});const m=load(f.content);m("script, style, link, svg, [src^='data:image/']").remove(),f.content=m.html()||"";const a=new TurndownService({headingStyle:"atx",codeBlockStyle:"fenced"}).turndown(f.content).trim();return logger$1.debug("成功转换为 Markdown",{markdownLength:a.length}),a}}}catch(r){logger$1.warn("Readability 解析失败，将使用备用方法",r)}logger$1.debug("使用备用方法提取内容"),t("script, style, link, svg, [src^='data:image/']").remove(),t("*").each((r,d)=>{if("attribs"in d){const f=d.attribs;for(const m in f)m!=="href"&&m!=="src"&&t(d).removeAttr(m)}});const s=t('[role="main"]').html()||t("main").html()||t("body").html()||"",i=new TurndownService({headingStyle:"atx",codeBlockStyle:"fenced"}).turndown(s).trim();return logger$1.debug("成功转换为 Markdown（备用方法）",{markdownLength:i.length}),i}catch(t){return logger$1.error("提取页面内容失败",t),"无法提取页面内容。错误: "+(t instanceof Error?t.message:String(t))}};function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf$1={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports){(function(t,s){module.exports=t.pdfjsLib=s()})(globalThis,()=>(()=>{var __webpack_modules__=[,(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VerbosityLevel=t.Util=t.UnknownErrorException=t.UnexpectedResponseException=t.TextRenderingMode=t.RenderingIntentFlag=t.PromiseCapability=t.PermissionFlag=t.PasswordResponses=t.PasswordException=t.PageActionEventType=t.OPS=t.MissingPDFException=t.MAX_IMAGE_SIZE_TO_CACHE=t.LINE_FACTOR=t.LINE_DESCENT_FACTOR=t.InvalidPDFException=t.ImageKind=t.IDENTITY_MATRIX=t.FormatError=t.FeatureTest=t.FONT_IDENTITY_MATRIX=t.DocumentActionEventType=t.CMapCompressionType=t.BaseException=t.BASELINE_FACTOR=t.AnnotationType=t.AnnotationReplyType=t.AnnotationPrefix=t.AnnotationMode=t.AnnotationFlag=t.AnnotationFieldFlag=t.AnnotationEditorType=t.AnnotationEditorPrefix=t.AnnotationEditorParamsType=t.AnnotationBorderStyleType=t.AnnotationActionEventType=t.AbortException=void 0,t.assert=b,t.bytesToString=q,t.createValidAbsoluteUrl=R,t.getModificationDate=_e,t.getUuid=He,t.getVerbosityLevel=ae,t.info=te,t.isArrayBuffer=pe,t.isArrayEqual=Ie,t.isNodeJS=void 0,t.normalizeUnicode=Fe,t.objectFromMap=Q,t.objectSize=ue,t.setVerbosityLevel=ne,t.shadow=L,t.string32=K,t.stringToBytes=j,t.stringToPDFString=de,t.stringToUTF8String=fe,t.unreachable=N,t.utf8StringToString=ge,t.warn=G;const s=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");t.isNodeJS=s;const n=[1,0,0,1,0,0];t.IDENTITY_MATRIX=n;const i=[.001,0,0,.001,0,0];t.FONT_IDENTITY_MATRIX=i;const r=1e7;t.MAX_IMAGE_SIZE_TO_CACHE=r;const d=1.35;t.LINE_FACTOR=d;const f=.35;t.LINE_DESCENT_FACTOR=f;const m=f/d;t.BASELINE_FACTOR=m;const u={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};t.RenderingIntentFlag=u;const a={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};t.AnnotationMode=a;const c="pdfjs_internal_editor_";t.AnnotationEditorPrefix=c;const T={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};t.AnnotationEditorType=T;const p={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};t.AnnotationEditorParamsType=p;const h={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};t.PermissionFlag=h;const _={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};t.TextRenderingMode=_;const I={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};t.ImageKind=I;const A={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};t.AnnotationType=A;const O={GROUP:"Group",REPLY:"R"};t.AnnotationReplyType=O;const w={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};t.AnnotationFlag=w;const P={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};t.AnnotationFieldFlag=P;const C={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};t.AnnotationBorderStyleType=C;const y={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};t.AnnotationActionEventType=y;const F={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};t.DocumentActionEventType=F;const H={O:"PageOpen",C:"PageClose"};t.PageActionEventType=H;const U={ERRORS:0,WARNINGS:1,INFOS:5};t.VerbosityLevel=U;const Y={NONE:0,BINARY:1};t.CMapCompressionType=Y;const V={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};t.OPS=V;const ie={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};t.PasswordResponses=ie;let J=U.WARNINGS;function ne(oe){Number.isInteger(oe)&&(J=oe)}function ae(){return J}function te(oe){J>=U.INFOS&&console.log(`Info: ${oe}`)}function G(oe){J>=U.WARNINGS&&console.log(`Warning: ${oe}`)}function N(oe){throw new Error(oe)}function b(oe,z){oe||N(z)}function S(oe){switch(oe?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function R(oe,z=null,X=null){if(!oe)return null;try{if(X&&typeof oe=="string"&&(X.addDefaultProtocol&&oe.startsWith("www.")&&oe.match(/\./g)?.length>=2&&(oe=`http://${oe}`),X.tryConvertEncoding))try{oe=fe(oe)}catch{}const le=z?new URL(oe,z):new URL(oe);if(S(le))return le}catch{}return null}function L(oe,z,X,le=!1){return Object.defineProperty(oe,z,{value:X,enumerable:!le,configurable:!0,writable:!1}),X}const B=function(){function z(X,le){this.constructor===z&&N("Cannot initialize BaseException."),this.message=X,this.name=le}return z.prototype=new Error,z.constructor=z,z}();t.BaseException=B;class W extends B{constructor(z,X){super(z,"PasswordException"),this.code=X}}t.PasswordException=W;class M extends B{constructor(z,X){super(z,"UnknownErrorException"),this.details=X}}t.UnknownErrorException=M;class E extends B{constructor(z){super(z,"InvalidPDFException")}}t.InvalidPDFException=E;class D extends B{constructor(z){super(z,"MissingPDFException")}}t.MissingPDFException=D;class x extends B{constructor(z,X){super(z,"UnexpectedResponseException"),this.status=X}}t.UnexpectedResponseException=x;class v extends B{constructor(z){super(z,"FormatError")}}t.FormatError=v;class k extends B{constructor(z){super(z,"AbortException")}}t.AbortException=k;function q(oe){(typeof oe!="object"||oe?.length===void 0)&&N("Invalid argument for bytesToString");const z=oe.length,X=8192;if(z<X)return String.fromCharCode.apply(null,oe);const le=[];for(let me=0;me<z;me+=X){const Ee=Math.min(me+X,z),Ae=oe.subarray(me,Ee);le.push(String.fromCharCode.apply(null,Ae))}return le.join("")}function j(oe){typeof oe!="string"&&N("Invalid argument for stringToBytes");const z=oe.length,X=new Uint8Array(z);for(let le=0;le<z;++le)X[le]=oe.charCodeAt(le)&255;return X}function K(oe){return String.fromCharCode(oe>>24&255,oe>>16&255,oe>>8&255,oe&255)}function ue(oe){return Object.keys(oe).length}function Q(oe){const z=Object.create(null);for(const[X,le]of oe)z[X]=le;return z}function Z(){const oe=new Uint8Array(4);return oe[0]=1,new Uint32Array(oe.buffer,0,1)[0]===1}function ee(){try{return new Function(""),!0}catch{return!1}}class se{static get isLittleEndian(){return L(this,"isLittleEndian",Z())}static get isEvalSupported(){return L(this,"isEvalSupported",ee())}static get isOffscreenCanvasSupported(){return L(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?L(this,"platform",{isWin:!1,isMac:!1}):L(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){return L(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}t.FeatureTest=se;const re=[...Array(256).keys()].map(oe=>oe.toString(16).padStart(2,"0"));class ce{static makeHexColor(z,X,le){return`#${re[z]}${re[X]}${re[le]}`}static scaleMinMax(z,X){let le;z[0]?(z[0]<0&&(le=X[0],X[0]=X[1],X[1]=le),X[0]*=z[0],X[1]*=z[0],z[3]<0&&(le=X[2],X[2]=X[3],X[3]=le),X[2]*=z[3],X[3]*=z[3]):(le=X[0],X[0]=X[2],X[2]=le,le=X[1],X[1]=X[3],X[3]=le,z[1]<0&&(le=X[2],X[2]=X[3],X[3]=le),X[2]*=z[1],X[3]*=z[1],z[2]<0&&(le=X[0],X[0]=X[1],X[1]=le),X[0]*=z[2],X[1]*=z[2]),X[0]+=z[4],X[1]+=z[4],X[2]+=z[5],X[3]+=z[5]}static transform(z,X){return[z[0]*X[0]+z[2]*X[1],z[1]*X[0]+z[3]*X[1],z[0]*X[2]+z[2]*X[3],z[1]*X[2]+z[3]*X[3],z[0]*X[4]+z[2]*X[5]+z[4],z[1]*X[4]+z[3]*X[5]+z[5]]}static applyTransform(z,X){const le=z[0]*X[0]+z[1]*X[2]+X[4],me=z[0]*X[1]+z[1]*X[3]+X[5];return[le,me]}static applyInverseTransform(z,X){const le=X[0]*X[3]-X[1]*X[2],me=(z[0]*X[3]-z[1]*X[2]+X[2]*X[5]-X[4]*X[3])/le,Ee=(-z[0]*X[1]+z[1]*X[0]+X[4]*X[1]-X[5]*X[0])/le;return[me,Ee]}static getAxialAlignedBoundingBox(z,X){const le=this.applyTransform(z,X),me=this.applyTransform(z.slice(2,4),X),Ee=this.applyTransform([z[0],z[3]],X),Ae=this.applyTransform([z[2],z[1]],X);return[Math.min(le[0],me[0],Ee[0],Ae[0]),Math.min(le[1],me[1],Ee[1],Ae[1]),Math.max(le[0],me[0],Ee[0],Ae[0]),Math.max(le[1],me[1],Ee[1],Ae[1])]}static inverseTransform(z){const X=z[0]*z[3]-z[1]*z[2];return[z[3]/X,-z[1]/X,-z[2]/X,z[0]/X,(z[2]*z[5]-z[4]*z[3])/X,(z[4]*z[1]-z[5]*z[0])/X]}static singularValueDecompose2dScale(z){const X=[z[0],z[2],z[1],z[3]],le=z[0]*X[0]+z[1]*X[2],me=z[0]*X[1]+z[1]*X[3],Ee=z[2]*X[0]+z[3]*X[2],Ae=z[2]*X[1]+z[3]*X[3],Oe=(le+Ae)/2,xe=Math.sqrt((le+Ae)**2-4*(le*Ae-Ee*me))/2,Ne=Oe+xe||1,Se=Oe-xe||1;return[Math.sqrt(Ne),Math.sqrt(Se)]}static normalizeRect(z){const X=z.slice(0);return z[0]>z[2]&&(X[0]=z[2],X[2]=z[0]),z[1]>z[3]&&(X[1]=z[3],X[3]=z[1]),X}static intersect(z,X){const le=Math.max(Math.min(z[0],z[2]),Math.min(X[0],X[2])),me=Math.min(Math.max(z[0],z[2]),Math.max(X[0],X[2]));if(le>me)return null;const Ee=Math.max(Math.min(z[1],z[3]),Math.min(X[1],X[3])),Ae=Math.min(Math.max(z[1],z[3]),Math.max(X[1],X[3]));return Ee>Ae?null:[le,Ee,me,Ae]}static bezierBoundingBox(z,X,le,me,Ee,Ae,Oe,xe){const Ne=[],Se=[[],[]];let Pe,De,Le,Te,we,ke,Be,Ge;for(let Ue=0;Ue<2;++Ue){if(Ue===0?(De=6*z-12*le+6*Ee,Pe=-3*z+9*le-9*Ee+3*Oe,Le=3*le-3*z):(De=6*X-12*me+6*Ae,Pe=-3*X+9*me-9*Ae+3*xe,Le=3*me-3*X),Math.abs(Pe)<1e-12){if(Math.abs(De)<1e-12)continue;Te=-Le/De,0<Te&&Te<1&&Ne.push(Te);continue}Be=De*De-4*Le*Pe,Ge=Math.sqrt(Be),!(Be<0)&&(we=(-De+Ge)/(2*Pe),0<we&&we<1&&Ne.push(we),ke=(-De-Ge)/(2*Pe),0<ke&&ke<1&&Ne.push(ke))}let ve=Ne.length,Ce;const Me=ve;for(;ve--;)Te=Ne[ve],Ce=1-Te,Se[0][ve]=Ce*Ce*Ce*z+3*Ce*Ce*Te*le+3*Ce*Te*Te*Ee+Te*Te*Te*Oe,Se[1][ve]=Ce*Ce*Ce*X+3*Ce*Ce*Te*me+3*Ce*Te*Te*Ae+Te*Te*Te*xe;return Se[0][Me]=z,Se[1][Me]=X,Se[0][Me+1]=Oe,Se[1][Me+1]=xe,Se[0].length=Se[1].length=Me+2,[Math.min(...Se[0]),Math.min(...Se[1]),Math.max(...Se[0]),Math.max(...Se[1])]}}t.Util=ce;const he=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function de(oe){if(oe[0]>="ï"){let X;if(oe[0]==="þ"&&oe[1]==="ÿ"?X="utf-16be":oe[0]==="ÿ"&&oe[1]==="þ"?X="utf-16le":oe[0]==="ï"&&oe[1]==="»"&&oe[2]==="¿"&&(X="utf-8"),X)try{const le=new TextDecoder(X,{fatal:!0}),me=j(oe);return le.decode(me)}catch(le){G(`stringToPDFString: "${le}".`)}}const z=[];for(let X=0,le=oe.length;X<le;X++){const me=he[oe.charCodeAt(X)];z.push(me?String.fromCharCode(me):oe.charAt(X))}return z.join("")}function fe(oe){return decodeURIComponent(escape(oe))}function ge(oe){return unescape(encodeURIComponent(oe))}function pe(oe){return typeof oe=="object"&&oe?.byteLength!==void 0}function Ie(oe,z){if(oe.length!==z.length)return!1;for(let X=0,le=oe.length;X<le;X++)if(oe[X]!==z[X])return!1;return!0}function _e(oe=new Date){return[oe.getUTCFullYear().toString(),(oe.getUTCMonth()+1).toString().padStart(2,"0"),oe.getUTCDate().toString().padStart(2,"0"),oe.getUTCHours().toString().padStart(2,"0"),oe.getUTCMinutes().toString().padStart(2,"0"),oe.getUTCSeconds().toString().padStart(2,"0")].join("")}class Re{#e=!1;constructor(){this.promise=new Promise((z,X)=>{this.resolve=le=>{this.#e=!0,z(le)},this.reject=le=>{this.#e=!0,X(le)}})}get settled(){return this.#e}}t.PromiseCapability=Re;let be=null,ye=null;function Fe(oe){return be||(be=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,ye=new Map([["ﬅ","ſt"]])),oe.replaceAll(be,(z,X,le)=>X?X.normalize("NFKC"):ye.get(le))}function He(){if(typeof crypto<"u"&&typeof crypto?.randomUUID=="function")return crypto.randomUUID();const oe=new Uint8Array(32);if(typeof crypto<"u"&&typeof crypto?.getRandomValues=="function")crypto.getRandomValues(oe);else for(let z=0;z<32;z++)oe[z]=Math.floor(Math.random()*255);return q(oe)}const $e="pdfjs_internal_id_";t.AnnotationPrefix=$e},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports.build=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(e){if(typeof e=="string"||e instanceof URL?e={url:e}:(0,_util.isArrayBuffer)(e)&&(e={data:e}),typeof e!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!e.url&&!e.data&&!e.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const t=new PDFDocumentLoadingTask,{docId:s}=t,n=e.url?getUrlProp(e.url):null,i=e.data?getDataProp(e.data):null,r=e.httpHeaders||null,d=e.withCredentials===!0,f=e.password??null,m=e.range instanceof PDFDataRangeTransport?e.range:null,u=Number.isInteger(e.rangeChunkSize)&&e.rangeChunkSize>0?e.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let a=e.worker instanceof PDFWorker?e.worker:null;const c=e.verbosity,T=typeof e.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(e.docBaseUrl)?e.docBaseUrl:null,p=typeof e.cMapUrl=="string"?e.cMapUrl:null,h=e.cMapPacked!==!1,_=e.CMapReaderFactory||DefaultCMapReaderFactory,I=typeof e.standardFontDataUrl=="string"?e.standardFontDataUrl:null,A=e.StandardFontDataFactory||DefaultStandardFontDataFactory,O=e.stopAtErrors!==!0,w=Number.isInteger(e.maxImageSize)&&e.maxImageSize>-1?e.maxImageSize:-1,P=e.isEvalSupported!==!1,C=typeof e.isOffscreenCanvasSupported=="boolean"?e.isOffscreenCanvasSupported:!_util.isNodeJS,y=Number.isInteger(e.canvasMaxAreaInBytes)?e.canvasMaxAreaInBytes:-1,F=typeof e.disableFontFace=="boolean"?e.disableFontFace:_util.isNodeJS,H=e.fontExtraProperties===!0,U=e.enableXfa===!0,Y=e.ownerDocument||globalThis.document,V=e.disableRange===!0,ie=e.disableStream===!0,J=e.disableAutoFetch===!0,ne=e.pdfBug===!0,ae=m?m.length:e.length??NaN,te=typeof e.useSystemFonts=="boolean"?e.useSystemFonts:!_util.isNodeJS&&!F,G=typeof e.useWorkerFetch=="boolean"?e.useWorkerFetch:_===_display_utils.DOMCMapReaderFactory&&A===_display_utils.DOMStandardFontDataFactory&&p&&I&&(0,_display_utils.isValidFetchUrl)(p,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(I,document.baseURI),N=e.canvasFactory||new DefaultCanvasFactory({ownerDocument:Y}),b=e.filterFactory||new DefaultFilterFactory({docId:s,ownerDocument:Y}),S=null;(0,_util.setVerbosityLevel)(c);const R={canvasFactory:N,filterFactory:b};if(G||(R.cMapReaderFactory=new _({baseUrl:p,isCompressed:h}),R.standardFontDataFactory=new A({baseUrl:I})),!a){const W={verbosity:c,port:_worker_options.GlobalWorkerOptions.workerPort};a=W.port?PDFWorker.fromPort(W):new PDFWorker(W),t._worker=a}const L={docId:s,apiVersion:"3.11.174",data:i,password:f,disableAutoFetch:J,rangeChunkSize:u,length:ae,docBaseUrl:T,enableXfa:U,evaluatorOptions:{maxImageSize:w,disableFontFace:F,ignoreErrors:O,isEvalSupported:P,isOffscreenCanvasSupported:C,canvasMaxAreaInBytes:y,fontExtraProperties:H,useSystemFonts:te,cMapUrl:G?p:null,standardFontDataUrl:G?I:null}},B={ignoreErrors:O,isEvalSupported:P,disableFontFace:F,fontExtraProperties:H,enableXfa:U,ownerDocument:Y,disableAutoFetch:J,pdfBug:ne,styleElement:S};return a.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");const W=_fetchDocument(a,L),M=new Promise(function(E){let D;m?D=new _transport_stream.PDFDataTransportStream({length:ae,initialData:m.initialData,progressiveDone:m.progressiveDone,contentDispositionFilename:m.contentDispositionFilename,disableRange:V,disableStream:ie},m):i||(D=(v=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(v):(0,_display_utils.isValidFetchUrl)(v.url)?new _displayFetch_stream.PDFFetchStream(v):new _displayNetwork.PDFNetworkStream(v))({url:n,length:ae,httpHeaders:r,withCredentials:d,rangeChunkSize:u,disableRange:V,disableStream:ie})),E(D)});return Promise.all([W,M]).then(function([E,D]){if(t.destroyed)throw new Error("Loading aborted");const x=new _message_handler.MessageHandler(s,E,a.port),v=new WorkerTransport(x,t,D,B,R);t._transport=v,x.send("Ready",null)})}).catch(t._capability.reject),t}async function _fetchDocument(e,t){if(e.destroyed)throw new Error("Worker was destroyed");const s=await e.messageHandler.sendWithPromise("GetDocRequest",t,t.data?[t.data.buffer]:null);if(e.destroyed)throw new Error("Worker was destroyed");return s}function getUrlProp(e){if(e instanceof URL)return e.href;try{return new URL(e,window.location).href}catch{if(_util.isNodeJS&&typeof e=="string")return e}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(e){if(_util.isNodeJS&&typeof Buffer<"u"&&e instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength)return e;if(typeof e=="string")return(0,_util.stringToBytes)(e);if(typeof e=="object"&&!isNaN(e?.length)||(0,_util.isArrayBuffer)(e))return new Uint8Array(e);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}class PDFDocumentLoadingTask{static#e=0;constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${PDFDocumentLoadingTask.#e++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(t,s,n=!1,i=null){this.length=t,this.initialData=s,this.progressiveDone=n,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,s){for(const n of this._rangeListeners)n(t,s)}onDataProgress(t,s){this._readyCapability.promise.then(()=>{for(const n of this._progressListeners)n(t,s)})}onDataProgressiveRead(t){this._readyCapability.promise.then(()=>{for(const s of this._progressiveReadListeners)s(t)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const t of this._progressiveDoneListeners)t()})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,s){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(t,s){this._pdfInfo=t,this._transport=s,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(n=>{if(!n)return n;const i=[];for(const r in n)i.push(...n[r]);return i}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{#e=null;#t=!1;constructor(t,s,n,i=!1){this._pageIndex=t,this._pageInfo=s,this._transport=n,this._stats=i?new _display_utils.StatTimer:null,this._pdfBug=i,this.commonObjs=n.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:s=this.rotate,offsetX:n=0,offsetY:i=0,dontFlip:r=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:t,rotation:s,offsetX:n,offsetY:i,dontFlip:r})}getAnnotations({intent:t="display"}={}){const s=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,s.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,viewport:s,intent:n="display",annotationMode:i=_util.AnnotationMode.ENABLE,transform:r=null,background:d=null,optionalContentConfigPromise:f=null,annotationCanvasMap:m=null,pageColors:u=null,printAnnotationStorage:a=null}){this._stats?.time("Overall");const c=this._transport.getRenderingIntent(n,i,a);this.#t=!1,this.#n(),f||(f=this._transport.getOptionalContentConfig());let T=this._intentStates.get(c.cacheKey);T||(T=Object.create(null),this._intentStates.set(c.cacheKey,T)),T.streamReaderCancelTimeout&&(clearTimeout(T.streamReaderCancelTimeout),T.streamReaderCancelTimeout=null);const p=!!(c.renderingIntent&_util.RenderingIntentFlag.PRINT);T.displayReadyCapability||(T.displayReadyCapability=new _util.PromiseCapability,T.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(c));const h=A=>{T.renderTasks.delete(_),(this._maybeCleanupAfterRender||p)&&(this.#t=!0),this.#s(!p),A?(_.capability.reject(A),this._abortOperatorList({intentState:T,reason:A instanceof Error?A:new Error(A)})):_.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},_=new InternalRenderTask({callback:h,params:{canvasContext:t,viewport:s,transform:r,background:d},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:m,operatorList:T.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!p,pdfBug:this._pdfBug,pageColors:u});(T.renderTasks||=new Set).add(_);const I=_.task;return Promise.all([T.displayReadyCapability.promise,f]).then(([A,O])=>{if(this.destroyed){h();return}this._stats?.time("Rendering"),_.initializeGraphics({transparency:A,optionalContentConfig:O}),_.operatorListChanged()}).catch(h),I}getOperatorList({intent:t="display",annotationMode:s=_util.AnnotationMode.ENABLE,printAnnotationStorage:n=null}={}){function i(){d.operatorList.lastChunk&&(d.opListReadCapability.resolve(d.operatorList),d.renderTasks.delete(f))}const r=this._transport.getRenderingIntent(t,s,n,!0);let d=this._intentStates.get(r.cacheKey);d||(d=Object.create(null),this._intentStates.set(r.cacheKey,d));let f;return d.opListReadCapability||(f=Object.create(null),f.operatorListChanged=i,d.opListReadCapability=new _util.PromiseCapability,(d.renderTasks||=new Set).add(f),d.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(r)),d.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:s=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:s===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>_xfa_text.XfaText.textContent(n));const s=this.streamTextContent(t);return new Promise(function(n,i){function r(){d.read().then(function({value:m,done:u}){if(u){n(f);return}Object.assign(f.styles,m.styles),f.items.push(...m.items),r()},i)}const d=s.getReader(),f={items:[],styles:Object.create(null)};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const s of this._intentStates.values())if(this._abortOperatorList({intentState:s,reason:new Error("Page was destroyed."),force:!0}),!s.opListReadCapability)for(const n of s.renderTasks)t.push(n.completed),n.cancel();return this.objs.clear(),this.#t=!1,this.#n(),Promise.all(t)}cleanup(t=!1){this.#t=!0;const s=this.#s(!1);return t&&s&&(this._stats&&=new _display_utils.StatTimer),s}#s(t=!1){if(this.#n(),!this.#t||this.destroyed)return!1;if(t)return this.#e=setTimeout(()=>{this.#e=null,this.#s(!1)},DELAYED_CLEANUP_TIMEOUT),!1;for(const{renderTasks:s,operatorList:n}of this._intentStates.values())if(s.size>0||!n.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}#n(){this.#e&&(clearTimeout(this.#e),this.#e=null)}_startRenderPage(t,s){const n=this._intentStates.get(s);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(t))}_renderPageChunk(t,s){for(let n=0,i=t.length;n<i;n++)s.operatorList.fnArray.push(t.fnArray[n]),s.operatorList.argsArray.push(t.argsArray[n]);s.operatorList.lastChunk=t.lastChunk,s.operatorList.separateAnnots=t.separateAnnots;for(const n of s.renderTasks)n.operatorListChanged();t.lastChunk&&this.#s(!0)}_pumpOperatorList({renderingIntent:t,cacheKey:s,annotationStorageSerializable:n}){const{map:i,transfers:r}=n,f=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:s,annotationStorage:i},r).getReader(),m=this._intentStates.get(s);m.streamReader=f;const u=()=>{f.read().then(({value:a,done:c})=>{if(c){m.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(a,m),u())},a=>{if(m.streamReader=null,!this._transport.destroyed){if(m.operatorList){m.operatorList.lastChunk=!0;for(const c of m.renderTasks)c.operatorListChanged();this.#s(!0)}if(m.displayReadyCapability)m.displayReadyCapability.reject(a);else if(m.opListReadCapability)m.opListReadCapability.reject(a);else throw a}})};u()}_abortOperatorList({intentState:t,reason:s,force:n=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!n){if(t.renderTasks.size>0)return;if(s instanceof _display_utils.RenderingCancelledException){let i=RENDERING_CANCELLED_TIMEOUT;s.extraDelay>0&&s.extraDelay<1e3&&(i+=s.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:s,force:!0})},i);return}}if(t.streamReader.cancel(new _util.AbortException(s.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[i,r]of this._intentStates)if(r===t){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{#e=new Set;#t=Promise.resolve();postMessage(t,s){const n={data:structuredClone(t,s?{transfer:s}:null)};this.#t.then(()=>{for(const i of this.#e)i.call(this,n)})}addEventListener(t,s){this.#e.add(s)}removeEventListener(t,s){this.#e.delete(s)}terminate(){this.#e.clear()}}exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const e=document?.currentScript?.src;e&&(PDFWorkerUtil.fallbackWorkerSrc=e.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(e,t){let s;try{if(s=new URL(e),!s.origin||s.origin==="null")return!1}catch{return!1}const n=new URL(t,s);return s.origin===n.origin},PDFWorkerUtil.createCDNWrapper=function(e){const t=`importScripts("${e}");`;return URL.createObjectURL(new Blob([t]))}}class PDFWorker{static#workerPorts;constructor({name:e=null,port:t=null,verbosity:s=(0,_util.getVerbosityLevel)()}={}){if(this.name=e,this.destroyed=!1,this.verbosity=s,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,t){if(PDFWorker.#workerPorts?.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(PDFWorker.#workerPorts||=new WeakMap).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new _message_handler.MessageHandler("main","worker",e),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:e}=PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,e)||(e=PDFWorkerUtil.createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e),s=new _message_handler.MessageHandler("main","worker",t),n=()=>{t.removeEventListener("error",i),s.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},i=()=>{this._webWorker||n()};t.addEventListener("error",i),s.on("test",d=>{if(t.removeEventListener("error",i),this.destroyed){n();return}d?(this._messageHandler=s,this._port=t,this._webWorker=t,this._readyCapability.resolve(),s.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),s.destroy(),t.terminate())}),s.on("ready",d=>{if(t.removeEventListener("error",i),this.destroyed){n();return}try{r()}catch{this._setupFakeWorker()}});const r=()=>{const d=new Uint8Array;s.send("test",d,[d.buffer])};r();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),PDFWorker._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const t=new LoopbackPort;this._port=t;const s=`fake${PDFWorkerUtil.fakeWorkerId++}`,n=new _message_handler.MessageHandler(s+"_worker",s,t);e.setup(n,t);const i=new _message_handler.MessageHandler(s,s+"_worker",t);this._messageHandler=i,this._readyCapability.resolve(),i.send("configure",{verbosity:this.verbosity})}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),PDFWorker.#workerPorts?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(e){if(!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const t=this.#workerPorts?.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new PDFWorker(e)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}}exports.PDFWorker=PDFWorker;class WorkerTransport{#e=new Map;#t=new Map;#s=new Map;#n=null;constructor(t,s,n,i,r){this.messageHandler=t,this.loadingTask=s,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this._params=i,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}#a(t,s=null){const n=this.#e.get(t);if(n)return n;const i=this.messageHandler.sendWithPromise(t,s);return this.#e.set(t,i),i}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(t,s=_util.AnnotationMode.ENABLE,n=null,i=!1){let r=_util.RenderingIntentFlag.DISPLAY,d=_annotation_storage.SerializableEmpty;switch(t){case"any":r=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":r=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${t}`)}switch(s){case _util.AnnotationMode.DISABLE:r+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:r+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:r+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,d=(r&_util.RenderingIntentFlag.PRINT&&n instanceof _annotation_storage.PrintAnnotationStorage?n:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${s}`)}return i&&(r+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:r,cacheKey:`${r}_${d.hash}`,annotationStorageSerializable:d}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,this.#n?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const n of this.#t.values())t.push(n._destroy());this.#t.clear(),this.#s.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const s=this.messageHandler.sendWithPromise("Terminate",null);return t.push(s),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(),this._networkStream?.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:s}=this;t.on("GetReader",(n,i)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},i.onPull=()=>{this._fullReader.read().then(function({value:r,done:d}){if(d){i.close();return}(0,_util.assert)(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{this._fullReader.cancel(r),i.ready.catch(d=>{if(!this.destroyed)throw d})}}),t.on("ReaderHeadersReady",n=>{const i=new _util.PromiseCapability,r=this._fullReader;return r.headersReady.then(()=>{(!r.isStreamingSupported||!r.isRangeSupported)&&(this._lastProgress&&s.onProgress?.(this._lastProgress),r.onProgress=d=>{s.onProgress?.({loaded:d.loaded,total:d.total})}),i.resolve({isStreamingSupported:r.isStreamingSupported,isRangeSupported:r.isRangeSupported,contentLength:r.contentLength})},i.reject),i.promise}),t.on("GetRangeReader",(n,i)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(n.begin,n.end);if(!r){i.close();return}i.onPull=()=>{r.read().then(function({value:d,done:f}){if(f){i.close();return}(0,_util.assert)(d instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(d),1,[d])}).catch(d=>{i.error(d)})},i.onCancel=d=>{r.cancel(d),i.ready.catch(f=>{if(!this.destroyed)throw f})}}),t.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,s._capability.resolve(new PDFDocumentProxy(n,this))}),t.on("DocException",function(n){let i;switch(n.name){case"PasswordException":i=new _util.PasswordException(n.message,n.code);break;case"InvalidPDFException":i=new _util.InvalidPDFException(n.message);break;case"MissingPDFException":i=new _util.MissingPDFException(n.message);break;case"UnexpectedResponseException":i=new _util.UnexpectedResponseException(n.message,n.status);break;case"UnknownErrorException":i=new _util.UnknownErrorException(n.message,n.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}s._capability.reject(i)}),t.on("PasswordRequest",n=>{if(this.#n=new _util.PromiseCapability,s.onPassword){const i=r=>{r instanceof Error?this.#n.reject(r):this.#n.resolve({password:r})};try{s.onPassword(i,n.code)}catch(r){this.#n.reject(r)}}else this.#n.reject(new _util.PasswordException(n.message,n.code));return this.#n.promise}),t.on("DataLoaded",n=>{s.onProgress?.({loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),t.on("StartRenderPage",n=>{if(this.destroyed)return;this.#t.get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),t.on("commonobj",([n,i,r])=>{if(!this.destroyed&&!this.commonObjs.has(n))switch(i){case"Font":const d=this._params;if("error"in r){const u=r.error;(0,_util.warn)(`Error during font loading: ${u}`),this.commonObjs.resolve(n,u);break}const f=d.pdfBug&&globalThis.FontInspector?.enabled?(u,a)=>globalThis.FontInspector.fontAdded(u,a):null,m=new _font_loader.FontFaceObject(r,{isEvalSupported:d.isEvalSupported,disableFontFace:d.disableFontFace,ignoreErrors:d.ignoreErrors,inspectFont:f});this.fontLoader.bind(m).catch(u=>t.sendWithPromise("FontFallback",{id:n})).finally(()=>{!d.fontExtraProperties&&m.data&&(m.data=null),this.commonObjs.resolve(n,m)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,r);break;default:throw new Error(`Got unknown common object type ${i}`)}}),t.on("obj",([n,i,r,d])=>{if(this.destroyed)return;const f=this.#t.get(i);if(!f.objs.has(n))switch(r){case"Image":if(f.objs.resolve(n,d),d){let m;if(d.bitmap){const{width:u,height:a}=d;m=u*a*4}else m=d.data?.length||0;m>_util.MAX_IMAGE_SIZE_TO_CACHE&&(f._maybeCleanupAfterRender=!0)}break;case"Pattern":f.objs.resolve(n,d);break;default:throw new Error(`Got unknown object type ${r}`)}}),t.on("DocProgress",n=>{this.destroyed||s.onProgress?.({loaded:n.loaded,total:n.total})}),t.on("FetchBuiltInCMap",n=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(n):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),t.on("FetchStandardFontData",n=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(n):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfers:s}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},s).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const s=t-1,n=this.#s.get(s);if(n)return n;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:s}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");const d=new PDFPageProxy(s,r,this,this._params.pdfBug);return this.#t.set(s,d),d});return this.#s.set(s,i),i}getPageIndex(t){return typeof t!="object"||t===null||!Number.isInteger(t.num)||t.num<0||!Number.isInteger(t.gen)||t.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen})}getAnnotations(t,s){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:s})}getFieldObjects(){return this.#a("GetFieldObjects")}hasJSActions(){return this.#a("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#a("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(t=>new _optional_content_config.OptionalContentConfig(t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",s=this.#e.get(t);if(s)return s;const n=this.messageHandler.sendWithPromise(t,null).then(i=>({info:i[0],metadata:i[1]?new _metadata.Metadata(i[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#e.set(t,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const s of this.#t.values())if(!s.cleanup())throw new Error(`startCleanup: Page ${s.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:t,enableXfa:s}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:t,enableXfa:s})}}class PDFObjects{#e=Object.create(null);#t(t){return this.#e[t]||={capability:new _util.PromiseCapability,data:null}}get(t,s=null){if(s){const i=this.#t(t);return i.capability.promise.then(()=>s(i.data)),null}const n=this.#e[t];if(!n?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return n.data}has(t){return this.#e[t]?.capability.settled||!1}resolve(t,s=null){const n=this.#t(t);n.data=s,n.capability.resolve()}clear(){for(const t in this.#e){const{data:s}=this.#e[t];s?.bitmap?.close()}this.#e=Object.create(null)}}class RenderTask{#e=null;constructor(t){this.#e=t,this.onContinue=null}get promise(){return this.#e.capability.promise}cancel(t=0){this.#e.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#e.operatorList;if(!t)return!1;const{annotationCanvasMap:s}=this.#e;return t.form||t.canvas&&s?.size>0}}exports.RenderTask=RenderTask;class InternalRenderTask{static#e=new WeakSet;constructor({callback:t,params:s,objs:n,commonObjs:i,annotationCanvasMap:r,operatorList:d,pageIndex:f,canvasFactory:m,filterFactory:u,useRequestAnimationFrame:a=!1,pdfBug:c=!1,pageColors:T=null}){this.callback=t,this.params=s,this.objs=n,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=d,this._pageIndex=f,this.canvasFactory=m,this.filterFactory=u,this._pdfBug=c,this.pageColors=T,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=a===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=s.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:s}){if(this.cancelled)return;if(this._canvas){if(InternalRenderTask.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");InternalRenderTask.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:n,viewport:i,transform:r,background:d}=this.params;this.gfx=new _canvas.CanvasGraphics(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:s},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:r,viewport:i,transparency:t,background:d}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,s=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),InternalRenderTask.#e.delete(this._canvas),this.callback(t||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,s))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),InternalRenderTask.#e.delete(this._canvas),this.callback())))}}const version="3.11.174";exports.version=version;const build="ce8716743";exports.build=build},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SerializableEmpty=t.PrintAnnotationStorage=t.AnnotationStorage=void 0;var n=s(1),i=s(4),r=s(8);const d=Object.freeze({map:null,hash:"",transfers:void 0});t.SerializableEmpty=d;class f{#e=!1;#t=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(a,c){const T=this.#t.get(a);return T===void 0?c:Object.assign(c,T)}getRawValue(a){return this.#t.get(a)}remove(a){if(this.#t.delete(a),this.#t.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const c of this.#t.values())if(c instanceof i.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(a,c){const T=this.#t.get(a);let p=!1;if(T!==void 0)for(const[h,_]of Object.entries(c))T[h]!==_&&(p=!0,T[h]=_);else p=!0,this.#t.set(a,c);p&&this.#s(),c instanceof i.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(c.constructor._type)}has(a){return this.#t.has(a)}getAll(){return this.#t.size>0?(0,n.objectFromMap)(this.#t):null}setAll(a){for(const[c,T]of Object.entries(a))this.setValue(c,T)}get size(){return this.#t.size}#s(){this.#e||(this.#e=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#e&&(this.#e=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new m(this)}get serializable(){if(this.#t.size===0)return d;const a=new Map,c=new r.MurmurHash3_64,T=[],p=Object.create(null);let h=!1;for(const[_,I]of this.#t){const A=I instanceof i.AnnotationEditor?I.serialize(!1,p):I;A&&(a.set(_,A),c.update(`${_}:${JSON.stringify(A)}`),h||=!!A.bitmap)}if(h)for(const _ of a.values())_.bitmap&&T.push(_.bitmap);return a.size>0?{map:a,hash:c.hexdigest(),transfers:T}:d}}t.AnnotationStorage=f;class m extends f{#e;constructor(a){super();const{map:c,hash:T,transfers:p}=a.serializable,h=structuredClone(c,p?{transfer:p}:null);this.#e={map:h,hash:T,transfers:p}}get print(){(0,n.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}}t.PrintAnnotationStorage=m},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationEditor=void 0;var n=s(5),i=s(1),r=s(6);class d{#e="";#t=!1;#s=null;#n=null;#a=null;#o=!1;#r=null;#u=this.focusin.bind(this);#c=this.focusout.bind(this);#i=!1;#f=!1;#h=!1;_initialOptions=Object.create(null);_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#d=!1;#g=d._zIndex++;static _borderLineWidth=-1;static _colorManager=new n.ColorManager;static _zIndex=1;static SMALL_EDITOR_SIZE=0;constructor(u){this.constructor===d&&(0,i.unreachable)("Cannot initialize AnnotationEditor."),this.parent=u.parent,this.id=u.id,this.width=this.height=null,this.pageIndex=u.parent.pageIndex,this.name=u.name,this.div=null,this._uiManager=u.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=u.isCentered,this._structTreeParentId=null;const{rotation:a,rawDims:{pageWidth:c,pageHeight:T,pageX:p,pageY:h}}=this.parent.viewport;this.rotation=a,this.pageRotation=(360+a-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[c,T],this.pageTranslation=[p,h];const[_,I]=this.parentDimensions;this.x=u.x/_,this.y=u.y/I,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,i.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(u){const a=new f({id:u.parent.getNextId(),parent:u.parent,uiManager:u._uiManager});a.annotationElementId=u.annotationElementId,a.deleted=!0,a._uiManager.addToAnnotationStorage(a)}static initialize(u,a=null){if(d._l10nPromise||=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(T=>[T,u.get(T)])),a?.strings)for(const T of a.strings)d._l10nPromise.set(T,u.get(T));if(d._borderLineWidth!==-1)return;const c=getComputedStyle(document.documentElement);d._borderLineWidth=parseFloat(c.getPropertyValue("--outline-width"))||0}static updateDefaultParams(u,a){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(u){return!1}static paste(u,a){(0,i.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#d}set _isDraggable(u){this.#d=u,this.div?.classList.toggle("draggable",u)}center(){const[u,a]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*a/(u*2),this.y+=this.width*u/(a*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*a/(u*2),this.y-=this.width*u/(a*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(u){this._uiManager.addCommands(u)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#g}setParent(u){u!==null&&(this.pageIndex=u.pageIndex,this.pageDimensions=u.pageDimensions),this.parent=u}focusin(u){this._focusEventsAllowed&&(this.#i?this.#i=!1:this.parent.setSelected(this))}focusout(u){!this._focusEventsAllowed||!this.isAttachedToDOM||u.relatedTarget?.closest(`#${this.id}`)||(u.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(u,a,c,T){const[p,h]=this.parentDimensions;[c,T]=this.screenToPageTranslation(c,T),this.x=(u+c)/p,this.y=(a+T)/h,this.fixAndSetPosition()}#T([u,a],c,T){[c,T]=this.screenToPageTranslation(c,T),this.x+=c/u,this.y+=T/a,this.fixAndSetPosition()}translate(u,a){this.#T(this.parentDimensions,u,a)}translateInPage(u,a){this.#T(this.pageDimensions,u,a),this.div.scrollIntoView({block:"nearest"})}drag(u,a){const[c,T]=this.parentDimensions;if(this.x+=u/c,this.y+=a/T,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:A,y:O}=this.div.getBoundingClientRect();this.parent.findNewParent(this,A,O)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:p,y:h}=this;const[_,I]=this.#p();p+=_,h+=I,this.div.style.left=`${(100*p).toFixed(2)}%`,this.div.style.top=`${(100*h).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}#p(){const[u,a]=this.parentDimensions,{_borderLineWidth:c}=d,T=c/u,p=c/a;switch(this.rotation){case 90:return[-T,p];case 180:return[T,p];case 270:return[T,-p];default:return[-T,-p]}}fixAndSetPosition(){const[u,a]=this.pageDimensions;let{x:c,y:T,width:p,height:h}=this;switch(p*=u,h*=a,c*=u,T*=a,this.rotation){case 0:c=Math.max(0,Math.min(u-p,c)),T=Math.max(0,Math.min(a-h,T));break;case 90:c=Math.max(0,Math.min(u-h,c)),T=Math.min(a,Math.max(p,T));break;case 180:c=Math.min(u,Math.max(p,c)),T=Math.min(a,Math.max(h,T));break;case 270:c=Math.min(u,Math.max(h,c)),T=Math.max(0,Math.min(a-p,T));break}this.x=c/=u,this.y=T/=a;const[_,I]=this.#p();c+=_,T+=I;const{style:A}=this.div;A.left=`${(100*c).toFixed(2)}%`,A.top=`${(100*T).toFixed(2)}%`,this.moveInDOM()}static#m(u,a,c){switch(c){case 90:return[a,-u];case 180:return[-u,-a];case 270:return[-a,u];default:return[u,a]}}screenToPageTranslation(u,a){return d.#m(u,a,this.parentRotation)}pageTranslationToScreen(u,a){return d.#m(u,a,360-this.parentRotation)}#l(u){switch(u){case 90:{const[a,c]=this.pageDimensions;return[0,-a/c,c/a,0]}case 180:return[-1,0,0,-1];case 270:{const[a,c]=this.pageDimensions;return[0,a/c,-c/a,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:u,pageDimensions:[a,c]}=this,T=a*u,p=c*u;return i.FeatureTest.isCSSRoundSupported?[Math.round(T),Math.round(p)]:[T,p]}setDims(u,a){const[c,T]=this.parentDimensions;this.div.style.width=`${(100*u/c).toFixed(2)}%`,this.#o||(this.div.style.height=`${(100*a/T).toFixed(2)}%`),this.#s?.classList.toggle("small",u<d.SMALL_EDITOR_SIZE||a<d.SMALL_EDITOR_SIZE)}fixDims(){const{style:u}=this.div,{height:a,width:c}=u,T=c.endsWith("%"),p=!this.#o&&a.endsWith("%");if(T&&p)return;const[h,_]=this.parentDimensions;T||(u.width=`${(100*parseFloat(c)/h).toFixed(2)}%`),!this.#o&&!p&&(u.height=`${(100*parseFloat(a)/_).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#E(){if(this.#r)return;this.#r=document.createElement("div"),this.#r.classList.add("resizers");const u=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||u.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const a of u){const c=document.createElement("div");this.#r.append(c),c.classList.add("resizer",a),c.addEventListener("pointerdown",this.#I.bind(this,a)),c.addEventListener("contextmenu",r.noContextMenu)}this.div.prepend(this.#r)}#I(u,a){a.preventDefault();const{isMac:c}=i.FeatureTest.platform;if(a.button!==0||a.ctrlKey&&c)return;const T=this.#S.bind(this,u),p=this._isDraggable;this._isDraggable=!1;const h={passive:!0,capture:!0};window.addEventListener("pointermove",T,h);const _=this.x,I=this.y,A=this.width,O=this.height,w=this.parent.div.style.cursor,P=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(a.target).cursor;const C=()=>{this._isDraggable=p,window.removeEventListener("pointerup",C),window.removeEventListener("blur",C),window.removeEventListener("pointermove",T,h),this.parent.div.style.cursor=w,this.div.style.cursor=P;const y=this.x,F=this.y,H=this.width,U=this.height;y===_&&F===I&&H===A&&U===O||this.addCommands({cmd:()=>{this.width=H,this.height=U,this.x=y,this.y=F;const[Y,V]=this.parentDimensions;this.setDims(Y*H,V*U),this.fixAndSetPosition()},undo:()=>{this.width=A,this.height=O,this.x=_,this.y=I;const[Y,V]=this.parentDimensions;this.setDims(Y*A,V*O),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",C),window.addEventListener("blur",C)}#S(u,a){const[c,T]=this.parentDimensions,p=this.x,h=this.y,_=this.width,I=this.height,A=d.MIN_SIZE/c,O=d.MIN_SIZE/T,w=M=>Math.round(M*1e4)/1e4,P=this.#l(this.rotation),C=(M,E)=>[P[0]*M+P[2]*E,P[1]*M+P[3]*E],y=this.#l(360-this.rotation),F=(M,E)=>[y[0]*M+y[2]*E,y[1]*M+y[3]*E];let H,U,Y=!1,V=!1;switch(u){case"topLeft":Y=!0,H=(M,E)=>[0,0],U=(M,E)=>[M,E];break;case"topMiddle":H=(M,E)=>[M/2,0],U=(M,E)=>[M/2,E];break;case"topRight":Y=!0,H=(M,E)=>[M,0],U=(M,E)=>[0,E];break;case"middleRight":V=!0,H=(M,E)=>[M,E/2],U=(M,E)=>[0,E/2];break;case"bottomRight":Y=!0,H=(M,E)=>[M,E],U=(M,E)=>[0,0];break;case"bottomMiddle":H=(M,E)=>[M/2,E],U=(M,E)=>[M/2,0];break;case"bottomLeft":Y=!0,H=(M,E)=>[0,E],U=(M,E)=>[M,0];break;case"middleLeft":V=!0,H=(M,E)=>[0,E/2],U=(M,E)=>[M,E/2];break}const ie=H(_,I),J=U(_,I);let ne=C(...J);const ae=w(p+ne[0]),te=w(h+ne[1]);let G=1,N=1,[b,S]=this.screenToPageTranslation(a.movementX,a.movementY);if([b,S]=F(b/c,S/T),Y){const M=Math.hypot(_,I);G=N=Math.max(Math.min(Math.hypot(J[0]-ie[0]-b,J[1]-ie[1]-S)/M,1/_,1/I),A/_,O/I)}else V?G=Math.max(A,Math.min(1,Math.abs(J[0]-ie[0]-b)))/_:N=Math.max(O,Math.min(1,Math.abs(J[1]-ie[1]-S)))/I;const R=w(_*G),L=w(I*N);ne=C(...U(R,L));const B=ae-ne[0],W=te-ne[1];this.width=R,this.height=L,this.x=B,this.y=W,this.setDims(c*R,T*L),this.fixAndSetPosition()}async addAltTextButton(){if(this.#s)return;const u=this.#s=document.createElement("button");u.className="altText";const a=await d._l10nPromise.get("editor_alt_text_button_label");u.textContent=a,u.setAttribute("aria-label",a),u.tabIndex="0",u.addEventListener("contextmenu",r.noContextMenu),u.addEventListener("pointerdown",c=>c.stopPropagation()),u.addEventListener("click",c=>{c.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),u.addEventListener("keydown",c=>{c.target===u&&c.key==="Enter"&&(c.preventDefault(),this._uiManager.editAltText(this))}),this.#D(),this.div.append(u),d.SMALL_EDITOR_SIZE||(d.SMALL_EDITOR_SIZE=Math.min(128,Math.round(u.getBoundingClientRect().width*1.4)))}async#D(){const u=this.#s;if(!u)return;if(!this.#e&&!this.#t){u.classList.remove("done"),this.#n?.remove();return}d._l10nPromise.get("editor_alt_text_edit_button_label").then(c=>{u.setAttribute("aria-label",c)});let a=this.#n;if(!a){this.#n=a=document.createElement("span"),a.className="tooltip",a.setAttribute("role","tooltip");const c=a.id=`alt-text-tooltip-${this.id}`;u.setAttribute("aria-describedby",c);const T=100;u.addEventListener("mouseenter",()=>{this.#a=setTimeout(()=>{this.#a=null,this.#n.classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},T)}),u.addEventListener("mouseleave",()=>{clearTimeout(this.#a),this.#a=null,this.#n?.classList.remove("show")})}u.classList.add("done"),a.innerText=this.#t?await d._l10nPromise.get("editor_alt_text_decorative_tooltip"):this.#e,a.parentNode||u.append(a)}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:this.#e,decorative:this.#t}}set altTextData({altText:u,decorative:a}){this.#e===u&&this.#t===a||(this.#e=u,this.#t=a,this.#D())}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",this.#u),this.div.addEventListener("focusout",this.#c);const[u,a]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*a/u).toFixed(2)}%`,this.div.style.maxHeight=`${(100*u/a).toFixed(2)}%`);const[c,T]=this.getInitialTranslation();return this.translate(c,T),(0,n.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(u){const{isMac:a}=i.FeatureTest.platform;if(u.button!==0||u.ctrlKey&&a){u.preventDefault();return}this.#i=!0,this.#R(u)}#R(u){if(!this._isDraggable)return;const a=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let c,T;a&&(c={passive:!0,capture:!0},T=h=>{const[_,I]=this.screenToPageTranslation(h.movementX,h.movementY);this._uiManager.dragSelectedEditors(_,I)},window.addEventListener("pointermove",T,c));const p=()=>{if(window.removeEventListener("pointerup",p),window.removeEventListener("blur",p),a&&window.removeEventListener("pointermove",T,c),this.#i=!1,!this._uiManager.endDragSession()){const{isMac:h}=i.FeatureTest.platform;u.ctrlKey&&!h||u.shiftKey||u.metaKey&&h?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",p),window.addEventListener("blur",p)}moveInDOM(){this.parent?.moveEditorInDOM(this)}_setParentAndPosition(u,a,c){u.changeParent(this),this.x=a,this.y=c,this.fixAndSetPosition()}getRect(u,a){const c=this.parentScale,[T,p]=this.pageDimensions,[h,_]=this.pageTranslation,I=u/c,A=a/c,O=this.x*T,w=this.y*p,P=this.width*T,C=this.height*p;switch(this.rotation){case 0:return[O+I+h,p-w-A-C+_,O+I+P+h,p-w-A+_];case 90:return[O+A+h,p-w+I+_,O+A+C+h,p-w+I+P+_];case 180:return[O-I-P+h,p-w+A+_,O-I+h,p-w+A+C+_];case 270:return[O-A-C+h,p-w-I-P+_,O-A+h,p-w-I+_];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(u,a){const[c,T,p,h]=u,_=p-c,I=h-T;switch(this.rotation){case 0:return[c,a-h,_,I];case 90:return[c,a-T,I,_];case 180:return[p,a-T,_,I];case 270:return[p,a-h,I,_];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#h=!0}disableEditMode(){this.#h=!1}isInEditMode(){return this.#h}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#u),this.div?.addEventListener("focusout",this.#c)}serialize(u=!1,a=null){(0,i.unreachable)("An editor must be serializable")}static deserialize(u,a,c){const T=new this.prototype.constructor({parent:a,id:a.getNextId(),uiManager:c});T.rotation=u.rotation;const[p,h]=T.pageDimensions,[_,I,A,O]=T.getRectInCurrentCoords(u.rect,h);return T.x=_/p,T.y=I/h,T.width=A/p,T.height=O/h,T}remove(){this.div.removeEventListener("focusin",this.#u),this.div.removeEventListener("focusout",this.#c),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#s?.remove(),this.#s=null,this.#n=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#E(),this.#r.classList.remove("hidden"))}select(){this.makeResizable(),this.div?.classList.add("selectedEditor")}unselect(){this.#r?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(u,a){}disableEditing(){this.#s&&(this.#s.hidden=!0)}enableEditing(){this.#s&&(this.#s.hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return this.#f}set isEditing(u){this.#f=u,this.parent&&(u?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(u,a){this.#o=!0;const c=u/a,{style:T}=this.div;T.aspectRatio=c,T.height="auto"}static get MIN_SIZE(){return 16}}t.AnnotationEditor=d;class f extends d{constructor(u){super(u),this.annotationElementId=u.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardManager=t.CommandManager=t.ColorManager=t.AnnotationEditorUIManager=void 0,t.bindEvents=r,t.opacityToHex=d;var n=s(1),i=s(6);function r(p,h,_){for(const I of _)h.addEventListener(I,p[I].bind(p))}function d(p){return Math.round(Math.min(255,Math.max(1,255*p))).toString(16).padStart(2,"0")}class f{#e=0;getId(){return`${n.AnnotationEditorPrefix}${this.#e++}`}}class m{#e=(0,n.getUuid)();#t=0;#s=null;static get _isSVGFittingCanvas(){const h='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',I=new OffscreenCanvas(1,3).getContext("2d"),A=new Image;A.src=h;const O=A.decode().then(()=>(I.drawImage(A,0,0,1,1,0,0,1,3),new Uint32Array(I.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,n.shadow)(this,"_isSVGFittingCanvas",O)}async#n(h,_){this.#s||=new Map;let I=this.#s.get(h);if(I===null)return null;if(I?.bitmap)return I.refCounter+=1,I;try{I||={bitmap:null,id:`image_${this.#e}_${this.#t++}`,refCounter:0,isSvg:!1};let A;if(typeof _=="string"){I.url=_;const O=await fetch(_);if(!O.ok)throw new Error(O.statusText);A=await O.blob()}else A=I.file=_;if(A.type==="image/svg+xml"){const O=m._isSVGFittingCanvas,w=new FileReader,P=new Image,C=new Promise((y,F)=>{P.onload=()=>{I.bitmap=P,I.isSvg=!0,y()},w.onload=async()=>{const H=I.svgUrl=w.result;P.src=await O?`${H}#svgView(preserveAspectRatio(none))`:H},P.onerror=w.onerror=F});w.readAsDataURL(A),await C}else I.bitmap=await createImageBitmap(A);I.refCounter=1}catch(A){console.error(A),I=null}return this.#s.set(h,I),I&&this.#s.set(I.id,I),I}async getFromFile(h){const{lastModified:_,name:I,size:A,type:O}=h;return this.#n(`${_}_${I}_${A}_${O}`,h)}async getFromUrl(h){return this.#n(h,h)}async getFromId(h){this.#s||=new Map;const _=this.#s.get(h);return _?_.bitmap?(_.refCounter+=1,_):_.file?this.getFromFile(_.file):this.getFromUrl(_.url):null}getSvgUrl(h){const _=this.#s.get(h);return _?.isSvg?_.svgUrl:null}deleteId(h){this.#s||=new Map;const _=this.#s.get(h);_&&(_.refCounter-=1,_.refCounter===0&&(_.bitmap=null))}isValidId(h){return h.startsWith(`image_${this.#e}_`)}}class u{#e=[];#t=!1;#s;#n=-1;constructor(h=128){this.#s=h}add({cmd:h,undo:_,mustExec:I,type:A=NaN,overwriteIfSameType:O=!1,keepUndo:w=!1}){if(I&&h(),this.#t)return;const P={cmd:h,undo:_,type:A};if(this.#n===-1){this.#e.length>0&&(this.#e.length=0),this.#n=0,this.#e.push(P);return}if(O&&this.#e[this.#n].type===A){w&&(P.undo=this.#e[this.#n].undo),this.#e[this.#n]=P;return}const C=this.#n+1;C===this.#s?this.#e.splice(0,1):(this.#n=C,C<this.#e.length&&this.#e.splice(C)),this.#e.push(P)}undo(){this.#n!==-1&&(this.#t=!0,this.#e[this.#n].undo(),this.#t=!1,this.#n-=1)}redo(){this.#n<this.#e.length-1&&(this.#n+=1,this.#t=!0,this.#e[this.#n].cmd(),this.#t=!1)}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#e.length-1}destroy(){this.#e=null}}t.CommandManager=u;class a{constructor(h){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:_}=n.FeatureTest.platform;for(const[I,A,O={}]of h)for(const w of I){const P=w.startsWith("mac+");_&&P?(this.callbacks.set(w.slice(4),{callback:A,options:O}),this.allKeys.add(w.split("+").at(-1))):!_&&!P&&(this.callbacks.set(w,{callback:A,options:O}),this.allKeys.add(w.split("+").at(-1)))}}#e(h){h.altKey&&this.buffer.push("alt"),h.ctrlKey&&this.buffer.push("ctrl"),h.metaKey&&this.buffer.push("meta"),h.shiftKey&&this.buffer.push("shift"),this.buffer.push(h.key);const _=this.buffer.join("+");return this.buffer.length=0,_}exec(h,_){if(!this.allKeys.has(_.key))return;const I=this.callbacks.get(this.#e(_));if(!I)return;const{callback:A,options:{bubbles:O=!1,args:w=[],checker:P=null}}=I;P&&!P(h,_)||(A.bind(h,...w)(),O||(_.stopPropagation(),_.preventDefault()))}}t.KeyboardManager=a;class c{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const h=new Map([["CanvasText",null],["Canvas",null]]);return(0,i.getColorValues)(h),(0,n.shadow)(this,"_colors",h)}convert(h){const _=(0,i.getRGB)(h);if(!window.matchMedia("(forced-colors: active)").matches)return _;for(const[I,A]of this._colors)if(A.every((O,w)=>O===_[w]))return c._colorsMapping.get(I);return _}getHexCode(h){const _=this._colors.get(h);return _?n.Util.makeHexColor(..._):h}}t.ColorManager=c;class T{#e=null;#t=new Map;#s=new Map;#n=null;#a=null;#o=new u;#r=0;#u=new Set;#c=null;#i=null;#f=new Set;#h=null;#d=new f;#g=!1;#T=!1;#p=null;#m=n.AnnotationEditorType.NONE;#l=new Set;#E=null;#I=this.blur.bind(this);#S=this.focus.bind(this);#D=this.copy.bind(this);#R=this.cut.bind(this);#L=this.paste.bind(this);#w=this.keydown.bind(this);#k=this.onEditingAction.bind(this);#A=this.onPageChanging.bind(this);#M=this.onScaleChanging.bind(this);#O=this.onRotationChanging.bind(this);#x={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1};#_=[0,0];#N=null;#C=null;#F=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const h=T.prototype,_=O=>{const{activeElement:w}=document;return w&&O.#C.contains(w)&&O.hasSomethingToControl()},I=this.TRANSLATE_SMALL,A=this.TRANSLATE_BIG;return(0,n.shadow)(this,"_keyboardManager",new a([[["ctrl+a","mac+meta+a"],h.selectAll],[["ctrl+z","mac+meta+z"],h.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],h.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],h.delete],[["Escape","mac+Escape"],h.unselectAll],[["ArrowLeft","mac+ArrowLeft"],h.translateSelectedEditors,{args:[-I,0],checker:_}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],h.translateSelectedEditors,{args:[-A,0],checker:_}],[["ArrowRight","mac+ArrowRight"],h.translateSelectedEditors,{args:[I,0],checker:_}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],h.translateSelectedEditors,{args:[A,0],checker:_}],[["ArrowUp","mac+ArrowUp"],h.translateSelectedEditors,{args:[0,-I],checker:_}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],h.translateSelectedEditors,{args:[0,-A],checker:_}],[["ArrowDown","mac+ArrowDown"],h.translateSelectedEditors,{args:[0,I],checker:_}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],h.translateSelectedEditors,{args:[0,A],checker:_}]]))}constructor(h,_,I,A,O,w){this.#C=h,this.#F=_,this.#n=I,this._eventBus=A,this._eventBus._on("editingaction",this.#k),this._eventBus._on("pagechanging",this.#A),this._eventBus._on("scalechanging",this.#M),this._eventBus._on("rotationchanging",this.#O),this.#a=O.annotationStorage,this.#h=O.filterFactory,this.#E=w,this.viewParameters={realScale:i.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}destroy(){this.#P(),this.#G(),this._eventBus._off("editingaction",this.#k),this._eventBus._off("pagechanging",this.#A),this._eventBus._off("scalechanging",this.#M),this._eventBus._off("rotationchanging",this.#O);for(const h of this.#s.values())h.destroy();this.#s.clear(),this.#t.clear(),this.#f.clear(),this.#e=null,this.#l.clear(),this.#o.destroy(),this.#n.destroy()}get hcmFilter(){return(0,n.shadow)(this,"hcmFilter",this.#E?this.#h.addHCMFilter(this.#E.foreground,this.#E.background):"none")}get direction(){return(0,n.shadow)(this,"direction",getComputedStyle(this.#C).direction)}editAltText(h){this.#n?.editAltText(this,h)}onPageChanging({pageNumber:h}){this.#r=h-1}focusMainContainer(){this.#C.focus()}findParent(h,_){for(const I of this.#s.values()){const{x:A,y:O,width:w,height:P}=I.div.getBoundingClientRect();if(h>=A&&h<=A+w&&_>=O&&_<=O+P)return I}return null}disableUserSelect(h=!1){this.#F.classList.toggle("noUserSelect",h)}addShouldRescale(h){this.#f.add(h)}removeShouldRescale(h){this.#f.delete(h)}onScaleChanging({scale:h}){this.commitOrRemove(),this.viewParameters.realScale=h*i.PixelsPerInch.PDF_TO_CSS_UNITS;for(const _ of this.#f)_.onScaleChanging()}onRotationChanging({pagesRotation:h}){this.commitOrRemove(),this.viewParameters.rotation=h}addToAnnotationStorage(h){!h.isEmpty()&&this.#a&&!this.#a.has(h.id)&&this.#a.setValue(h.id,h)}#B(){window.addEventListener("focus",this.#S),window.addEventListener("blur",this.#I)}#G(){window.removeEventListener("focus",this.#S),window.removeEventListener("blur",this.#I)}blur(){if(!this.hasSelection)return;const{activeElement:h}=document;for(const _ of this.#l)if(_.div.contains(h)){this.#p=[_,h],_._focusEventsAllowed=!1;break}}focus(){if(!this.#p)return;const[h,_]=this.#p;this.#p=null,_.addEventListener("focusin",()=>{h._focusEventsAllowed=!0},{once:!0}),_.focus()}#U(){window.addEventListener("keydown",this.#w,{capture:!0})}#P(){window.removeEventListener("keydown",this.#w,{capture:!0})}#v(){document.addEventListener("copy",this.#D),document.addEventListener("cut",this.#R),document.addEventListener("paste",this.#L)}#y(){document.removeEventListener("copy",this.#D),document.removeEventListener("cut",this.#R),document.removeEventListener("paste",this.#L)}addEditListeners(){this.#U(),this.#v()}removeEditListeners(){this.#P(),this.#y()}copy(h){if(h.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const _=[];for(const I of this.#l){const A=I.serialize(!0);A&&_.push(A)}_.length!==0&&h.clipboardData.setData("application/pdfjs",JSON.stringify(_))}cut(h){this.copy(h),this.delete()}paste(h){h.preventDefault();const{clipboardData:_}=h;for(const O of _.items)for(const w of this.#i)if(w.isHandlingMimeForPasting(O.type)){w.paste(O,this.currentLayer);return}let I=_.getData("application/pdfjs");if(!I)return;try{I=JSON.parse(I)}catch(O){(0,n.warn)(`paste: "${O.message}".`);return}if(!Array.isArray(I))return;this.unselectAll();const A=this.currentLayer;try{const O=[];for(const C of I){const y=A.deserialize(C);if(!y)return;O.push(y)}const w=()=>{for(const C of O)this.#W(C);this.#q(O)},P=()=>{for(const C of O)C.remove()};this.addCommands({cmd:w,undo:P,mustExec:!0})}catch(O){(0,n.warn)(`paste: "${O.message}".`)}}keydown(h){this.getActive()?.shouldGetKeyboardEvents()||T._keyboardManager.exec(this,h)}onEditingAction(h){["undo","redo","delete","selectAll"].includes(h.name)&&this[h.name]()}#b(h){Object.entries(h).some(([I,A])=>this.#x[I]!==A)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#x,h)})}#H(h){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:h})}setEditingState(h){h?(this.#B(),this.#U(),this.#v(),this.#b({isEditing:this.#m!==n.AnnotationEditorType.NONE,isEmpty:this.#$(),hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:this.#o.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#G(),this.#P(),this.#y(),this.#b({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(h){if(!this.#i){this.#i=h;for(const _ of this.#i)this.#H(_.defaultPropertiesToUpdate)}}getId(){return this.#d.getId()}get currentLayer(){return this.#s.get(this.#r)}getLayer(h){return this.#s.get(h)}get currentPageIndex(){return this.#r}addLayer(h){this.#s.set(h.pageIndex,h),this.#g?h.enable():h.disable()}removeLayer(h){this.#s.delete(h.pageIndex)}updateMode(h,_=null){if(this.#m!==h){if(this.#m=h,h===n.AnnotationEditorType.NONE){this.setEditingState(!1),this.#Y();return}this.setEditingState(!0),this.#j(),this.unselectAll();for(const I of this.#s.values())I.updateMode(h);if(_){for(const I of this.#t.values())if(I.annotationElementId===_){this.setSelected(I),I.enterInEditMode();break}}}}updateToolbar(h){h!==this.#m&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:h})}updateParams(h,_){if(this.#i){if(h===n.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(h);return}for(const I of this.#l)I.updateParams(h,_);for(const I of this.#i)I.updateDefaultParams(h,_)}}enableWaiting(h=!1){if(this.#T!==h){this.#T=h;for(const _ of this.#s.values())h?_.disableClick():_.enableClick(),_.div.classList.toggle("waiting",h)}}#j(){if(!this.#g){this.#g=!0;for(const h of this.#s.values())h.enable()}}#Y(){if(this.unselectAll(),this.#g){this.#g=!1;for(const h of this.#s.values())h.disable()}}getEditors(h){const _=[];for(const I of this.#t.values())I.pageIndex===h&&_.push(I);return _}getEditor(h){return this.#t.get(h)}addEditor(h){this.#t.set(h.id,h)}removeEditor(h){this.#t.delete(h.id),this.unselect(h),(!h.annotationElementId||!this.#u.has(h.annotationElementId))&&this.#a?.remove(h.id)}addDeletedAnnotationElement(h){this.#u.add(h.annotationElementId),h.deleted=!0}isDeletedAnnotationElement(h){return this.#u.has(h)}removeDeletedAnnotationElement(h){this.#u.delete(h.annotationElementId),h.deleted=!1}#W(h){const _=this.#s.get(h.pageIndex);_?_.addOrRebuild(h):this.addEditor(h)}setActiveEditor(h){this.#e!==h&&(this.#e=h,h&&this.#H(h.propertiesToUpdate))}toggleSelected(h){if(this.#l.has(h)){this.#l.delete(h),h.unselect(),this.#b({hasSelectedEditor:this.hasSelection});return}this.#l.add(h),h.select(),this.#H(h.propertiesToUpdate),this.#b({hasSelectedEditor:!0})}setSelected(h){for(const _ of this.#l)_!==h&&_.unselect();this.#l.clear(),this.#l.add(h),h.select(),this.#H(h.propertiesToUpdate),this.#b({hasSelectedEditor:!0})}isSelected(h){return this.#l.has(h)}unselect(h){h.unselect(),this.#l.delete(h),this.#b({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#l.size!==0}undo(){this.#o.undo(),this.#b({hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#$()})}redo(){this.#o.redo(),this.#b({hasSomethingToUndo:!0,hasSomethingToRedo:this.#o.hasSomethingToRedo(),isEmpty:this.#$()})}addCommands(h){this.#o.add(h),this.#b({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#$()})}#$(){if(this.#t.size===0)return!0;if(this.#t.size===1)for(const h of this.#t.values())return h.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const h=[...this.#l],_=()=>{for(const A of h)A.remove()},I=()=>{for(const A of h)this.#W(A)};this.addCommands({cmd:_,undo:I,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#q(h){this.#l.clear();for(const _ of h)_.isEmpty()||(this.#l.add(_),_.select());this.#b({hasSelectedEditor:!0})}selectAll(){for(const h of this.#l)h.commit();this.#q(this.#t.values())}unselectAll(){if(this.#e){this.#e.commitOrRemove();return}if(this.hasSelection){for(const h of this.#l)h.unselect();this.#l.clear(),this.#b({hasSelectedEditor:!1})}}translateSelectedEditors(h,_,I=!1){if(I||this.commitOrRemove(),!this.hasSelection)return;this.#_[0]+=h,this.#_[1]+=_;const[A,O]=this.#_,w=[...this.#l],P=1e3;this.#N&&clearTimeout(this.#N),this.#N=setTimeout(()=>{this.#N=null,this.#_[0]=this.#_[1]=0,this.addCommands({cmd:()=>{for(const C of w)this.#t.has(C.id)&&C.translateInPage(A,O)},undo:()=>{for(const C of w)this.#t.has(C.id)&&C.translateInPage(-A,-O)},mustExec:!1})},P);for(const C of w)C.translateInPage(h,_)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#c=new Map;for(const h of this.#l)this.#c.set(h,{savedX:h.x,savedY:h.y,savedPageIndex:h.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#c)return!1;this.disableUserSelect(!1);const h=this.#c;this.#c=null;let _=!1;for(const[{x:A,y:O,pageIndex:w},P]of h)P.newX=A,P.newY=O,P.newPageIndex=w,_||=A!==P.savedX||O!==P.savedY||w!==P.savedPageIndex;if(!_)return!1;const I=(A,O,w,P)=>{if(this.#t.has(A.id)){const C=this.#s.get(P);C?A._setParentAndPosition(C,O,w):(A.pageIndex=P,A.x=O,A.y=w)}};return this.addCommands({cmd:()=>{for(const[A,{newX:O,newY:w,newPageIndex:P}]of h)I(A,O,w,P)},undo:()=>{for(const[A,{savedX:O,savedY:w,savedPageIndex:P}]of h)I(A,O,w,P)},mustExec:!0}),!0}dragSelectedEditors(h,_){if(this.#c)for(const I of this.#c.keys())I.drag(h,_)}rebuild(h){if(h.parent===null){const _=this.getLayer(h.pageIndex);_?(_.changeParent(h),_.addOrRebuild(h)):(this.addEditor(h),this.addToAnnotationStorage(h),h.rebuild())}else h.parent.addOrRebuild(h)}isActive(h){return this.#e===h}getActive(){return this.#e}getMode(){return this.#m}get imageManager(){return(0,n.shadow)(this,"imageManager",new m)}}t.AnnotationEditorUIManager=T},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StatTimer=t.RenderingCancelledException=t.PixelsPerInch=t.PageViewport=t.PDFDateString=t.DOMStandardFontDataFactory=t.DOMSVGFactory=t.DOMFilterFactory=t.DOMCanvasFactory=t.DOMCMapReaderFactory=void 0,t.deprecated=F,t.getColorValues=ie,t.getCurrentTransform=J,t.getCurrentTransformInverse=ne,t.getFilenameFromUrl=A,t.getPdfFilenameFromUrl=O,t.getRGB=V,t.getXfaPageViewport=Y,t.isDataScheme=_,t.isPdfFile=I,t.isValidFetchUrl=P,t.loadScript=y,t.noContextMenu=C,t.setLayerDimensions=ae;var n=s(7),i=s(1);const r="http://www.w3.org/2000/svg";class d{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}t.PixelsPerInch=d;class f extends n.BaseFilterFactory{#e;#t;#s;#n;#a;#o;#r;#u;#c;#i;#f=0;constructor({docId:G,ownerDocument:N=globalThis.document}={}){super(),this.#s=G,this.#n=N}get#h(){return this.#e||=new Map}get#d(){if(!this.#t){const G=this.#n.createElement("div"),{style:N}=G;N.visibility="hidden",N.contain="strict",N.width=N.height=0,N.position="absolute",N.top=N.left=0,N.zIndex=-1;const b=this.#n.createElementNS(r,"svg");b.setAttribute("width",0),b.setAttribute("height",0),this.#t=this.#n.createElementNS(r,"defs"),G.append(b),b.append(this.#t),this.#n.body.append(G)}return this.#t}addFilter(G){if(!G)return"none";let N=this.#h.get(G);if(N)return N;let b,S,R,L;if(G.length===1){const E=G[0],D=new Array(256);for(let x=0;x<256;x++)D[x]=E[x]/255;L=b=S=R=D.join(",")}else{const[E,D,x]=G,v=new Array(256),k=new Array(256),q=new Array(256);for(let j=0;j<256;j++)v[j]=E[j]/255,k[j]=D[j]/255,q[j]=x[j]/255;b=v.join(","),S=k.join(","),R=q.join(","),L=`${b}${S}${R}`}if(N=this.#h.get(L),N)return this.#h.set(G,N),N;const B=`g_${this.#s}_transfer_map_${this.#f++}`,W=`url(#${B})`;this.#h.set(G,W),this.#h.set(L,W);const M=this.#T(B);return this.#m(b,S,R,M),W}addHCMFilter(G,N){const b=`${G}-${N}`;if(this.#o===b)return this.#r;if(this.#o=b,this.#r="none",this.#a?.remove(),!G||!N)return this.#r;const S=this.#l(G);G=i.Util.makeHexColor(...S);const R=this.#l(N);if(N=i.Util.makeHexColor(...R),this.#d.style.color="",G==="#000000"&&N==="#ffffff"||G===N)return this.#r;const L=new Array(256);for(let D=0;D<=255;D++){const x=D/255;L[D]=x<=.03928?x/12.92:((x+.055)/1.055)**2.4}const B=L.join(","),W=`g_${this.#s}_hcm_filter`,M=this.#u=this.#T(W);this.#m(B,B,B,M),this.#g(M);const E=(D,x)=>{const v=S[D]/255,k=R[D]/255,q=new Array(x+1);for(let j=0;j<=x;j++)q[j]=v+j/x*(k-v);return q.join(",")};return this.#m(E(0,5),E(1,5),E(2,5),M),this.#r=`url(#${W})`,this.#r}addHighlightHCMFilter(G,N,b,S){const R=`${G}-${N}-${b}-${S}`;if(this.#c===R)return this.#i;if(this.#c=R,this.#i="none",this.#u?.remove(),!G||!N)return this.#i;const[L,B]=[G,N].map(this.#l.bind(this));let W=Math.round(.2126*L[0]+.7152*L[1]+.0722*L[2]),M=Math.round(.2126*B[0]+.7152*B[1]+.0722*B[2]),[E,D]=[b,S].map(this.#l.bind(this));M<W&&([W,M,E,D]=[M,W,D,E]),this.#d.style.color="";const x=(q,j,K)=>{const ue=new Array(256),Q=(M-W)/K,Z=q/255,ee=(j-q)/(255*K);let se=0;for(let re=0;re<=K;re++){const ce=Math.round(W+re*Q),he=Z+re*ee;for(let de=se;de<=ce;de++)ue[de]=he;se=ce+1}for(let re=se;re<256;re++)ue[re]=ue[se-1];return ue.join(",")},v=`g_${this.#s}_hcm_highlight_filter`,k=this.#u=this.#T(v);return this.#g(k),this.#m(x(E[0],D[0],5),x(E[1],D[1],5),x(E[2],D[2],5),k),this.#i=`url(#${v})`,this.#i}destroy(G=!1){G&&(this.#r||this.#i)||(this.#t&&(this.#t.parentNode.parentNode.remove(),this.#t=null),this.#e&&(this.#e.clear(),this.#e=null),this.#f=0)}#g(G){const N=this.#n.createElementNS(r,"feColorMatrix");N.setAttribute("type","matrix"),N.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),G.append(N)}#T(G){const N=this.#n.createElementNS(r,"filter");return N.setAttribute("color-interpolation-filters","sRGB"),N.setAttribute("id",G),this.#d.append(N),N}#p(G,N,b){const S=this.#n.createElementNS(r,N);S.setAttribute("type","discrete"),S.setAttribute("tableValues",b),G.append(S)}#m(G,N,b,S){const R=this.#n.createElementNS(r,"feComponentTransfer");S.append(R),this.#p(R,"feFuncR",G),this.#p(R,"feFuncG",N),this.#p(R,"feFuncB",b)}#l(G){return this.#d.style.color=G,V(getComputedStyle(this.#d).getPropertyValue("color"))}}t.DOMFilterFactory=f;class m extends n.BaseCanvasFactory{constructor({ownerDocument:G=globalThis.document}={}){super(),this._document=G}_createCanvas(G,N){const b=this._document.createElement("canvas");return b.width=G,b.height=N,b}}t.DOMCanvasFactory=m;async function u(te,G=!1){if(P(te,document.baseURI)){const N=await fetch(te);if(!N.ok)throw new Error(N.statusText);return G?new Uint8Array(await N.arrayBuffer()):(0,i.stringToBytes)(await N.text())}return new Promise((N,b)=>{const S=new XMLHttpRequest;S.open("GET",te,!0),G&&(S.responseType="arraybuffer"),S.onreadystatechange=()=>{if(S.readyState===XMLHttpRequest.DONE){if(S.status===200||S.status===0){let R;if(G&&S.response?R=new Uint8Array(S.response):!G&&S.responseText&&(R=(0,i.stringToBytes)(S.responseText)),R){N(R);return}}b(new Error(S.statusText))}},S.send(null)})}class a extends n.BaseCMapReaderFactory{_fetchData(G,N){return u(G,this.isCompressed).then(b=>({cMapData:b,compressionType:N}))}}t.DOMCMapReaderFactory=a;class c extends n.BaseStandardFontDataFactory{_fetchData(G){return u(G,!0)}}t.DOMStandardFontDataFactory=c;class T extends n.BaseSVGFactory{_createSVG(G){return document.createElementNS(r,G)}}t.DOMSVGFactory=T;class p{constructor({viewBox:G,scale:N,rotation:b,offsetX:S=0,offsetY:R=0,dontFlip:L=!1}){this.viewBox=G,this.scale=N,this.rotation=b,this.offsetX=S,this.offsetY=R;const B=(G[2]+G[0])/2,W=(G[3]+G[1])/2;let M,E,D,x;switch(b%=360,b<0&&(b+=360),b){case 180:M=-1,E=0,D=0,x=1;break;case 90:M=0,E=1,D=1,x=0;break;case 270:M=0,E=-1,D=-1,x=0;break;case 0:M=1,E=0,D=0,x=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}L&&(D=-D,x=-x);let v,k,q,j;M===0?(v=Math.abs(W-G[1])*N+S,k=Math.abs(B-G[0])*N+R,q=(G[3]-G[1])*N,j=(G[2]-G[0])*N):(v=Math.abs(B-G[0])*N+S,k=Math.abs(W-G[1])*N+R,q=(G[2]-G[0])*N,j=(G[3]-G[1])*N),this.transform=[M*N,E*N,D*N,x*N,v-M*N*B-D*N*W,k-E*N*B-x*N*W],this.width=q,this.height=j}get rawDims(){const{viewBox:G}=this;return(0,i.shadow)(this,"rawDims",{pageWidth:G[2]-G[0],pageHeight:G[3]-G[1],pageX:G[0],pageY:G[1]})}clone({scale:G=this.scale,rotation:N=this.rotation,offsetX:b=this.offsetX,offsetY:S=this.offsetY,dontFlip:R=!1}={}){return new p({viewBox:this.viewBox.slice(),scale:G,rotation:N,offsetX:b,offsetY:S,dontFlip:R})}convertToViewportPoint(G,N){return i.Util.applyTransform([G,N],this.transform)}convertToViewportRectangle(G){const N=i.Util.applyTransform([G[0],G[1]],this.transform),b=i.Util.applyTransform([G[2],G[3]],this.transform);return[N[0],N[1],b[0],b[1]]}convertToPdfPoint(G,N){return i.Util.applyInverseTransform([G,N],this.transform)}}t.PageViewport=p;class h extends i.BaseException{constructor(G,N=0){super(G,"RenderingCancelledException"),this.extraDelay=N}}t.RenderingCancelledException=h;function _(te){const G=te.length;let N=0;for(;N<G&&te[N].trim()==="";)N++;return te.substring(N,N+5).toLowerCase()==="data:"}function I(te){return typeof te=="string"&&/\.pdf$/i.test(te)}function A(te,G=!1){return G||([te]=te.split(/[#?]/,1)),te.substring(te.lastIndexOf("/")+1)}function O(te,G="document.pdf"){if(typeof te!="string")return G;if(_(te))return(0,i.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),G;const N=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,b=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,S=N.exec(te);let R=b.exec(S[1])||b.exec(S[2])||b.exec(S[3]);if(R&&(R=R[0],R.includes("%")))try{R=b.exec(decodeURIComponent(R))[0]}catch{}return R||G}class w{started=Object.create(null);times=[];time(G){G in this.started&&(0,i.warn)(`Timer is already running for ${G}`),this.started[G]=Date.now()}timeEnd(G){G in this.started||(0,i.warn)(`Timer has not been started for ${G}`),this.times.push({name:G,start:this.started[G],end:Date.now()}),delete this.started[G]}toString(){const G=[];let N=0;for(const{name:b}of this.times)N=Math.max(b.length,N);for(const{name:b,start:S,end:R}of this.times)G.push(`${b.padEnd(N)} ${R-S}ms
`);return G.join("")}}t.StatTimer=w;function P(te,G){try{const{protocol:N}=G?new URL(te,G):new URL(te);return N==="http:"||N==="https:"}catch{return!1}}function C(te){te.preventDefault()}function y(te,G=!1){return new Promise((N,b)=>{const S=document.createElement("script");S.src=te,S.onload=function(R){G&&S.remove(),N(R)},S.onerror=function(){b(new Error(`Cannot load script at: ${S.src}`))},(document.head||document.documentElement).append(S)})}function F(te){console.log("Deprecated API usage: "+te)}let H;class U{static toDateObject(G){if(!G||typeof G!="string")return null;H||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const N=H.exec(G);if(!N)return null;const b=parseInt(N[1],10);let S=parseInt(N[2],10);S=S>=1&&S<=12?S-1:0;let R=parseInt(N[3],10);R=R>=1&&R<=31?R:1;let L=parseInt(N[4],10);L=L>=0&&L<=23?L:0;let B=parseInt(N[5],10);B=B>=0&&B<=59?B:0;let W=parseInt(N[6],10);W=W>=0&&W<=59?W:0;const M=N[7]||"Z";let E=parseInt(N[8],10);E=E>=0&&E<=23?E:0;let D=parseInt(N[9],10)||0;return D=D>=0&&D<=59?D:0,M==="-"?(L+=E,B+=D):M==="+"&&(L-=E,B-=D),new Date(Date.UTC(b,S,R,L,B,W))}}t.PDFDateString=U;function Y(te,{scale:G=1,rotation:N=0}){const{width:b,height:S}=te.attributes.style,R=[0,0,parseInt(b),parseInt(S)];return new p({viewBox:R,scale:G,rotation:N})}function V(te){if(te.startsWith("#")){const G=parseInt(te.slice(1),16);return[(G&16711680)>>16,(G&65280)>>8,G&255]}return te.startsWith("rgb(")?te.slice(4,-1).split(",").map(G=>parseInt(G)):te.startsWith("rgba(")?te.slice(5,-1).split(",").map(G=>parseInt(G)).slice(0,3):((0,i.warn)(`Not a valid color format: "${te}"`),[0,0,0])}function ie(te){const G=document.createElement("span");G.style.visibility="hidden",document.body.append(G);for(const N of te.keys()){G.style.color=N;const b=window.getComputedStyle(G).color;te.set(N,V(b))}G.remove()}function J(te){const{a:G,b:N,c:b,d:S,e:R,f:L}=te.getTransform();return[G,N,b,S,R,L]}function ne(te){const{a:G,b:N,c:b,d:S,e:R,f:L}=te.getTransform().invertSelf();return[G,N,b,S,R,L]}function ae(te,G,N=!1,b=!0){if(G instanceof p){const{pageWidth:S,pageHeight:R}=G.rawDims,{style:L}=te,B=i.FeatureTest.isCSSRoundSupported,W=`var(--scale-factor) * ${S}px`,M=`var(--scale-factor) * ${R}px`,E=B?`round(${W}, 1px)`:`calc(${W})`,D=B?`round(${M}, 1px)`:`calc(${M})`;!N||G.rotation%180===0?(L.width=E,L.height=D):(L.width=D,L.height=E)}b&&te.setAttribute("data-main-rotation",G.rotation)}},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseStandardFontDataFactory=t.BaseSVGFactory=t.BaseFilterFactory=t.BaseCanvasFactory=t.BaseCMapReaderFactory=void 0;var n=s(1);class i{constructor(){this.constructor===i&&(0,n.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(a){return"none"}addHCMFilter(a,c){return"none"}addHighlightHCMFilter(a,c,T,p){return"none"}destroy(a=!1){}}t.BaseFilterFactory=i;class r{constructor(){this.constructor===r&&(0,n.unreachable)("Cannot initialize BaseCanvasFactory.")}create(a,c){if(a<=0||c<=0)throw new Error("Invalid canvas size");const T=this._createCanvas(a,c);return{canvas:T,context:T.getContext("2d")}}reset(a,c,T){if(!a.canvas)throw new Error("Canvas is not specified");if(c<=0||T<=0)throw new Error("Invalid canvas size");a.canvas.width=c,a.canvas.height=T}destroy(a){if(!a.canvas)throw new Error("Canvas is not specified");a.canvas.width=0,a.canvas.height=0,a.canvas=null,a.context=null}_createCanvas(a,c){(0,n.unreachable)("Abstract method `_createCanvas` called.")}}t.BaseCanvasFactory=r;class d{constructor({baseUrl:a=null,isCompressed:c=!0}){this.constructor===d&&(0,n.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=a,this.isCompressed=c}async fetch({name:a}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!a)throw new Error("CMap name must be specified.");const c=this.baseUrl+a+(this.isCompressed?".bcmap":""),T=this.isCompressed?n.CMapCompressionType.BINARY:n.CMapCompressionType.NONE;return this._fetchData(c,T).catch(p=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${c}`)})}_fetchData(a,c){(0,n.unreachable)("Abstract method `_fetchData` called.")}}t.BaseCMapReaderFactory=d;class f{constructor({baseUrl:a=null}){this.constructor===f&&(0,n.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=a}async fetch({filename:a}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!a)throw new Error("Font filename must be specified.");const c=`${this.baseUrl}${a}`;return this._fetchData(c).catch(T=>{throw new Error(`Unable to load font data at: ${c}`)})}_fetchData(a){(0,n.unreachable)("Abstract method `_fetchData` called.")}}t.BaseStandardFontDataFactory=f;class m{constructor(){this.constructor===m&&(0,n.unreachable)("Cannot initialize BaseSVGFactory.")}create(a,c,T=!1){if(a<=0||c<=0)throw new Error("Invalid SVG dimensions");const p=this._createSVG("svg:svg");return p.setAttribute("version","1.1"),T||(p.setAttribute("width",`${a}px`),p.setAttribute("height",`${c}px`)),p.setAttribute("preserveAspectRatio","none"),p.setAttribute("viewBox",`0 0 ${a} ${c}`),p}createElement(a){if(typeof a!="string")throw new Error("Invalid SVG element type");return this._createSVG(a)}_createSVG(a){(0,n.unreachable)("Abstract method `_createSVG` called.")}}t.BaseSVGFactory=m},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MurmurHash3_64=void 0;var n=s(1);const i=3285377520,r=4294901760,d=65535;class f{constructor(u){this.h1=u?u&4294967295:i,this.h2=u?u&4294967295:i}update(u){let a,c;if(typeof u=="string"){a=new Uint8Array(u.length*2),c=0;for(let F=0,H=u.length;F<H;F++){const U=u.charCodeAt(F);U<=255?a[c++]=U:(a[c++]=U>>>8,a[c++]=U&255)}}else if((0,n.isArrayBuffer)(u))a=u.slice(),c=a.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const T=c>>2,p=c-T*4,h=new Uint32Array(a.buffer,0,T);let _=0,I=0,A=this.h1,O=this.h2;const w=3432918353,P=461845907,C=w&d,y=P&d;for(let F=0;F<T;F++)F&1?(_=h[F],_=_*w&r|_*C&d,_=_<<15|_>>>17,_=_*P&r|_*y&d,A^=_,A=A<<13|A>>>19,A=A*5+3864292196):(I=h[F],I=I*w&r|I*C&d,I=I<<15|I>>>17,I=I*P&r|I*y&d,O^=I,O=O<<13|O>>>19,O=O*5+3864292196);switch(_=0,p){case 3:_^=a[T*4+2]<<16;case 2:_^=a[T*4+1]<<8;case 1:_^=a[T*4],_=_*w&r|_*C&d,_=_<<15|_>>>17,_=_*P&r|_*y&d,T&1?A^=_:O^=_}this.h1=A,this.h2=O}hexdigest(){let u=this.h1,a=this.h2;return u^=a>>>1,u=u*3981806797&r|u*36045&d,a=a*4283543511&r|((a<<16|u>>>16)*2950163797&r)>>>16,u^=a>>>1,u=u*444984403&r|u*60499&d,a=a*3301882366&r|((a<<16|u>>>16)*3120437893&r)>>>16,u^=a>>>1,(u>>>0).toString(16).padStart(8,"0")+(a>>>0).toString(16).padStart(8,"0")}}t.MurmurHash3_64=f},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FontLoader=t.FontFaceObject=void 0;var n=s(1);class i{#e=new Set;constructor({ownerDocument:f=globalThis.document,styleElement:m=null}){this._document=f,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(f){this.nativeFontFaces.add(f),this._document.fonts.add(f)}removeNativeFontFace(f){this.nativeFontFaces.delete(f),this._document.fonts.delete(f)}insertRule(f){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const m=this.styleElement.sheet;m.insertRule(f,m.cssRules.length)}clear(){for(const f of this.nativeFontFaces)this._document.fonts.delete(f);this.nativeFontFaces.clear(),this.#e.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(f){if(!(!f||this.#e.has(f.loadedName))){if((0,n.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:m,src:u,style:a}=f,c=new FontFace(m,u,a);this.addNativeFontFace(c);try{await c.load(),this.#e.add(m)}catch{(0,n.warn)(`Cannot load system font: ${f.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(c)}return}(0,n.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(f){if(f.attached||f.missingFile&&!f.systemFontInfo)return;if(f.attached=!0,f.systemFontInfo){await this.loadSystemFont(f.systemFontInfo);return}if(this.isFontLoadingAPISupported){const u=f.createNativeFontFace();if(u){this.addNativeFontFace(u);try{await u.loaded}catch(a){throw(0,n.warn)(`Failed to load font '${u.family}': '${a}'.`),f.disableFontFace=!0,a}}return}const m=f.createFontFaceRule();if(m){if(this.insertRule(m),this.isSyncFontLoadingSupported)return;await new Promise(u=>{const a=this._queueLoadingCallback(u);this._prepareFontLoadEvent(f,a)})}}get isFontLoadingAPISupported(){const f=!!this._document?.fonts;return(0,n.shadow)(this,"isFontLoadingAPISupported",f)}get isSyncFontLoadingSupported(){let f=!1;return(n.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(f=!0),(0,n.shadow)(this,"isSyncFontLoadingSupported",f)}_queueLoadingCallback(f){function m(){for((0,n.assert)(!a.done,"completeRequest() cannot be called twice."),a.done=!0;u.length>0&&u[0].done;){const c=u.shift();setTimeout(c.callback,0)}}const{loadingRequests:u}=this,a={done:!1,complete:m,callback:f};return u.push(a),a}get _loadTestFont(){const f=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,n.shadow)(this,"_loadTestFont",f)}_prepareFontLoadEvent(f,m){function u(Y,V){return Y.charCodeAt(V)<<24|Y.charCodeAt(V+1)<<16|Y.charCodeAt(V+2)<<8|Y.charCodeAt(V+3)&255}function a(Y,V,ie,J){const ne=Y.substring(0,V),ae=Y.substring(V+ie);return ne+J+ae}let c,T;const p=this._document.createElement("canvas");p.width=1,p.height=1;const h=p.getContext("2d");let _=0;function I(Y,V){if(++_>30){(0,n.warn)("Load test font never loaded."),V();return}if(h.font="30px "+Y,h.fillText(".",0,20),h.getImageData(0,0,1,1).data[3]>0){V();return}setTimeout(I.bind(null,Y,V))}const A=`lt${Date.now()}${this.loadTestFontId++}`;let O=this._loadTestFont;O=a(O,976,A.length,A);const P=16,C=1482184792;let y=u(O,P);for(c=0,T=A.length-3;c<T;c+=4)y=y-C+u(A,c)|0;c<A.length&&(y=y-C+u(A+"XXX",c)|0),O=a(O,P,4,(0,n.string32)(y));const F=`url(data:font/opentype;base64,${btoa(O)});`,H=`@font-face {font-family:"${A}";src:${F}}`;this.insertRule(H);const U=this._document.createElement("div");U.style.visibility="hidden",U.style.width=U.style.height="10px",U.style.position="absolute",U.style.top=U.style.left="0px";for(const Y of[f.loadedName,A]){const V=this._document.createElement("span");V.textContent="Hi",V.style.fontFamily=Y,U.append(V)}this._document.body.append(U),I(A,()=>{U.remove(),m.complete()})}}t.FontLoader=i;class r{constructor(f,{isEvalSupported:m=!0,disableFontFace:u=!1,ignoreErrors:a=!1,inspectFont:c=null}){this.compiledGlyphs=Object.create(null);for(const T in f)this[T]=f[T];this.isEvalSupported=m!==!1,this.disableFontFace=u===!0,this.ignoreErrors=a===!0,this._inspectFont=c}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let f;if(!this.cssFontInfo)f=new FontFace(this.loadedName,this.data,{});else{const m={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(m.style=`oblique ${this.cssFontInfo.italicAngle}deg`),f=new FontFace(this.cssFontInfo.fontFamily,this.data,m)}return this._inspectFont?.(this),f}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const f=(0,n.bytesToString)(this.data),m=`url(data:${this.mimetype};base64,${btoa(f)});`;let u;if(!this.cssFontInfo)u=`@font-face {font-family:"${this.loadedName}";src:${m}}`;else{let a=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(a+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),u=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${a}src:${m}}`}return this._inspectFont?.(this,m),u}getPathGenerator(f,m){if(this.compiledGlyphs[m]!==void 0)return this.compiledGlyphs[m];let u;try{u=f.get(this.loadedName+"_path_"+m)}catch(a){if(!this.ignoreErrors)throw a;return(0,n.warn)(`getPathGenerator - ignoring character: "${a}".`),this.compiledGlyphs[m]=function(c,T){}}if(this.isEvalSupported&&n.FeatureTest.isEvalSupported){const a=[];for(const c of u){const T=c.args!==void 0?c.args.join(","):"";a.push("c.",c.cmd,"(",T,`);
`)}return this.compiledGlyphs[m]=new Function("c","size",a.join(""))}return this.compiledGlyphs[m]=function(a,c){for(const T of u)T.cmd==="scale"&&(T.args=[c,-c]),a[T.cmd].apply(a,T.args)}}}t.FontFaceObject=r},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NodeStandardFontDataFactory=t.NodeFilterFactory=t.NodeCanvasFactory=t.NodeCMapReaderFactory=void 0;var n=s(7);s(1);const i=function(u){return new Promise((a,c)=>{require$$5.readFile(u,(p,h)=>{if(p||!h){c(new Error(p));return}a(new Uint8Array(h))})})};class r extends n.BaseFilterFactory{}t.NodeFilterFactory=r;class d extends n.BaseCanvasFactory{_createCanvas(a,c){return require$$5.createCanvas(a,c)}}t.NodeCanvasFactory=d;class f extends n.BaseCMapReaderFactory{_fetchData(a,c){return i(a).then(T=>({cMapData:T,compressionType:c}))}}t.NodeCMapReaderFactory=f;class m extends n.BaseStandardFontDataFactory{_fetchData(a){return i(a)}}t.NodeStandardFontDataFactory=m},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasGraphics=void 0;var n=s(1),i=s(6),r=s(12),d=s(13);const f=16,m=100,u=4096,a=15,c=10,T=1e3,p=16;function h(N,b){if(N._removeMirroring)throw new Error("Context is already forwarding operations.");N.__originalSave=N.save,N.__originalRestore=N.restore,N.__originalRotate=N.rotate,N.__originalScale=N.scale,N.__originalTranslate=N.translate,N.__originalTransform=N.transform,N.__originalSetTransform=N.setTransform,N.__originalResetTransform=N.resetTransform,N.__originalClip=N.clip,N.__originalMoveTo=N.moveTo,N.__originalLineTo=N.lineTo,N.__originalBezierCurveTo=N.bezierCurveTo,N.__originalRect=N.rect,N.__originalClosePath=N.closePath,N.__originalBeginPath=N.beginPath,N._removeMirroring=()=>{N.save=N.__originalSave,N.restore=N.__originalRestore,N.rotate=N.__originalRotate,N.scale=N.__originalScale,N.translate=N.__originalTranslate,N.transform=N.__originalTransform,N.setTransform=N.__originalSetTransform,N.resetTransform=N.__originalResetTransform,N.clip=N.__originalClip,N.moveTo=N.__originalMoveTo,N.lineTo=N.__originalLineTo,N.bezierCurveTo=N.__originalBezierCurveTo,N.rect=N.__originalRect,N.closePath=N.__originalClosePath,N.beginPath=N.__originalBeginPath,delete N._removeMirroring},N.save=function(){b.save(),this.__originalSave()},N.restore=function(){b.restore(),this.__originalRestore()},N.translate=function(R,L){b.translate(R,L),this.__originalTranslate(R,L)},N.scale=function(R,L){b.scale(R,L),this.__originalScale(R,L)},N.transform=function(R,L,B,W,M,E){b.transform(R,L,B,W,M,E),this.__originalTransform(R,L,B,W,M,E)},N.setTransform=function(R,L,B,W,M,E){b.setTransform(R,L,B,W,M,E),this.__originalSetTransform(R,L,B,W,M,E)},N.resetTransform=function(){b.resetTransform(),this.__originalResetTransform()},N.rotate=function(R){b.rotate(R),this.__originalRotate(R)},N.clip=function(R){b.clip(R),this.__originalClip(R)},N.moveTo=function(S,R){b.moveTo(S,R),this.__originalMoveTo(S,R)},N.lineTo=function(S,R){b.lineTo(S,R),this.__originalLineTo(S,R)},N.bezierCurveTo=function(S,R,L,B,W,M){b.bezierCurveTo(S,R,L,B,W,M),this.__originalBezierCurveTo(S,R,L,B,W,M)},N.rect=function(S,R,L,B){b.rect(S,R,L,B),this.__originalRect(S,R,L,B)},N.closePath=function(){b.closePath(),this.__originalClosePath()},N.beginPath=function(){b.beginPath(),this.__originalBeginPath()}}class _{constructor(b){this.canvasFactory=b,this.cache=Object.create(null)}getCanvas(b,S,R){let L;return this.cache[b]!==void 0?(L=this.cache[b],this.canvasFactory.reset(L,S,R)):(L=this.canvasFactory.create(S,R),this.cache[b]=L),L}delete(b){delete this.cache[b]}clear(){for(const b in this.cache){const S=this.cache[b];this.canvasFactory.destroy(S),delete this.cache[b]}}}function I(N,b,S,R,L,B,W,M,E,D){const[x,v,k,q,j,K]=(0,i.getCurrentTransform)(N);if(v===0&&k===0){const Z=W*x+j,ee=Math.round(Z),se=M*q+K,re=Math.round(se),ce=(W+E)*x+j,he=Math.abs(Math.round(ce)-ee)||1,de=(M+D)*q+K,fe=Math.abs(Math.round(de)-re)||1;return N.setTransform(Math.sign(x),0,0,Math.sign(q),ee,re),N.drawImage(b,S,R,L,B,0,0,he,fe),N.setTransform(x,v,k,q,j,K),[he,fe]}if(x===0&&q===0){const Z=M*k+j,ee=Math.round(Z),se=W*v+K,re=Math.round(se),ce=(M+D)*k+j,he=Math.abs(Math.round(ce)-ee)||1,de=(W+E)*v+K,fe=Math.abs(Math.round(de)-re)||1;return N.setTransform(0,Math.sign(v),Math.sign(k),0,ee,re),N.drawImage(b,S,R,L,B,0,0,fe,he),N.setTransform(x,v,k,q,j,K),[fe,he]}N.drawImage(b,S,R,L,B,W,M,E,D);const ue=Math.hypot(x,v),Q=Math.hypot(k,q);return[ue*E,Q*D]}function A(N){const{width:b,height:S}=N;if(b>T||S>T)return null;const R=1e3,L=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),B=b+1;let W=new Uint8Array(B*(S+1)),M,E,D;const x=b+7&-8;let v=new Uint8Array(x*S),k=0;for(const Q of N.data){let Z=128;for(;Z>0;)v[k++]=Q&Z?0:255,Z>>=1}let q=0;for(k=0,v[k]!==0&&(W[0]=1,++q),E=1;E<b;E++)v[k]!==v[k+1]&&(W[E]=v[k]?2:1,++q),k++;for(v[k]!==0&&(W[E]=2,++q),M=1;M<S;M++){k=M*x,D=M*B,v[k-x]!==v[k]&&(W[D]=v[k]?1:8,++q);let Q=(v[k]?4:0)+(v[k-x]?8:0);for(E=1;E<b;E++)Q=(Q>>2)+(v[k+1]?4:0)+(v[k-x+1]?8:0),L[Q]&&(W[D+E]=L[Q],++q),k++;if(v[k-x]!==v[k]&&(W[D+E]=v[k]?2:4,++q),q>R)return null}for(k=x*(S-1),D=M*B,v[k]!==0&&(W[D]=8,++q),E=1;E<b;E++)v[k]!==v[k+1]&&(W[D+E]=v[k]?4:8,++q),k++;if(v[k]!==0&&(W[D+E]=4,++q),q>R)return null;const j=new Int32Array([0,B,-1,0,-B,0,0,0,1]),K=new Path2D;for(M=0;q&&M<=S;M++){let Q=M*B;const Z=Q+b;for(;Q<Z&&!W[Q];)Q++;if(Q===Z)continue;K.moveTo(Q%B,M);const ee=Q;let se=W[Q];do{const re=j[se];do Q+=re;while(!W[Q]);const ce=W[Q];ce!==5&&ce!==10?(se=ce,W[Q]=0):(se=ce&51*se>>4,W[Q]&=se>>2|se<<2),K.lineTo(Q%B,Q/B|0),W[Q]||--q}while(ee!==Q);--M}return v=null,W=null,function(Q){Q.save(),Q.scale(1/b,-1/S),Q.translate(0,-S),Q.fill(K),Q.beginPath(),Q.restore()}}class O{constructor(b,S){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=n.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=n.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,b,S])}clone(){const b=Object.create(this);return b.clipBox=this.clipBox.slice(),b}setCurrentPoint(b,S){this.x=b,this.y=S}updatePathMinMax(b,S,R){[S,R]=n.Util.applyTransform([S,R],b),this.minX=Math.min(this.minX,S),this.minY=Math.min(this.minY,R),this.maxX=Math.max(this.maxX,S),this.maxY=Math.max(this.maxY,R)}updateRectMinMax(b,S){const R=n.Util.applyTransform(S,b),L=n.Util.applyTransform(S.slice(2),b);this.minX=Math.min(this.minX,R[0],L[0]),this.minY=Math.min(this.minY,R[1],L[1]),this.maxX=Math.max(this.maxX,R[0],L[0]),this.maxY=Math.max(this.maxY,R[1],L[1])}updateScalingPathMinMax(b,S){n.Util.scaleMinMax(b,S),this.minX=Math.min(this.minX,S[0]),this.maxX=Math.max(this.maxX,S[1]),this.minY=Math.min(this.minY,S[2]),this.maxY=Math.max(this.maxY,S[3])}updateCurvePathMinMax(b,S,R,L,B,W,M,E,D,x){const v=n.Util.bezierBoundingBox(S,R,L,B,W,M,E,D);if(x){x[0]=Math.min(x[0],v[0],v[2]),x[1]=Math.max(x[1],v[0],v[2]),x[2]=Math.min(x[2],v[1],v[3]),x[3]=Math.max(x[3],v[1],v[3]);return}this.updateRectMinMax(b,v)}getPathBoundingBox(b=r.PathType.FILL,S=null){const R=[this.minX,this.minY,this.maxX,this.maxY];if(b===r.PathType.STROKE){S||(0,n.unreachable)("Stroke bounding box must include transform.");const L=n.Util.singularValueDecompose2dScale(S),B=L[0]*this.lineWidth/2,W=L[1]*this.lineWidth/2;R[0]-=B,R[1]-=W,R[2]+=B,R[3]+=W}return R}updateClipFromPath(){const b=n.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(b||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(b){this.clipBox=b,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(b=r.PathType.FILL,S=null){return n.Util.intersect(this.clipBox,this.getPathBoundingBox(b,S))}}function w(N,b){if(typeof ImageData<"u"&&b instanceof ImageData){N.putImageData(b,0,0);return}const S=b.height,R=b.width,L=S%p,B=(S-L)/p,W=L===0?B:B+1,M=N.createImageData(R,p);let E=0,D;const x=b.data,v=M.data;let k,q,j,K;if(b.kind===n.ImageKind.GRAYSCALE_1BPP){const ue=x.byteLength,Q=new Uint32Array(v.buffer,0,v.byteLength>>2),Z=Q.length,ee=R+7>>3,se=4294967295,re=n.FeatureTest.isLittleEndian?4278190080:255;for(k=0;k<W;k++){for(j=k<B?p:L,D=0,q=0;q<j;q++){const ce=ue-E;let he=0;const de=ce>ee?R:ce*8-7,fe=de&-8;let ge=0,pe=0;for(;he<fe;he+=8)pe=x[E++],Q[D++]=pe&128?se:re,Q[D++]=pe&64?se:re,Q[D++]=pe&32?se:re,Q[D++]=pe&16?se:re,Q[D++]=pe&8?se:re,Q[D++]=pe&4?se:re,Q[D++]=pe&2?se:re,Q[D++]=pe&1?se:re;for(;he<de;he++)ge===0&&(pe=x[E++],ge=128),Q[D++]=pe&ge?se:re,ge>>=1}for(;D<Z;)Q[D++]=0;N.putImageData(M,0,k*p)}}else if(b.kind===n.ImageKind.RGBA_32BPP){for(q=0,K=R*p*4,k=0;k<B;k++)v.set(x.subarray(E,E+K)),E+=K,N.putImageData(M,0,q),q+=p;k<W&&(K=R*L*4,v.set(x.subarray(E,E+K)),N.putImageData(M,0,q))}else if(b.kind===n.ImageKind.RGB_24BPP)for(j=p,K=R*j,k=0;k<W;k++){for(k>=B&&(j=L,K=R*j),D=0,q=K;q--;)v[D++]=x[E++],v[D++]=x[E++],v[D++]=x[E++],v[D++]=255;N.putImageData(M,0,k*p)}else throw new Error(`bad image kind: ${b.kind}`)}function P(N,b){if(b.bitmap){N.drawImage(b.bitmap,0,0);return}const S=b.height,R=b.width,L=S%p,B=(S-L)/p,W=L===0?B:B+1,M=N.createImageData(R,p);let E=0;const D=b.data,x=M.data;for(let v=0;v<W;v++){const k=v<B?p:L;({srcPos:E}=(0,d.convertBlackAndWhiteToRGBA)({src:D,srcPos:E,dest:x,width:R,height:k,nonBlackColor:0})),N.putImageData(M,0,v*p)}}function C(N,b){const S=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const R of S)N[R]!==void 0&&(b[R]=N[R]);N.setLineDash!==void 0&&(b.setLineDash(N.getLineDash()),b.lineDashOffset=N.lineDashOffset)}function y(N){if(N.strokeStyle=N.fillStyle="#000000",N.fillRule="nonzero",N.globalAlpha=1,N.lineWidth=1,N.lineCap="butt",N.lineJoin="miter",N.miterLimit=10,N.globalCompositeOperation="source-over",N.font="10px sans-serif",N.setLineDash!==void 0&&(N.setLineDash([]),N.lineDashOffset=0),!n.isNodeJS){const{filter:b}=N;b!=="none"&&b!==""&&(N.filter="none")}}function F(N,b,S,R){const L=N.length;for(let B=3;B<L;B+=4){const W=N[B];if(W===0)N[B-3]=b,N[B-2]=S,N[B-1]=R;else if(W<255){const M=255-W;N[B-3]=N[B-3]*W+b*M>>8,N[B-2]=N[B-2]*W+S*M>>8,N[B-1]=N[B-1]*W+R*M>>8}}}function H(N,b,S){const R=N.length,L=1/255;for(let B=3;B<R;B+=4){const W=S?S[N[B]]:N[B];b[B]=b[B]*W*L|0}}function U(N,b,S){const R=N.length;for(let L=3;L<R;L+=4){const B=N[L-3]*77+N[L-2]*152+N[L-1]*28;b[L]=S?b[L]*S[B>>8]>>8:b[L]*B>>16}}function Y(N,b,S,R,L,B,W,M,E,D,x){const v=!!B,k=v?B[0]:0,q=v?B[1]:0,j=v?B[2]:0,K=L==="Luminosity"?U:H,Q=Math.min(R,Math.ceil(1048576/S));for(let Z=0;Z<R;Z+=Q){const ee=Math.min(Q,R-Z),se=N.getImageData(M-D,Z+(E-x),S,ee),re=b.getImageData(M,Z+E,S,ee);v&&F(se.data,k,q,j),K(se.data,re.data,W),b.putImageData(re,M,Z+E)}}function V(N,b,S,R){const L=R[0],B=R[1],W=R[2]-L,M=R[3]-B;W===0||M===0||(Y(b.context,S,W,M,b.subtype,b.backdrop,b.transferMap,L,B,b.offsetX,b.offsetY),N.save(),N.globalAlpha=1,N.globalCompositeOperation="source-over",N.setTransform(1,0,0,1,0,0),N.drawImage(S.canvas,0,0),N.restore())}function ie(N,b){const S=n.Util.singularValueDecompose2dScale(N);S[0]=Math.fround(S[0]),S[1]=Math.fround(S[1]);const R=Math.fround((globalThis.devicePixelRatio||1)*i.PixelsPerInch.PDF_TO_CSS_UNITS);return b!==void 0?b:S[0]<=R||S[1]<=R}const J=["butt","round","square"],ne=["miter","round","bevel"],ae={},te={};class G{constructor(b,S,R,L,B,{optionalContentConfig:W,markedContentStack:M=null},E,D){this.ctx=b,this.current=new O(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=S,this.objs=R,this.canvasFactory=L,this.filterFactory=B,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=M||[],this.optionalContentConfig=W,this.cachedCanvases=new _(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=E,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=D,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(b,S=null){return typeof b=="string"?b.startsWith("g_")?this.commonObjs.get(b):this.objs.get(b):S}beginDrawing({transform:b,viewport:S,transparency:R=!1,background:L=null}){const B=this.ctx.canvas.width,W=this.ctx.canvas.height,M=this.ctx.fillStyle;if(this.ctx.fillStyle=L||"#ffffff",this.ctx.fillRect(0,0,B,W),this.ctx.fillStyle=M,R){const E=this.cachedCanvases.getCanvas("transparent",B,W);this.compositeCtx=this.ctx,this.transparentCanvas=E.canvas,this.ctx=E.context,this.ctx.save(),this.ctx.transform(...(0,i.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),y(this.ctx),b&&(this.ctx.transform(...b),this.outputScaleX=b[0],this.outputScaleY=b[0]),this.ctx.transform(...S.transform),this.viewportScale=S.scale,this.baseTransform=(0,i.getCurrentTransform)(this.ctx)}executeOperatorList(b,S,R,L){const B=b.argsArray,W=b.fnArray;let M=S||0;const E=B.length;if(E===M)return M;const D=E-M>c&&typeof R=="function",x=D?Date.now()+a:0;let v=0;const k=this.commonObjs,q=this.objs;let j;for(;;){if(L!==void 0&&M===L.nextBreakPoint)return L.breakIt(M,R),M;if(j=W[M],j!==n.OPS.dependency)this[j].apply(this,B[M]);else for(const K of B[M]){const ue=K.startsWith("g_")?k:q;if(!ue.has(K))return ue.get(K,R),M}if(M++,M===E)return M;if(D&&++v>c){if(Date.now()>x)return R(),M;v=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const b of this._cachedBitmapsMap.values()){for(const S of b.values())typeof HTMLCanvasElement<"u"&&S instanceof HTMLCanvasElement&&(S.width=S.height=0);b.clear()}this._cachedBitmapsMap.clear(),this.#t()}#t(){if(this.pageColors){const b=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(b!=="none"){const S=this.ctx.filter;this.ctx.filter=b,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=S}}}_scaleImage(b,S){const R=b.width,L=b.height;let B=Math.max(Math.hypot(S[0],S[1]),1),W=Math.max(Math.hypot(S[2],S[3]),1),M=R,E=L,D="prescale1",x,v;for(;B>2&&M>1||W>2&&E>1;){let k=M,q=E;B>2&&M>1&&(k=M>=16384?Math.floor(M/2)-1||1:Math.ceil(M/2),B/=M/k),W>2&&E>1&&(q=E>=16384?Math.floor(E/2)-1||1:Math.ceil(E)/2,W/=E/q),x=this.cachedCanvases.getCanvas(D,k,q),v=x.context,v.clearRect(0,0,k,q),v.drawImage(b,0,0,M,E,0,0,k,q),b=x.canvas,M=k,E=q,D=D==="prescale1"?"prescale2":"prescale1"}return{img:b,paintWidth:M,paintHeight:E}}_createMaskCanvas(b){const S=this.ctx,{width:R,height:L}=b,B=this.current.fillColor,W=this.current.patternFill,M=(0,i.getCurrentTransform)(S);let E,D,x,v;if((b.bitmap||b.data)&&b.count>1){const he=b.bitmap||b.data.buffer;D=JSON.stringify(W?M:[M.slice(0,4),B]),E=this._cachedBitmapsMap.get(he),E||(E=new Map,this._cachedBitmapsMap.set(he,E));const de=E.get(D);if(de&&!W){const fe=Math.round(Math.min(M[0],M[2])+M[4]),ge=Math.round(Math.min(M[1],M[3])+M[5]);return{canvas:de,offsetX:fe,offsetY:ge}}x=de}x||(v=this.cachedCanvases.getCanvas("maskCanvas",R,L),P(v.context,b));let k=n.Util.transform(M,[1/R,0,0,-1/L,0,0]);k=n.Util.transform(k,[1,0,0,1,0,-L]);const q=n.Util.applyTransform([0,0],k),j=n.Util.applyTransform([R,L],k),K=n.Util.normalizeRect([q[0],q[1],j[0],j[1]]),ue=Math.round(K[2]-K[0])||1,Q=Math.round(K[3]-K[1])||1,Z=this.cachedCanvases.getCanvas("fillCanvas",ue,Q),ee=Z.context,se=Math.min(q[0],j[0]),re=Math.min(q[1],j[1]);ee.translate(-se,-re),ee.transform(...k),x||(x=this._scaleImage(v.canvas,(0,i.getCurrentTransformInverse)(ee)),x=x.img,E&&W&&E.set(D,x)),ee.imageSmoothingEnabled=ie((0,i.getCurrentTransform)(ee),b.interpolate),I(ee,x,0,0,x.width,x.height,0,0,R,L),ee.globalCompositeOperation="source-in";const ce=n.Util.transform((0,i.getCurrentTransformInverse)(ee),[1,0,0,1,-se,-re]);return ee.fillStyle=W?B.getPattern(S,this,ce,r.PathType.FILL):B,ee.fillRect(0,0,R,L),E&&!W&&(this.cachedCanvases.delete("fillCanvas"),E.set(D,Z.canvas)),{canvas:Z.canvas,offsetX:Math.round(se),offsetY:Math.round(re)}}setLineWidth(b){b!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=b,this.ctx.lineWidth=b}setLineCap(b){this.ctx.lineCap=J[b]}setLineJoin(b){this.ctx.lineJoin=ne[b]}setMiterLimit(b){this.ctx.miterLimit=b}setDash(b,S){const R=this.ctx;R.setLineDash!==void 0&&(R.setLineDash(b),R.lineDashOffset=S)}setRenderingIntent(b){}setFlatness(b){}setGState(b){for(const[S,R]of b)switch(S){case"LW":this.setLineWidth(R);break;case"LC":this.setLineCap(R);break;case"LJ":this.setLineJoin(R);break;case"ML":this.setMiterLimit(R);break;case"D":this.setDash(R[0],R[1]);break;case"RI":this.setRenderingIntent(R);break;case"FL":this.setFlatness(R);break;case"Font":this.setFont(R[0],R[1]);break;case"CA":this.current.strokeAlpha=R;break;case"ca":this.current.fillAlpha=R,this.ctx.globalAlpha=R;break;case"BM":this.ctx.globalCompositeOperation=R;break;case"SMask":this.current.activeSMask=R?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(R);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const b=this.inSMaskMode;this.current.activeSMask&&!b?this.beginSMaskMode():!this.current.activeSMask&&b&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const b=this.ctx.canvas.width,S=this.ctx.canvas.height,R="smaskGroupAt"+this.groupLevel,L=this.cachedCanvases.getCanvas(R,b,S);this.suspendedCtx=this.ctx,this.ctx=L.context;const B=this.ctx;B.setTransform(...(0,i.getCurrentTransform)(this.suspendedCtx)),C(this.suspendedCtx,B),h(B,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),C(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(b){if(!this.current.activeSMask)return;b?(b[0]=Math.floor(b[0]),b[1]=Math.floor(b[1]),b[2]=Math.ceil(b[2]),b[3]=Math.ceil(b[3])):b=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const S=this.current.activeSMask,R=this.suspendedCtx;V(R,S,this.ctx,b),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(C(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const b=this.current;this.stateStack.push(b),this.current=b.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),C(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(b,S,R,L,B,W){this.ctx.transform(b,S,R,L,B,W),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(b,S,R){const L=this.ctx,B=this.current;let W=B.x,M=B.y,E,D;const x=(0,i.getCurrentTransform)(L),v=x[0]===0&&x[3]===0||x[1]===0&&x[2]===0,k=v?R.slice(0):null;for(let q=0,j=0,K=b.length;q<K;q++)switch(b[q]|0){case n.OPS.rectangle:W=S[j++],M=S[j++];const ue=S[j++],Q=S[j++],Z=W+ue,ee=M+Q;L.moveTo(W,M),ue===0||Q===0?L.lineTo(Z,ee):(L.lineTo(Z,M),L.lineTo(Z,ee),L.lineTo(W,ee)),v||B.updateRectMinMax(x,[W,M,Z,ee]),L.closePath();break;case n.OPS.moveTo:W=S[j++],M=S[j++],L.moveTo(W,M),v||B.updatePathMinMax(x,W,M);break;case n.OPS.lineTo:W=S[j++],M=S[j++],L.lineTo(W,M),v||B.updatePathMinMax(x,W,M);break;case n.OPS.curveTo:E=W,D=M,W=S[j+4],M=S[j+5],L.bezierCurveTo(S[j],S[j+1],S[j+2],S[j+3],W,M),B.updateCurvePathMinMax(x,E,D,S[j],S[j+1],S[j+2],S[j+3],W,M,k),j+=6;break;case n.OPS.curveTo2:E=W,D=M,L.bezierCurveTo(W,M,S[j],S[j+1],S[j+2],S[j+3]),B.updateCurvePathMinMax(x,E,D,W,M,S[j],S[j+1],S[j+2],S[j+3],k),W=S[j+2],M=S[j+3],j+=4;break;case n.OPS.curveTo3:E=W,D=M,W=S[j+2],M=S[j+3],L.bezierCurveTo(S[j],S[j+1],W,M,W,M),B.updateCurvePathMinMax(x,E,D,S[j],S[j+1],W,M,W,M,k),j+=4;break;case n.OPS.closePath:L.closePath();break}v&&B.updateScalingPathMinMax(x,k),B.setCurrentPoint(W,M)}closePath(){this.ctx.closePath()}stroke(b=!0){const S=this.ctx,R=this.current.strokeColor;S.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof R=="object"&&R?.getPattern?(S.save(),S.strokeStyle=R.getPattern(S,this,(0,i.getCurrentTransformInverse)(S),r.PathType.STROKE),this.rescaleAndStroke(!1),S.restore()):this.rescaleAndStroke(!0)),b&&this.consumePath(this.current.getClippedPathBoundingBox()),S.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(b=!0){const S=this.ctx,R=this.current.fillColor,L=this.current.patternFill;let B=!1;L&&(S.save(),S.fillStyle=R.getPattern(S,this,(0,i.getCurrentTransformInverse)(S),r.PathType.FILL),B=!0);const W=this.current.getClippedPathBoundingBox();this.contentVisible&&W!==null&&(this.pendingEOFill?(S.fill("evenodd"),this.pendingEOFill=!1):S.fill()),B&&S.restore(),b&&this.consumePath(W)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=ae}eoClip(){this.pendingClip=te}beginText(){this.current.textMatrix=n.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const b=this.pendingTextPaths,S=this.ctx;if(b===void 0){S.beginPath();return}S.save(),S.beginPath();for(const R of b)S.setTransform(...R.transform),S.translate(R.x,R.y),R.addToPath(S,R.fontSize);S.restore(),S.clip(),S.beginPath(),delete this.pendingTextPaths}setCharSpacing(b){this.current.charSpacing=b}setWordSpacing(b){this.current.wordSpacing=b}setHScale(b){this.current.textHScale=b/100}setLeading(b){this.current.leading=-b}setFont(b,S){const R=this.commonObjs.get(b),L=this.current;if(!R)throw new Error(`Can't find font for ${b}`);if(L.fontMatrix=R.fontMatrix||n.FONT_IDENTITY_MATRIX,(L.fontMatrix[0]===0||L.fontMatrix[3]===0)&&(0,n.warn)("Invalid font matrix for font "+b),S<0?(S=-S,L.fontDirection=-1):L.fontDirection=1,this.current.font=R,this.current.fontSize=S,R.isType3Font)return;const B=R.loadedName||"sans-serif",W=R.systemFontInfo?.css||`"${B}", ${R.fallbackName}`;let M="normal";R.black?M="900":R.bold&&(M="bold");const E=R.italic?"italic":"normal";let D=S;S<f?D=f:S>m&&(D=m),this.current.fontSizeScale=S/D,this.ctx.font=`${E} ${M} ${D}px ${W}`}setTextRenderingMode(b){this.current.textRenderingMode=b}setTextRise(b){this.current.textRise=b}moveText(b,S){this.current.x=this.current.lineX+=b,this.current.y=this.current.lineY+=S}setLeadingMoveText(b,S){this.setLeading(-S),this.moveText(b,S)}setTextMatrix(b,S,R,L,B,W){this.current.textMatrix=[b,S,R,L,B,W],this.current.textMatrixScale=Math.hypot(b,S),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(b,S,R,L){const B=this.ctx,W=this.current,M=W.font,E=W.textRenderingMode,D=W.fontSize/W.fontSizeScale,x=E&n.TextRenderingMode.FILL_STROKE_MASK,v=!!(E&n.TextRenderingMode.ADD_TO_PATH_FLAG),k=W.patternFill&&!M.missingFile;let q;(M.disableFontFace||v||k)&&(q=M.getPathGenerator(this.commonObjs,b)),M.disableFontFace||k?(B.save(),B.translate(S,R),B.beginPath(),q(B,D),L&&B.setTransform(...L),(x===n.TextRenderingMode.FILL||x===n.TextRenderingMode.FILL_STROKE)&&B.fill(),(x===n.TextRenderingMode.STROKE||x===n.TextRenderingMode.FILL_STROKE)&&B.stroke(),B.restore()):((x===n.TextRenderingMode.FILL||x===n.TextRenderingMode.FILL_STROKE)&&B.fillText(b,S,R),(x===n.TextRenderingMode.STROKE||x===n.TextRenderingMode.FILL_STROKE)&&B.strokeText(b,S,R)),v&&(this.pendingTextPaths||=[]).push({transform:(0,i.getCurrentTransform)(B),x:S,y:R,fontSize:D,addToPath:q})}get isFontSubpixelAAEnabled(){const{context:b}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);b.scale(1.5,1),b.fillText("I",0,10);const S=b.getImageData(0,0,10,10).data;let R=!1;for(let L=3;L<S.length;L+=4)if(S[L]>0&&S[L]<255){R=!0;break}return(0,n.shadow)(this,"isFontSubpixelAAEnabled",R)}showText(b){const S=this.current,R=S.font;if(R.isType3Font)return this.showType3Text(b);const L=S.fontSize;if(L===0)return;const B=this.ctx,W=S.fontSizeScale,M=S.charSpacing,E=S.wordSpacing,D=S.fontDirection,x=S.textHScale*D,v=b.length,k=R.vertical,q=k?1:-1,j=R.defaultVMetrics,K=L*S.fontMatrix[0],ue=S.textRenderingMode===n.TextRenderingMode.FILL&&!R.disableFontFace&&!S.patternFill;B.save(),B.transform(...S.textMatrix),B.translate(S.x,S.y+S.textRise),D>0?B.scale(x,-1):B.scale(x,1);let Q;if(S.patternFill){B.save();const ce=S.fillColor.getPattern(B,this,(0,i.getCurrentTransformInverse)(B),r.PathType.FILL);Q=(0,i.getCurrentTransform)(B),B.restore(),B.fillStyle=ce}let Z=S.lineWidth;const ee=S.textMatrixScale;if(ee===0||Z===0){const ce=S.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;(ce===n.TextRenderingMode.STROKE||ce===n.TextRenderingMode.FILL_STROKE)&&(Z=this.getSinglePixelWidth())}else Z/=ee;if(W!==1&&(B.scale(W,W),Z/=W),B.lineWidth=Z,R.isInvalidPDFjsFont){const ce=[];let he=0;for(const de of b)ce.push(de.unicode),he+=de.width;B.fillText(ce.join(""),0,0),S.x+=he*K*x,B.restore(),this.compose();return}let se=0,re;for(re=0;re<v;++re){const ce=b[re];if(typeof ce=="number"){se+=q*ce*L/1e3;continue}let he=!1;const de=(ce.isSpace?E:0)+M,fe=ce.fontChar,ge=ce.accent;let pe,Ie,_e=ce.width;if(k){const be=ce.vmetric||j,ye=-(ce.vmetric?be[1]:_e*.5)*K,Fe=be[2]*K;_e=be?-be[0]:_e,pe=ye/W,Ie=(se+Fe)/W}else pe=se/W,Ie=0;if(R.remeasure&&_e>0){const be=B.measureText(fe).width*1e3/L*W;if(_e<be&&this.isFontSubpixelAAEnabled){const ye=_e/be;he=!0,B.save(),B.scale(ye,1),pe/=ye}else _e!==be&&(pe+=(_e-be)/2e3*L/W)}if(this.contentVisible&&(ce.isInFont||R.missingFile)){if(ue&&!ge)B.fillText(fe,pe,Ie);else if(this.paintChar(fe,pe,Ie,Q),ge){const be=pe+L*ge.offset.x/W,ye=Ie-L*ge.offset.y/W;this.paintChar(ge.fontChar,be,ye,Q)}}const Re=k?_e*K-de*D:_e*K+de*D;se+=Re,he&&B.restore()}k?S.y-=se:S.x+=se*x,B.restore(),this.compose()}showType3Text(b){const S=this.ctx,R=this.current,L=R.font,B=R.fontSize,W=R.fontDirection,M=L.vertical?1:-1,E=R.charSpacing,D=R.wordSpacing,x=R.textHScale*W,v=R.fontMatrix||n.FONT_IDENTITY_MATRIX,k=b.length,q=R.textRenderingMode===n.TextRenderingMode.INVISIBLE;let j,K,ue,Q;if(!(q||B===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,S.save(),S.transform(...R.textMatrix),S.translate(R.x,R.y),S.scale(x,W),j=0;j<k;++j){if(K=b[j],typeof K=="number"){Q=M*K*B/1e3,this.ctx.translate(Q,0),R.x+=Q*x;continue}const Z=(K.isSpace?D:0)+E,ee=L.charProcOperatorList[K.operatorListId];if(!ee){(0,n.warn)(`Type3 character "${K.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=K,this.save(),S.scale(B,B),S.transform(...v),this.executeOperatorList(ee),this.restore()),ue=n.Util.applyTransform([K.width,0],v)[0]*B+Z,S.translate(ue,0),R.x+=ue*x}S.restore(),this.processingType3=null}}setCharWidth(b,S){}setCharWidthAndBounds(b,S,R,L,B,W){this.ctx.rect(R,L,B-R,W-L),this.ctx.clip(),this.endPath()}getColorN_Pattern(b){let S;if(b[0]==="TilingPattern"){const R=b[1],L=this.baseTransform||(0,i.getCurrentTransform)(this.ctx),B={createCanvasGraphics:W=>new G(W,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};S=new r.TilingPattern(b,R,this.ctx,B,L)}else S=this._getPattern(b[1],b[2]);return S}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(b,S,R){const L=n.Util.makeHexColor(b,S,R);this.ctx.strokeStyle=L,this.current.strokeColor=L}setFillRGBColor(b,S,R){const L=n.Util.makeHexColor(b,S,R);this.ctx.fillStyle=L,this.current.fillColor=L,this.current.patternFill=!1}_getPattern(b,S=null){let R;return this.cachedPatterns.has(b)?R=this.cachedPatterns.get(b):(R=(0,r.getShadingPattern)(this.getObject(b)),this.cachedPatterns.set(b,R)),S&&(R.matrix=S),R}shadingFill(b){if(!this.contentVisible)return;const S=this.ctx;this.save();const R=this._getPattern(b);S.fillStyle=R.getPattern(S,this,(0,i.getCurrentTransformInverse)(S),r.PathType.SHADING);const L=(0,i.getCurrentTransformInverse)(S);if(L){const{width:B,height:W}=S.canvas,[M,E,D,x]=n.Util.getAxialAlignedBoundingBox([0,0,B,W],L);this.ctx.fillRect(M,E,D-M,x-E)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,n.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,n.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(b,S){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(b)&&b.length===6&&this.transform(...b),this.baseTransform=(0,i.getCurrentTransform)(this.ctx),S)){const R=S[2]-S[0],L=S[3]-S[1];this.ctx.rect(S[0],S[1],R,L),this.current.updateRectMinMax((0,i.getCurrentTransform)(this.ctx),S),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(b){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const S=this.ctx;b.isolated||(0,n.info)("TODO: Support non-isolated groups."),b.knockout&&(0,n.warn)("Knockout groups not supported.");const R=(0,i.getCurrentTransform)(S);if(b.matrix&&S.transform(...b.matrix),!b.bbox)throw new Error("Bounding box is required.");let L=n.Util.getAxialAlignedBoundingBox(b.bbox,(0,i.getCurrentTransform)(S));const B=[0,0,S.canvas.width,S.canvas.height];L=n.Util.intersect(L,B)||[0,0,0,0];const W=Math.floor(L[0]),M=Math.floor(L[1]);let E=Math.max(Math.ceil(L[2])-W,1),D=Math.max(Math.ceil(L[3])-M,1),x=1,v=1;E>u&&(x=E/u,E=u),D>u&&(v=D/u,D=u),this.current.startNewPathAndClipBox([0,0,E,D]);let k="groupAt"+this.groupLevel;b.smask&&(k+="_smask_"+this.smaskCounter++%2);const q=this.cachedCanvases.getCanvas(k,E,D),j=q.context;j.scale(1/x,1/v),j.translate(-W,-M),j.transform(...R),b.smask?this.smaskStack.push({canvas:q.canvas,context:j,offsetX:W,offsetY:M,scaleX:x,scaleY:v,subtype:b.smask.subtype,backdrop:b.smask.backdrop,transferMap:b.smask.transferMap||null,startTransformInverse:null}):(S.setTransform(1,0,0,1,0,0),S.translate(W,M),S.scale(x,v),S.save()),C(S,j),this.ctx=j,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(S),this.groupLevel++}endGroup(b){if(!this.contentVisible)return;this.groupLevel--;const S=this.ctx,R=this.groupStack.pop();if(this.ctx=R,this.ctx.imageSmoothingEnabled=!1,b.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const L=(0,i.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...L);const B=n.Util.getAxialAlignedBoundingBox([0,0,S.canvas.width,S.canvas.height],L);this.ctx.drawImage(S.canvas,0,0),this.ctx.restore(),this.compose(B)}}beginAnnotation(b,S,R,L,B){if(this.#e(),y(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(S)&&S.length===4){const W=S[2]-S[0],M=S[3]-S[1];if(B&&this.annotationCanvasMap){R=R.slice(),R[4]-=S[0],R[5]-=S[1],S=S.slice(),S[0]=S[1]=0,S[2]=W,S[3]=M;const[E,D]=n.Util.singularValueDecompose2dScale((0,i.getCurrentTransform)(this.ctx)),{viewportScale:x}=this,v=Math.ceil(W*this.outputScaleX*x),k=Math.ceil(M*this.outputScaleY*x);this.annotationCanvas=this.canvasFactory.create(v,k);const{canvas:q,context:j}=this.annotationCanvas;this.annotationCanvasMap.set(b,q),this.annotationCanvas.savedCtx=this.ctx,this.ctx=j,this.ctx.save(),this.ctx.setTransform(E,0,0,-D,0,M*D),y(this.ctx)}else y(this.ctx),this.ctx.rect(S[0],S[1],W,M),this.ctx.clip(),this.endPath()}this.current=new O(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...R),this.transform(...L)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#t(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(b){if(!this.contentVisible)return;const S=b.count;b=this.getObject(b.data,b),b.count=S;const R=this.ctx,L=this.processingType3;if(L&&(L.compiled===void 0&&(L.compiled=A(b)),L.compiled)){L.compiled(R);return}const B=this._createMaskCanvas(b),W=B.canvas;R.save(),R.setTransform(1,0,0,1,0,0),R.drawImage(W,B.offsetX,B.offsetY),R.restore(),this.compose()}paintImageMaskXObjectRepeat(b,S,R=0,L=0,B,W){if(!this.contentVisible)return;b=this.getObject(b.data,b);const M=this.ctx;M.save();const E=(0,i.getCurrentTransform)(M);M.transform(S,R,L,B,0,0);const D=this._createMaskCanvas(b);M.setTransform(1,0,0,1,D.offsetX-E[4],D.offsetY-E[5]);for(let x=0,v=W.length;x<v;x+=2){const k=n.Util.transform(E,[S,R,L,B,W[x],W[x+1]]),[q,j]=n.Util.applyTransform([0,0],k);M.drawImage(D.canvas,q,j)}M.restore(),this.compose()}paintImageMaskXObjectGroup(b){if(!this.contentVisible)return;const S=this.ctx,R=this.current.fillColor,L=this.current.patternFill;for(const B of b){const{data:W,width:M,height:E,transform:D}=B,x=this.cachedCanvases.getCanvas("maskCanvas",M,E),v=x.context;v.save();const k=this.getObject(W,B);P(v,k),v.globalCompositeOperation="source-in",v.fillStyle=L?R.getPattern(v,this,(0,i.getCurrentTransformInverse)(S),r.PathType.FILL):R,v.fillRect(0,0,M,E),v.restore(),S.save(),S.transform(...D),S.scale(1,-1),I(S,x.canvas,0,0,M,E,0,-1,1,1),S.restore()}this.compose()}paintImageXObject(b){if(!this.contentVisible)return;const S=this.getObject(b);if(!S){(0,n.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(S)}paintImageXObjectRepeat(b,S,R,L){if(!this.contentVisible)return;const B=this.getObject(b);if(!B){(0,n.warn)("Dependent image isn't ready yet");return}const W=B.width,M=B.height,E=[];for(let D=0,x=L.length;D<x;D+=2)E.push({transform:[S,0,0,R,L[D],L[D+1]],x:0,y:0,w:W,h:M});this.paintInlineImageXObjectGroup(B,E)}applyTransferMapsToCanvas(b){return this.current.transferMaps!=="none"&&(b.filter=this.current.transferMaps,b.drawImage(b.canvas,0,0),b.filter="none"),b.canvas}applyTransferMapsToBitmap(b){if(this.current.transferMaps==="none")return b.bitmap;const{bitmap:S,width:R,height:L}=b,B=this.cachedCanvases.getCanvas("inlineImage",R,L),W=B.context;return W.filter=this.current.transferMaps,W.drawImage(S,0,0),W.filter="none",B.canvas}paintInlineImageXObject(b){if(!this.contentVisible)return;const S=b.width,R=b.height,L=this.ctx;if(this.save(),!n.isNodeJS){const{filter:M}=L;M!=="none"&&M!==""&&(L.filter="none")}L.scale(1/S,-1/R);let B;if(b.bitmap)B=this.applyTransferMapsToBitmap(b);else if(typeof HTMLElement=="function"&&b instanceof HTMLElement||!b.data)B=b;else{const E=this.cachedCanvases.getCanvas("inlineImage",S,R).context;w(E,b),B=this.applyTransferMapsToCanvas(E)}const W=this._scaleImage(B,(0,i.getCurrentTransformInverse)(L));L.imageSmoothingEnabled=ie((0,i.getCurrentTransform)(L),b.interpolate),I(L,W.img,0,0,W.paintWidth,W.paintHeight,0,-R,S,R),this.compose(),this.restore()}paintInlineImageXObjectGroup(b,S){if(!this.contentVisible)return;const R=this.ctx;let L;if(b.bitmap)L=b.bitmap;else{const B=b.width,W=b.height,E=this.cachedCanvases.getCanvas("inlineImage",B,W).context;w(E,b),L=this.applyTransferMapsToCanvas(E)}for(const B of S)R.save(),R.transform(...B.transform),R.scale(1,-1),I(R,L,B.x,B.y,B.w,B.h,0,-1,1,1),R.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(b){}markPointProps(b,S){}beginMarkedContent(b){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(b,S){b==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(S)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(b){const S=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(b);const R=this.ctx;this.pendingClip&&(S||(this.pendingClip===te?R.clip("evenodd"):R.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),R.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const b=(0,i.getCurrentTransform)(this.ctx);if(b[1]===0&&b[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(b[0]),Math.abs(b[3]));else{const S=Math.abs(b[0]*b[3]-b[2]*b[1]),R=Math.hypot(b[0],b[2]),L=Math.hypot(b[1],b[3]);this._cachedGetSinglePixelWidth=Math.max(R,L)/S}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:b}=this.current,{a:S,b:R,c:L,d:B}=this.ctx.getTransform();let W,M;if(R===0&&L===0){const E=Math.abs(S),D=Math.abs(B);if(E===D)if(b===0)W=M=1/E;else{const x=E*b;W=M=x<1?1/x:1}else if(b===0)W=1/E,M=1/D;else{const x=E*b,v=D*b;W=x<1?1/x:1,M=v<1?1/v:1}}else{const E=Math.abs(S*B-R*L),D=Math.hypot(S,R),x=Math.hypot(L,B);if(b===0)W=x/E,M=D/E;else{const v=b*E;W=x>v?x/v:1,M=D>v?D/v:1}}this._cachedScaleForStroking[0]=W,this._cachedScaleForStroking[1]=M}return this._cachedScaleForStroking}rescaleAndStroke(b){const{ctx:S}=this,{lineWidth:R}=this.current,[L,B]=this.getScaleForStroking();if(S.lineWidth=R||1,L===1&&B===1){S.stroke();return}const W=S.getLineDash();if(b&&S.save(),S.scale(L,B),W.length>0){const M=Math.max(L,B);S.setLineDash(W.map(E=>E/M)),S.lineDashOffset/=M}S.stroke(),b&&S.restore()}isContentVisible(){for(let b=this.markedContentStack.length-1;b>=0;b--)if(!this.markedContentStack[b].visible)return!1;return!0}}t.CanvasGraphics=G;for(const N in n.OPS)G.prototype[N]!==void 0&&(G.prototype[n.OPS[N]]=G.prototype[N])},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TilingPattern=t.PathType=void 0,t.getShadingPattern=p;var n=s(1),i=s(6);const r={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};t.PathType=r;function d(I,A){if(!A)return;const O=A[2]-A[0],w=A[3]-A[1],P=new Path2D;P.rect(A[0],A[1],O,w),I.clip(P)}class f{constructor(){this.constructor===f&&(0,n.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,n.unreachable)("Abstract method `getPattern` called.")}}class m extends f{constructor(A){super(),this._type=A[1],this._bbox=A[2],this._colorStops=A[3],this._p0=A[4],this._p1=A[5],this._r0=A[6],this._r1=A[7],this.matrix=null}_createGradient(A){let O;this._type==="axial"?O=A.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(O=A.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const w of this._colorStops)O.addColorStop(w[0],w[1]);return O}getPattern(A,O,w,P){let C;if(P===r.STROKE||P===r.FILL){const y=O.current.getClippedPathBoundingBox(P,(0,i.getCurrentTransform)(A))||[0,0,0,0],F=Math.ceil(y[2]-y[0])||1,H=Math.ceil(y[3]-y[1])||1,U=O.cachedCanvases.getCanvas("pattern",F,H,!0),Y=U.context;Y.clearRect(0,0,Y.canvas.width,Y.canvas.height),Y.beginPath(),Y.rect(0,0,Y.canvas.width,Y.canvas.height),Y.translate(-y[0],-y[1]),w=n.Util.transform(w,[1,0,0,1,y[0],y[1]]),Y.transform(...O.baseTransform),this.matrix&&Y.transform(...this.matrix),d(Y,this._bbox),Y.fillStyle=this._createGradient(Y),Y.fill(),C=A.createPattern(U.canvas,"no-repeat");const V=new DOMMatrix(w);C.setTransform(V)}else d(A,this._bbox),C=this._createGradient(A);return C}}function u(I,A,O,w,P,C,y,F){const H=A.coords,U=A.colors,Y=I.data,V=I.width*4;let ie;H[O+1]>H[w+1]&&(ie=O,O=w,w=ie,ie=C,C=y,y=ie),H[w+1]>H[P+1]&&(ie=w,w=P,P=ie,ie=y,y=F,F=ie),H[O+1]>H[w+1]&&(ie=O,O=w,w=ie,ie=C,C=y,y=ie);const J=(H[O]+A.offsetX)*A.scaleX,ne=(H[O+1]+A.offsetY)*A.scaleY,ae=(H[w]+A.offsetX)*A.scaleX,te=(H[w+1]+A.offsetY)*A.scaleY,G=(H[P]+A.offsetX)*A.scaleX,N=(H[P+1]+A.offsetY)*A.scaleY;if(ne>=N)return;const b=U[C],S=U[C+1],R=U[C+2],L=U[y],B=U[y+1],W=U[y+2],M=U[F],E=U[F+1],D=U[F+2],x=Math.round(ne),v=Math.round(N);let k,q,j,K,ue,Q,Z,ee;for(let se=x;se<=v;se++){if(se<te){const fe=se<ne?0:(ne-se)/(ne-te);k=J-(J-ae)*fe,q=b-(b-L)*fe,j=S-(S-B)*fe,K=R-(R-W)*fe}else{let fe;se>N?fe=1:te===N?fe=0:fe=(te-se)/(te-N),k=ae-(ae-G)*fe,q=L-(L-M)*fe,j=B-(B-E)*fe,K=W-(W-D)*fe}let re;se<ne?re=0:se>N?re=1:re=(ne-se)/(ne-N),ue=J-(J-G)*re,Q=b-(b-M)*re,Z=S-(S-E)*re,ee=R-(R-D)*re;const ce=Math.round(Math.min(k,ue)),he=Math.round(Math.max(k,ue));let de=V*se+ce*4;for(let fe=ce;fe<=he;fe++)re=(k-fe)/(k-ue),re<0?re=0:re>1&&(re=1),Y[de++]=q-(q-Q)*re|0,Y[de++]=j-(j-Z)*re|0,Y[de++]=K-(K-ee)*re|0,Y[de++]=255}}function a(I,A,O){const w=A.coords,P=A.colors;let C,y;switch(A.type){case"lattice":const F=A.verticesPerRow,H=Math.floor(w.length/F)-1,U=F-1;for(C=0;C<H;C++){let Y=C*F;for(let V=0;V<U;V++,Y++)u(I,O,w[Y],w[Y+1],w[Y+F],P[Y],P[Y+1],P[Y+F]),u(I,O,w[Y+F+1],w[Y+1],w[Y+F],P[Y+F+1],P[Y+1],P[Y+F])}break;case"triangles":for(C=0,y=w.length;C<y;C+=3)u(I,O,w[C],w[C+1],w[C+2],P[C],P[C+1],P[C+2]);break;default:throw new Error("illegal figure")}}class c extends f{constructor(A){super(),this._coords=A[2],this._colors=A[3],this._figures=A[4],this._bounds=A[5],this._bbox=A[7],this._background=A[8],this.matrix=null}_createMeshCanvas(A,O,w){const F=Math.floor(this._bounds[0]),H=Math.floor(this._bounds[1]),U=Math.ceil(this._bounds[2])-F,Y=Math.ceil(this._bounds[3])-H,V=Math.min(Math.ceil(Math.abs(U*A[0]*1.1)),3e3),ie=Math.min(Math.ceil(Math.abs(Y*A[1]*1.1)),3e3),J=U/V,ne=Y/ie,ae={coords:this._coords,colors:this._colors,offsetX:-F,offsetY:-H,scaleX:1/J,scaleY:1/ne},te=V+2*2,G=ie+2*2,N=w.getCanvas("mesh",te,G,!1),b=N.context,S=b.createImageData(V,ie);if(O){const L=S.data;for(let B=0,W=L.length;B<W;B+=4)L[B]=O[0],L[B+1]=O[1],L[B+2]=O[2],L[B+3]=255}for(const L of this._figures)a(S,L,ae);return b.putImageData(S,2,2),{canvas:N.canvas,offsetX:F-2*J,offsetY:H-2*ne,scaleX:J,scaleY:ne}}getPattern(A,O,w,P){d(A,this._bbox);let C;if(P===r.SHADING)C=n.Util.singularValueDecompose2dScale((0,i.getCurrentTransform)(A));else if(C=n.Util.singularValueDecompose2dScale(O.baseTransform),this.matrix){const F=n.Util.singularValueDecompose2dScale(this.matrix);C=[C[0]*F[0],C[1]*F[1]]}const y=this._createMeshCanvas(C,P===r.SHADING?null:this._background,O.cachedCanvases);return P!==r.SHADING&&(A.setTransform(...O.baseTransform),this.matrix&&A.transform(...this.matrix)),A.translate(y.offsetX,y.offsetY),A.scale(y.scaleX,y.scaleY),A.createPattern(y.canvas,"no-repeat")}}class T extends f{getPattern(){return"hotpink"}}function p(I){switch(I[0]){case"RadialAxial":return new m(I);case"Mesh":return new c(I);case"Dummy":return new T}throw new Error(`Unknown IR type: ${I[0]}`)}const h={COLORED:1,UNCOLORED:2};class _{static MAX_PATTERN_SIZE=3e3;constructor(A,O,w,P,C){this.operatorList=A[2],this.matrix=A[3]||[1,0,0,1,0,0],this.bbox=A[4],this.xstep=A[5],this.ystep=A[6],this.paintType=A[7],this.tilingType=A[8],this.color=O,this.ctx=w,this.canvasGraphicsFactory=P,this.baseTransform=C}createPatternCanvas(A){const O=this.operatorList,w=this.bbox,P=this.xstep,C=this.ystep,y=this.paintType,F=this.tilingType,H=this.color,U=this.canvasGraphicsFactory;(0,n.info)("TilingType: "+F);const Y=w[0],V=w[1],ie=w[2],J=w[3],ne=n.Util.singularValueDecompose2dScale(this.matrix),ae=n.Util.singularValueDecompose2dScale(this.baseTransform),te=[ne[0]*ae[0],ne[1]*ae[1]],G=this.getSizeAndScale(P,this.ctx.canvas.width,te[0]),N=this.getSizeAndScale(C,this.ctx.canvas.height,te[1]),b=A.cachedCanvases.getCanvas("pattern",G.size,N.size,!0),S=b.context,R=U.createCanvasGraphics(S);R.groupLevel=A.groupLevel,this.setFillAndStrokeStyleToContext(R,y,H);let L=Y,B=V,W=ie,M=J;return Y<0&&(L=0,W+=Math.abs(Y)),V<0&&(B=0,M+=Math.abs(V)),S.translate(-(G.scale*L),-(N.scale*B)),R.transform(G.scale,0,0,N.scale,0,0),S.save(),this.clipBbox(R,L,B,W,M),R.baseTransform=(0,i.getCurrentTransform)(R.ctx),R.executeOperatorList(O),R.endDrawing(),{canvas:b.canvas,scaleX:G.scale,scaleY:N.scale,offsetX:L,offsetY:B}}getSizeAndScale(A,O,w){A=Math.abs(A);const P=Math.max(_.MAX_PATTERN_SIZE,O);let C=Math.ceil(A*w);return C>=P?C=P:w=C/A,{scale:w,size:C}}clipBbox(A,O,w,P,C){const y=P-O,F=C-w;A.ctx.rect(O,w,y,F),A.current.updateRectMinMax((0,i.getCurrentTransform)(A.ctx),[O,w,P,C]),A.clip(),A.endPath()}setFillAndStrokeStyleToContext(A,O,w){const P=A.ctx,C=A.current;switch(O){case h.COLORED:const y=this.ctx;P.fillStyle=y.fillStyle,P.strokeStyle=y.strokeStyle,C.fillColor=y.fillStyle,C.strokeColor=y.strokeStyle;break;case h.UNCOLORED:const F=n.Util.makeHexColor(w[0],w[1],w[2]);P.fillStyle=F,P.strokeStyle=F,C.fillColor=F,C.strokeColor=F;break;default:throw new n.FormatError(`Unsupported paint type: ${O}`)}}getPattern(A,O,w,P){let C=w;P!==r.SHADING&&(C=n.Util.transform(C,O.baseTransform),this.matrix&&(C=n.Util.transform(C,this.matrix)));const y=this.createPatternCanvas(O);let F=new DOMMatrix(C);F=F.translate(y.offsetX,y.offsetY),F=F.scale(1/y.scaleX,1/y.scaleY);const H=A.createPattern(y.canvas,"repeat");return H.setTransform(F),H}}t.TilingPattern=_},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertBlackAndWhiteToRGBA=r,t.convertToRGBA=i,t.grayToRGBA=f;var n=s(1);function i(m){switch(m.kind){case n.ImageKind.GRAYSCALE_1BPP:return r(m);case n.ImageKind.RGB_24BPP:return d(m)}return null}function r({src:m,srcPos:u=0,dest:a,width:c,height:T,nonBlackColor:p=4294967295,inverseDecode:h=!1}){const _=n.FeatureTest.isLittleEndian?4278190080:255,[I,A]=h?[p,_]:[_,p],O=c>>3,w=c&7,P=m.length;a=new Uint32Array(a.buffer);let C=0;for(let y=0;y<T;y++){for(const H=u+O;u<H;u++){const U=u<P?m[u]:255;a[C++]=U&128?A:I,a[C++]=U&64?A:I,a[C++]=U&32?A:I,a[C++]=U&16?A:I,a[C++]=U&8?A:I,a[C++]=U&4?A:I,a[C++]=U&2?A:I,a[C++]=U&1?A:I}if(w===0)continue;const F=u<P?m[u++]:255;for(let H=0;H<w;H++)a[C++]=F&1<<7-H?A:I}return{srcPos:u,destPos:C}}function d({src:m,srcPos:u=0,dest:a,destPos:c=0,width:T,height:p}){let h=0;const _=m.length>>2,I=new Uint32Array(m.buffer,u,_);if(n.FeatureTest.isLittleEndian){for(;h<_-2;h+=3,c+=4){const A=I[h],O=I[h+1],w=I[h+2];a[c]=A|4278190080,a[c+1]=A>>>24|O<<8|4278190080,a[c+2]=O>>>16|w<<16|4278190080,a[c+3]=w>>>8|4278190080}for(let A=h*4,O=m.length;A<O;A+=3)a[c++]=m[A]|m[A+1]<<8|m[A+2]<<16|4278190080}else{for(;h<_-2;h+=3,c+=4){const A=I[h],O=I[h+1],w=I[h+2];a[c]=A|255,a[c+1]=A<<24|O>>>8|255,a[c+2]=O<<16|w>>>16|255,a[c+3]=w<<8|255}for(let A=h*4,O=m.length;A<O;A+=3)a[c++]=m[A]<<24|m[A+1]<<16|m[A+2]<<8|255}return{srcPos:u,destPos:c}}function f(m,u){if(n.FeatureTest.isLittleEndian)for(let a=0,c=m.length;a<c;a++)u[a]=m[a]*65793|4278190080;else for(let a=0,c=m.length;a<c;a++)u[a]=m[a]*16843008|255}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalWorkerOptions=void 0;const s=Object.create(null);t.GlobalWorkerOptions=s,s.workerPort=null,s.workerSrc=""},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandler=void 0;var n=s(1);const i={UNKNOWN:0,DATA:1,ERROR:2},r={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function d(m){switch(m instanceof Error||typeof m=="object"&&m!==null||(0,n.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),m.name){case"AbortException":return new n.AbortException(m.message);case"MissingPDFException":return new n.MissingPDFException(m.message);case"PasswordException":return new n.PasswordException(m.message,m.code);case"UnexpectedResponseException":return new n.UnexpectedResponseException(m.message,m.status);case"UnknownErrorException":return new n.UnknownErrorException(m.message,m.details);default:return new n.UnknownErrorException(m.message,m.toString())}}class f{constructor(u,a,c){this.sourceName=u,this.targetName=a,this.comObj=c,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=T=>{const p=T.data;if(p.targetName!==this.sourceName)return;if(p.stream){this.#t(p);return}if(p.callback){const _=p.callbackId,I=this.callbackCapabilities[_];if(!I)throw new Error(`Cannot resolve callback ${_}`);if(delete this.callbackCapabilities[_],p.callback===i.DATA)I.resolve(p.data);else if(p.callback===i.ERROR)I.reject(d(p.reason));else throw new Error("Unexpected callback case");return}const h=this.actionHandler[p.action];if(!h)throw new Error(`Unknown action from worker: ${p.action}`);if(p.callbackId){const _=this.sourceName,I=p.sourceName;new Promise(function(A){A(h(p.data))}).then(function(A){c.postMessage({sourceName:_,targetName:I,callback:i.DATA,callbackId:p.callbackId,data:A})},function(A){c.postMessage({sourceName:_,targetName:I,callback:i.ERROR,callbackId:p.callbackId,reason:d(A)})});return}if(p.streamId){this.#e(p);return}h(p.data)},c.addEventListener("message",this._onComObjOnMessage)}on(u,a){const c=this.actionHandler;if(c[u])throw new Error(`There is already an actionName called "${u}"`);c[u]=a}send(u,a,c){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:u,data:a},c)}sendWithPromise(u,a,c){const T=this.callbackId++,p=new n.PromiseCapability;this.callbackCapabilities[T]=p;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:u,callbackId:T,data:a},c)}catch(h){p.reject(h)}return p.promise}sendWithStream(u,a,c,T){const p=this.streamId++,h=this.sourceName,_=this.targetName,I=this.comObj;return new ReadableStream({start:A=>{const O=new n.PromiseCapability;return this.streamControllers[p]={controller:A,startCall:O,pullCall:null,cancelCall:null,isClosed:!1},I.postMessage({sourceName:h,targetName:_,action:u,streamId:p,data:a,desiredSize:A.desiredSize},T),O.promise},pull:A=>{const O=new n.PromiseCapability;return this.streamControllers[p].pullCall=O,I.postMessage({sourceName:h,targetName:_,stream:r.PULL,streamId:p,desiredSize:A.desiredSize}),O.promise},cancel:A=>{(0,n.assert)(A instanceof Error,"cancel must have a valid reason");const O=new n.PromiseCapability;return this.streamControllers[p].cancelCall=O,this.streamControllers[p].isClosed=!0,I.postMessage({sourceName:h,targetName:_,stream:r.CANCEL,streamId:p,reason:d(A)}),O.promise}},c)}#e(u){const a=u.streamId,c=this.sourceName,T=u.sourceName,p=this.comObj,h=this,_=this.actionHandler[u.action],I={enqueue(A,O=1,w){if(this.isCancelled)return;const P=this.desiredSize;this.desiredSize-=O,P>0&&this.desiredSize<=0&&(this.sinkCapability=new n.PromiseCapability,this.ready=this.sinkCapability.promise),p.postMessage({sourceName:c,targetName:T,stream:r.ENQUEUE,streamId:a,chunk:A},w)},close(){this.isCancelled||(this.isCancelled=!0,p.postMessage({sourceName:c,targetName:T,stream:r.CLOSE,streamId:a}),delete h.streamSinks[a])},error(A){(0,n.assert)(A instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,p.postMessage({sourceName:c,targetName:T,stream:r.ERROR,streamId:a,reason:d(A)}))},sinkCapability:new n.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:u.desiredSize,ready:null};I.sinkCapability.resolve(),I.ready=I.sinkCapability.promise,this.streamSinks[a]=I,new Promise(function(A){A(_(u.data,I))}).then(function(){p.postMessage({sourceName:c,targetName:T,stream:r.START_COMPLETE,streamId:a,success:!0})},function(A){p.postMessage({sourceName:c,targetName:T,stream:r.START_COMPLETE,streamId:a,reason:d(A)})})}#t(u){const a=u.streamId,c=this.sourceName,T=u.sourceName,p=this.comObj,h=this.streamControllers[a],_=this.streamSinks[a];switch(u.stream){case r.START_COMPLETE:u.success?h.startCall.resolve():h.startCall.reject(d(u.reason));break;case r.PULL_COMPLETE:u.success?h.pullCall.resolve():h.pullCall.reject(d(u.reason));break;case r.PULL:if(!_){p.postMessage({sourceName:c,targetName:T,stream:r.PULL_COMPLETE,streamId:a,success:!0});break}_.desiredSize<=0&&u.desiredSize>0&&_.sinkCapability.resolve(),_.desiredSize=u.desiredSize,new Promise(function(I){I(_.onPull?.())}).then(function(){p.postMessage({sourceName:c,targetName:T,stream:r.PULL_COMPLETE,streamId:a,success:!0})},function(I){p.postMessage({sourceName:c,targetName:T,stream:r.PULL_COMPLETE,streamId:a,reason:d(I)})});break;case r.ENQUEUE:if((0,n.assert)(h,"enqueue should have stream controller"),h.isClosed)break;h.controller.enqueue(u.chunk);break;case r.CLOSE:if((0,n.assert)(h,"close should have stream controller"),h.isClosed)break;h.isClosed=!0,h.controller.close(),this.#s(h,a);break;case r.ERROR:(0,n.assert)(h,"error should have stream controller"),h.controller.error(d(u.reason)),this.#s(h,a);break;case r.CANCEL_COMPLETE:u.success?h.cancelCall.resolve():h.cancelCall.reject(d(u.reason)),this.#s(h,a);break;case r.CANCEL:if(!_)break;new Promise(function(I){I(_.onCancel?.(d(u.reason)))}).then(function(){p.postMessage({sourceName:c,targetName:T,stream:r.CANCEL_COMPLETE,streamId:a,success:!0})},function(I){p.postMessage({sourceName:c,targetName:T,stream:r.CANCEL_COMPLETE,streamId:a,reason:d(I)})}),_.sinkCapability.reject(d(u.reason)),_.isCancelled=!0,delete this.streamSinks[a];break;default:throw new Error("Unexpected stream case")}}async#s(u,a){await Promise.allSettled([u.startCall?.promise,u.pullCall?.promise,u.cancelCall?.promise]),delete this.streamControllers[a]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}t.MessageHandler=f},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var n=s(1);class i{#e;#t;constructor({parsedData:d,rawData:f}){this.#e=d,this.#t=f}getRaw(){return this.#t}get(d){return this.#e.get(d)??null}getAll(){return(0,n.objectFromMap)(this.#e)}has(d){return this.#e.has(d)}}t.Metadata=i},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OptionalContentConfig=void 0;var n=s(1),i=s(8);const r=Symbol("INTERNAL");class d{#e=!0;constructor(u,a){this.name=u,this.intent=a}get visible(){return this.#e}_setVisible(u,a){u!==r&&(0,n.unreachable)("Internal method `_setVisible` called."),this.#e=a}}class f{#e=null;#t=new Map;#s=null;#n=null;constructor(u){if(this.name=null,this.creator=null,u!==null){this.name=u.name,this.creator=u.creator,this.#n=u.order;for(const a of u.groups)this.#t.set(a.id,new d(a.name,a.intent));if(u.baseState==="OFF")for(const a of this.#t.values())a._setVisible(r,!1);for(const a of u.on)this.#t.get(a)._setVisible(r,!0);for(const a of u.off)this.#t.get(a)._setVisible(r,!1);this.#s=this.getHash()}}#a(u){const a=u.length;if(a<2)return!0;const c=u[0];for(let T=1;T<a;T++){const p=u[T];let h;if(Array.isArray(p))h=this.#a(p);else if(this.#t.has(p))h=this.#t.get(p).visible;else return(0,n.warn)(`Optional content group not found: ${p}`),!0;switch(c){case"And":if(!h)return!1;break;case"Or":if(h)return!0;break;case"Not":return!h;default:return!0}}return c==="And"}isVisible(u){if(this.#t.size===0)return!0;if(!u)return(0,n.warn)("Optional content group not defined."),!0;if(u.type==="OCG")return this.#t.has(u.id)?this.#t.get(u.id).visible:((0,n.warn)(`Optional content group not found: ${u.id}`),!0);if(u.type==="OCMD"){if(u.expression)return this.#a(u.expression);if(!u.policy||u.policy==="AnyOn"){for(const a of u.ids){if(!this.#t.has(a))return(0,n.warn)(`Optional content group not found: ${a}`),!0;if(this.#t.get(a).visible)return!0}return!1}else if(u.policy==="AllOn"){for(const a of u.ids){if(!this.#t.has(a))return(0,n.warn)(`Optional content group not found: ${a}`),!0;if(!this.#t.get(a).visible)return!1}return!0}else if(u.policy==="AnyOff"){for(const a of u.ids){if(!this.#t.has(a))return(0,n.warn)(`Optional content group not found: ${a}`),!0;if(!this.#t.get(a).visible)return!0}return!1}else if(u.policy==="AllOff"){for(const a of u.ids){if(!this.#t.has(a))return(0,n.warn)(`Optional content group not found: ${a}`),!0;if(this.#t.get(a).visible)return!1}return!0}return(0,n.warn)(`Unknown optional content policy ${u.policy}.`),!0}return(0,n.warn)(`Unknown group type ${u.type}.`),!0}setVisibility(u,a=!0){if(!this.#t.has(u)){(0,n.warn)(`Optional content group not found: ${u}`);return}this.#t.get(u)._setVisible(r,!!a),this.#e=null}get hasInitialVisibility(){return this.#s===null||this.getHash()===this.#s}getOrder(){return this.#t.size?this.#n?this.#n.slice():[...this.#t.keys()]:null}getGroups(){return this.#t.size>0?(0,n.objectFromMap)(this.#t):null}getGroup(u){return this.#t.get(u)||null}getHash(){if(this.#e!==null)return this.#e;const u=new i.MurmurHash3_64;for(const[a,c]of this.#t)u.update(`${a}:${c.visible}`);return this.#e=u.hexdigest()}}t.OptionalContentConfig=f},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFDataTransportStream=void 0;var n=s(1),i=s(6);class r{constructor({length:u,initialData:a,progressiveDone:c=!1,contentDispositionFilename:T=null,disableRange:p=!1,disableStream:h=!1},_){if((0,n.assert)(_,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=c,this._contentDispositionFilename=T,a?.length>0){const I=a instanceof Uint8Array&&a.byteLength===a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer;this._queuedChunks.push(I)}this._pdfDataRangeTransport=_,this._isStreamingSupported=!h,this._isRangeSupported=!p,this._contentLength=u,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((I,A)=>{this._onReceiveData({begin:I,chunk:A})}),this._pdfDataRangeTransport.addProgressListener((I,A)=>{this._onProgress({loaded:I,total:A})}),this._pdfDataRangeTransport.addProgressiveReadListener(I=>{this._onReceiveData({chunk:I})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:u,chunk:a}){const c=a instanceof Uint8Array&&a.byteLength===a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer;if(u===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(c):this._queuedChunks.push(c);else{const T=this._rangeReaders.some(function(p){return p._begin!==u?!1:(p._enqueue(c),!0)});(0,n.assert)(T,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(u){u.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:u.loaded}):this._fullRequestReader?.onProgress?.({loaded:u.loaded,total:u.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(u){const a=this._rangeReaders.indexOf(u);a>=0&&this._rangeReaders.splice(a,1)}getFullReader(){(0,n.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const u=this._queuedChunks;return this._queuedChunks=null,new d(this,u,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(u,a){if(a<=this._progressiveDataLength)return null;const c=new f(this,u,a);return this._pdfDataRangeTransport.requestDataRange(u,a),this._rangeReaders.push(c),c}cancelAllRequests(u){this._fullRequestReader?.cancel(u);for(const a of this._rangeReaders.slice(0))a.cancel(u);this._pdfDataRangeTransport.abort()}}t.PDFDataTransportStream=r;class d{constructor(u,a,c=!1,T=null){this._stream=u,this._done=c||!1,this._filename=(0,i.isPdfFile)(T)?T:null,this._queuedChunks=a||[],this._loaded=0;for(const p of this._queuedChunks)this._loaded+=p.byteLength;this._requests=[],this._headersReady=Promise.resolve(),u._fullRequestReader=this,this.onProgress=null}_enqueue(u){this._done||(this._requests.length>0?this._requests.shift().resolve({value:u,done:!1}):this._queuedChunks.push(u),this._loaded+=u.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const u=new n.PromiseCapability;return this._requests.push(u),u.promise}cancel(u){this._done=!0;for(const a of this._requests)a.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class f{constructor(u,a,c){this._stream=u,this._begin=a,this._end=c,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(u){if(!this._done){if(this._requests.length===0)this._queuedChunk=u;else{this._requests.shift().resolve({value:u,done:!1});for(const c of this._requests)c.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const a=this._queuedChunk;return this._queuedChunk=null,{value:a,done:!1}}if(this._done)return{value:void 0,done:!0};const u=new n.PromiseCapability;return this._requests.push(u),u.promise}cancel(u){this._done=!0;for(const a of this._requests)a.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFFetchStream=void 0;var n=s(1),i=s(20);function r(c,T,p){return{method:"GET",headers:c,signal:p.signal,mode:"cors",credentials:T?"include":"same-origin",redirect:"follow"}}function d(c){const T=new Headers;for(const p in c){const h=c[p];h!==void 0&&T.append(p,h)}return T}function f(c){return c instanceof Uint8Array?c.buffer:c instanceof ArrayBuffer?c:((0,n.warn)(`getArrayBuffer - unexpected data format: ${c}`),new Uint8Array(c).buffer)}class m{constructor(T){this.source=T,this.isHttp=/^https?:/i.test(T.url),this.httpHeaders=this.isHttp&&T.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new u(this),this._fullRequestReader}getRangeReader(T,p){if(p<=this._progressiveDataLength)return null;const h=new a(this,T,p);return this._rangeRequestReaders.push(h),h}cancelAllRequests(T){this._fullRequestReader?.cancel(T);for(const p of this._rangeRequestReaders.slice(0))p.cancel(T)}}t.PDFFetchStream=m;class u{constructor(T){this._stream=T,this._reader=null,this._loaded=0,this._filename=null;const p=T.source;this._withCredentials=p.withCredentials||!1,this._contentLength=p.length,this._headersCapability=new n.PromiseCapability,this._disableRange=p.disableRange||!1,this._rangeChunkSize=p.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!p.disableStream,this._isRangeSupported=!p.disableRange,this._headers=d(this._stream.httpHeaders);const h=p.url;fetch(h,r(this._headers,this._withCredentials,this._abortController)).then(_=>{if(!(0,i.validateResponseStatus)(_.status))throw(0,i.createResponseStatusError)(_.status,h);this._reader=_.body.getReader(),this._headersCapability.resolve();const I=w=>_.headers.get(w),{allowRangeRequests:A,suggestedLength:O}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:I,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=A,this._contentLength=O||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(I),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new n.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:T,done:p}=await this._reader.read();return p?{value:T,done:p}:(this._loaded+=T.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:f(T),done:!1})}cancel(T){this._reader?.cancel(T),this._abortController.abort()}}class a{constructor(T,p,h){this._stream=T,this._reader=null,this._loaded=0;const _=T.source;this._withCredentials=_.withCredentials||!1,this._readCapability=new n.PromiseCapability,this._isStreamingSupported=!_.disableStream,this._abortController=new AbortController,this._headers=d(this._stream.httpHeaders),this._headers.append("Range",`bytes=${p}-${h-1}`);const I=_.url;fetch(I,r(this._headers,this._withCredentials,this._abortController)).then(A=>{if(!(0,i.validateResponseStatus)(A.status))throw(0,i.createResponseStatusError)(A.status,I);this._readCapability.resolve(),this._reader=A.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:T,done:p}=await this._reader.read();return p?{value:T,done:p}:(this._loaded+=T.byteLength,this.onProgress?.({loaded:this._loaded}),{value:f(T),done:!1})}cancel(T){this._reader?.cancel(T),this._abortController.abort()}}},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createResponseStatusError=m,t.extractFilenameFromHeader=f,t.validateRangeRequestCapabilities=d,t.validateResponseStatus=u;var n=s(1),i=s(21),r=s(6);function d({getResponseHeader:a,isHttp:c,rangeChunkSize:T,disableRange:p}){const h={allowRangeRequests:!1,suggestedLength:void 0},_=parseInt(a("Content-Length"),10);return!Number.isInteger(_)||(h.suggestedLength=_,_<=2*T)||p||!c||a("Accept-Ranges")!=="bytes"||(a("Content-Encoding")||"identity")!=="identity"||(h.allowRangeRequests=!0),h}function f(a){const c=a("Content-Disposition");if(c){let T=(0,i.getFilenameFromContentDispositionHeader)(c);if(T.includes("%"))try{T=decodeURIComponent(T)}catch{}if((0,r.isPdfFile)(T))return T}return null}function m(a,c){return a===404||a===0&&c.startsWith("file:")?new n.MissingPDFException('Missing PDF "'+c+'".'):new n.UnexpectedResponseException(`Unexpected server response (${a}) while retrieving PDF "${c}".`,a)}function u(a){return a===200||a===206}},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFilenameFromContentDispositionHeader=i;var n=s(1);function i(r){let d=!0,f=m("filename\\*","i").exec(r);if(f){f=f[1];let _=T(f);return _=unescape(_),_=p(_),_=h(_),a(_)}if(f=c(r),f){const _=h(f);return a(_)}if(f=m("filename","i").exec(r),f){f=f[1];let _=T(f);return _=h(_),a(_)}function m(_,I){return new RegExp("(?:^|;)\\s*"+_+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',I)}function u(_,I){if(_){if(!/^[\x00-\xFF]+$/.test(I))return I;try{const A=new TextDecoder(_,{fatal:!0}),O=(0,n.stringToBytes)(I);I=A.decode(O),d=!1}catch{}}return I}function a(_){return d&&/[\x80-\xff]/.test(_)&&(_=u("utf-8",_),d&&(_=u("iso-8859-1",_))),_}function c(_){const I=[];let A;const O=m("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(A=O.exec(_))!==null;){let[,P,C,y]=A;if(P=parseInt(P,10),P in I){if(P===0)break;continue}I[P]=[C,y]}const w=[];for(let P=0;P<I.length&&P in I;++P){let[C,y]=I[P];y=T(y),C&&(y=unescape(y),P===0&&(y=p(y))),w.push(y)}return w.join("")}function T(_){if(_.startsWith('"')){const I=_.slice(1).split('\\"');for(let A=0;A<I.length;++A){const O=I[A].indexOf('"');O!==-1&&(I[A]=I[A].slice(0,O),I.length=A+1),I[A]=I[A].replaceAll(/\\(.)/g,"$1")}_=I.join('"')}return _}function p(_){const I=_.indexOf("'");if(I===-1)return _;const A=_.slice(0,I),w=_.slice(I+1).replace(/^[^']*'/,"");return u(A,w)}function h(_){return!_.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(_)?_:_.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(I,A,O,w){if(O==="q"||O==="Q")return w=w.replaceAll("_"," "),w=w.replaceAll(/=([0-9a-fA-F]{2})/g,function(P,C){return String.fromCharCode(parseInt(C,16))}),u(A,w);try{w=atob(w)}catch{}return u(A,w)})}return""}},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNetworkStream=void 0;var n=s(1),i=s(20);const r=200,d=206;function f(T){const p=T.response;return typeof p!="string"?p:(0,n.stringToBytes)(p).buffer}class m{constructor(p,h={}){this.url=p,this.isHttp=/^https?:/i.test(p),this.httpHeaders=this.isHttp&&h.httpHeaders||Object.create(null),this.withCredentials=h.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(p,h,_){const I={begin:p,end:h};for(const A in _)I[A]=_[A];return this.request(I)}requestFull(p){return this.request(p)}request(p){const h=new XMLHttpRequest,_=this.currXhrId++,I=this.pendingRequests[_]={xhr:h};h.open("GET",this.url),h.withCredentials=this.withCredentials;for(const A in this.httpHeaders){const O=this.httpHeaders[A];O!==void 0&&h.setRequestHeader(A,O)}return this.isHttp&&"begin"in p&&"end"in p?(h.setRequestHeader("Range",`bytes=${p.begin}-${p.end-1}`),I.expectedStatus=d):I.expectedStatus=r,h.responseType="arraybuffer",p.onError&&(h.onerror=function(A){p.onError(h.status)}),h.onreadystatechange=this.onStateChange.bind(this,_),h.onprogress=this.onProgress.bind(this,_),I.onHeadersReceived=p.onHeadersReceived,I.onDone=p.onDone,I.onError=p.onError,I.onProgress=p.onProgress,h.send(null),_}onProgress(p,h){const _=this.pendingRequests[p];_&&_.onProgress?.(h)}onStateChange(p,h){const _=this.pendingRequests[p];if(!_)return;const I=_.xhr;if(I.readyState>=2&&_.onHeadersReceived&&(_.onHeadersReceived(),delete _.onHeadersReceived),I.readyState!==4||!(p in this.pendingRequests))return;if(delete this.pendingRequests[p],I.status===0&&this.isHttp){_.onError?.(I.status);return}const A=I.status||r;if(!(A===r&&_.expectedStatus===d)&&A!==_.expectedStatus){_.onError?.(I.status);return}const w=f(I);if(A===d){const P=I.getResponseHeader("Content-Range"),C=/bytes (\d+)-(\d+)\/(\d+)/.exec(P);_.onDone({begin:parseInt(C[1],10),chunk:w})}else w?_.onDone({begin:0,chunk:w}):_.onError?.(I.status)}getRequestXhr(p){return this.pendingRequests[p].xhr}isPendingRequest(p){return p in this.pendingRequests}abortRequest(p){const h=this.pendingRequests[p].xhr;delete this.pendingRequests[p],h.abort()}}class u{constructor(p){this._source=p,this._manager=new m(p.url,{httpHeaders:p.httpHeaders,withCredentials:p.withCredentials}),this._rangeChunkSize=p.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(p){const h=this._rangeRequestReaders.indexOf(p);h>=0&&this._rangeRequestReaders.splice(h,1)}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new a(this._manager,this._source),this._fullRequestReader}getRangeReader(p,h){const _=new c(this._manager,p,h);return _.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(_),_}cancelAllRequests(p){this._fullRequestReader?.cancel(p);for(const h of this._rangeRequestReaders.slice(0))h.cancel(p)}}t.PDFNetworkStream=u;class a{constructor(p,h){this._manager=p;const _={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=h.url,this._fullRequestId=p.requestFull(_),this._headersReceivedCapability=new n.PromiseCapability,this._disableRange=h.disableRange||!1,this._contentLength=h.length,this._rangeChunkSize=h.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const p=this._fullRequestId,h=this._manager.getRequestXhr(p),_=O=>h.getResponseHeader(O),{allowRangeRequests:I,suggestedLength:A}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:_,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});I&&(this._isRangeSupported=!0),this._contentLength=A||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(_),this._isRangeSupported&&this._manager.abortRequest(p),this._headersReceivedCapability.resolve()}_onDone(p){if(p&&(this._requests.length>0?this._requests.shift().resolve({value:p.chunk,done:!1}):this._cachedChunks.push(p.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(p){this._storedError=(0,i.createResponseStatusError)(p,this._url),this._headersReceivedCapability.reject(this._storedError);for(const h of this._requests)h.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(p){this.onProgress?.({loaded:p.loaded,total:p.lengthComputable?p.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const p=new n.PromiseCapability;return this._requests.push(p),p.promise}cancel(p){this._done=!0,this._headersReceivedCapability.reject(p);for(const h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class c{constructor(p,h,_){this._manager=p;const I={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=p.url,this._requestId=p.requestRange(h,_,I),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(p){const h=p.chunk;this._requests.length>0?this._requests.shift().resolve({value:h,done:!1}):this._queuedChunk=h,this._done=!0;for(const _ of this._requests)_.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(p){this._storedError=(0,i.createResponseStatusError)(p,this._url);for(const h of this._requests)h.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(p){this.isStreamingSupported||this.onProgress?.({loaded:p.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const h=this._queuedChunk;return this._queuedChunk=null,{value:h,done:!1}}if(this._done)return{value:void 0,done:!0};const p=new n.PromiseCapability;return this._requests.push(p),p.promise}cancel(p){this._done=!0;for(const h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNodeStream=void 0;var n=s(1),i=s(20);const r=/^file:\/\/\/[a-zA-Z]:\//;function d(_){const I=require$$5,A=I.parse(_);return A.protocol==="file:"||A.host?A:/^[a-z]:[/\\]/i.test(_)?I.parse(`file:///${_}`):(A.host||(A.protocol="file:"),A)}class f{constructor(I){this.source=I,this.url=d(I.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&I.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new p(this):new c(this),this._fullRequestReader}getRangeReader(I,A){if(A<=this._progressiveDataLength)return null;const O=this.isFsUrl?new h(this,I,A):new T(this,I,A);return this._rangeRequestReaders.push(O),O}cancelAllRequests(I){this._fullRequestReader?.cancel(I);for(const A of this._rangeRequestReaders.slice(0))A.cancel(I)}}t.PDFNodeStream=f;class m{constructor(I){this._url=I.url,this._done=!1,this._storedError=null,this.onProgress=null;const A=I.source;this._contentLength=A.length,this._loaded=0,this._filename=null,this._disableRange=A.disableRange||!1,this._rangeChunkSize=A.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!A.disableStream,this._isRangeSupported=!A.disableRange,this._readableStream=null,this._readCapability=new n.PromiseCapability,this._headersCapability=new n.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const I=this._readableStream.read();return I===null?(this._readCapability=new n.PromiseCapability,this.read()):(this._loaded+=I.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(I).buffer,done:!1})}cancel(I){if(!this._readableStream){this._error(I);return}this._readableStream.destroy(I)}_error(I){this._storedError=I,this._readCapability.resolve()}_setReadableStream(I){this._readableStream=I,I.on("readable",()=>{this._readCapability.resolve()}),I.on("end",()=>{I.destroy(),this._done=!0,this._readCapability.resolve()}),I.on("error",A=>{this._error(A)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new n.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class u{constructor(I){this._url=I.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new n.PromiseCapability;const A=I.source;this._isStreamingSupported=!A.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const I=this._readableStream.read();return I===null?(this._readCapability=new n.PromiseCapability,this.read()):(this._loaded+=I.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(I).buffer,done:!1})}cancel(I){if(!this._readableStream){this._error(I);return}this._readableStream.destroy(I)}_error(I){this._storedError=I,this._readCapability.resolve()}_setReadableStream(I){this._readableStream=I,I.on("readable",()=>{this._readCapability.resolve()}),I.on("end",()=>{I.destroy(),this._done=!0,this._readCapability.resolve()}),I.on("error",A=>{this._error(A)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function a(_,I){return{protocol:_.protocol,auth:_.auth,host:_.hostname,port:_.port,path:_.path,method:"GET",headers:I}}class c extends m{constructor(I){super(I);const A=O=>{if(O.statusCode===404){const y=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=y,this._headersCapability.reject(y);return}this._headersCapability.resolve(),this._setReadableStream(O);const w=y=>this._readableStream.headers[y.toLowerCase()],{allowRangeRequests:P,suggestedLength:C}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:w,isHttp:I.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=P,this._contentLength=C||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(w)};if(this._request=null,this._url.protocol==="http:"){const O=require$$5;this._request=O.request(a(this._url,I.httpHeaders),A)}else{const O=require$$5;this._request=O.request(a(this._url,I.httpHeaders),A)}this._request.on("error",O=>{this._storedError=O,this._headersCapability.reject(O)}),this._request.end()}}class T extends u{constructor(I,A,O){super(I),this._httpHeaders={};for(const P in I.httpHeaders){const C=I.httpHeaders[P];C!==void 0&&(this._httpHeaders[P]=C)}this._httpHeaders.Range=`bytes=${A}-${O-1}`;const w=P=>{if(P.statusCode===404){const C=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=C;return}this._setReadableStream(P)};if(this._request=null,this._url.protocol==="http:"){const P=require$$5;this._request=P.request(a(this._url,this._httpHeaders),w)}else{const P=require$$5;this._request=P.request(a(this._url,this._httpHeaders),w)}this._request.on("error",P=>{this._storedError=P}),this._request.end()}}class p extends m{constructor(I){super(I);let A=decodeURIComponent(this._url.path);r.test(this._url.href)&&(A=A.replace(/^\//,""));const O=require$$5;O.lstat(A,(w,P)=>{if(w){w.code==="ENOENT"&&(w=new n.MissingPDFException(`Missing PDF "${A}".`)),this._storedError=w,this._headersCapability.reject(w);return}this._contentLength=P.size,this._setReadableStream(O.createReadStream(A)),this._headersCapability.resolve()})}}class h extends u{constructor(I,A,O){super(I);let w=decodeURIComponent(this._url.path);r.test(this._url.href)&&(w=w.replace(/^\//,""));const P=require$$5;this._setReadableStream(P.createReadStream(w,{start:A,end:O-1}))}}},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SVGGraphics=void 0;var n=s(6),i=s(1);const r={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},d="http://www.w3.org/XML/1998/namespace",f="http://www.w3.org/1999/xlink",m=["butt","round","square"],u=["miter","round","bevel"],a=function(P,C="",y=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!y)return URL.createObjectURL(new Blob([P],{type:C}));const F="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let H=`data:${C};base64,`;for(let U=0,Y=P.length;U<Y;U+=3){const V=P[U]&255,ie=P[U+1]&255,J=P[U+2]&255,ne=V>>2,ae=(V&3)<<4|ie>>4,te=U+1<Y?(ie&15)<<2|J>>6:64,G=U+2<Y?J&63:64;H+=F[ne]+F[ae]+F[te]+F[G]}return H},c=function(){const P=new Uint8Array([137,80,78,71,13,10,26,10]),C=12,y=new Int32Array(256);for(let J=0;J<256;J++){let ne=J;for(let ae=0;ae<8;ae++)ne=ne&1?3988292384^ne>>1&2147483647:ne>>1&2147483647;y[J]=ne}function F(J,ne,ae){let te=-1;for(let G=ne;G<ae;G++){const N=(te^J[G])&255,b=y[N];te=te>>>8^b}return te^-1}function H(J,ne,ae,te){let G=te;const N=ne.length;ae[G]=N>>24&255,ae[G+1]=N>>16&255,ae[G+2]=N>>8&255,ae[G+3]=N&255,G+=4,ae[G]=J.charCodeAt(0)&255,ae[G+1]=J.charCodeAt(1)&255,ae[G+2]=J.charCodeAt(2)&255,ae[G+3]=J.charCodeAt(3)&255,G+=4,ae.set(ne,G),G+=ne.length;const b=F(ae,te+4,G);ae[G]=b>>24&255,ae[G+1]=b>>16&255,ae[G+2]=b>>8&255,ae[G+3]=b&255}function U(J,ne,ae){let te=1,G=0;for(let N=ne;N<ae;++N)te=(te+(J[N]&255))%65521,G=(G+te)%65521;return G<<16|te}function Y(J){if(!i.isNodeJS)return V(J);try{const ne=parseInt(process.versions.node)>=8?J:Buffer.from(J),ae=require$$5.deflateSync(ne,{level:9});return ae instanceof Uint8Array?ae:new Uint8Array(ae)}catch(ne){(0,i.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+ne)}return V(J)}function V(J){let ne=J.length;const ae=65535,te=Math.ceil(ne/ae),G=new Uint8Array(2+ne+te*5+4);let N=0;G[N++]=120,G[N++]=156;let b=0;for(;ne>ae;)G[N++]=0,G[N++]=255,G[N++]=255,G[N++]=0,G[N++]=0,G.set(J.subarray(b,b+ae),N),N+=ae,b+=ae,ne-=ae;G[N++]=1,G[N++]=ne&255,G[N++]=ne>>8&255,G[N++]=~ne&65535&255,G[N++]=(~ne&65535)>>8&255,G.set(J.subarray(b),N),N+=J.length-b;const S=U(J,0,J.length);return G[N++]=S>>24&255,G[N++]=S>>16&255,G[N++]=S>>8&255,G[N++]=S&255,G}function ie(J,ne,ae,te){const G=J.width,N=J.height;let b,S,R;const L=J.data;switch(ne){case i.ImageKind.GRAYSCALE_1BPP:S=0,b=1,R=G+7>>3;break;case i.ImageKind.RGB_24BPP:S=2,b=8,R=G*3;break;case i.ImageKind.RGBA_32BPP:S=6,b=8,R=G*4;break;default:throw new Error("invalid format")}const B=new Uint8Array((1+R)*N);let W=0,M=0;for(let q=0;q<N;++q)B[W++]=0,B.set(L.subarray(M,M+R),W),M+=R,W+=R;if(ne===i.ImageKind.GRAYSCALE_1BPP&&te){W=0;for(let q=0;q<N;q++){W++;for(let j=0;j<R;j++)B[W++]^=255}}const E=new Uint8Array([G>>24&255,G>>16&255,G>>8&255,G&255,N>>24&255,N>>16&255,N>>8&255,N&255,b,S,0,0,0]),D=Y(B),x=P.length+C*3+E.length+D.length,v=new Uint8Array(x);let k=0;return v.set(P,k),k+=P.length,H("IHDR",E,v,k),k+=C+E.length,H("IDATA",D,v,k),k+=C+D.length,H("IEND",new Uint8Array(0),v,k),a(v,"image/png",ae)}return function(ne,ae,te){const G=ne.kind===void 0?i.ImageKind.GRAYSCALE_1BPP:ne.kind;return ie(ne,G,ae,te)}}();class T{constructor(){this.fontSizeScale=1,this.fontWeight=r.fontWeight,this.fontSize=0,this.textMatrix=i.IDENTITY_MATRIX,this.fontMatrix=i.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=i.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=r.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(C,y){this.x=C,this.y=y}}function p(P){let C=[];const y=[];for(const F of P){if(F.fn==="save"){C.push({fnId:92,fn:"group",items:[]}),y.push(C),C=C.at(-1).items;continue}F.fn==="restore"?C=y.pop():C.push(F)}return C}function h(P){if(Number.isInteger(P))return P.toString();const C=P.toFixed(10);let y=C.length-1;if(C[y]!=="0")return C;do y--;while(C[y]==="0");return C.substring(0,C[y]==="."?y:y+1)}function _(P){if(P[4]===0&&P[5]===0){if(P[1]===0&&P[2]===0)return P[0]===1&&P[3]===1?"":`scale(${h(P[0])} ${h(P[3])})`;if(P[0]===P[3]&&P[1]===-P[2]){const C=Math.acos(P[0])*180/Math.PI;return`rotate(${h(C)})`}}else if(P[0]===1&&P[1]===0&&P[2]===0&&P[3]===1)return`translate(${h(P[4])} ${h(P[5])})`;return`matrix(${h(P[0])} ${h(P[1])} ${h(P[2])} ${h(P[3])} ${h(P[4])} ${h(P[5])})`}let I=0,A=0,O=0;class w{constructor(C,y,F=!1){(0,n.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new n.DOMSVGFactory,this.current=new T,this.transformMatrix=i.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=C,this.objs=y,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!F,this._operatorIdMapping=[];for(const H in i.OPS)this._operatorIdMapping[i.OPS[H]]=H}getObject(C,y=null){return typeof C=="string"?C.startsWith("g_")?this.commonObjs.get(C):this.objs.get(C):y}save(){this.transformStack.push(this.transformMatrix);const C=this.current;this.extraStack.push(C),this.current=C.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(C){this.save(),this.executeOpTree(C),this.restore()}loadDependencies(C){const y=C.fnArray,F=C.argsArray;for(let H=0,U=y.length;H<U;H++)if(y[H]===i.OPS.dependency)for(const Y of F[H]){const V=Y.startsWith("g_")?this.commonObjs:this.objs,ie=new Promise(J=>{V.get(Y,J)});this.current.dependencies.push(ie)}return Promise.all(this.current.dependencies)}transform(C,y,F,H,U,Y){const V=[C,y,F,H,U,Y];this.transformMatrix=i.Util.transform(this.transformMatrix,V),this.tgrp=null}getSVG(C,y){this.viewport=y;const F=this._initialize(y);return this.loadDependencies(C).then(()=>(this.transformMatrix=i.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(C)),F))}convertOpList(C){const y=this._operatorIdMapping,F=C.argsArray,H=C.fnArray,U=[];for(let Y=0,V=H.length;Y<V;Y++){const ie=H[Y];U.push({fnId:ie,fn:y[ie],args:F[Y]})}return p(U)}executeOpTree(C){for(const y of C){const F=y.fn,H=y.fnId,U=y.args;switch(H|0){case i.OPS.beginText:this.beginText();break;case i.OPS.dependency:break;case i.OPS.setLeading:this.setLeading(U);break;case i.OPS.setLeadingMoveText:this.setLeadingMoveText(U[0],U[1]);break;case i.OPS.setFont:this.setFont(U);break;case i.OPS.showText:this.showText(U[0]);break;case i.OPS.showSpacedText:this.showText(U[0]);break;case i.OPS.endText:this.endText();break;case i.OPS.moveText:this.moveText(U[0],U[1]);break;case i.OPS.setCharSpacing:this.setCharSpacing(U[0]);break;case i.OPS.setWordSpacing:this.setWordSpacing(U[0]);break;case i.OPS.setHScale:this.setHScale(U[0]);break;case i.OPS.setTextMatrix:this.setTextMatrix(U[0],U[1],U[2],U[3],U[4],U[5]);break;case i.OPS.setTextRise:this.setTextRise(U[0]);break;case i.OPS.setTextRenderingMode:this.setTextRenderingMode(U[0]);break;case i.OPS.setLineWidth:this.setLineWidth(U[0]);break;case i.OPS.setLineJoin:this.setLineJoin(U[0]);break;case i.OPS.setLineCap:this.setLineCap(U[0]);break;case i.OPS.setMiterLimit:this.setMiterLimit(U[0]);break;case i.OPS.setFillRGBColor:this.setFillRGBColor(U[0],U[1],U[2]);break;case i.OPS.setStrokeRGBColor:this.setStrokeRGBColor(U[0],U[1],U[2]);break;case i.OPS.setStrokeColorN:this.setStrokeColorN(U);break;case i.OPS.setFillColorN:this.setFillColorN(U);break;case i.OPS.shadingFill:this.shadingFill(U[0]);break;case i.OPS.setDash:this.setDash(U[0],U[1]);break;case i.OPS.setRenderingIntent:this.setRenderingIntent(U[0]);break;case i.OPS.setFlatness:this.setFlatness(U[0]);break;case i.OPS.setGState:this.setGState(U[0]);break;case i.OPS.fill:this.fill();break;case i.OPS.eoFill:this.eoFill();break;case i.OPS.stroke:this.stroke();break;case i.OPS.fillStroke:this.fillStroke();break;case i.OPS.eoFillStroke:this.eoFillStroke();break;case i.OPS.clip:this.clip("nonzero");break;case i.OPS.eoClip:this.clip("evenodd");break;case i.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case i.OPS.paintImageXObject:this.paintImageXObject(U[0]);break;case i.OPS.paintInlineImageXObject:this.paintInlineImageXObject(U[0]);break;case i.OPS.paintImageMaskXObject:this.paintImageMaskXObject(U[0]);break;case i.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(U[0],U[1]);break;case i.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case i.OPS.closePath:this.closePath();break;case i.OPS.closeStroke:this.closeStroke();break;case i.OPS.closeFillStroke:this.closeFillStroke();break;case i.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case i.OPS.nextLine:this.nextLine();break;case i.OPS.transform:this.transform(U[0],U[1],U[2],U[3],U[4],U[5]);break;case i.OPS.constructPath:this.constructPath(U[0],U[1]);break;case i.OPS.endPath:this.endPath();break;case 92:this.group(y.items);break;default:(0,i.warn)(`Unimplemented operator ${F}`);break}}}setWordSpacing(C){this.current.wordSpacing=C}setCharSpacing(C){this.current.charSpacing=C}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(C,y,F,H,U,Y){const V=this.current;V.textMatrix=V.lineMatrix=[C,y,F,H,U,Y],V.textMatrixScale=Math.hypot(C,y),V.x=V.lineX=0,V.y=V.lineY=0,V.xcoords=[],V.ycoords=[],V.tspan=this.svgFactory.createElement("svg:tspan"),V.tspan.setAttributeNS(null,"font-family",V.fontFamily),V.tspan.setAttributeNS(null,"font-size",`${h(V.fontSize)}px`),V.tspan.setAttributeNS(null,"y",h(-V.y)),V.txtElement=this.svgFactory.createElement("svg:text"),V.txtElement.append(V.tspan)}beginText(){const C=this.current;C.x=C.lineX=0,C.y=C.lineY=0,C.textMatrix=i.IDENTITY_MATRIX,C.lineMatrix=i.IDENTITY_MATRIX,C.textMatrixScale=1,C.tspan=this.svgFactory.createElement("svg:tspan"),C.txtElement=this.svgFactory.createElement("svg:text"),C.txtgrp=this.svgFactory.createElement("svg:g"),C.xcoords=[],C.ycoords=[]}moveText(C,y){const F=this.current;F.x=F.lineX+=C,F.y=F.lineY+=y,F.xcoords=[],F.ycoords=[],F.tspan=this.svgFactory.createElement("svg:tspan"),F.tspan.setAttributeNS(null,"font-family",F.fontFamily),F.tspan.setAttributeNS(null,"font-size",`${h(F.fontSize)}px`),F.tspan.setAttributeNS(null,"y",h(-F.y))}showText(C){const y=this.current,F=y.font,H=y.fontSize;if(H===0)return;const U=y.fontSizeScale,Y=y.charSpacing,V=y.wordSpacing,ie=y.fontDirection,J=y.textHScale*ie,ne=F.vertical,ae=ne?1:-1,te=F.defaultVMetrics,G=H*y.fontMatrix[0];let N=0;for(const R of C){if(R===null){N+=ie*V;continue}else if(typeof R=="number"){N+=ae*R*H/1e3;continue}const L=(R.isSpace?V:0)+Y,B=R.fontChar;let W,M,E=R.width;if(ne){let x;const v=R.vmetric||te;x=R.vmetric?v[1]:E*.5,x=-x*G;const k=v[2]*G;E=v?-v[0]:E,W=x/U,M=(N+k)/U}else W=N/U,M=0;(R.isInFont||F.missingFile)&&(y.xcoords.push(y.x+W),ne&&y.ycoords.push(-y.y+M),y.tspan.textContent+=B);const D=ne?E*G-L*ie:E*G+L*ie;N+=D}y.tspan.setAttributeNS(null,"x",y.xcoords.map(h).join(" ")),ne?y.tspan.setAttributeNS(null,"y",y.ycoords.map(h).join(" ")):y.tspan.setAttributeNS(null,"y",h(-y.y)),ne?y.y-=N:y.x+=N*J,y.tspan.setAttributeNS(null,"font-family",y.fontFamily),y.tspan.setAttributeNS(null,"font-size",`${h(y.fontSize)}px`),y.fontStyle!==r.fontStyle&&y.tspan.setAttributeNS(null,"font-style",y.fontStyle),y.fontWeight!==r.fontWeight&&y.tspan.setAttributeNS(null,"font-weight",y.fontWeight);const b=y.textRenderingMode&i.TextRenderingMode.FILL_STROKE_MASK;if(b===i.TextRenderingMode.FILL||b===i.TextRenderingMode.FILL_STROKE?(y.fillColor!==r.fillColor&&y.tspan.setAttributeNS(null,"fill",y.fillColor),y.fillAlpha<1&&y.tspan.setAttributeNS(null,"fill-opacity",y.fillAlpha)):y.textRenderingMode===i.TextRenderingMode.ADD_TO_PATH?y.tspan.setAttributeNS(null,"fill","transparent"):y.tspan.setAttributeNS(null,"fill","none"),b===i.TextRenderingMode.STROKE||b===i.TextRenderingMode.FILL_STROKE){const R=1/(y.textMatrixScale||1);this._setStrokeAttributes(y.tspan,R)}let S=y.textMatrix;y.textRise!==0&&(S=S.slice(),S[5]+=y.textRise),y.txtElement.setAttributeNS(null,"transform",`${_(S)} scale(${h(J)}, -1)`),y.txtElement.setAttributeNS(d,"xml:space","preserve"),y.txtElement.append(y.tspan),y.txtgrp.append(y.txtElement),this._ensureTransformGroup().append(y.txtElement)}setLeadingMoveText(C,y){this.setLeading(-y),this.moveText(C,y)}addFontStyle(C){if(!C.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const y=a(C.data,C.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${C.loadedName}"; src: url(${y}); }
`}setFont(C){const y=this.current,F=this.commonObjs.get(C[0]);let H=C[1];y.font=F,this.embedFonts&&!F.missingFile&&!this.embeddedFonts[F.loadedName]&&(this.addFontStyle(F),this.embeddedFonts[F.loadedName]=F),y.fontMatrix=F.fontMatrix||i.FONT_IDENTITY_MATRIX;let U="normal";F.black?U="900":F.bold&&(U="bold");const Y=F.italic?"italic":"normal";H<0?(H=-H,y.fontDirection=-1):y.fontDirection=1,y.fontSize=H,y.fontFamily=F.loadedName,y.fontWeight=U,y.fontStyle=Y,y.tspan=this.svgFactory.createElement("svg:tspan"),y.tspan.setAttributeNS(null,"y",h(-y.y)),y.xcoords=[],y.ycoords=[]}endText(){const C=this.current;C.textRenderingMode&i.TextRenderingMode.ADD_TO_PATH_FLAG&&C.txtElement?.hasChildNodes()&&(C.element=C.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(C){C>0&&(this.current.lineWidth=C)}setLineCap(C){this.current.lineCap=m[C]}setLineJoin(C){this.current.lineJoin=u[C]}setMiterLimit(C){this.current.miterLimit=C}setStrokeAlpha(C){this.current.strokeAlpha=C}setStrokeRGBColor(C,y,F){this.current.strokeColor=i.Util.makeHexColor(C,y,F)}setFillAlpha(C){this.current.fillAlpha=C}setFillRGBColor(C,y,F){this.current.fillColor=i.Util.makeHexColor(C,y,F),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(C){this.current.strokeColor=this._makeColorN_Pattern(C)}setFillColorN(C){this.current.fillColor=this._makeColorN_Pattern(C)}shadingFill(C){const{width:y,height:F}=this.viewport,H=i.Util.inverseTransform(this.transformMatrix),[U,Y,V,ie]=i.Util.getAxialAlignedBoundingBox([0,0,y,F],H),J=this.svgFactory.createElement("svg:rect");J.setAttributeNS(null,"x",U),J.setAttributeNS(null,"y",Y),J.setAttributeNS(null,"width",V-U),J.setAttributeNS(null,"height",ie-Y),J.setAttributeNS(null,"fill",this._makeShadingPattern(C)),this.current.fillAlpha<1&&J.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(J)}_makeColorN_Pattern(C){return C[0]==="TilingPattern"?this._makeTilingPattern(C):this._makeShadingPattern(C)}_makeTilingPattern(C){const y=C[1],F=C[2],H=C[3]||i.IDENTITY_MATRIX,[U,Y,V,ie]=C[4],J=C[5],ne=C[6],ae=C[7],te=`shading${O++}`,[G,N,b,S]=i.Util.normalizeRect([...i.Util.applyTransform([U,Y],H),...i.Util.applyTransform([V,ie],H)]),[R,L]=i.Util.singularValueDecompose2dScale(H),B=J*R,W=ne*L,M=this.svgFactory.createElement("svg:pattern");M.setAttributeNS(null,"id",te),M.setAttributeNS(null,"patternUnits","userSpaceOnUse"),M.setAttributeNS(null,"width",B),M.setAttributeNS(null,"height",W),M.setAttributeNS(null,"x",`${G}`),M.setAttributeNS(null,"y",`${N}`);const E=this.svg,D=this.transformMatrix,x=this.current.fillColor,v=this.current.strokeColor,k=this.svgFactory.create(b-G,S-N);if(this.svg=k,this.transformMatrix=H,ae===2){const q=i.Util.makeHexColor(...y);this.current.fillColor=q,this.current.strokeColor=q}return this.executeOpTree(this.convertOpList(F)),this.svg=E,this.transformMatrix=D,this.current.fillColor=x,this.current.strokeColor=v,M.append(k.childNodes[0]),this.defs.append(M),`url(#${te})`}_makeShadingPattern(C){switch(typeof C=="string"&&(C=this.objs.get(C)),C[0]){case"RadialAxial":const y=`shading${O++}`,F=C[3];let H;switch(C[1]){case"axial":const U=C[4],Y=C[5];H=this.svgFactory.createElement("svg:linearGradient"),H.setAttributeNS(null,"id",y),H.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),H.setAttributeNS(null,"x1",U[0]),H.setAttributeNS(null,"y1",U[1]),H.setAttributeNS(null,"x2",Y[0]),H.setAttributeNS(null,"y2",Y[1]);break;case"radial":const V=C[4],ie=C[5],J=C[6],ne=C[7];H=this.svgFactory.createElement("svg:radialGradient"),H.setAttributeNS(null,"id",y),H.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),H.setAttributeNS(null,"cx",ie[0]),H.setAttributeNS(null,"cy",ie[1]),H.setAttributeNS(null,"r",ne),H.setAttributeNS(null,"fx",V[0]),H.setAttributeNS(null,"fy",V[1]),H.setAttributeNS(null,"fr",J);break;default:throw new Error(`Unknown RadialAxial type: ${C[1]}`)}for(const U of F){const Y=this.svgFactory.createElement("svg:stop");Y.setAttributeNS(null,"offset",U[0]),Y.setAttributeNS(null,"stop-color",U[1]),H.append(Y)}return this.defs.append(H),`url(#${y})`;case"Mesh":return(0,i.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${C[0]}`)}}setDash(C,y){this.current.dashArray=C,this.current.dashPhase=y}constructPath(C,y){const F=this.current;let H=F.x,U=F.y,Y=[],V=0;for(const ie of C)switch(ie|0){case i.OPS.rectangle:H=y[V++],U=y[V++];const J=y[V++],ne=y[V++],ae=H+J,te=U+ne;Y.push("M",h(H),h(U),"L",h(ae),h(U),"L",h(ae),h(te),"L",h(H),h(te),"Z");break;case i.OPS.moveTo:H=y[V++],U=y[V++],Y.push("M",h(H),h(U));break;case i.OPS.lineTo:H=y[V++],U=y[V++],Y.push("L",h(H),h(U));break;case i.OPS.curveTo:H=y[V+4],U=y[V+5],Y.push("C",h(y[V]),h(y[V+1]),h(y[V+2]),h(y[V+3]),h(H),h(U)),V+=6;break;case i.OPS.curveTo2:Y.push("C",h(H),h(U),h(y[V]),h(y[V+1]),h(y[V+2]),h(y[V+3])),H=y[V+2],U=y[V+3],V+=4;break;case i.OPS.curveTo3:H=y[V+2],U=y[V+3],Y.push("C",h(y[V]),h(y[V+1]),h(H),h(U),h(H),h(U)),V+=4;break;case i.OPS.closePath:Y.push("Z");break}Y=Y.join(" "),F.path&&C.length>0&&C[0]!==i.OPS.rectangle&&C[0]!==i.OPS.moveTo?Y=F.path.getAttributeNS(null,"d")+Y:(F.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(F.path)),F.path.setAttributeNS(null,"d",Y),F.path.setAttributeNS(null,"fill","none"),F.element=F.path,F.setCurrentPoint(H,U)}endPath(){const C=this.current;if(C.path=null,!this.pendingClip)return;if(!C.element){this.pendingClip=null;return}const y=`clippath${I++}`,F=this.svgFactory.createElement("svg:clipPath");F.setAttributeNS(null,"id",y),F.setAttributeNS(null,"transform",_(this.transformMatrix));const H=C.element.cloneNode(!0);if(this.pendingClip==="evenodd"?H.setAttributeNS(null,"clip-rule","evenodd"):H.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,F.append(H),this.defs.append(F),C.activeClipUrl){C.clipGroup=null;for(const U of this.extraStack)U.clipGroup=null;F.setAttributeNS(null,"clip-path",C.activeClipUrl)}C.activeClipUrl=`url(#${y})`,this.tgrp=null}clip(C){this.pendingClip=C}closePath(){const C=this.current;if(C.path){const y=`${C.path.getAttributeNS(null,"d")}Z`;C.path.setAttributeNS(null,"d",y)}}setLeading(C){this.current.leading=-C}setTextRise(C){this.current.textRise=C}setTextRenderingMode(C){this.current.textRenderingMode=C}setHScale(C){this.current.textHScale=C/100}setRenderingIntent(C){}setFlatness(C){}setGState(C){for(const[y,F]of C)switch(y){case"LW":this.setLineWidth(F);break;case"LC":this.setLineCap(F);break;case"LJ":this.setLineJoin(F);break;case"ML":this.setMiterLimit(F);break;case"D":this.setDash(F[0],F[1]);break;case"RI":this.setRenderingIntent(F);break;case"FL":this.setFlatness(F);break;case"Font":this.setFont(F);break;case"CA":this.setStrokeAlpha(F);break;case"ca":this.setFillAlpha(F);break;default:(0,i.warn)(`Unimplemented graphic state operator ${y}`);break}}fill(){const C=this.current;C.element&&(C.element.setAttributeNS(null,"fill",C.fillColor),C.element.setAttributeNS(null,"fill-opacity",C.fillAlpha),this.endPath())}stroke(){const C=this.current;C.element&&(this._setStrokeAttributes(C.element),C.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(C,y=1){const F=this.current;let H=F.dashArray;y!==1&&H.length>0&&(H=H.map(function(U){return y*U})),C.setAttributeNS(null,"stroke",F.strokeColor),C.setAttributeNS(null,"stroke-opacity",F.strokeAlpha),C.setAttributeNS(null,"stroke-miterlimit",h(F.miterLimit)),C.setAttributeNS(null,"stroke-linecap",F.lineCap),C.setAttributeNS(null,"stroke-linejoin",F.lineJoin),C.setAttributeNS(null,"stroke-width",h(y*F.lineWidth)+"px"),C.setAttributeNS(null,"stroke-dasharray",H.map(h).join(" ")),C.setAttributeNS(null,"stroke-dashoffset",h(y*F.dashPhase)+"px")}eoFill(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const C=this.svgFactory.createElement("svg:rect");C.setAttributeNS(null,"x","0"),C.setAttributeNS(null,"y","0"),C.setAttributeNS(null,"width","1px"),C.setAttributeNS(null,"height","1px"),C.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(C)}paintImageXObject(C){const y=this.getObject(C);if(!y){(0,i.warn)(`Dependent image with object ID ${C} is not ready yet`);return}this.paintInlineImageXObject(y)}paintInlineImageXObject(C,y){const F=C.width,H=C.height,U=c(C,this.forceDataSchema,!!y),Y=this.svgFactory.createElement("svg:rect");Y.setAttributeNS(null,"x","0"),Y.setAttributeNS(null,"y","0"),Y.setAttributeNS(null,"width",h(F)),Y.setAttributeNS(null,"height",h(H)),this.current.element=Y,this.clip("nonzero");const V=this.svgFactory.createElement("svg:image");V.setAttributeNS(f,"xlink:href",U),V.setAttributeNS(null,"x","0"),V.setAttributeNS(null,"y",h(-H)),V.setAttributeNS(null,"width",h(F)+"px"),V.setAttributeNS(null,"height",h(H)+"px"),V.setAttributeNS(null,"transform",`scale(${h(1/F)} ${h(-1/H)})`),y?y.append(V):this._ensureTransformGroup().append(V)}paintImageMaskXObject(C){const y=this.getObject(C.data,C);if(y.bitmap){(0,i.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const F=this.current,H=y.width,U=y.height,Y=F.fillColor;F.maskId=`mask${A++}`;const V=this.svgFactory.createElement("svg:mask");V.setAttributeNS(null,"id",F.maskId);const ie=this.svgFactory.createElement("svg:rect");ie.setAttributeNS(null,"x","0"),ie.setAttributeNS(null,"y","0"),ie.setAttributeNS(null,"width",h(H)),ie.setAttributeNS(null,"height",h(U)),ie.setAttributeNS(null,"fill",Y),ie.setAttributeNS(null,"mask",`url(#${F.maskId})`),this.defs.append(V),this._ensureTransformGroup().append(ie),this.paintInlineImageXObject(y,V)}paintFormXObjectBegin(C,y){if(Array.isArray(C)&&C.length===6&&this.transform(C[0],C[1],C[2],C[3],C[4],C[5]),y){const F=y[2]-y[0],H=y[3]-y[1],U=this.svgFactory.createElement("svg:rect");U.setAttributeNS(null,"x",y[0]),U.setAttributeNS(null,"y",y[1]),U.setAttributeNS(null,"width",h(F)),U.setAttributeNS(null,"height",h(H)),this.current.element=U,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(C){const y=this.svgFactory.create(C.width,C.height),F=this.svgFactory.createElement("svg:defs");y.append(F),this.defs=F;const H=this.svgFactory.createElement("svg:g");return H.setAttributeNS(null,"transform",_(C.transform)),y.append(H),this.svg=H,y}_ensureClipGroup(){if(!this.current.clipGroup){const C=this.svgFactory.createElement("svg:g");C.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(C),this.current.clipGroup=C}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",_(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}t.SVGGraphics=w},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XfaText=void 0;class s{static textContent(i){const r=[],d={items:r,styles:Object.create(null)};function f(m){if(!m)return;let u=null;const a=m.name;if(a==="#text")u=m.value;else if(s.shouldBuildText(a))m?.attributes?.textContent?u=m.attributes.textContent:m.value&&(u=m.value);else return;if(u!==null&&r.push({str:u}),!!m.children)for(const c of m.children)f(c)}return f(i),d}static shouldBuildText(i){return!(i==="textarea"||i==="input"||i==="option"||i==="select")}}t.XfaText=s},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextLayerRenderTask=void 0,t.renderTextLayer=_,t.updateTextLayer=I;var n=s(1),i=s(6);const r=1e5,d=30,f=.8,m=new Map;function u(A,O){let w;if(O&&n.FeatureTest.isOffscreenCanvasSupported)w=new OffscreenCanvas(A,A).getContext("2d",{alpha:!1});else{const P=document.createElement("canvas");P.width=P.height=A,w=P.getContext("2d",{alpha:!1})}return w}function a(A,O){const w=m.get(A);if(w)return w;const P=u(d,O);P.font=`${d}px ${A}`;const C=P.measureText("");let y=C.fontBoundingBoxAscent,F=Math.abs(C.fontBoundingBoxDescent);if(y){const U=y/(y+F);return m.set(A,U),P.canvas.width=P.canvas.height=0,U}P.strokeStyle="red",P.clearRect(0,0,d,d),P.strokeText("g",0,0);let H=P.getImageData(0,0,d,d).data;F=0;for(let U=H.length-1-3;U>=0;U-=4)if(H[U]>0){F=Math.ceil(U/4/d);break}P.clearRect(0,0,d,d),P.strokeText("A",0,d),H=P.getImageData(0,0,d,d).data,y=0;for(let U=0,Y=H.length;U<Y;U+=4)if(H[U]>0){y=d-Math.floor(U/4/d);break}if(P.canvas.width=P.canvas.height=0,y){const U=y/(y+F);return m.set(A,U),U}return m.set(A,f),f}function c(A,O,w){const P=document.createElement("span"),C={angle:0,canvasWidth:0,hasText:O.str!=="",hasEOL:O.hasEOL,fontSize:0};A._textDivs.push(P);const y=n.Util.transform(A._transform,O.transform);let F=Math.atan2(y[1],y[0]);const H=w[O.fontName];H.vertical&&(F+=Math.PI/2);const U=Math.hypot(y[2],y[3]),Y=U*a(H.fontFamily,A._isOffscreenCanvasSupported);let V,ie;F===0?(V=y[4],ie=y[5]-Y):(V=y[4]+Y*Math.sin(F),ie=y[5]-Y*Math.cos(F));const J="calc(var(--scale-factor)*",ne=P.style;A._container===A._rootContainer?(ne.left=`${(100*V/A._pageWidth).toFixed(2)}%`,ne.top=`${(100*ie/A._pageHeight).toFixed(2)}%`):(ne.left=`${J}${V.toFixed(2)}px)`,ne.top=`${J}${ie.toFixed(2)}px)`),ne.fontSize=`${J}${U.toFixed(2)}px)`,ne.fontFamily=H.fontFamily,C.fontSize=U,P.setAttribute("role","presentation"),P.textContent=O.str,P.dir=O.dir,A._fontInspectorEnabled&&(P.dataset.fontName=O.fontName),F!==0&&(C.angle=F*(180/Math.PI));let ae=!1;if(O.str.length>1)ae=!0;else if(O.str!==" "&&O.transform[0]!==O.transform[3]){const te=Math.abs(O.transform[0]),G=Math.abs(O.transform[3]);te!==G&&Math.max(te,G)/Math.min(te,G)>1.5&&(ae=!0)}ae&&(C.canvasWidth=H.vertical?O.height:O.width),A._textDivProperties.set(P,C),A._isReadableStream&&A._layoutText(P)}function T(A){const{div:O,scale:w,properties:P,ctx:C,prevFontSize:y,prevFontFamily:F}=A,{style:H}=O;let U="";if(P.canvasWidth!==0&&P.hasText){const{fontFamily:Y}=H,{canvasWidth:V,fontSize:ie}=P;(y!==ie||F!==Y)&&(C.font=`${ie*w}px ${Y}`,A.prevFontSize=ie,A.prevFontFamily=Y);const{width:J}=C.measureText(O.textContent);J>0&&(U=`scaleX(${V*w/J})`)}P.angle!==0&&(U=`rotate(${P.angle}deg) ${U}`),U.length>0&&(H.transform=U)}function p(A){if(A._canceled)return;const O=A._textDivs,w=A._capability;if(O.length>r){w.resolve();return}if(!A._isReadableStream)for(const C of O)A._layoutText(C);w.resolve()}class h{constructor({textContentSource:O,container:w,viewport:P,textDivs:C,textDivProperties:y,textContentItemsStr:F,isOffscreenCanvasSupported:H}){this._textContentSource=O,this._isReadableStream=O instanceof ReadableStream,this._container=this._rootContainer=w,this._textDivs=C||[],this._textContentItemsStr=F||[],this._isOffscreenCanvasSupported=H,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=y||new WeakMap,this._canceled=!1,this._capability=new n.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:P.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:u(0,H)};const{pageWidth:U,pageHeight:Y,pageX:V,pageY:ie}=P.rawDims;this._transform=[1,0,0,-1,-V,ie+Y],this._pageWidth=U,this._pageHeight=Y,(0,i.setLayerDimensions)(w,P),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new n.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new n.AbortException("TextLayer task cancelled."))}_processItems(O,w){for(const P of O){if(P.str===void 0){if(P.type==="beginMarkedContentProps"||P.type==="beginMarkedContent"){const C=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),P.id!==null&&this._container.setAttribute("id",`${P.id}`),C.append(this._container)}else P.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(P.str),c(this,P,w)}}_layoutText(O){const w=this._layoutTextParams.properties=this._textDivProperties.get(O);if(this._layoutTextParams.div=O,T(this._layoutTextParams),w.hasText&&this._container.append(O),w.hasEOL){const P=document.createElement("br");P.setAttribute("role","presentation"),this._container.append(P)}}_render(){const O=new n.PromiseCapability;let w=Object.create(null);if(this._isReadableStream){const P=()=>{this._reader.read().then(({value:C,done:y})=>{if(y){O.resolve();return}Object.assign(w,C.styles),this._processItems(C.items,w),P()},O.reject)};this._reader=this._textContentSource.getReader(),P()}else if(this._textContentSource){const{items:P,styles:C}=this._textContentSource;this._processItems(P,C),O.resolve()}else throw new Error('No "textContentSource" parameter specified.');O.promise.then(()=>{w=null,p(this)},this._capability.reject)}}t.TextLayerRenderTask=h;function _(A){!A.textContentSource&&(A.textContent||A.textContentStream)&&((0,i.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),A.textContentSource=A.textContent||A.textContentStream);const{container:O,viewport:w}=A,P=getComputedStyle(O),C=P.getPropertyValue("visibility"),y=parseFloat(P.getPropertyValue("--scale-factor"));C==="visible"&&(!y||Math.abs(y-w.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const F=new h(A);return F._render(),F}function I({container:A,viewport:O,textDivs:w,textDivProperties:P,isOffscreenCanvasSupported:C,mustRotate:y=!0,mustRescale:F=!0}){if(y&&(0,i.setLayerDimensions)(A,{rotation:O.rotation}),F){const H=u(0,C),Y={prevFontSize:null,prevFontFamily:null,div:null,scale:O.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:H};for(const V of w)Y.properties=P.get(V),Y.div=V,T(Y)}}},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationEditorLayer=void 0;var n=s(1),i=s(4),r=s(28),d=s(33),f=s(6),m=s(34);class u{#e;#t=!1;#s=null;#n=this.pointerup.bind(this);#a=this.pointerdown.bind(this);#o=new Map;#r=!1;#u=!1;#c=!1;#i;static _initialized=!1;constructor({uiManager:c,pageIndex:T,div:p,accessibilityManager:h,annotationLayer:_,viewport:I,l10n:A}){const O=[r.FreeTextEditor,d.InkEditor,m.StampEditor];if(!u._initialized){u._initialized=!0;for(const w of O)w.initialize(A)}c.registerEditorTypes(O),this.#i=c,this.pageIndex=T,this.div=p,this.#e=h,this.#s=_,this.viewport=I,this.#i.addLayer(this)}get isEmpty(){return this.#o.size===0}updateToolbar(c){this.#i.updateToolbar(c)}updateMode(c=this.#i.getMode()){this.#g(),c===n.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),c!==n.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",c===n.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",c===n.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",c===n.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(c){if(!c&&this.#i.getMode()!==n.AnnotationEditorType.INK)return;if(!c){for(const p of this.#o.values())if(p.isEmpty()){p.setInBackground();return}}this.#h({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(c){this.#i.setEditingState(c)}addCommands(c){this.#i.addCommands(c)}enable(){this.div.style.pointerEvents="auto";const c=new Set;for(const p of this.#o.values())p.enableEditing(),p.annotationElementId&&c.add(p.annotationElementId);if(!this.#s)return;const T=this.#s.getEditableAnnotations();for(const p of T){if(p.hide(),this.#i.isDeletedAnnotationElement(p.data.id)||c.has(p.data.id))continue;const h=this.deserialize(p);h&&(this.addOrRebuild(h),h.enableEditing())}}disable(){this.#c=!0,this.div.style.pointerEvents="none";const c=new Set;for(const T of this.#o.values()){if(T.disableEditing(),!T.annotationElementId||T.serialize()!==null){c.add(T.annotationElementId);continue}this.getEditableAnnotation(T.annotationElementId)?.show(),T.remove()}if(this.#s){const T=this.#s.getEditableAnnotations();for(const p of T){const{id:h}=p.data;c.has(h)||this.#i.isDeletedAnnotationElement(h)||p.show()}}this.#g(),this.isEmpty&&(this.div.hidden=!0),this.#c=!1}getEditableAnnotation(c){return this.#s?.getEditableAnnotation(c)||null}setActiveEditor(c){this.#i.getActive()!==c&&this.#i.setActiveEditor(c)}enableClick(){this.div.addEventListener("pointerdown",this.#a),this.div.addEventListener("pointerup",this.#n)}disableClick(){this.div.removeEventListener("pointerdown",this.#a),this.div.removeEventListener("pointerup",this.#n)}attach(c){this.#o.set(c.id,c);const{annotationElementId:T}=c;T&&this.#i.isDeletedAnnotationElement(T)&&this.#i.removeDeletedAnnotationElement(c)}detach(c){this.#o.delete(c.id),this.#e?.removePointerInTextLayer(c.contentDiv),!this.#c&&c.annotationElementId&&this.#i.addDeletedAnnotationElement(c)}remove(c){this.detach(c),this.#i.removeEditor(c),c.div.contains(document.activeElement)&&setTimeout(()=>{this.#i.focusMainContainer()},0),c.div.remove(),c.isAttachedToDOM=!1,this.#u||this.addInkEditorIfNeeded(!1)}changeParent(c){c.parent!==this&&(c.annotationElementId&&(this.#i.addDeletedAnnotationElement(c.annotationElementId),i.AnnotationEditor.deleteAnnotationElement(c),c.annotationElementId=null),this.attach(c),c.parent?.detach(c),c.setParent(this),c.div&&c.isAttachedToDOM&&(c.div.remove(),this.div.append(c.div)))}add(c){if(this.changeParent(c),this.#i.addEditor(c),this.attach(c),!c.isAttachedToDOM){const T=c.render();this.div.append(T),c.isAttachedToDOM=!0}c.fixAndSetPosition(),c.onceAdded(),this.#i.addToAnnotationStorage(c)}moveEditorInDOM(c){if(!c.isAttachedToDOM)return;const{activeElement:T}=document;c.div.contains(T)&&(c._focusEventsAllowed=!1,setTimeout(()=>{c.div.contains(document.activeElement)?c._focusEventsAllowed=!0:(c.div.addEventListener("focusin",()=>{c._focusEventsAllowed=!0},{once:!0}),T.focus())},0)),c._structTreeParentId=this.#e?.moveElementInDOM(this.div,c.div,c.contentDiv,!0)}addOrRebuild(c){c.needsToBeRebuilt()?c.rebuild():this.add(c)}addUndoableEditor(c){const T=()=>c._uiManager.rebuild(c),p=()=>{c.remove()};this.addCommands({cmd:T,undo:p,mustExec:!1})}getNextId(){return this.#i.getId()}#f(c){switch(this.#i.getMode()){case n.AnnotationEditorType.FREETEXT:return new r.FreeTextEditor(c);case n.AnnotationEditorType.INK:return new d.InkEditor(c);case n.AnnotationEditorType.STAMP:return new m.StampEditor(c)}return null}pasteEditor(c,T){this.#i.updateToolbar(c),this.#i.updateMode(c);const{offsetX:p,offsetY:h}=this.#d(),_=this.getNextId(),I=this.#f({parent:this,id:_,x:p,y:h,uiManager:this.#i,isCentered:!0,...T});I&&this.add(I)}deserialize(c){switch(c.annotationType??c.annotationEditorType){case n.AnnotationEditorType.FREETEXT:return r.FreeTextEditor.deserialize(c,this,this.#i);case n.AnnotationEditorType.INK:return d.InkEditor.deserialize(c,this,this.#i);case n.AnnotationEditorType.STAMP:return m.StampEditor.deserialize(c,this,this.#i)}return null}#h(c,T){const p=this.getNextId(),h=this.#f({parent:this,id:p,x:c.offsetX,y:c.offsetY,uiManager:this.#i,isCentered:T});return h&&this.add(h),h}#d(){const{x:c,y:T,width:p,height:h}=this.div.getBoundingClientRect(),_=Math.max(0,c),I=Math.max(0,T),A=Math.min(window.innerWidth,c+p),O=Math.min(window.innerHeight,T+h),w=(_+A)/2-c,P=(I+O)/2-T,[C,y]=this.viewport.rotation%180===0?[w,P]:[P,w];return{offsetX:C,offsetY:y}}addNewEditor(){this.#h(this.#d(),!0)}setSelected(c){this.#i.setSelected(c)}toggleSelected(c){this.#i.toggleSelected(c)}isSelected(c){return this.#i.isSelected(c)}unselect(c){this.#i.unselect(c)}pointerup(c){const{isMac:T}=n.FeatureTest.platform;if(!(c.button!==0||c.ctrlKey&&T)&&c.target===this.div&&this.#r){if(this.#r=!1,!this.#t){this.#t=!0;return}if(this.#i.getMode()===n.AnnotationEditorType.STAMP){this.#i.unselectAll();return}this.#h(c,!1)}}pointerdown(c){if(this.#r){this.#r=!1;return}const{isMac:T}=n.FeatureTest.platform;if(c.button!==0||c.ctrlKey&&T||c.target!==this.div)return;this.#r=!0;const p=this.#i.getActive();this.#t=!p||p.isEmpty()}findNewParent(c,T,p){const h=this.#i.findParent(T,p);return h===null||h===this?!1:(h.changeParent(c),!0)}destroy(){this.#i.getActive()?.parent===this&&(this.#i.commitOrRemove(),this.#i.setActiveEditor(null));for(const c of this.#o.values())this.#e?.removePointerInTextLayer(c.contentDiv),c.setParent(null),c.isAttachedToDOM=!1,c.div.remove();this.div=null,this.#o.clear(),this.#i.removeLayer(this)}#g(){this.#u=!0;for(const c of this.#o.values())c.isEmpty()&&c.remove();this.#u=!1}render({viewport:c}){this.viewport=c,(0,f.setLayerDimensions)(this.div,c);for(const T of this.#i.getEditors(this.pageIndex))this.add(T);this.updateMode()}update({viewport:c}){this.#i.commitOrRemove(),this.viewport=c,(0,f.setLayerDimensions)(this.div,{rotation:c.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:c,pageHeight:T}=this.viewport.rawDims;return[c,T]}}t.AnnotationEditorLayer=u},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FreeTextEditor=void 0;var n=s(1),i=s(5),r=s(4),d=s(29);class f extends r.AnnotationEditor{#e=this.editorDivBlur.bind(this);#t=this.editorDivFocus.bind(this);#s=this.editorDivInput.bind(this);#n=this.editorDivKeydown.bind(this);#a;#o="";#r=`${this.id}-editor`;#u;#c=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const u=f.prototype,a=p=>p.isEmpty(),c=i.AnnotationEditorUIManager.TRANSLATE_SMALL,T=i.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,n.shadow)(this,"_keyboardManager",new i.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],u.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],u.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],u._translateEmpty,{args:[-c,0],checker:a}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],u._translateEmpty,{args:[-T,0],checker:a}],[["ArrowRight","mac+ArrowRight"],u._translateEmpty,{args:[c,0],checker:a}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],u._translateEmpty,{args:[T,0],checker:a}],[["ArrowUp","mac+ArrowUp"],u._translateEmpty,{args:[0,-c],checker:a}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],u._translateEmpty,{args:[0,-T],checker:a}],[["ArrowDown","mac+ArrowDown"],u._translateEmpty,{args:[0,c],checker:a}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],u._translateEmpty,{args:[0,T],checker:a}]]))}static _type="freetext";constructor(u){super({...u,name:"freeTextEditor"}),this.#a=u.color||f._defaultColor||r.AnnotationEditor._defaultLineColor,this.#u=u.fontSize||f._defaultFontSize}static initialize(u){r.AnnotationEditor.initialize(u,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const a=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(a.getPropertyValue("--freetext-padding"))}static updateDefaultParams(u,a){switch(u){case n.AnnotationEditorParamsType.FREETEXT_SIZE:f._defaultFontSize=a;break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:f._defaultColor=a;break}}updateParams(u,a){switch(u){case n.AnnotationEditorParamsType.FREETEXT_SIZE:this.#i(a);break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:this.#f(a);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,f._defaultFontSize],[n.AnnotationEditorParamsType.FREETEXT_COLOR,f._defaultColor||r.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,this.#u],[n.AnnotationEditorParamsType.FREETEXT_COLOR,this.#a]]}#i(u){const a=T=>{this.editorDiv.style.fontSize=`calc(${T}px * var(--scale-factor))`,this.translate(0,-(T-this.#u)*this.parentScale),this.#u=T,this.#d()},c=this.#u;this.addCommands({cmd:()=>{a(u)},undo:()=>{a(c)},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#f(u){const a=this.#a;this.addCommands({cmd:()=>{this.#a=this.editorDiv.style.color=u},undo:()=>{this.#a=this.editorDiv.style.color=a},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(u,a){this._uiManager.translateSelectedEditors(u,a,!0)}getInitialTranslation(){const u=this.parentScale;return[-f._internalPadding*u,-(f._internalPadding+this.#u)*u]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(n.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",this.#n),this.editorDiv.addEventListener("focus",this.#t),this.editorDiv.addEventListener("blur",this.#e),this.editorDiv.addEventListener("input",this.#s))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#r),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#n),this.editorDiv.removeEventListener("focus",this.#t),this.editorDiv.removeEventListener("blur",this.#e),this.editorDiv.removeEventListener("input",this.#s),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(u){this._focusEventsAllowed&&(super.focusin(u),u.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){if(this.width){this.#p();return}this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}#h(){const u=this.editorDiv.getElementsByTagName("div");if(u.length===0)return this.editorDiv.innerText;const a=[];for(const c of u)a.push(c.innerText.replace(/\r\n?|\n/,""));return a.join(`
`)}#d(){const[u,a]=this.parentDimensions;let c;if(this.isAttachedToDOM)c=this.div.getBoundingClientRect();else{const{currentLayer:T,div:p}=this,h=p.style.display;p.style.display="hidden",T.div.append(this.div),c=p.getBoundingClientRect(),p.remove(),p.style.display=h}this.rotation%180===this.parentRotation%180?(this.width=c.width/u,this.height=c.height/a):(this.width=c.height/u,this.height=c.width/a),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const u=this.#o,a=this.#o=this.#h().trimEnd();if(u===a)return;const c=T=>{if(this.#o=T,!T){this.remove();return}this.#g(),this._uiManager.rebuild(this),this.#d()};this.addCommands({cmd:()=>{c(a)},undo:()=>{c(u)},mustExec:!1}),this.#d()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(u){this.enterInEditMode()}keydown(u){u.target===this.div&&u.key==="Enter"&&(this.enterInEditMode(),u.preventDefault())}editorDivKeydown(u){f._keyboardManager.exec(this,u)}editorDivFocus(u){this.isEditing=!0}editorDivBlur(u){this.isEditing=!1}editorDivInput(u){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let u,a;this.width&&(u=this.x,a=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#r),this.enableEditing(),r.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(T=>this.editorDiv?.setAttribute("aria-label",T)),r.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(T=>this.editorDiv?.setAttribute("default-content",T)),this.editorDiv.contentEditable=!0;const{style:c}=this.editorDiv;if(c.fontSize=`calc(${this.#u}px * var(--scale-factor))`,c.color=this.#a,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,i.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[T,p]=this.parentDimensions;if(this.annotationElementId){const{position:h}=this.#c;let[_,I]=this.getInitialTranslation();[_,I]=this.pageTranslationToScreen(_,I);const[A,O]=this.pageDimensions,[w,P]=this.pageTranslation;let C,y;switch(this.rotation){case 0:C=u+(h[0]-w)/A,y=a+this.height-(h[1]-P)/O;break;case 90:C=u+(h[0]-w)/A,y=a-(h[1]-P)/O,[_,I]=[I,-_];break;case 180:C=u-this.width+(h[0]-w)/A,y=a-(h[1]-P)/O,[_,I]=[-_,-I];break;case 270:C=u+(h[0]-w-this.height*O)/A,y=a+(h[1]-P-this.width*A)/O,[_,I]=[-I,_];break}this.setAt(C*T,y*p,_,I)}else this.setAt(u*T,a*p,this.width*T,this.height*p);this.#g(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}#g(){if(this.editorDiv.replaceChildren(),!!this.#o)for(const u of this.#o.split(`
`)){const a=document.createElement("div");a.append(u?document.createTextNode(u):document.createElement("br")),this.editorDiv.append(a)}}get contentDiv(){return this.editorDiv}static deserialize(u,a,c){let T=null;if(u instanceof d.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:h,fontColor:_},rect:I,rotation:A,id:O},textContent:w,textPosition:P,parent:{page:{pageNumber:C}}}=u;if(!w||w.length===0)return null;T=u={annotationType:n.AnnotationEditorType.FREETEXT,color:Array.from(_),fontSize:h,value:w.join(`
`),position:P,pageIndex:C-1,rect:I,rotation:A,id:O,deleted:!1}}const p=super.deserialize(u,a,c);return p.#u=u.fontSize,p.#a=n.Util.makeHexColor(...u.color),p.#o=u.value,p.annotationElementId=u.id||null,p.#c=T,p}serialize(u=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const a=f._internalPadding*this.parentScale,c=this.getRect(a,a),T=r.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#a),p={annotationType:n.AnnotationEditorType.FREETEXT,color:T,fontSize:this.#u,value:this.#o,pageIndex:this.pageIndex,rect:c,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return u?p:this.annotationElementId&&!this.#T(p)?null:(p.id=this.annotationElementId,p)}#T(u){const{value:a,fontSize:c,color:T,rect:p,pageIndex:h}=this.#c;return u.value!==a||u.fontSize!==c||u.rect.some((_,I)=>Math.abs(_-p[I])>=1)||u.color.some((_,I)=>_!==T[I])||u.pageIndex!==h}#p(u=!1){if(!this.annotationElementId)return;if(this.#d(),!u&&(this.width===0||this.height===0)){setTimeout(()=>this.#p(!0),0);return}const a=f._internalPadding*this.parentScale;this.#c.rect=this.getRect(a,a)}}t.FreeTextEditor=f},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StampAnnotationElement=t.InkAnnotationElement=t.FreeTextAnnotationElement=t.AnnotationLayer=void 0;var n=s(1),i=s(6),r=s(3),d=s(30),f=s(31),m=s(32);const u=1e3,a=9,c=new WeakSet;function T(M){return{width:M[2]-M[0],height:M[3]-M[1]}}class p{static create(E){switch(E.data.annotationType){case n.AnnotationType.LINK:return new _(E);case n.AnnotationType.TEXT:return new I(E);case n.AnnotationType.WIDGET:switch(E.data.fieldType){case"Tx":return new O(E);case"Btn":return E.data.radioButton?new C(E):E.data.checkBox?new P(E):new y(E);case"Ch":return new F(E);case"Sig":return new w(E)}return new A(E);case n.AnnotationType.POPUP:return new H(E);case n.AnnotationType.FREETEXT:return new Y(E);case n.AnnotationType.LINE:return new V(E);case n.AnnotationType.SQUARE:return new ie(E);case n.AnnotationType.CIRCLE:return new J(E);case n.AnnotationType.POLYLINE:return new ne(E);case n.AnnotationType.CARET:return new te(E);case n.AnnotationType.INK:return new G(E);case n.AnnotationType.POLYGON:return new ae(E);case n.AnnotationType.HIGHLIGHT:return new N(E);case n.AnnotationType.UNDERLINE:return new b(E);case n.AnnotationType.SQUIGGLY:return new S(E);case n.AnnotationType.STRIKEOUT:return new R(E);case n.AnnotationType.STAMP:return new L(E);case n.AnnotationType.FILEATTACHMENT:return new B(E);default:return new h(E)}}}class h{#e=!1;constructor(E,{isRenderable:D=!1,ignoreBorder:x=!1,createQuadrilaterals:v=!1}={}){this.isRenderable=D,this.data=E.data,this.layer=E.layer,this.linkService=E.linkService,this.downloadManager=E.downloadManager,this.imageResourcesPath=E.imageResourcesPath,this.renderForms=E.renderForms,this.svgFactory=E.svgFactory,this.annotationStorage=E.annotationStorage,this.enableScripting=E.enableScripting,this.hasJSActions=E.hasJSActions,this._fieldObjects=E.fieldObjects,this.parent=E.parent,D&&(this.container=this._createContainer(x)),v&&this._createQuadrilaterals()}static _hasPopupData({titleObj:E,contentsObj:D,richText:x}){return!!(E?.str||D?.str||x?.str)}get hasPopupData(){return h._hasPopupData(this.data)}_createContainer(E){const{data:D,parent:{page:x,viewport:v}}=this,k=document.createElement("section");k.setAttribute("data-annotation-id",D.id),this instanceof A||(k.tabIndex=u),k.style.zIndex=this.parent.zIndex++,this.data.popupRef&&k.setAttribute("aria-haspopup","dialog"),D.noRotate&&k.classList.add("norotate");const{pageWidth:q,pageHeight:j,pageX:K,pageY:ue}=v.rawDims;if(!D.rect||this instanceof H){const{rotation:re}=D;return!D.hasOwnCanvas&&re!==0&&this.setRotation(re,k),k}const{width:Q,height:Z}=T(D.rect),ee=n.Util.normalizeRect([D.rect[0],x.view[3]-D.rect[1]+x.view[1],D.rect[2],x.view[3]-D.rect[3]+x.view[1]]);if(!E&&D.borderStyle.width>0){k.style.borderWidth=`${D.borderStyle.width}px`;const re=D.borderStyle.horizontalCornerRadius,ce=D.borderStyle.verticalCornerRadius;if(re>0||ce>0){const de=`calc(${re}px * var(--scale-factor)) / calc(${ce}px * var(--scale-factor))`;k.style.borderRadius=de}else if(this instanceof C){const de=`calc(${Q}px * var(--scale-factor)) / calc(${Z}px * var(--scale-factor))`;k.style.borderRadius=de}switch(D.borderStyle.style){case n.AnnotationBorderStyleType.SOLID:k.style.borderStyle="solid";break;case n.AnnotationBorderStyleType.DASHED:k.style.borderStyle="dashed";break;case n.AnnotationBorderStyleType.BEVELED:(0,n.warn)("Unimplemented border style: beveled");break;case n.AnnotationBorderStyleType.INSET:(0,n.warn)("Unimplemented border style: inset");break;case n.AnnotationBorderStyleType.UNDERLINE:k.style.borderBottomStyle="solid";break}const he=D.borderColor||null;he?(this.#e=!0,k.style.borderColor=n.Util.makeHexColor(he[0]|0,he[1]|0,he[2]|0)):k.style.borderWidth=0}k.style.left=`${100*(ee[0]-K)/q}%`,k.style.top=`${100*(ee[1]-ue)/j}%`;const{rotation:se}=D;return D.hasOwnCanvas||se===0?(k.style.width=`${100*Q/q}%`,k.style.height=`${100*Z/j}%`):this.setRotation(se,k),k}setRotation(E,D=this.container){if(!this.data.rect)return;const{pageWidth:x,pageHeight:v}=this.parent.viewport.rawDims,{width:k,height:q}=T(this.data.rect);let j,K;E%180===0?(j=100*k/x,K=100*q/v):(j=100*q/x,K=100*k/v),D.style.width=`${j}%`,D.style.height=`${K}%`,D.setAttribute("data-main-rotation",(360-E)%360)}get _commonActions(){const E=(D,x,v)=>{const k=v.detail[D],q=k[0],j=k.slice(1);v.target.style[x]=d.ColorConverters[`${q}_HTML`](j),this.annotationStorage.setValue(this.data.id,{[x]:d.ColorConverters[`${q}_rgb`](j)})};return(0,n.shadow)(this,"_commonActions",{display:D=>{const{display:x}=D.detail,v=x%2===1;this.container.style.visibility=v?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:v,noPrint:x===1||x===2})},print:D=>{this.annotationStorage.setValue(this.data.id,{noPrint:!D.detail.print})},hidden:D=>{const{hidden:x}=D.detail;this.container.style.visibility=x?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:x,noView:x})},focus:D=>{setTimeout(()=>D.target.focus({preventScroll:!1}),0)},userName:D=>{D.target.title=D.detail.userName},readonly:D=>{D.target.disabled=D.detail.readonly},required:D=>{this._setRequired(D.target,D.detail.required)},bgColor:D=>{E("bgColor","backgroundColor",D)},fillColor:D=>{E("fillColor","backgroundColor",D)},fgColor:D=>{E("fgColor","color",D)},textColor:D=>{E("textColor","color",D)},borderColor:D=>{E("borderColor","borderColor",D)},strokeColor:D=>{E("strokeColor","borderColor",D)},rotation:D=>{const x=D.detail.rotation;this.setRotation(x),this.annotationStorage.setValue(this.data.id,{rotation:x})}})}_dispatchEventFromSandbox(E,D){const x=this._commonActions;for(const v of Object.keys(D.detail))(E[v]||x[v])?.(D)}_setDefaultPropertiesFromJS(E){if(!this.enableScripting)return;const D=this.annotationStorage.getRawValue(this.data.id);if(!D)return;const x=this._commonActions;for(const[v,k]of Object.entries(D)){const q=x[v];if(q){const j={detail:{[v]:k},target:E};q(j),delete D[v]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:E}=this.data;if(!E)return;const[D,x,v,k]=this.data.rect;if(E.length===1){const[,{x:ce,y:he},{x:de,y:fe}]=E[0];if(v===ce&&k===he&&D===de&&x===fe)return}const{style:q}=this.container;let j;if(this.#e){const{borderColor:ce,borderWidth:he}=q;q.borderWidth=0,j=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${ce}" stroke-width="${he}">`],this.container.classList.add("hasBorder")}const K=v-D,ue=k-x,{svgFactory:Q}=this,Z=Q.createElement("svg");Z.classList.add("quadrilateralsContainer"),Z.setAttribute("width",0),Z.setAttribute("height",0);const ee=Q.createElement("defs");Z.append(ee);const se=Q.createElement("clipPath"),re=`clippath_${this.data.id}`;se.setAttribute("id",re),se.setAttribute("clipPathUnits","objectBoundingBox"),ee.append(se);for(const[,{x:ce,y:he},{x:de,y:fe}]of E){const ge=Q.createElement("rect"),pe=(de-D)/K,Ie=(k-he)/ue,_e=(ce-de)/K,Re=(he-fe)/ue;ge.setAttribute("x",pe),ge.setAttribute("y",Ie),ge.setAttribute("width",_e),ge.setAttribute("height",Re),se.append(ge),j?.push(`<rect vector-effect="non-scaling-stroke" x="${pe}" y="${Ie}" width="${_e}" height="${Re}"/>`)}this.#e&&(j.push("</g></svg>')"),q.backgroundImage=j.join("")),this.container.append(Z),this.container.style.clipPath=`url(#${re})`}_createPopup(){const{container:E,data:D}=this;E.setAttribute("aria-haspopup","dialog");const x=new H({data:{color:D.color,titleObj:D.titleObj,modificationDate:D.modificationDate,contentsObj:D.contentsObj,richText:D.richText,parentRect:D.rect,borderStyle:0,id:`popup_${D.id}`,rotation:D.rotation},parent:this.parent,elements:[this]});this.parent.div.append(x.render())}render(){(0,n.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(E,D=null){const x=[];if(this._fieldObjects){const v=this._fieldObjects[E];if(v)for(const{page:k,id:q,exportValues:j}of v){if(k===-1||q===D)continue;const K=typeof j=="string"?j:null,ue=document.querySelector(`[data-element-id="${q}"]`);if(ue&&!c.has(ue)){(0,n.warn)(`_getElementsByName - element not allowed: ${q}`);continue}x.push({id:q,exportValue:K,domElement:ue})}return x}for(const v of document.getElementsByName(E)){const{exportValue:k}=v,q=v.getAttribute("data-element-id");q!==D&&c.has(v)&&x.push({id:q,exportValue:k,domElement:v})}return x}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const E=this.getElementsToTriggerPopup();if(Array.isArray(E))for(const D of E)D.classList.add("highlightArea");else E.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:E,data:{id:D}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:E,editId:D})})}}class _ extends h{constructor(E,D=null){super(E,{isRenderable:!0,ignoreBorder:!!D?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=E.data.isTooltipOnly}render(){const{data:E,linkService:D}=this,x=document.createElement("a");x.setAttribute("data-element-id",E.id);let v=!1;return E.url?(D.addLinkAttributes(x,E.url,E.newWindow),v=!0):E.action?(this._bindNamedAction(x,E.action),v=!0):E.attachment?(this._bindAttachment(x,E.attachment),v=!0):E.setOCGState?(this.#t(x,E.setOCGState),v=!0):E.dest?(this._bindLink(x,E.dest),v=!0):(E.actions&&(E.actions.Action||E.actions["Mouse Up"]||E.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(x,E),v=!0),E.resetForm?(this._bindResetFormAction(x,E.resetForm),v=!0):this.isTooltipOnly&&!v&&(this._bindLink(x,""),v=!0)),this.container.classList.add("linkAnnotation"),v&&this.container.append(x),this.container}#e(){this.container.setAttribute("data-internal-link","")}_bindLink(E,D){E.href=this.linkService.getDestinationHash(D),E.onclick=()=>(D&&this.linkService.goToDestination(D),!1),(D||D==="")&&this.#e()}_bindNamedAction(E,D){E.href=this.linkService.getAnchorUrl(""),E.onclick=()=>(this.linkService.executeNamedAction(D),!1),this.#e()}_bindAttachment(E,D){E.href=this.linkService.getAnchorUrl(""),E.onclick=()=>(this.downloadManager?.openOrDownloadData(this.container,D.content,D.filename),!1),this.#e()}#t(E,D){E.href=this.linkService.getAnchorUrl(""),E.onclick=()=>(this.linkService.executeSetOCGState(D),!1),this.#e()}_bindJSAction(E,D){E.href=this.linkService.getAnchorUrl("");const x=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const v of Object.keys(D.actions)){const k=x.get(v);k&&(E[k]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:D.id,name:v}}),!1))}E.onclick||(E.onclick=()=>!1),this.#e()}_bindResetFormAction(E,D){const x=E.onclick;if(x||(E.href=this.linkService.getAnchorUrl("")),this.#e(),!this._fieldObjects){(0,n.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),x||(E.onclick=()=>!1);return}E.onclick=()=>{x?.();const{fields:v,refs:k,include:q}=D,j=[];if(v.length!==0||k.length!==0){const Q=new Set(k);for(const Z of v){const ee=this._fieldObjects[Z]||[];for(const{id:se}of ee)Q.add(se)}for(const Z of Object.values(this._fieldObjects))for(const ee of Z)Q.has(ee.id)===q&&j.push(ee)}else for(const Q of Object.values(this._fieldObjects))j.push(...Q);const K=this.annotationStorage,ue=[];for(const Q of j){const{id:Z}=Q;switch(ue.push(Z),Q.type){case"text":{const se=Q.defaultValue||"";K.setValue(Z,{value:se});break}case"checkbox":case"radiobutton":{const se=Q.defaultValue===Q.exportValues;K.setValue(Z,{value:se});break}case"combobox":case"listbox":{const se=Q.defaultValue||"";K.setValue(Z,{value:se});break}default:continue}const ee=document.querySelector(`[data-element-id="${Z}"]`);if(ee){if(!c.has(ee)){(0,n.warn)(`_bindResetFormAction - element not allowed: ${Z}`);continue}}else continue;ee.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:ue,name:"ResetForm"}}),!1}}}class I extends h{constructor(E){super(E,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const E=document.createElement("img");return E.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",E.alt="[{{type}} Annotation]",E.dataset.l10nId="text_annotation_type",E.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(E),this.container}}class A extends h{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(E){this.data.hasOwnCanvas&&(E.previousSibling?.nodeName==="CANVAS"&&(E.previousSibling.hidden=!0),E.hidden=!1)}_getKeyModifier(E){const{isWin:D,isMac:x}=n.FeatureTest.platform;return D&&E.ctrlKey||x&&E.metaKey}_setEventListener(E,D,x,v,k){x.includes("mouse")?E.addEventListener(x,q=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:v,value:k(q),shift:q.shiftKey,modifier:this._getKeyModifier(q)}})}):E.addEventListener(x,q=>{if(x==="blur"){if(!D.focused||!q.relatedTarget)return;D.focused=!1}else if(x==="focus"){if(D.focused)return;D.focused=!0}k&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:v,value:k(q)}})})}_setEventListeners(E,D,x,v){for(const[k,q]of x)(q==="Action"||this.data.actions?.[q])&&((q==="Focus"||q==="Blur")&&(D||={focused:!1}),this._setEventListener(E,D,k,q,v),q==="Focus"&&!this.data.actions?.Blur?this._setEventListener(E,D,"blur","Blur",null):q==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(E,D,"focus","Focus",null))}_setBackgroundColor(E){const D=this.data.backgroundColor||null;E.style.backgroundColor=D===null?"transparent":n.Util.makeHexColor(D[0],D[1],D[2])}_setTextStyle(E){const D=["left","center","right"],{fontColor:x}=this.data.defaultAppearanceData,v=this.data.defaultAppearanceData.fontSize||a,k=E.style;let q;const j=2,K=ue=>Math.round(10*ue)/10;if(this.data.multiLine){const ue=Math.abs(this.data.rect[3]-this.data.rect[1]-j),Q=Math.round(ue/(n.LINE_FACTOR*v))||1,Z=ue/Q;q=Math.min(v,K(Z/n.LINE_FACTOR))}else{const ue=Math.abs(this.data.rect[3]-this.data.rect[1]-j);q=Math.min(v,K(ue/n.LINE_FACTOR))}k.fontSize=`calc(${q}px * var(--scale-factor))`,k.color=n.Util.makeHexColor(x[0],x[1],x[2]),this.data.textAlignment!==null&&(k.textAlign=D[this.data.textAlignment])}_setRequired(E,D){D?E.setAttribute("required",!0):E.removeAttribute("required"),E.setAttribute("aria-required",D)}}class O extends A{constructor(E){const D=E.renderForms||!E.data.hasAppearance&&!!E.data.fieldValue;super(E,{isRenderable:D})}setPropertyOnSiblings(E,D,x,v){const k=this.annotationStorage;for(const q of this._getElementsByName(E.name,E.id))q.domElement&&(q.domElement[D]=x),k.setValue(q.id,{[v]:x})}render(){const E=this.annotationStorage,D=this.data.id;this.container.classList.add("textWidgetAnnotation");let x=null;if(this.renderForms){const v=E.getValue(D,{value:this.data.fieldValue});let k=v.value||"";const q=E.getValue(D,{charLimit:this.data.maxLen}).charLimit;q&&k.length>q&&(k=k.slice(0,q));let j=v.formattedValue||this.data.textContent?.join(`
`)||null;j&&this.data.comb&&(j=j.replaceAll(/\s+/g,""));const K={userValue:k,formattedValue:j,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(x=document.createElement("textarea"),x.textContent=j??k,this.data.doNotScroll&&(x.style.overflowY="hidden")):(x=document.createElement("input"),x.type="text",x.setAttribute("value",j??k),this.data.doNotScroll&&(x.style.overflowX="hidden")),this.data.hasOwnCanvas&&(x.hidden=!0),c.add(x),x.setAttribute("data-element-id",D),x.disabled=this.data.readOnly,x.name=this.data.fieldName,x.tabIndex=u,this._setRequired(x,this.data.required),q&&(x.maxLength=q),x.addEventListener("input",Q=>{E.setValue(D,{value:Q.target.value}),this.setPropertyOnSiblings(x,"value",Q.target.value,"value"),K.formattedValue=null}),x.addEventListener("resetform",Q=>{const Z=this.data.defaultFieldValue??"";x.value=K.userValue=Z,K.formattedValue=null});let ue=Q=>{const{formattedValue:Z}=K;Z!=null&&(Q.target.value=Z),Q.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){x.addEventListener("focus",Z=>{if(K.focused)return;const{target:ee}=Z;K.userValue&&(ee.value=K.userValue),K.lastCommittedValue=ee.value,K.commitKey=1,K.focused=!0}),x.addEventListener("updatefromsandbox",Z=>{this.showElementAndHideCanvas(Z.target);const ee={value(se){K.userValue=se.detail.value??"",E.setValue(D,{value:K.userValue.toString()}),se.target.value=K.userValue},formattedValue(se){const{formattedValue:re}=se.detail;K.formattedValue=re,re!=null&&se.target!==document.activeElement&&(se.target.value=re),E.setValue(D,{formattedValue:re})},selRange(se){se.target.setSelectionRange(...se.detail.selRange)},charLimit:se=>{const{charLimit:re}=se.detail,{target:ce}=se;if(re===0){ce.removeAttribute("maxLength");return}ce.setAttribute("maxLength",re);let he=K.userValue;!he||he.length<=re||(he=he.slice(0,re),ce.value=K.userValue=he,E.setValue(D,{value:he}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:D,name:"Keystroke",value:he,willCommit:!0,commitKey:1,selStart:ce.selectionStart,selEnd:ce.selectionEnd}}))}};this._dispatchEventFromSandbox(ee,Z)}),x.addEventListener("keydown",Z=>{K.commitKey=1;let ee=-1;if(Z.key==="Escape"?ee=0:Z.key==="Enter"&&!this.data.multiLine?ee=2:Z.key==="Tab"&&(K.commitKey=3),ee===-1)return;const{value:se}=Z.target;K.lastCommittedValue!==se&&(K.lastCommittedValue=se,K.userValue=se,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:D,name:"Keystroke",value:se,willCommit:!0,commitKey:ee,selStart:Z.target.selectionStart,selEnd:Z.target.selectionEnd}}))});const Q=ue;ue=null,x.addEventListener("blur",Z=>{if(!K.focused||!Z.relatedTarget)return;K.focused=!1;const{value:ee}=Z.target;K.userValue=ee,K.lastCommittedValue!==ee&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:D,name:"Keystroke",value:ee,willCommit:!0,commitKey:K.commitKey,selStart:Z.target.selectionStart,selEnd:Z.target.selectionEnd}}),Q(Z)}),this.data.actions?.Keystroke&&x.addEventListener("beforeinput",Z=>{K.lastCommittedValue=null;const{data:ee,target:se}=Z,{value:re,selectionStart:ce,selectionEnd:he}=se;let de=ce,fe=he;switch(Z.inputType){case"deleteWordBackward":{const ge=re.substring(0,ce).match(/\w*[^\w]*$/);ge&&(de-=ge[0].length);break}case"deleteWordForward":{const ge=re.substring(ce).match(/^[^\w]*\w*/);ge&&(fe+=ge[0].length);break}case"deleteContentBackward":ce===he&&(de-=1);break;case"deleteContentForward":ce===he&&(fe+=1);break}Z.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:D,name:"Keystroke",value:re,change:ee||"",willCommit:!1,selStart:de,selEnd:fe}})}),this._setEventListeners(x,K,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Z=>Z.target.value)}if(ue&&x.addEventListener("blur",ue),this.data.comb){const Z=(this.data.rect[2]-this.data.rect[0])/q;x.classList.add("comb"),x.style.letterSpacing=`calc(${Z}px * var(--scale-factor) - 1ch)`}}else x=document.createElement("div"),x.textContent=this.data.fieldValue,x.style.verticalAlign="middle",x.style.display="table-cell";return this._setTextStyle(x),this._setBackgroundColor(x),this._setDefaultPropertiesFromJS(x),this.container.append(x),this.container}}class w extends A{constructor(E){super(E,{isRenderable:!!E.data.hasOwnCanvas})}}class P extends A{constructor(E){super(E,{isRenderable:E.renderForms})}render(){const E=this.annotationStorage,D=this.data,x=D.id;let v=E.getValue(x,{value:D.exportValue===D.fieldValue}).value;typeof v=="string"&&(v=v!=="Off",E.setValue(x,{value:v})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const k=document.createElement("input");return c.add(k),k.setAttribute("data-element-id",x),k.disabled=D.readOnly,this._setRequired(k,this.data.required),k.type="checkbox",k.name=D.fieldName,v&&k.setAttribute("checked",!0),k.setAttribute("exportValue",D.exportValue),k.tabIndex=u,k.addEventListener("change",q=>{const{name:j,checked:K}=q.target;for(const ue of this._getElementsByName(j,x)){const Q=K&&ue.exportValue===D.exportValue;ue.domElement&&(ue.domElement.checked=Q),E.setValue(ue.id,{value:Q})}E.setValue(x,{value:K})}),k.addEventListener("resetform",q=>{const j=D.defaultFieldValue||"Off";q.target.checked=j===D.exportValue}),this.enableScripting&&this.hasJSActions&&(k.addEventListener("updatefromsandbox",q=>{const j={value(K){K.target.checked=K.detail.value!=="Off",E.setValue(x,{value:K.target.checked})}};this._dispatchEventFromSandbox(j,q)}),this._setEventListeners(k,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],q=>q.target.checked)),this._setBackgroundColor(k),this._setDefaultPropertiesFromJS(k),this.container.append(k),this.container}}class C extends A{constructor(E){super(E,{isRenderable:E.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const E=this.annotationStorage,D=this.data,x=D.id;let v=E.getValue(x,{value:D.fieldValue===D.buttonValue}).value;typeof v=="string"&&(v=v!==D.buttonValue,E.setValue(x,{value:v}));const k=document.createElement("input");if(c.add(k),k.setAttribute("data-element-id",x),k.disabled=D.readOnly,this._setRequired(k,this.data.required),k.type="radio",k.name=D.fieldName,v&&k.setAttribute("checked",!0),k.tabIndex=u,k.addEventListener("change",q=>{const{name:j,checked:K}=q.target;for(const ue of this._getElementsByName(j,x))E.setValue(ue.id,{value:!1});E.setValue(x,{value:K})}),k.addEventListener("resetform",q=>{const j=D.defaultFieldValue;q.target.checked=j!=null&&j===D.buttonValue}),this.enableScripting&&this.hasJSActions){const q=D.buttonValue;k.addEventListener("updatefromsandbox",j=>{const K={value:ue=>{const Q=q===ue.detail.value;for(const Z of this._getElementsByName(ue.target.name)){const ee=Q&&Z.id===x;Z.domElement&&(Z.domElement.checked=ee),E.setValue(Z.id,{value:ee})}}};this._dispatchEventFromSandbox(K,j)}),this._setEventListeners(k,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],j=>j.target.checked)}return this._setBackgroundColor(k),this._setDefaultPropertiesFromJS(k),this.container.append(k),this.container}}class y extends _{constructor(E){super(E,{ignoreBorder:E.data.hasAppearance})}render(){const E=super.render();E.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(E.title=this.data.alternativeText);const D=E.lastChild;return this.enableScripting&&this.hasJSActions&&D&&(this._setDefaultPropertiesFromJS(D),D.addEventListener("updatefromsandbox",x=>{this._dispatchEventFromSandbox({},x)})),E}}class F extends A{constructor(E){super(E,{isRenderable:E.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const E=this.annotationStorage,D=this.data.id,x=E.getValue(D,{value:this.data.fieldValue}),v=document.createElement("select");c.add(v),v.setAttribute("data-element-id",D),v.disabled=this.data.readOnly,this._setRequired(v,this.data.required),v.name=this.data.fieldName,v.tabIndex=u;let k=this.data.combo&&this.data.options.length>0;this.data.combo||(v.size=this.data.options.length,this.data.multiSelect&&(v.multiple=!0)),v.addEventListener("resetform",Q=>{const Z=this.data.defaultFieldValue;for(const ee of v.options)ee.selected=ee.value===Z});for(const Q of this.data.options){const Z=document.createElement("option");Z.textContent=Q.displayValue,Z.value=Q.exportValue,x.value.includes(Q.exportValue)&&(Z.setAttribute("selected",!0),k=!1),v.append(Z)}let q=null;if(k){const Q=document.createElement("option");Q.value=" ",Q.setAttribute("hidden",!0),Q.setAttribute("selected",!0),v.prepend(Q),q=()=>{Q.remove(),v.removeEventListener("input",q),q=null},v.addEventListener("input",q)}const j=Q=>{const Z=Q?"value":"textContent",{options:ee,multiple:se}=v;return se?Array.prototype.filter.call(ee,re=>re.selected).map(re=>re[Z]):ee.selectedIndex===-1?null:ee[ee.selectedIndex][Z]};let K=j(!1);const ue=Q=>{const Z=Q.target.options;return Array.prototype.map.call(Z,ee=>({displayValue:ee.textContent,exportValue:ee.value}))};return this.enableScripting&&this.hasJSActions?(v.addEventListener("updatefromsandbox",Q=>{const Z={value(ee){q?.();const se=ee.detail.value,re=new Set(Array.isArray(se)?se:[se]);for(const ce of v.options)ce.selected=re.has(ce.value);E.setValue(D,{value:j(!0)}),K=j(!1)},multipleSelection(ee){v.multiple=!0},remove(ee){const se=v.options,re=ee.detail.remove;se[re].selected=!1,v.remove(re),se.length>0&&Array.prototype.findIndex.call(se,he=>he.selected)===-1&&(se[0].selected=!0),E.setValue(D,{value:j(!0),items:ue(ee)}),K=j(!1)},clear(ee){for(;v.length!==0;)v.remove(0);E.setValue(D,{value:null,items:[]}),K=j(!1)},insert(ee){const{index:se,displayValue:re,exportValue:ce}=ee.detail.insert,he=v.children[se],de=document.createElement("option");de.textContent=re,de.value=ce,he?he.before(de):v.append(de),E.setValue(D,{value:j(!0),items:ue(ee)}),K=j(!1)},items(ee){const{items:se}=ee.detail;for(;v.length!==0;)v.remove(0);for(const re of se){const{displayValue:ce,exportValue:he}=re,de=document.createElement("option");de.textContent=ce,de.value=he,v.append(de)}v.options.length>0&&(v.options[0].selected=!0),E.setValue(D,{value:j(!0),items:ue(ee)}),K=j(!1)},indices(ee){const se=new Set(ee.detail.indices);for(const re of ee.target.options)re.selected=se.has(re.index);E.setValue(D,{value:j(!0)}),K=j(!1)},editable(ee){ee.target.disabled=!ee.detail.editable}};this._dispatchEventFromSandbox(Z,Q)}),v.addEventListener("input",Q=>{const Z=j(!0);E.setValue(D,{value:Z}),Q.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:D,name:"Keystroke",value:K,changeEx:Z,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(v,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],Q=>Q.target.value)):v.addEventListener("input",function(Q){E.setValue(D,{value:j(!0)})}),this.data.combo&&this._setTextStyle(v),this._setBackgroundColor(v),this._setDefaultPropertiesFromJS(v),this.container.append(v),this.container}}class H extends h{constructor(E){const{data:D,elements:x}=E;super(E,{isRenderable:h._hasPopupData(D)}),this.elements=x}render(){this.container.classList.add("popupAnnotation");const E=new U({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),D=[];for(const x of this.elements)x.popup=E,D.push(x.data.id),x.addHighlightArea();return this.container.setAttribute("aria-controls",D.map(x=>`${n.AnnotationPrefix}${x}`).join(",")),this.container}}class U{#e=null;#t=this.#l.bind(this);#s=this.#S.bind(this);#n=this.#I.bind(this);#a=this.#E.bind(this);#o=null;#r=null;#u=null;#c=null;#i=null;#f=null;#h=!1;#d=null;#g=null;#T=null;#p=null;#m=!1;constructor({container:E,color:D,elements:x,titleObj:v,modificationDate:k,contentsObj:q,richText:j,parent:K,rect:ue,parentRect:Q,open:Z}){this.#r=E,this.#p=v,this.#u=q,this.#T=j,this.#i=K,this.#o=D,this.#g=ue,this.#f=Q,this.#c=x;const ee=i.PDFDateString.toDateObject(k);ee&&(this.#e=K.l10n.get("annotation_date_string",{date:ee.toLocaleDateString(),time:ee.toLocaleTimeString()})),this.trigger=x.flatMap(se=>se.getElementsToTriggerPopup());for(const se of this.trigger)se.addEventListener("click",this.#a),se.addEventListener("mouseenter",this.#n),se.addEventListener("mouseleave",this.#s),se.classList.add("popupTriggerArea");for(const se of x)se.container?.addEventListener("keydown",this.#t);this.#r.hidden=!0,Z&&this.#E()}render(){if(this.#d)return;const{page:{view:E},viewport:{rawDims:{pageWidth:D,pageHeight:x,pageX:v,pageY:k}}}=this.#i,q=this.#d=document.createElement("div");if(q.className="popup",this.#o){const ge=q.style.outlineColor=n.Util.makeHexColor(...this.#o);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?q.style.backgroundColor=`color-mix(in srgb, ${ge} 30%, white)`:q.style.backgroundColor=n.Util.makeHexColor(...this.#o.map(Ie=>Math.floor(.7*(255-Ie)+Ie)))}const j=document.createElement("span");j.className="header";const K=document.createElement("h1");if(j.append(K),{dir:K.dir,str:K.textContent}=this.#p,q.append(j),this.#e){const ge=document.createElement("span");ge.classList.add("popupDate"),this.#e.then(pe=>{ge.textContent=pe}),j.append(ge)}const ue=this.#u,Q=this.#T;if(Q?.str&&(!ue?.str||ue.str===Q.str))m.XfaLayer.render({xfaHtml:Q.html,intent:"richText",div:q}),q.lastChild.classList.add("richText","popupContent");else{const ge=this._formatContents(ue);q.append(ge)}let Z=!!this.#f,ee=Z?this.#f:this.#g;for(const ge of this.#c)if(!ee||n.Util.intersect(ge.data.rect,ee)!==null){ee=ge.data.rect,Z=!0;break}const se=n.Util.normalizeRect([ee[0],E[3]-ee[1]+E[1],ee[2],E[3]-ee[3]+E[1]]),ce=Z?ee[2]-ee[0]+5:0,he=se[0]+ce,de=se[1],{style:fe}=this.#r;fe.left=`${100*(he-v)/D}%`,fe.top=`${100*(de-k)/x}%`,this.#r.append(q)}_formatContents({str:E,dir:D}){const x=document.createElement("p");x.classList.add("popupContent"),x.dir=D;const v=E.split(/(?:\r\n?|\n)/);for(let k=0,q=v.length;k<q;++k){const j=v[k];x.append(document.createTextNode(j)),k<q-1&&x.append(document.createElement("br"))}return x}#l(E){E.altKey||E.shiftKey||E.ctrlKey||E.metaKey||(E.key==="Enter"||E.key==="Escape"&&this.#h)&&this.#E()}#E(){this.#h=!this.#h,this.#h?(this.#I(),this.#r.addEventListener("click",this.#a),this.#r.addEventListener("keydown",this.#t)):(this.#S(),this.#r.removeEventListener("click",this.#a),this.#r.removeEventListener("keydown",this.#t))}#I(){this.#d||this.render(),this.isVisible?this.#h&&this.#r.classList.add("focused"):(this.#r.hidden=!1,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)+1e3)}#S(){this.#r.classList.remove("focused"),!(this.#h||!this.isVisible)&&(this.#r.hidden=!0,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)-1e3)}forceHide(){this.#m=this.isVisible,this.#m&&(this.#r.hidden=!0)}maybeShow(){this.#m&&(this.#m=!1,this.#r.hidden=!1)}get isVisible(){return this.#r.hidden===!1}}class Y extends h{constructor(E){super(E,{isRenderable:!0,ignoreBorder:!0}),this.textContent=E.data.textContent,this.textPosition=E.data.textPosition,this.annotationEditorType=n.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const E=document.createElement("div");E.classList.add("annotationTextContent"),E.setAttribute("role","comment");for(const D of this.textContent){const x=document.createElement("span");x.textContent=D,E.append(x)}this.container.append(E)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}t.FreeTextAnnotationElement=Y;class V extends h{#e=null;constructor(E){super(E,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const E=this.data,{width:D,height:x}=T(E.rect),v=this.svgFactory.create(D,x,!0),k=this.#e=this.svgFactory.createElement("svg:line");return k.setAttribute("x1",E.rect[2]-E.lineCoordinates[0]),k.setAttribute("y1",E.rect[3]-E.lineCoordinates[1]),k.setAttribute("x2",E.rect[2]-E.lineCoordinates[2]),k.setAttribute("y2",E.rect[3]-E.lineCoordinates[3]),k.setAttribute("stroke-width",E.borderStyle.width||1),k.setAttribute("stroke","transparent"),k.setAttribute("fill","transparent"),v.append(k),this.container.append(v),!E.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class ie extends h{#e=null;constructor(E){super(E,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const E=this.data,{width:D,height:x}=T(E.rect),v=this.svgFactory.create(D,x,!0),k=E.borderStyle.width,q=this.#e=this.svgFactory.createElement("svg:rect");return q.setAttribute("x",k/2),q.setAttribute("y",k/2),q.setAttribute("width",D-k),q.setAttribute("height",x-k),q.setAttribute("stroke-width",k||1),q.setAttribute("stroke","transparent"),q.setAttribute("fill","transparent"),v.append(q),this.container.append(v),!E.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class J extends h{#e=null;constructor(E){super(E,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const E=this.data,{width:D,height:x}=T(E.rect),v=this.svgFactory.create(D,x,!0),k=E.borderStyle.width,q=this.#e=this.svgFactory.createElement("svg:ellipse");return q.setAttribute("cx",D/2),q.setAttribute("cy",x/2),q.setAttribute("rx",D/2-k/2),q.setAttribute("ry",x/2-k/2),q.setAttribute("stroke-width",k||1),q.setAttribute("stroke","transparent"),q.setAttribute("fill","transparent"),v.append(q),this.container.append(v),!E.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class ne extends h{#e=null;constructor(E){super(E,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const E=this.data,{width:D,height:x}=T(E.rect),v=this.svgFactory.create(D,x,!0);let k=[];for(const j of E.vertices){const K=j.x-E.rect[0],ue=E.rect[3]-j.y;k.push(K+","+ue)}k=k.join(" ");const q=this.#e=this.svgFactory.createElement(this.svgElementName);return q.setAttribute("points",k),q.setAttribute("stroke-width",E.borderStyle.width||1),q.setAttribute("stroke","transparent"),q.setAttribute("fill","transparent"),v.append(q),this.container.append(v),!E.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class ae extends ne{constructor(E){super(E),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class te extends h{constructor(E){super(E,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class G extends h{#e=[];constructor(E){super(E,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=n.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const E=this.data,{width:D,height:x}=T(E.rect),v=this.svgFactory.create(D,x,!0);for(const k of E.inkLists){let q=[];for(const K of k){const ue=K.x-E.rect[0],Q=E.rect[3]-K.y;q.push(`${ue},${Q}`)}q=q.join(" ");const j=this.svgFactory.createElement(this.svgElementName);this.#e.push(j),j.setAttribute("points",q),j.setAttribute("stroke-width",E.borderStyle.width||1),j.setAttribute("stroke","transparent"),j.setAttribute("fill","transparent"),!E.popupRef&&this.hasPopupData&&this._createPopup(),v.append(j)}return this.container.append(v),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}t.InkAnnotationElement=G;class N extends h{constructor(E){super(E,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class b extends h{constructor(E){super(E,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class S extends h{constructor(E){super(E,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class R extends h{constructor(E){super(E,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class L extends h{constructor(E){super(E,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}t.StampAnnotationElement=L;class B extends h{#e=null;constructor(E){super(E,{isRenderable:!0});const{filename:D,content:x}=this.data.file;this.filename=(0,i.getFilenameFromUrl)(D,!0),this.content=x,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:D,content:x})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:E,data:D}=this;let x;D.hasAppearance||D.fillAlpha===0?x=document.createElement("div"):(x=document.createElement("img"),x.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(D.name)?"paperclip":"pushpin"}.svg`,D.fillAlpha&&D.fillAlpha<1&&(x.style=`filter: opacity(${Math.round(D.fillAlpha*100)}%);`)),x.addEventListener("dblclick",this.#t.bind(this)),this.#e=x;const{isMac:v}=n.FeatureTest.platform;return E.addEventListener("keydown",k=>{k.key==="Enter"&&(v?k.metaKey:k.ctrlKey)&&this.#t()}),!D.popupRef&&this.hasPopupData?this._createPopup():x.classList.add("popupTriggerArea"),E.append(x),E}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}#t(){this.downloadManager?.openOrDownloadData(this.container,this.content,this.filename)}}class W{#e=null;#t=null;#s=new Map;constructor({div:E,accessibilityManager:D,annotationCanvasMap:x,l10n:v,page:k,viewport:q}){this.div=E,this.#e=D,this.#t=x,this.l10n=v,this.page=k,this.viewport=q,this.zIndex=0,this.l10n||=f.NullL10n}#n(E,D){const x=E.firstChild||E;x.id=`${n.AnnotationPrefix}${D}`,this.div.append(E),this.#e?.moveElementInDOM(this.div,E,x,!1)}async render(E){const{annotations:D}=E,x=this.div;(0,i.setLayerDimensions)(x,this.viewport);const v=new Map,k={data:null,layer:x,linkService:E.linkService,downloadManager:E.downloadManager,imageResourcesPath:E.imageResourcesPath||"",renderForms:E.renderForms!==!1,svgFactory:new i.DOMSVGFactory,annotationStorage:E.annotationStorage||new r.AnnotationStorage,enableScripting:E.enableScripting===!0,hasJSActions:E.hasJSActions,fieldObjects:E.fieldObjects,parent:this,elements:null};for(const q of D){if(q.noHTML)continue;const j=q.annotationType===n.AnnotationType.POPUP;if(j){const Q=v.get(q.id);if(!Q)continue;k.elements=Q}else{const{width:Q,height:Z}=T(q.rect);if(Q<=0||Z<=0)continue}k.data=q;const K=p.create(k);if(!K.isRenderable)continue;if(!j&&q.popupRef){const Q=v.get(q.popupRef);Q?Q.push(K):v.set(q.popupRef,[K])}K.annotationEditorType>0&&this.#s.set(K.data.id,K);const ue=K.render();q.hidden&&(ue.style.visibility="hidden"),this.#n(ue,q.id)}this.#a(),await this.l10n.translate(x)}update({viewport:E}){const D=this.div;this.viewport=E,(0,i.setLayerDimensions)(D,{rotation:E.rotation}),this.#a(),D.hidden=!1}#a(){if(!this.#t)return;const E=this.div;for(const[D,x]of this.#t){const v=E.querySelector(`[data-annotation-id="${D}"]`);if(!v)continue;const{firstChild:k}=v;k?k.nodeName==="CANVAS"?k.replaceWith(x):k.before(x):v.append(x)}this.#t.clear()}getEditableAnnotations(){return Array.from(this.#s.values())}getEditableAnnotation(E){return this.#s.get(E)}}t.AnnotationLayer=W},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorConverters=void 0;function s(r){return Math.floor(Math.max(0,Math.min(1,r))*255).toString(16).padStart(2,"0")}function n(r){return Math.max(0,Math.min(255,255*r))}class i{static CMYK_G([d,f,m,u]){return["G",1-Math.min(1,.3*d+.59*m+.11*f+u)]}static G_CMYK([d]){return["CMYK",0,0,0,1-d]}static G_RGB([d]){return["RGB",d,d,d]}static G_rgb([d]){return d=n(d),[d,d,d]}static G_HTML([d]){const f=s(d);return`#${f}${f}${f}`}static RGB_G([d,f,m]){return["G",.3*d+.59*f+.11*m]}static RGB_rgb(d){return d.map(n)}static RGB_HTML(d){return`#${d.map(s).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([d,f,m,u]){return["RGB",1-Math.min(1,d+u),1-Math.min(1,m+u),1-Math.min(1,f+u)]}static CMYK_rgb([d,f,m,u]){return[n(1-Math.min(1,d+u)),n(1-Math.min(1,m+u)),n(1-Math.min(1,f+u))]}static CMYK_HTML(d){const f=this.CMYK_RGB(d).slice(1);return this.RGB_HTML(f)}static RGB_CMYK([d,f,m]){const u=1-d,a=1-f,c=1-m,T=Math.min(u,a,c);return["CMYK",u,a,c,T]}}t.ColorConverters=i},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NullL10n=void 0,t.getL10nFallback=n;const s={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};s.print_progress_percent="{{progress}}%";function n(d,f){switch(d){case"find_match_count":d=`find_match_count[${f.total===1?"one":"other"}]`;break;case"find_match_count_limit":d=`find_match_count_limit[${f.limit===1?"one":"other"}]`;break}return s[d]||""}function i(d,f){return f?d.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(m,u)=>u in f?f[u]:"{{"+u+"}}"):d}const r={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(d,f=null,m=n(d,f)){return i(m,f)},async translate(d){}};t.NullL10n=r},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XfaLayer=void 0;var n=s(25);class i{static setupStorage(d,f,m,u,a){const c=u.getValue(f,{value:null});switch(m.name){case"textarea":if(c.value!==null&&(d.textContent=c.value),a==="print")break;d.addEventListener("input",T=>{u.setValue(f,{value:T.target.value})});break;case"input":if(m.attributes.type==="radio"||m.attributes.type==="checkbox"){if(c.value===m.attributes.xfaOn?d.setAttribute("checked",!0):c.value===m.attributes.xfaOff&&d.removeAttribute("checked"),a==="print")break;d.addEventListener("change",T=>{u.setValue(f,{value:T.target.checked?T.target.getAttribute("xfaOn"):T.target.getAttribute("xfaOff")})})}else{if(c.value!==null&&d.setAttribute("value",c.value),a==="print")break;d.addEventListener("input",T=>{u.setValue(f,{value:T.target.value})})}break;case"select":if(c.value!==null){d.setAttribute("value",c.value);for(const T of m.children)T.attributes.value===c.value?T.attributes.selected=!0:T.attributes.hasOwnProperty("selected")&&delete T.attributes.selected}d.addEventListener("input",T=>{const p=T.target.options,h=p.selectedIndex===-1?"":p[p.selectedIndex].value;u.setValue(f,{value:h})});break}}static setAttributes({html:d,element:f,storage:m=null,intent:u,linkService:a}){const{attributes:c}=f,T=d instanceof HTMLAnchorElement;c.type==="radio"&&(c.name=`${c.name}-${u}`);for(const[p,h]of Object.entries(c))if(h!=null)switch(p){case"class":h.length&&d.setAttribute(p,h.join(" "));break;case"dataId":break;case"id":d.setAttribute("data-element-id",h);break;case"style":Object.assign(d.style,h);break;case"textContent":d.textContent=h;break;default:(!T||p!=="href"&&p!=="newWindow")&&d.setAttribute(p,h)}T&&a.addLinkAttributes(d,c.href,c.newWindow),m&&c.dataId&&this.setupStorage(d,c.dataId,f,m)}static render(d){const f=d.annotationStorage,m=d.linkService,u=d.xfaHtml,a=d.intent||"display",c=document.createElement(u.name);u.attributes&&this.setAttributes({html:c,element:u,intent:a,linkService:m});const T=[[u,-1,c]],p=d.div;if(p.append(c),d.viewport){const _=`matrix(${d.viewport.transform.join(",")})`;p.style.transform=_}a!=="richText"&&p.setAttribute("class","xfaLayer xfaFont");const h=[];for(;T.length>0;){const[_,I,A]=T.at(-1);if(I+1===_.children.length){T.pop();continue}const O=_.children[++T.at(-1)[1]];if(O===null)continue;const{name:w}=O;if(w==="#text"){const C=document.createTextNode(O.value);h.push(C),A.append(C);continue}const P=O?.attributes?.xmlns?document.createElementNS(O.attributes.xmlns,w):document.createElement(w);if(A.append(P),O.attributes&&this.setAttributes({html:P,element:O,storage:f,intent:a,linkService:m}),O.children&&O.children.length>0)T.push([O,-1,P]);else if(O.value){const C=document.createTextNode(O.value);n.XfaText.shouldBuildText(w)&&h.push(C),P.append(C)}}for(const _ of p.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))_.setAttribute("readOnly",!0);return{textDivs:h}}static update(d){const f=`matrix(${d.viewport.transform.join(",")})`;d.div.style.transform=f,d.div.hidden=!1}}t.XfaLayer=i},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InkEditor=void 0;var n=s(1),i=s(4),r=s(29),d=s(6),f=s(5);class m extends i.AnnotationEditor{#e=0;#t=0;#s=this.canvasPointermove.bind(this);#n=this.canvasPointerleave.bind(this);#a=this.canvasPointerup.bind(this);#o=this.canvasPointerdown.bind(this);#r=new Path2D;#u=!1;#c=!1;#i=!1;#f=null;#h=0;#d=0;#g=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";constructor(a){super({...a,name:"inkEditor"}),this.color=a.color||null,this.thickness=a.thickness||null,this.opacity=a.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(a){i.AnnotationEditor.initialize(a,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(a,c){switch(a){case n.AnnotationEditorParamsType.INK_THICKNESS:m._defaultThickness=c;break;case n.AnnotationEditorParamsType.INK_COLOR:m._defaultColor=c;break;case n.AnnotationEditorParamsType.INK_OPACITY:m._defaultOpacity=c/100;break}}updateParams(a,c){switch(a){case n.AnnotationEditorParamsType.INK_THICKNESS:this.#T(c);break;case n.AnnotationEditorParamsType.INK_COLOR:this.#p(c);break;case n.AnnotationEditorParamsType.INK_OPACITY:this.#m(c);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,m._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,m._defaultColor||i.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(m._defaultOpacity*100)]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||m._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,this.color||m._defaultColor||i.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??m._defaultOpacity))]]}#T(a){const c=this.thickness;this.addCommands({cmd:()=>{this.thickness=a,this.#y()},undo:()=>{this.thickness=c,this.#y()},mustExec:!0,type:n.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#p(a){const c=this.color;this.addCommands({cmd:()=>{this.color=a,this.#A()},undo:()=>{this.color=c,this.#A()},mustExec:!0,type:n.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#m(a){a/=100;const c=this.opacity;this.addCommands({cmd:()=>{this.opacity=a,this.#A()},undo:()=>{this.opacity=c,this.#A()},mustExec:!0,type:n.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(this.#O(),this.#x()),this.isAttachedToDOM||(this.parent.add(this),this.#_()),this.#y()))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#f.disconnect(),this.#f=null,super.remove())}setParent(a){!this.parent&&a?this._uiManager.removeShouldRescale(this):this.parent&&a===null&&this._uiManager.addShouldRescale(this),super.setParent(a)}onScaleChanging(){const[a,c]=this.parentDimensions,T=this.width*a,p=this.height*c;this.setDimensions(T,p)}enableEditMode(){this.#u||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#o))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#o))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#l(){const{parentRotation:a,parentDimensions:[c,T]}=this;switch(a){case 90:return[0,T,T,c];case 180:return[c,T,c,T];case 270:return[c,0,T,c];default:return[0,0,c,T]}}#E(){const{ctx:a,color:c,opacity:T,thickness:p,parentScale:h,scaleFactor:_}=this;a.lineWidth=p*h/_,a.lineCap="round",a.lineJoin="round",a.miterLimit=10,a.strokeStyle=`${c}${(0,f.opacityToHex)(T)}`}#I(a,c){this.canvas.addEventListener("contextmenu",d.noContextMenu),this.canvas.addEventListener("pointerleave",this.#n),this.canvas.addEventListener("pointermove",this.#s),this.canvas.addEventListener("pointerup",this.#a),this.canvas.removeEventListener("pointerdown",this.#o),this.isEditing=!0,this.#i||(this.#i=!0,this.#_(),this.thickness||=m._defaultThickness,this.color||=m._defaultColor||i.AnnotationEditor._defaultLineColor,this.opacity??=m._defaultOpacity),this.currentPath.push([a,c]),this.#c=!1,this.#E(),this.#g=()=>{this.#L(),this.#g&&window.requestAnimationFrame(this.#g)},window.requestAnimationFrame(this.#g)}#S(a,c){const[T,p]=this.currentPath.at(-1);if(this.currentPath.length>1&&a===T&&c===p)return;const h=this.currentPath;let _=this.#r;if(h.push([a,c]),this.#c=!0,h.length<=2){_.moveTo(...h[0]),_.lineTo(a,c);return}h.length===3&&(this.#r=_=new Path2D,_.moveTo(...h[0])),this.#w(_,...h.at(-3),...h.at(-2),a,c)}#D(){if(this.currentPath.length===0)return;const a=this.currentPath.at(-1);this.#r.lineTo(...a)}#R(a,c){this.#g=null,a=Math.min(Math.max(a,0),this.canvas.width),c=Math.min(Math.max(c,0),this.canvas.height),this.#S(a,c),this.#D();let T;if(this.currentPath.length!==1)T=this.#k();else{const A=[a,c];T=[[A,A.slice(),A.slice(),A]]}const p=this.#r,h=this.currentPath;this.currentPath=[],this.#r=new Path2D;const _=()=>{this.allRawPaths.push(h),this.paths.push(T),this.bezierPath2D.push(p),this.rebuild()},I=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#O(),this.#x()),this.#y())};this.addCommands({cmd:_,undo:I,mustExec:!0})}#L(){if(!this.#c)return;this.#c=!1;const a=Math.ceil(this.thickness*this.parentScale),c=this.currentPath.slice(-3),T=c.map(_=>_[0]),p=c.map(_=>_[1]);Math.min(...T)-a,Math.max(...T)+a,Math.min(...p)-a,Math.max(...p)+a;const{ctx:h}=this;h.save(),h.clearRect(0,0,this.canvas.width,this.canvas.height);for(const _ of this.bezierPath2D)h.stroke(_);h.stroke(this.#r),h.restore()}#w(a,c,T,p,h,_,I){const A=(c+p)/2,O=(T+h)/2,w=(p+_)/2,P=(h+I)/2;a.bezierCurveTo(A+2*(p-A)/3,O+2*(h-O)/3,w+2*(p-w)/3,P+2*(h-P)/3,w,P)}#k(){const a=this.currentPath;if(a.length<=2)return[[a[0],a[0],a.at(-1),a.at(-1)]];const c=[];let T,[p,h]=a[0];for(T=1;T<a.length-2;T++){const[C,y]=a[T],[F,H]=a[T+1],U=(C+F)/2,Y=(y+H)/2,V=[p+2*(C-p)/3,h+2*(y-h)/3],ie=[U+2*(C-U)/3,Y+2*(y-Y)/3];c.push([[p,h],V,ie,[U,Y]]),[p,h]=[U,Y]}const[_,I]=a[T],[A,O]=a[T+1],w=[p+2*(_-p)/3,h+2*(I-h)/3],P=[A+2*(_-A)/3,O+2*(I-O)/3];return c.push([[p,h],w,P,[A,O]]),c}#A(){if(this.isEmpty()){this.#C();return}this.#E();const{canvas:a,ctx:c}=this;c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,a.width,a.height),this.#C();for(const T of this.bezierPath2D)c.stroke(T)}commit(){this.#u||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#u=!0,this.div.classList.add("disabled"),this.#y(!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(a){this._focusEventsAllowed&&(super.focusin(a),this.enableEditMode())}canvasPointerdown(a){a.button!==0||!this.isInEditMode()||this.#u||(this.setInForeground(),a.preventDefault(),a.type!=="mouse"&&this.div.focus(),this.#I(a.offsetX,a.offsetY))}canvasPointermove(a){a.preventDefault(),this.#S(a.offsetX,a.offsetY)}canvasPointerup(a){a.preventDefault(),this.#M(a)}canvasPointerleave(a){this.#M(a)}#M(a){this.canvas.removeEventListener("pointerleave",this.#n),this.canvas.removeEventListener("pointermove",this.#s),this.canvas.removeEventListener("pointerup",this.#a),this.canvas.addEventListener("pointerdown",this.#o),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",d.noContextMenu)},10),this.#R(a.offsetX,a.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#O(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",i.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(a=>this.canvas?.setAttribute("aria-label",a)),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#x(){this.#f=new ResizeObserver(a=>{const c=a[0].contentRect;c.width&&c.height&&this.setDimensions(c.width,c.height)}),this.#f.observe(this.div)}get isResizable(){return!this.isEmpty()&&this.#u}render(){if(this.div)return this.div;let a,c;this.width&&(a=this.x,c=this.y),super.render(),i.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(I=>this.div?.setAttribute("aria-label",I));const[T,p,h,_]=this.#l();if(this.setAt(T,p,0,0),this.setDims(h,_),this.#O(),this.width){const[I,A]=this.parentDimensions;this.setAspectRatio(this.width*I,this.height*A),this.setAt(a*I,c*A,this.width*I,this.height*A),this.#i=!0,this.#_(),this.setDims(this.width*I,this.height*A),this.#A(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#x(),this.div}#_(){if(!this.#i)return;const[a,c]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*a),this.canvas.height=Math.ceil(this.height*c),this.#C()}setDimensions(a,c){const T=Math.round(a),p=Math.round(c);if(this.#h===T&&this.#d===p)return;this.#h=T,this.#d=p,this.canvas.style.visibility="hidden";const[h,_]=this.parentDimensions;this.width=a/h,this.height=c/_,this.fixAndSetPosition(),this.#u&&this.#N(a,c),this.#_(),this.#A(),this.canvas.style.visibility="visible",this.fixDims()}#N(a,c){const T=this.#v(),p=(a-T)/this.#t,h=(c-T)/this.#e;this.scaleFactor=Math.min(p,h)}#C(){const a=this.#v()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+a,this.translationY*this.scaleFactor+a)}static#F(a){const c=new Path2D;for(let T=0,p=a.length;T<p;T++){const[h,_,I,A]=a[T];T===0&&c.moveTo(...h),c.bezierCurveTo(_[0],_[1],I[0],I[1],A[0],A[1])}return c}static#B(a,c,T){const[p,h,_,I]=c;switch(T){case 0:for(let A=0,O=a.length;A<O;A+=2)a[A]+=p,a[A+1]=I-a[A+1];break;case 90:for(let A=0,O=a.length;A<O;A+=2){const w=a[A];a[A]=a[A+1]+p,a[A+1]=w+h}break;case 180:for(let A=0,O=a.length;A<O;A+=2)a[A]=_-a[A],a[A+1]+=h;break;case 270:for(let A=0,O=a.length;A<O;A+=2){const w=a[A];a[A]=_-a[A+1],a[A+1]=I-w}break;default:throw new Error("Invalid rotation")}return a}static#G(a,c,T){const[p,h,_,I]=c;switch(T){case 0:for(let A=0,O=a.length;A<O;A+=2)a[A]-=p,a[A+1]=I-a[A+1];break;case 90:for(let A=0,O=a.length;A<O;A+=2){const w=a[A];a[A]=a[A+1]-h,a[A+1]=w-p}break;case 180:for(let A=0,O=a.length;A<O;A+=2)a[A]=_-a[A],a[A+1]-=h;break;case 270:for(let A=0,O=a.length;A<O;A+=2){const w=a[A];a[A]=I-a[A+1],a[A+1]=_-w}break;default:throw new Error("Invalid rotation")}return a}#U(a,c,T,p){const h=[],_=this.thickness/2,I=a*c+_,A=a*T+_;for(const O of this.paths){const w=[],P=[];for(let C=0,y=O.length;C<y;C++){const[F,H,U,Y]=O[C],V=a*F[0]+I,ie=a*F[1]+A,J=a*H[0]+I,ne=a*H[1]+A,ae=a*U[0]+I,te=a*U[1]+A,G=a*Y[0]+I,N=a*Y[1]+A;C===0&&(w.push(V,ie),P.push(V,ie)),w.push(J,ne,ae,te,G,N),P.push(J,ne),C===y-1&&P.push(G,N)}h.push({bezier:m.#B(w,p,this.rotation),points:m.#B(P,p,this.rotation)})}return h}#P(){let a=1/0,c=-1/0,T=1/0,p=-1/0;for(const h of this.paths)for(const[_,I,A,O]of h){const w=n.Util.bezierBoundingBox(..._,...I,...A,...O);a=Math.min(a,w[0]),T=Math.min(T,w[1]),c=Math.max(c,w[2]),p=Math.max(p,w[3])}return[a,T,c,p]}#v(){return this.#u?Math.ceil(this.thickness*this.parentScale):0}#y(a=!1){if(this.isEmpty())return;if(!this.#u){this.#A();return}const c=this.#P(),T=this.#v();this.#t=Math.max(i.AnnotationEditor.MIN_SIZE,c[2]-c[0]),this.#e=Math.max(i.AnnotationEditor.MIN_SIZE,c[3]-c[1]);const p=Math.ceil(T+this.#t*this.scaleFactor),h=Math.ceil(T+this.#e*this.scaleFactor),[_,I]=this.parentDimensions;this.width=p/_,this.height=h/I,this.setAspectRatio(p,h);const A=this.translationX,O=this.translationY;this.translationX=-c[0],this.translationY=-c[1],this.#_(),this.#A(),this.#h=p,this.#d=h,this.setDims(p,h);const w=a?T/this.scaleFactor/2:0;this.translate(A-this.translationX-w,O-this.translationY-w)}static deserialize(a,c,T){if(a instanceof r.InkAnnotationElement)return null;const p=super.deserialize(a,c,T);p.thickness=a.thickness,p.color=n.Util.makeHexColor(...a.color),p.opacity=a.opacity;const[h,_]=p.pageDimensions,I=p.width*h,A=p.height*_,O=p.parentScale,w=a.thickness/2;p.#u=!0,p.#h=Math.round(I),p.#d=Math.round(A);const{paths:P,rect:C,rotation:y}=a;for(let{bezier:H}of P){H=m.#G(H,C,y);const U=[];p.paths.push(U);let Y=O*(H[0]-w),V=O*(H[1]-w);for(let J=2,ne=H.length;J<ne;J+=6){const ae=O*(H[J]-w),te=O*(H[J+1]-w),G=O*(H[J+2]-w),N=O*(H[J+3]-w),b=O*(H[J+4]-w),S=O*(H[J+5]-w);U.push([[Y,V],[ae,te],[G,N],[b,S]]),Y=b,V=S}const ie=this.#F(U);p.bezierPath2D.push(ie)}const F=p.#P();return p.#t=Math.max(i.AnnotationEditor.MIN_SIZE,F[2]-F[0]),p.#e=Math.max(i.AnnotationEditor.MIN_SIZE,F[3]-F[1]),p.#N(I,A),p}serialize(){if(this.isEmpty())return null;const a=this.getRect(0,0),c=i.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:n.AnnotationEditorType.INK,color:c,thickness:this.thickness,opacity:this.opacity,paths:this.#U(this.scaleFactor/this.parentScale,this.translationX,this.translationY,a),pageIndex:this.pageIndex,rect:a,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}t.InkEditor=m},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StampEditor=void 0;var n=s(1),i=s(4),r=s(6),d=s(29);class f extends i.AnnotationEditor{#e=null;#t=null;#s=null;#n=null;#a=null;#o=null;#r=null;#u=null;#c=!1;#i=!1;static _type="stamp";constructor(u){super({...u,name:"stampEditor"}),this.#n=u.bitmapUrl,this.#a=u.bitmapFile}static initialize(u){i.AnnotationEditor.initialize(u)}static get supportedTypes(){const u=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,n.shadow)(this,"supportedTypes",u.map(a=>`image/${a}`))}static get supportedTypesStr(){return(0,n.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(u){return this.supportedTypes.includes(u)}static paste(u,a){a.pasteEditor(n.AnnotationEditorType.STAMP,{bitmapFile:u.getAsFile()})}#f(u,a=!1){if(!u){this.remove();return}this.#e=u.bitmap,a||(this.#t=u.id,this.#c=u.isSvg),this.#g()}#h(){this.#s=null,this._uiManager.enableWaiting(!1),this.#o&&this.div.focus()}#d(){if(this.#t){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#t).then(a=>this.#f(a,!0)).finally(()=>this.#h());return}if(this.#n){const a=this.#n;this.#n=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromUrl(a).then(c=>this.#f(c)).finally(()=>this.#h());return}if(this.#a){const a=this.#a;this.#a=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromFile(a).then(c=>this.#f(c)).finally(()=>this.#h());return}const u=document.createElement("input");u.type="file",u.accept=f.supportedTypesStr,this.#s=new Promise(a=>{u.addEventListener("change",async()=>{if(!u.files||u.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const c=await this._uiManager.imageManager.getFromFile(u.files[0]);this.#f(c)}a()}),u.addEventListener("cancel",()=>{this.remove(),a()})}).finally(()=>this.#h()),u.click()}remove(){this.#t&&(this.#e=null,this._uiManager.imageManager.deleteId(this.#t),this.#o?.remove(),this.#o=null,this.#r?.disconnect(),this.#r=null),super.remove()}rebuild(){if(!this.parent){this.#t&&this.#d();return}super.rebuild(),this.div!==null&&(this.#t&&this.#d(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#s||this.#e||this.#n||this.#a)}get isResizable(){return!0}render(){if(this.div)return this.div;let u,a;if(this.width&&(u=this.x,a=this.y),super.render(),this.div.hidden=!0,this.#e?this.#g():this.#d(),this.width){const[c,T]=this.parentDimensions;this.setAt(u*c,a*T,this.width*c,this.height*T)}return this.div}#g(){const{div:u}=this;let{width:a,height:c}=this.#e;const[T,p]=this.pageDimensions,h=.75;if(this.width)a=this.width*T,c=this.height*p;else if(a>h*T||c>h*p){const O=Math.min(h*T/a,h*p/c);a*=O,c*=O}const[_,I]=this.parentDimensions;this.setDims(a*_/T,c*I/p),this._uiManager.enableWaiting(!1);const A=this.#o=document.createElement("canvas");u.append(A),u.hidden=!1,this.#m(a,c),this.#E(),this.#i||(this.parent.addUndoableEditor(this),this.#i=!0),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()}#T(u,a){const[c,T]=this.parentDimensions;this.width=u/c,this.height=a/T,this.setDims(u,a),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this.#u!==null&&clearTimeout(this.#u);const p=200;this.#u=setTimeout(()=>{this.#u=null,this.#m(u,a)},p)}#p(u,a){const{width:c,height:T}=this.#e;let p=c,h=T,_=this.#e;for(;p>2*u||h>2*a;){const I=p,A=h;p>2*u&&(p=p>=16384?Math.floor(p/2)-1:Math.ceil(p/2)),h>2*a&&(h=h>=16384?Math.floor(h/2)-1:Math.ceil(h/2));const O=new OffscreenCanvas(p,h);O.getContext("2d").drawImage(_,0,0,I,A,0,0,p,h),_=O.transferToImageBitmap()}return _}#m(u,a){u=Math.ceil(u),a=Math.ceil(a);const c=this.#o;if(!c||c.width===u&&c.height===a)return;c.width=u,c.height=a;const T=this.#c?this.#e:this.#p(u,a),p=c.getContext("2d");p.filter=this._uiManager.hcmFilter,p.drawImage(T,0,0,T.width,T.height,0,0,u,a)}#l(u){if(u){if(this.#c){const T=this._uiManager.imageManager.getSvgUrl(this.#t);if(T)return T}const a=document.createElement("canvas");return{width:a.width,height:a.height}=this.#e,a.getContext("2d").drawImage(this.#e,0,0),a.toDataURL()}if(this.#c){const[a,c]=this.pageDimensions,T=Math.round(this.width*a*r.PixelsPerInch.PDF_TO_CSS_UNITS),p=Math.round(this.height*c*r.PixelsPerInch.PDF_TO_CSS_UNITS),h=new OffscreenCanvas(T,p);return h.getContext("2d").drawImage(this.#e,0,0,this.#e.width,this.#e.height,0,0,T,p),h.transferToImageBitmap()}return structuredClone(this.#e)}#E(){this.#r=new ResizeObserver(u=>{const a=u[0].contentRect;a.width&&a.height&&this.#T(a.width,a.height)}),this.#r.observe(this.div)}static deserialize(u,a,c){if(u instanceof d.StampAnnotationElement)return null;const T=super.deserialize(u,a,c),{rect:p,bitmapUrl:h,bitmapId:_,isSvg:I,accessibilityData:A}=u;_&&c.imageManager.isValidId(_)?T.#t=_:T.#n=h,T.#c=I;const[O,w]=T.pageDimensions;return T.width=(p[2]-p[0])/O,T.height=(p[3]-p[1])/w,A&&(T.altTextData=A),T}serialize(u=!1,a=null){if(this.isEmpty())return null;const c={annotationType:n.AnnotationEditorType.STAMP,bitmapId:this.#t,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#c,structTreeParentId:this._structTreeParentId};if(u)return c.bitmapUrl=this.#l(!0),c.accessibilityData=this.altTextData,c;const{decorative:T,altText:p}=this.altTextData;if(!T&&p&&(c.accessibilityData={type:"Figure",alt:p}),a===null)return c;a.stamps||=new Map;const h=this.#c?(c.rect[2]-c.rect[0])*(c.rect[3]-c.rect[1]):null;if(!a.stamps.has(this.#t))a.stamps.set(this.#t,{area:h,serialized:c}),c.bitmap=this.#l(!1);else if(this.#c){const _=a.stamps.get(this.#t);h>_.area&&(_.area=h,_.serialized.bitmap.close(),_.serialized.bitmap=this.#l(!1))}return c}}t.StampEditor=f}],__webpack_module_cache__={};function __w_pdfjs_require__(e){var t=__webpack_module_cache__[e];if(t!==void 0)return t.exports;var s=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](s,s.exports,__w_pdfjs_require__),s.exports}var __webpack_exports__={};return(()=>{var e=__webpack_exports__;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"AbortException",{enumerable:!0,get:function(){return t.AbortException}}),Object.defineProperty(e,"AnnotationEditorLayer",{enumerable:!0,get:function(){return r.AnnotationEditorLayer}}),Object.defineProperty(e,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return t.AnnotationEditorParamsType}}),Object.defineProperty(e,"AnnotationEditorType",{enumerable:!0,get:function(){return t.AnnotationEditorType}}),Object.defineProperty(e,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return d.AnnotationEditorUIManager}}),Object.defineProperty(e,"AnnotationLayer",{enumerable:!0,get:function(){return f.AnnotationLayer}}),Object.defineProperty(e,"AnnotationMode",{enumerable:!0,get:function(){return t.AnnotationMode}}),Object.defineProperty(e,"CMapCompressionType",{enumerable:!0,get:function(){return t.CMapCompressionType}}),Object.defineProperty(e,"DOMSVGFactory",{enumerable:!0,get:function(){return n.DOMSVGFactory}}),Object.defineProperty(e,"FeatureTest",{enumerable:!0,get:function(){return t.FeatureTest}}),Object.defineProperty(e,"GlobalWorkerOptions",{enumerable:!0,get:function(){return m.GlobalWorkerOptions}}),Object.defineProperty(e,"ImageKind",{enumerable:!0,get:function(){return t.ImageKind}}),Object.defineProperty(e,"InvalidPDFException",{enumerable:!0,get:function(){return t.InvalidPDFException}}),Object.defineProperty(e,"MissingPDFException",{enumerable:!0,get:function(){return t.MissingPDFException}}),Object.defineProperty(e,"OPS",{enumerable:!0,get:function(){return t.OPS}}),Object.defineProperty(e,"PDFDataRangeTransport",{enumerable:!0,get:function(){return s.PDFDataRangeTransport}}),Object.defineProperty(e,"PDFDateString",{enumerable:!0,get:function(){return n.PDFDateString}}),Object.defineProperty(e,"PDFWorker",{enumerable:!0,get:function(){return s.PDFWorker}}),Object.defineProperty(e,"PasswordResponses",{enumerable:!0,get:function(){return t.PasswordResponses}}),Object.defineProperty(e,"PermissionFlag",{enumerable:!0,get:function(){return t.PermissionFlag}}),Object.defineProperty(e,"PixelsPerInch",{enumerable:!0,get:function(){return n.PixelsPerInch}}),Object.defineProperty(e,"PromiseCapability",{enumerable:!0,get:function(){return t.PromiseCapability}}),Object.defineProperty(e,"RenderingCancelledException",{enumerable:!0,get:function(){return n.RenderingCancelledException}}),Object.defineProperty(e,"SVGGraphics",{enumerable:!0,get:function(){return s.SVGGraphics}}),Object.defineProperty(e,"UnexpectedResponseException",{enumerable:!0,get:function(){return t.UnexpectedResponseException}}),Object.defineProperty(e,"Util",{enumerable:!0,get:function(){return t.Util}}),Object.defineProperty(e,"VerbosityLevel",{enumerable:!0,get:function(){return t.VerbosityLevel}}),Object.defineProperty(e,"XfaLayer",{enumerable:!0,get:function(){return u.XfaLayer}}),Object.defineProperty(e,"build",{enumerable:!0,get:function(){return s.build}}),Object.defineProperty(e,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return t.createValidAbsoluteUrl}}),Object.defineProperty(e,"getDocument",{enumerable:!0,get:function(){return s.getDocument}}),Object.defineProperty(e,"getFilenameFromUrl",{enumerable:!0,get:function(){return n.getFilenameFromUrl}}),Object.defineProperty(e,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return n.getPdfFilenameFromUrl}}),Object.defineProperty(e,"getXfaPageViewport",{enumerable:!0,get:function(){return n.getXfaPageViewport}}),Object.defineProperty(e,"isDataScheme",{enumerable:!0,get:function(){return n.isDataScheme}}),Object.defineProperty(e,"isPdfFile",{enumerable:!0,get:function(){return n.isPdfFile}}),Object.defineProperty(e,"loadScript",{enumerable:!0,get:function(){return n.loadScript}}),Object.defineProperty(e,"noContextMenu",{enumerable:!0,get:function(){return n.noContextMenu}}),Object.defineProperty(e,"normalizeUnicode",{enumerable:!0,get:function(){return t.normalizeUnicode}}),Object.defineProperty(e,"renderTextLayer",{enumerable:!0,get:function(){return i.renderTextLayer}}),Object.defineProperty(e,"setLayerDimensions",{enumerable:!0,get:function(){return n.setLayerDimensions}}),Object.defineProperty(e,"shadow",{enumerable:!0,get:function(){return t.shadow}}),Object.defineProperty(e,"updateTextLayer",{enumerable:!0,get:function(){return i.updateTextLayer}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return s.version}});var t=__w_pdfjs_require__(1),s=__w_pdfjs_require__(2),n=__w_pdfjs_require__(6),i=__w_pdfjs_require__(26),r=__w_pdfjs_require__(27),d=__w_pdfjs_require__(5),f=__w_pdfjs_require__(29),m=__w_pdfjs_require__(14),u=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf$1);var pdfExports=pdf$1.exports;const pdf=getDefaultExportFromCjs(pdfExports),PDFJS=_mergeNamespaces({__proto__:null,default:pdf},[pdfExports]),pdfjsWorker=new URL("pdfjs-dist/build/pdf.worker.js",self.location.href).toString();pdfExports.GlobalWorkerOptions.workerSrc=pdfjsWorker;const pdfDist=PDFJS,getPdf=async e=>{const t=pdfDist.getDocument({data:e,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0});return t.onPassword=n=>{const i=prompt("Enter the password: ");if(!i)throw new Error("Password required to open the PDF.");n(i)},await t.promise},isTweet=e=>{const t=/twitter\.com\/[a-zA-Z0-9_]+\/status\/[0-9]+/g,s=/x\.com\/[a-zA-Z0-9_]+\/status\/[0-9]+/g;return t.test(e)||s.test(e)},isTwitterTimeline=e=>e==="https://twitter.com/home"||e==="https://x.com/home",parseTwitterTimeline=e=>{const t=load(e),s=t("[data-testid=tweetText]"),n=t("[data-testid=User-Name]");return s.map((r,d)=>{const f=t(d).text();return{author:t(n[r]).text(),post:f}}).get().map(r=>`## Author: ${r.author}

${r.post}

---

`).filter((r,d,f)=>f.indexOf(r)===d).join(`
`)},parseTweet=e=>{const t=load(e),s=t("[data-testid=tweetText]"),n=t("[data-testid=User-Name]");return s.map((r,d)=>{const f=t(d).text();return{author:t(n[r]).text(),post:f,isReply:r!==0}}).get().map(r=>`##Author: ${r.author}

${r.isReply?"Reply:":"Post:"} ${r.post}

---

`).join(`
`)},isGoogleDocs=e=>/docs\.google\.com\/document/g.test(e),getGoogleDocs=()=>{try{const t=function(s,n,i,r=Object.getOwnPropertyNames(s)){const d=new Set,f=[];let m=0;const u=(a,c,T,p=0)=>{if(m++,a==="prototype"||c instanceof Window||p>i)return;const h=[...T,a];try{if(n(a,c)){f.push({path:h,value:c});return}}catch{}c!=null&&!d.has(c)&&(d.add(c),Array.isArray(c)?c.forEach((_,I)=>{try{u(I.toString(),_,h,p+1)}catch{}}):c instanceof Object&&(c&&c.nodeType===1&&typeof c.nodeName=="string"?Object.getOwnPropertyNames(s):Object.getOwnPropertyNames(c)).forEach(I=>{try{u(I,c[I],h,p+1)}catch{}}))};return r.forEach(a=>{try{u(a,s[a],[])}catch{}}),{results:f,iterations:m}}(window.KX_kixApp,(s,n)=>n&&n.toString().charAt(0)==="",5);return t.results?.[0]?.value?{content:t.results[0].value}:{content:null}}catch{return{content:null}}},parseGoogleDocs=async()=>{const e=new Promise(s=>{browser.tabs.query({active:!0,currentWindow:!0}).then(async n=>{const i=n[0],r=await browser.scripting.executeScript({target:{tabId:i.id},func:getGoogleDocs});r.length>0&&s(r[0].result)})}),{content:t}=await e;return t},cleanUnwantedUnicode=e=>{const t=/[\u200B-\u200D\uFEFF]/g;return e.replace(t,"").trim()},_getHtml=()=>{const e=window.location.href,t=document.title,s=document.querySelector('link[rel="icon"]')?.getAttribute("href")||document.querySelector('link[rel="shortcut icon"]')?.getAttribute("href")||`${window.location.origin}/favicon.ico`;return document.contentType==="application/pdf"?{url:e,title:t,content:"",type:"pdf",favicon:s}:{content:document.documentElement.outerHTML,url:e,title:t,type:"html",favicon:s}},getDataFromCurrentTab=async()=>{logger$1.debug("开始获取当前标签页内容");const e=await new Promise((f,m)=>{logger$1.debug("使用 Firefox/其他浏览器 API 获取标签页内容"),browser.tabs.query({active:!0,currentWindow:!0}).then(async u=>{if(!u||u.length===0){logger$1.error("无法获取当前标签页"),m(new Error("无法获取当前标签页"));return}const a=u[0];if(logger$1.debug("获取到当前标签页",{tabId:a.id,url:a.url}),!a.id){logger$1.error("标签页ID无效"),m(new Error("标签页ID无效"));return}try{const c=await browser.scripting.executeScript({target:{tabId:a.id},func:_getHtml});c&&c.length>0?(logger$1.debug("成功执行内容脚本获取HTML",{resultType:c[0].result.type,contentLength:c[0].result.content?.length}),f(c[0].result)):(logger$1.error("内容脚本执行结果为空"),m(new Error("内容脚本执行结果为空")))}catch(c){logger$1.error("执行内容脚本失败",c);{logger$1.info("检测到 Firefox PDF 页面，使用替代方法获取内容");const T={url:a.url,title:a.title||"PDF Document",content:"",type:"pdf",favicon:a.favIconUrl};logger$1.debug("使用替代方法获取 PDF 内容成功",{url:a.url}),f(T)}}}).catch(u=>{logger$1.error("查询标签页失败",u),m(u)})});logger$1.debug("成功获取页面基本数据",{url:e.url,title:e.title,type:e.type});const{content:t,type:s,url:n,title:i,favicon:r}=e;if(s==="pdf"){logger$1.debug("检测到PDF文件，开始处理PDF内容",{url:n});try{const f=await fetch(n);if(!f.ok)throw logger$1.error("获取PDF文件失败",{status:f.status,statusText:f.statusText}),new Error(`获取PDF文件失败: ${f.status} ${f.statusText}`);const m=await f.arrayBuffer();logger$1.debug("成功获取PDF文件数据",{dataSize:m.byteLength});let u=[];const a=await getPdf(m);logger$1.info("成功解析PDF文件",{numPages:a.numPages});for(let c=1;c<=a.numPages;c+=1){logger$1.debug(`处理PDF第${c}页`);const p=await(await a.getPage(c)).getTextContent();if(!p||p.items.length===0){logger$1.debug(`PDF第${c}页没有文本内容，跳过`);continue}const h=p.items.map(_=>_.str).join(`
`).replace(/\x00/g,"").trim();u.push({content:h,page:c}),logger$1.debug(`成功提取PDF第${c}页文本`,{textLength:h.length})}return logger$1.info("PDF处理完成",{totalPages:u.length}),{url:n,title:i,content:"",pdf:u,type:"pdf",favicon:r}}catch(f){return logger$1.error("处理PDF文件时出错",f),{url:n,title:i,content:"PDF处理失败，无法提取内容",pdf:[],type:"pdf",favicon:r}}}if(isTwitterTimeline(n)){logger$1.debug("检测到Twitter时间线页面，使用专用解析器",{url:n});const f=parseTwitterTimeline(t);return logger$1.info("成功解析Twitter时间线内容",{contentLength:f?.length}),{url:n,title:i,content:f,type:"html",pdf:[],favicon:r}}else if(isTweet(n)){logger$1.debug("检测到Twitter推文页面，使用专用解析器",{url:n});const f=parseTweet(t);return logger$1.info("成功解析Twitter推文内容",{contentLength:f?.length}),{url:n,title:i,content:f,type:"html",pdf:[],favicon:r}}else if(isGoogleDocs(n)){logger$1.debug("检测到Google Docs文档，使用专用解析器",{url:n});try{const f=await parseGoogleDocs();if(f){const m=cleanUnwantedUnicode(f);return logger$1.info("成功解析Google Docs内容",{contentLength:m?.length}),{url:n,title:i,content:m,type:"html",pdf:[],favicon:r}}else logger$1.warn("Google Docs解析返回空内容")}catch(f){logger$1.error("解析Google Docs内容失败",f)}}logger$1.debug("使用默认内容提取器处理页面",{url:n,contentLength:t?.length});const d=defaultExtractContent(t);return logger$1.info("成功提取页面内容",{extractedContentLength:d?.length}),{url:n,title:i,content:d,type:s,pdf:[],favicon:r}},captureVisibleTab=()=>(logger$1.debug("开始捕获当前标签页截图"),new Promise((t,s)=>{logger$1.debug("使用 Firefox/其他浏览器 API 捕获截图"),browser.tabs.query({active:!0,currentWindow:!0}).then(async n=>{if(!n||n.length===0){logger$1.error("无法获取当前标签页"),s(new Error("无法获取当前标签页"));return}const i=n[0];logger$1.debug("获取到当前标签页",{tabId:i.id,url:i.url});try{logger$1.debug("开始捕获截图，设置10秒超时");const r=await Promise.race([browser.tabs.captureVisibleTab(null,{format:"png"}),new Promise((d,f)=>setTimeout(()=>{logger$1.error("截图捕获超时"),f(new Error("截图捕获超时（10秒）"))},1e4))]);if(!r){logger$1.error("截图数据为空"),s(new Error("截图数据为空"));return}logger$1.debug("成功捕获截图",{dataUrlLength:r.length}),t(r)}catch(r){logger$1.error("捕获截图时出错",r),s(r)}}).catch(n=>{logger$1.error("查询标签页失败",n),s(n)})})),getScreenshotFromCurrentTab=async()=>{logger$1.info("开始获取当前标签页截图");try{const e=await captureVisibleTab();return logger$1.info("成功获取截图",{dataUrlLength:e.length}),{success:!0,screenshot:e,error:null}}catch(e){const t=e instanceof Error?e.message:"截图捕获失败";return logger$1.error("获取截图失败",{error:t}),{success:!1,screenshot:null,error:t}}},DB_NAME="page-assist-saved-pages",DB_VERSION=1,STORE_NAME="pages",generateID=()=>"page_xxxx-xxxx-xxx-xxxx".replace(/[x]/g,()=>Math.floor(Math.random()*16).toString(16)),openDatabase=()=>(logger$1.debug(`正在打开数据库: ${DB_NAME}, 版本: ${DB_VERSION}`),new Promise((e,t)=>{const s=indexedDB.open(DB_NAME,DB_VERSION);s.onerror=n=>{const i=s.error;logger$1.error("打开数据库失败",{errorName:i?.name,errorMessage:i?.message}),t(new Error(`无法打开数据库: ${i?.message||"未知错误"}`))},s.onsuccess=n=>{logger$1.debug("数据库连接成功打开"),e(s.result)},s.onupgradeneeded=n=>{logger$1.info(`数据库升级: 从版本 ${n.oldVersion} 到 ${n.newVersion}`);const i=s.result;if(!i.objectStoreNames.contains(STORE_NAME)){logger$1.info(`创建存储对象: ${STORE_NAME}`);const r=i.createObjectStore(STORE_NAME,{keyPath:"id"});logger$1.debug("创建数据库索引"),r.createIndex("url","url",{unique:!1}),r.createIndex("createdAt","createdAt",{unique:!1}),r.createIndex("updatedAt","updatedAt",{unique:!1}),r.createIndex("tags","tags",{unique:!1,multiEntry:!0}),logger$1.info("数据库结构初始化完成")}}}));class SavedPagesDB{async savePage(t){logger$1.debug("开始保存页面到数据库",{title:t.title,url:t.url,type:t.type,contentLength:t.content?.length,htmlLength:t.html?.length,hasScreenshot:!!t.screenshot});try{const s=await openDatabase();return new Promise((n,i)=>{const r=s.transaction([STORE_NAME],"readwrite"),d=r.objectStore(STORE_NAME);r.onerror=c=>{const T=r.error;logger$1.error("数据库事务错误",{errorName:T?.name,errorMessage:T?.message}),i(new Error(`数据库事务错误: ${T?.message||"未知错误"}`))};const f=Date.now(),m=generateID();logger$1.debug(`生成页面ID: ${m}`);const u={id:m,title:t.title,url:t.url,content:t.content,html:t.html,type:t.type,tags:t.tags||[],notes:t.notes||"",createdAt:f,updatedAt:f,favicon:t.favicon,screenshot:t.screenshot};logger$1.debug("准备添加页面到数据库",{id:u.id});const a=d.add(u);a.onsuccess=()=>{logger$1.info("页面成功保存到数据库",{id:u.id,title:u.title}),n(u)},a.onerror=()=>{const c=a.error;logger$1.error("保存页面失败",{errorName:c?.name,errorMessage:c?.message}),i(new Error(`保存页面失败: ${c?.message||"未知错误"}`))},r.oncomplete=()=>{logger$1.debug("数据库事务完成，关闭数据库连接"),s.close()}})}catch(s){throw logger$1.error("保存页面过程中发生错误",s),s}}async getAllPages(t){const s=await openDatabase();return new Promise((n,i)=>{const r=s.transaction([STORE_NAME],"readonly"),m=r.objectStore(STORE_NAME).index("updatedAt").openCursor(null,"prev"),u=[];m.onsuccess=a=>{const c=m.result;if(c){const T=c.value;let p=!0;if(t&&(t.tags&&t.tags.length>0&&(p=t.tags.some(h=>T.tags.includes(h))),p&&t.searchText)){const h=t.searchText.toLowerCase();p=T.title.toLowerCase().includes(h)||T.content.toLowerCase().includes(h)||T.notes.toLowerCase().includes(h)}p&&u.push(T),c.continue()}else if(t&&(t.offset!==void 0||t.limit!==void 0)){const T=t.offset||0,p=t.limit||u.length;n(u.slice(T,T+p))}else n(u)},m.onerror=()=>{i(new Error("获取页面失败"))},r.oncomplete=()=>{s.close()}})}async getPageById(t){const s=await openDatabase();return new Promise((n,i)=>{const r=s.transaction([STORE_NAME],"readonly"),f=r.objectStore(STORE_NAME).get(t);f.onsuccess=()=>{n(f.result||null)},f.onerror=()=>{i(new Error("获取页面失败"))},r.oncomplete=()=>{s.close()}})}async updatePage(t,s){const n=await openDatabase();return new Promise(async(i,r)=>{const d=n.transaction([STORE_NAME],"readwrite"),f=d.objectStore(STORE_NAME),m=f.get(t);m.onsuccess=()=>{if(!m.result){r(new Error("页面不存在"));return}const a={...m.result,...s,updatedAt:Date.now()},c=f.put(a);c.onsuccess=()=>{i(a)},c.onerror=()=>{r(new Error("更新页面失败"))}},m.onerror=()=>{r(new Error("获取页面失败"))},d.oncomplete=()=>{n.close()}})}async deletePage(t){const s=await openDatabase();return new Promise((n,i)=>{const r=s.transaction([STORE_NAME],"readwrite"),f=r.objectStore(STORE_NAME).delete(t);f.onsuccess=()=>{n()},f.onerror=()=>{i(new Error("删除页面失败"))},r.oncomplete=()=>{s.close()}})}async getAllTags(){const t=await this.getAllPages(),s=new Set;return t.forEach(n=>{n.tags.forEach(i=>s.add(i))}),Array.from(s)}}const savedPagesDB=new SavedPagesDB,saveCurrentPage=async e=>{logger$1.info("开始保存当前页面",e);try{logger$1.debug("正在获取页面内容");const t=await getDataFromCurrentTab().catch(h=>{throw logger$1.error("获取页面内容失败",h),new Error(`获取页面内容失败: ${h.message||"未知错误"}`)});if(!t)throw logger$1.error("获取页面内容返回空结果"),new Error("获取页面内容返回空结果");const{url:s,title:n,content:i,type:r,pdf:d,favicon:f}=t;logger$1.info("成功获取页面内容",{url:s,title:n,contentLength:i?.length,type:r}),logger$1.debug("正在获取页面截图");const m=await getScreenshotFromCurrentTab().catch(h=>(logger$1.error("获取页面截图失败",h),{success:!1,screenshot:void 0,error:h})),{success:u,screenshot:a,error:c}=m;u?logger$1.info("成功获取页面截图",{screenshotLength:a?.length}):logger$1.warn("获取页面截图失败，将继续保存页面",c);const T={title:n,url:s,content:i,html:r==="html"?i:"",type:r,tags:e?.tags||[],notes:e?.notes||"",favicon:f,screenshot:u?a:void 0};logger$1.debug("正在保存页面到数据库",{url:s,title:n});const p=await savedPagesDB.savePage(T).catch(h=>{throw logger$1.error("保存页面到数据库失败",h),new Error(`保存页面到数据库失败: ${h.message||"未知错误"}`)});return logger$1.info("页面保存成功",{id:p.id,title:p.title,url:p.url}),p}catch(t){throw logger$1.error("保存页面过程中发生错误",t),t instanceof Error?t:new Error(`保存页面失败: ${t}`)}},definition=defineBackground({main(){const e=new g({area:"local"});let t=!1,s="webui",n="sidePanel";const i=async()=>{try{e.watch({actionIconClick:m=>{const u=m?.oldValue||"webui",a=m?.newValue||"webui";u!==a&&(s=a)},contextMenuClick:m=>{const u=m?.oldValue||"sidePanel",a=m?.newValue||"sidePanel";u!==a&&(n=a,browser.contextMenus.remove(d[u]),browser.contextMenus.create({id:d[a],title:r[a],contexts:["page","selection"]}))}});const f=await getInitialConfig();n=f.contextMenuClick,s=f.actionIconClick,browser.contextMenus.create({id:d[n],title:r[n],contexts:["page","selection"]}),browser.contextMenus.create({id:"summarize-pa",title:browser.i18n.getMessage("contextSummarize"),contexts:["selection"]}),browser.contextMenus.create({id:"explain-pa",title:browser.i18n.getMessage("contextExplain"),contexts:["selection"]}),browser.contextMenus.create({id:"rephrase-pa",title:browser.i18n.getMessage("contextRephrase"),contexts:["selection"]}),browser.contextMenus.create({id:"translate-pg",title:browser.i18n.getMessage("contextTranslate"),contexts:["selection"]}),browser.contextMenus.create({id:"custom-pg",title:browser.i18n.getMessage("contextCustom"),contexts:["selection"]}),browser.contextMenus.create({id:"save-page-pa",title:"保存当前页面",contexts:["page"]})}catch(f){console.error("Error in initLogic:",f)}};browser.runtime.onMessage.addListener(async f=>{if(f.type==="sidepanel")await browser.sidebarAction.open();else if(f.type==="pull_model"){const m=await getOllamaURL();await isOllamaRunning()||(setBadgeText({text:"E"}),setBadgeBackgroundColor({color:"#FF0000"}),setTitle({title:"Ollama is not running"}),setTimeout(()=>{clearBadge()},5e3)),await streamDownload(m,f.modelName)}}),browser.runtime.onConnect.addListener(f=>{f.name==="pgCopilot"&&(t=!0,f.onDisconnect.addListener(()=>{t=!1}))}),browser.browserAction.onClicked.addListener(f=>{s==="webui"?browser.tabs.create({url:browser.runtime.getURL("/options.html")}):browser.sidebarAction.toggle()});const r={webui:browser.i18n.getMessage("openOptionToChat"),sidePanel:browser.i18n.getMessage("openSidePanelToChat")},d={webui:"open-web-ui-pa",sidePanel:"open-side-panel-pa"};browser.contextMenus.onClicked.addListener((f,m)=>{f.menuItemId==="open-side-panel-pa"?browser.sidebarAction.toggle():f.menuItemId==="open-web-ui-pa"?browser.tabs.create({url:browser.runtime.getURL("/options.html")}):f.menuItemId==="summarize-pa"?(t||browser.sidebarAction.toggle(),setTimeout(async()=>{await browser.runtime.sendMessage({from:"background",type:"summary",text:f.selectionText})},t?0:5e3)):f.menuItemId==="rephrase-pa"?(t||browser.sidebarAction.toggle(),setTimeout(async()=>{await browser.runtime.sendMessage({type:"rephrase",from:"background",text:f.selectionText})},t?0:5e3)):f.menuItemId==="translate-pg"?(t||browser.sidebarAction.toggle(),setTimeout(async()=>{await browser.runtime.sendMessage({type:"translate",from:"background",text:f.selectionText})},t?0:5e3)):f.menuItemId==="explain-pa"?(t||browser.sidebarAction.toggle(),setTimeout(async()=>{await browser.runtime.sendMessage({type:"explain",from:"background",text:f.selectionText})},t?0:5e3)):f.menuItemId==="custom-pg"?(t||browser.sidebarAction.toggle(),setTimeout(async()=>{await browser.runtime.sendMessage({type:"custom",from:"background",text:f.selectionText})},t?0:5e3)):f.menuItemId==="save-page-pa"&&saveCurrentPage().then(u=>{browser.notifications.create({type:"basic",iconUrl:browser.runtime.getURL("assets/icon-128.png"),title:"页面已保存",message:`已成功保存页面: ${u.title}`})}).catch(u=>{console.error("保存页面失败:",u),browser.notifications.create({type:"basic",iconUrl:browser.runtime.getURL("assets/icon-128.png"),title:"保存页面失败",message:"无法保存当前页面，请稍后重试。"})})}),browser.commands.onCommand.addListener(f=>{switch(f){case"execute_side_panel":browser.sidebarAction.toggle();break}}),i()},persistent:!0});function initPlugins(){}function print(e,...t){}const logger={debug:(...e)=>print(console.debug,...e),log:(...e)=>print(console.log,...e),warn:(...e)=>print(console.warn,...e),error:(...e)=>print(console.error,...e)};let result;try{result=definition.main(),result instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(e){throw logger.error("The background crashed on startup!"),e}const result$1=result;return result$1}();
_background;
