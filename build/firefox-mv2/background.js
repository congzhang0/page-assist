var background=function(){"use strict";function X(e){return e==null||typeof e=="function"?{main:e}:e}function Y(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var F={exports:{}},ee=F.exports,K;function te(){return K||(K=1,function(e,t){(function(s,l){l(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:ee,function(s){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)s.exports=globalThis.browser;else{const l="The message port closed before a response was received.",u=A=>{const c={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(c).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class r extends WeakMap{constructor(a,d=void 0){super(d),this.createItem=a}get(a){return this.has(a)||this.set(a,this.createItem(a)),super.get(a)}}const g=n=>n&&typeof n=="object"&&typeof n.then=="function",o=(n,a)=>(...d)=>{A.runtime.lastError?n.reject(new Error(A.runtime.lastError.message)):a.singleCallbackArg||d.length<=1&&a.singleCallbackArg!==!1?n.resolve(d[0]):n.resolve(d)},x=n=>n==1?"argument":"arguments",N=(n,a)=>function(h,...p){if(p.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${x(a.minArgs)} for ${n}(), got ${p.length}`);if(p.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${x(a.maxArgs)} for ${n}(), got ${p.length}`);return new Promise((w,b)=>{if(a.fallbackToNoCallback)try{h[n](...p,o({resolve:w,reject:b},a))}catch(m){console.warn(`${n} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,m),h[n](...p),a.fallbackToNoCallback=!1,a.noCallback=!0,w()}else a.noCallback?(h[n](...p),w()):h[n](...p,o({resolve:w,reject:b},a))})},U=(n,a,d)=>new Proxy(a,{apply(h,p,w){return d.call(p,n,...w)}});let T=Function.call.bind(Object.prototype.hasOwnProperty);const y=(n,a={},d={})=>{let h=Object.create(null),p={has(b,m){return m in n||m in h},get(b,m,C){if(m in h)return h[m];if(!(m in n))return;let f=n[m];if(typeof f=="function")if(typeof a[m]=="function")f=U(n,n[m],a[m]);else if(T(d,m)){let v=N(m,d[m]);f=U(n,n[m],v)}else f=f.bind(n);else if(typeof f=="object"&&f!==null&&(T(a,m)||T(d,m)))f=y(f,a[m],d[m]);else if(T(d,"*"))f=y(f,a[m],d["*"]);else return Object.defineProperty(h,m,{configurable:!0,enumerable:!0,get(){return n[m]},set(v){n[m]=v}}),f;return h[m]=f,f},set(b,m,C,f){return m in h?h[m]=C:n[m]=C,!0},defineProperty(b,m,C){return Reflect.defineProperty(h,m,C)},deleteProperty(b,m){return Reflect.deleteProperty(h,m)}},w=Object.create(n);return new Proxy(w,p)},$=n=>({addListener(a,d,...h){a.addListener(n.get(d),...h)},hasListener(a,d){return a.hasListener(n.get(d))},removeListener(a,d){a.removeListener(n.get(d))}}),be=new r(n=>typeof n!="function"?n:function(d){const h=y(d,{},{getContent:{minArgs:0,maxArgs:0}});n(h)}),Z=new r(n=>typeof n!="function"?n:function(d,h,p){let w=!1,b,m=new Promise(P=>{b=function(k){w=!0,P(k)}}),C;try{C=n(d,h,b)}catch(P){C=Promise.reject(P)}const f=C!==!0&&g(C);if(C!==!0&&!f&&!w)return!1;const v=P=>{P.then(k=>{p(k)},k=>{let j;k&&(k instanceof Error||typeof k.message=="string")?j=k.message:j="An unexpected error occurred",p({__mozWebExtensionPolyfillReject__:!0,message:j})}).catch(k=>{console.error("Failed to send onMessage rejected reply",k)})};return v(f?C:m),!0}),Ce=({reject:n,resolve:a},d)=>{A.runtime.lastError?A.runtime.lastError.message===l?a():n(new Error(A.runtime.lastError.message)):d&&d.__mozWebExtensionPolyfillReject__?n(new Error(d.message)):a(d)},Q=(n,a,d,...h)=>{if(h.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${x(a.minArgs)} for ${n}(), got ${h.length}`);if(h.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${x(a.maxArgs)} for ${n}(), got ${h.length}`);return new Promise((p,w)=>{const b=Ce.bind(null,{resolve:p,reject:w});h.push(b),d.sendMessage(...h)})},ke={devtools:{network:{onRequestFinished:$(be)}},runtime:{onMessage:$(Z),onMessageExternal:$(Z),sendMessage:Q.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:Q.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},B={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return c.privacy={network:{"*":B},services:{"*":B},websites:{"*":B}},y(A,ke,c)};s.exports=u(chrome)}})}(F)),F.exports}var se=te();const i=Y(se),E=({title:e})=>{i.browserAction.setTitle({title:e})},R=({color:e})=>{i.browserAction.setBadgeBackgroundColor({color:e})},S=({text:e})=>{i.browserAction.setBadgeText({text:e})},V=(e,t,s,l)=>function(...u){const A=t.promiseModule;return new A((c,r)=>{t.multiArgs?u.push((...o)=>{t.errorFirst?o[0]?r(o):(o.shift(),c(o)):c(o)}):t.errorFirst?u.push((o,x)=>{o?r(o):c(x)}):u.push(c),Reflect.apply(e,this===s?l:this,u)})},_=new WeakMap;function re(e,t){t={exclude:[/.+(?:Sync|Stream)$/],errorFirst:!0,promiseModule:Promise,...t};const s=typeof e;if(!(e!==null&&(s==="object"||s==="function")))throw new TypeError(`Expected \`input\` to be a \`Function\` or \`Object\`, got \`${e===null?"null":s}\``);const l=(c,r)=>{let g=_.get(c);if(g||(g={},_.set(c,g)),r in g)return g[r];const o=y=>typeof y=="string"||typeof r=="symbol"?r===y:y.test(r),x=Reflect.getOwnPropertyDescriptor(c,r),N=x===void 0||x.writable||x.configurable,T=(t.include?t.include.some(y=>o(y)):!t.exclude.some(y=>o(y)))&&N;return g[r]=T,T},u=new WeakMap,A=new Proxy(e,{apply(c,r,g){const o=u.get(c);if(o)return Reflect.apply(o,r,g);const x=t.excludeMain?c:V(c,t,A,c);return u.set(c,x),Reflect.apply(x,r,g)},get(c,r){const g=c[r];if(!l(c,r)||g===Function.prototype[r])return g;const o=u.get(g);if(o)return o;if(typeof g=="function"){const x=V(g,t,A,c);return u.set(g,x),x}return g}});return A}var ne=()=>{try{let e=(globalThis.navigator?.userAgent).match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(e[1]==="Chrome")return parseInt(e[2])<100||globalThis.chrome.runtime?.getManifest()?.manifest_version===2}catch{return!1}return!1},ae=class{#r;#t;get primaryClient(){return this.#t}#e;get secondaryClient(){return this.#e}#n;get area(){return this.#n}get hasWebApi(){try{return typeof window<"u"&&!!window.localStorage}catch(e){return console.error(e),!1}}#s=new Map;#a;get copiedKeySet(){return this.#a}isCopied=e=>this.hasWebApi&&(this.allCopied||this.copiedKeySet.has(e));#i=!1;get allCopied(){return this.#i}getExtStorageApi=()=>globalThis.browser?.storage||globalThis.chrome?.storage;get hasExtensionApi(){try{return!!this.getExtStorageApi()}catch(e){return console.error(e),!1}}isWatchSupported=()=>this.hasExtensionApi;keyNamespace="";isValidKey=e=>e.startsWith(this.keyNamespace);getNamespacedKey=e=>`${this.keyNamespace}${e}`;getUnnamespacedKey=e=>e.slice(this.keyNamespace.length);serde={serializer:JSON.stringify,deserializer:JSON.parse};constructor({area:e="sync",allCopied:t=!1,copiedKeyList:s=[],serde:l={}}={}){this.setCopiedKeySet(s),this.#n=e,this.#i=t,this.serde={...this.serde,...l};try{this.hasWebApi&&(t||s.length>0)&&(this.#e=window.localStorage)}catch{}try{this.hasExtensionApi&&(this.#r=this.getExtStorageApi(),ne()?this.#t=re(this.#r[this.area],{exclude:["getBytesInUse"],errorFirst:!1}):this.#t=this.#r[this.area])}catch{}}setCopiedKeySet(e){this.#a=new Set(e)}rawGetAll=()=>this.#t?.get();getAll=async()=>{let e=await this.rawGetAll();return Object.entries(e).filter(([t])=>this.isValidKey(t)).reduce((t,[s,l])=>(t[this.getUnnamespacedKey(s)]=l,t),{})};copy=async e=>{let t=e===void 0;if(!t&&!this.copiedKeySet.has(e)||!this.allCopied||!this.hasExtensionApi)return!1;let s=this.allCopied?await this.rawGetAll():await this.#t.get((t?[...this.copiedKeySet]:[e]).map(this.getNamespacedKey));if(!s)return!1;let l=!1;for(let u in s){let A=s[u],c=this.#e?.getItem(u);this.#e?.setItem(u,A),l||=A!==c}return l};rawGet=async e=>(await this.rawGetMany([e]))[e];rawGetMany=async e=>this.hasExtensionApi?await this.#t.get(e):e.filter(this.isCopied).reduce((t,s)=>(t[s]=this.#e?.getItem(s),t),{});rawSet=async(e,t)=>await this.rawSetMany({[e]:t});rawSetMany=async e=>(this.#e&&Object.entries(e).filter(([t])=>this.isCopied(t)).forEach(([t,s])=>this.#e.setItem(t,s)),this.hasExtensionApi&&await this.#t.set(e),null);clear=async(e=!1)=>{e&&this.#e?.clear(),await this.#t.clear()};rawRemove=async e=>{await this.rawRemoveMany([e])};rawRemoveMany=async e=>{this.#e&&e.filter(this.isCopied).forEach(t=>this.#e.removeItem(t)),this.hasExtensionApi&&await this.#t.remove(e)};removeAll=async()=>{let e=await this.getAll(),t=Object.keys(e);await this.removeMany(t)};watch=e=>{let t=this.isWatchSupported();return t&&this.#o(e),t};#o=e=>{for(let t in e){let s=this.getNamespacedKey(t),l=this.#s.get(s)?.callbackSet||new Set;if(l.add(e[t]),l.size>1)continue;let u=(A,c)=>{if(c!==this.area||!A[s])return;let r=this.#s.get(s);if(!r)throw new Error(`Storage comms does not exist for nsKey: ${s}`);Promise.all([this.parseValue(A[s].newValue),this.parseValue(A[s].oldValue)]).then(([g,o])=>{for(let x of r.callbackSet)x({newValue:g,oldValue:o},c)})};this.#r.onChanged.addListener(u),this.#s.set(s,{callbackSet:l,listener:u})}};unwatch=e=>{let t=this.isWatchSupported();return t&&this.#l(e),t};#l(e){for(let t in e){let s=this.getNamespacedKey(t),l=e[t],u=this.#s.get(s);u&&(u.callbackSet.delete(l),u.callbackSet.size===0&&(this.#s.delete(s),this.#r.onChanged.removeListener(u.listener)))}}unwatchAll=()=>this.#c();#c(){this.#s.forEach(({listener:e})=>this.#r.onChanged.removeListener(e)),this.#s.clear()}async getItem(e){return this.get(e)}async getItems(e){return await this.getMany(e)}async setItem(e,t){await this.set(e,t)}async setItems(e){await await this.setMany(e)}async removeItem(e){return this.remove(e)}async removeItems(e){return await this.removeMany(e)}},M=class extends ae{get=async e=>{let t=this.getNamespacedKey(e),s=await this.rawGet(t);return this.parseValue(s)};getMany=async e=>{let t=e.map(this.getNamespacedKey),s=await this.rawGetMany(t),l=await Promise.all(Object.values(s).map(this.parseValue));return Object.keys(s).reduce((u,A,c)=>(u[this.getUnnamespacedKey(A)]=l[c],u),{})};set=async(e,t)=>{let s=this.getNamespacedKey(e),l=this.serde.serializer(t);return this.rawSet(s,l)};setMany=async e=>{let t=Object.entries(e).reduce((s,[l,u])=>(s[this.getNamespacedKey(l)]=this.serde.serializer(u),s),{});return await this.rawSetMany(t)};remove=async e=>{let t=this.getNamespacedKey(e);return this.rawRemove(t)};removeMany=async e=>{let t=e.map(this.getNamespacedKey);return await this.rawRemoveMany(t)};setNamespace=e=>{this.keyNamespace=e};parseValue=async e=>{try{if(e!==void 0)return this.serde.deserializer(e)}catch(t){console.error(t)}}};const W=e=>e.endsWith("/")?e.slice(0,-1):e,O=new M,ie=new M({area:"local"}),oe="http://127.0.0.1:11434",le=async()=>await O.get("urlRewriteEnabled")??!1,ce=async()=>{try{return await ie.get("autoCORSFix")??!0}catch{return!0}},ge=async()=>{const e=await O.get("rewriteUrl");return!e||e.trim()===""?oe:e},me=async()=>{const[e,t,s]=await Promise.all([le(),ge(),ce()]);return{isEnableRewriteUrl:e,rewriteUrl:t,autoCORSFix:s}},ue=async()=>{const e=await O.get("customOllamaHeaders");return e||[]},Ae=async()=>{const e=await ue(),t={};for(const s of e)t[s.key]=s.value;return t},q=async function(e,t="ollama"){if(i.runtime&&i.runtime.id){const{isEnableRewriteUrl:s,rewriteUrl:l,autoCORSFix:u}=await me();if(!u){try{i.webRequest.onBeforeSendHeaders.removeListener(()=>{})}catch{}return}{const A=new URL(e),c=[`*://${A.hostname}/*`];i.webRequest.onBeforeSendHeaders.addListener(r=>{let g=`${A.protocol}//${A.hostname}`;s&&l&&t==="ollama"&&(g=l);for(let o=0;o<r.requestHeaders.length;o++)r.requestHeaders[o].name==="Origin"&&(r.requestHeaders[o].value=g);return{requestHeaders:r.requestHeaders}},{urls:c},["blocking","requestHeaders"])}}};new M;const H=async(e,t)=>{const s={...t},l=await Ae();return s.headers={...l,...s?.headers},fetch(e,s)},de=new M;new M({area:"local"});const z="http://127.0.0.1:11434",D=async()=>{const e=await de.get("ollamaURL");return!e||e.length===0?(await q(z),z):(await q(W(e)),e)},he=async()=>{try{const e=await D(),t=await H(`${W(e)}`);if(!t.ok)throw new Error(t.statusText);return!0}catch(e){return console.error(e),!1}},xe=(e,t)=>(e/t*100).toFixed(0)+"%",G=()=>{S({text:""}),E({title:""})},fe=async(e,t)=>{e+="/api/pull";const l=(await H(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:t,stream:!0})})).body?.getReader(),u=new TextDecoder;let A=!0;for(;l;){const{done:c,value:r}=await l.read();if(c)break;const g=u.decode(r);try{const o=JSON.parse(g.trim());o.total&&o.completed?(S({text:xe(o.completed,o.total)}),R({color:"#0000FF"})):(S({text:"🏋️‍♂️"}),R({color:"#FFFFFF"})),E({title:o.status}),o.status==="success"&&(A=!0)}catch(o){console.error(o)}}A?(S({text:"✅"}),R({color:"#00FF00"}),E({title:"Model pulled successfully"})):(S({text:"❌"}),R({color:"#FF0000"}),E({title:"Model pull failed"})),setTimeout(()=>{G()},5e3)},J=new M({area:"local"}),pe=async()=>{const e=await J.get("actionIconClick"),t=await J.get("contextMenuClick");return{actionIconClick:e||"webui",contextMenuClick:t||"sidePanel"}},we=X({main(){const e=new M({area:"local"});let t=!1,s="webui",l="sidePanel";const u=async()=>{try{e.watch({actionIconClick:g=>{const o=g?.oldValue||"webui",x=g?.newValue||"webui";o!==x&&(s=x)},contextMenuClick:g=>{const o=g?.oldValue||"sidePanel",x=g?.newValue||"sidePanel";o!==x&&(l=x,i.contextMenus.remove(c[o]),i.contextMenus.create({id:c[x],title:A[x],contexts:["page","selection"]}))}});const r=await pe();l=r.contextMenuClick,s=r.actionIconClick,i.contextMenus.create({id:c[l],title:A[l],contexts:["page","selection"]}),i.contextMenus.create({id:"summarize-pa",title:i.i18n.getMessage("contextSummarize"),contexts:["selection"]}),i.contextMenus.create({id:"explain-pa",title:i.i18n.getMessage("contextExplain"),contexts:["selection"]}),i.contextMenus.create({id:"rephrase-pa",title:i.i18n.getMessage("contextRephrase"),contexts:["selection"]}),i.contextMenus.create({id:"translate-pg",title:i.i18n.getMessage("contextTranslate"),contexts:["selection"]}),i.contextMenus.create({id:"custom-pg",title:i.i18n.getMessage("contextCustom"),contexts:["selection"]})}catch(r){console.error("Error in initLogic:",r)}};i.runtime.onMessage.addListener(async r=>{if(r.type==="sidepanel")await i.sidebarAction.open();else if(r.type==="pull_model"){const g=await D();await he()||(S({text:"E"}),R({color:"#FF0000"}),E({title:"Ollama is not running"}),setTimeout(()=>{G()},5e3)),await fe(g,r.modelName)}}),i.runtime.onConnect.addListener(r=>{r.name==="pgCopilot"&&(t=!0,r.onDisconnect.addListener(()=>{t=!1}))}),i.browserAction.onClicked.addListener(r=>{s==="webui"?i.tabs.create({url:i.runtime.getURL("/options.html")}):i.sidebarAction.toggle()});const A={webui:i.i18n.getMessage("openOptionToChat"),sidePanel:i.i18n.getMessage("openSidePanelToChat")},c={webui:"open-web-ui-pa",sidePanel:"open-side-panel-pa"};i.contextMenus.onClicked.addListener((r,g)=>{r.menuItemId==="open-side-panel-pa"?i.sidebarAction.toggle():r.menuItemId==="open-web-ui-pa"?i.tabs.create({url:i.runtime.getURL("/options.html")}):r.menuItemId==="summarize-pa"?(t||i.sidebarAction.toggle(),setTimeout(async()=>{await i.runtime.sendMessage({from:"background",type:"summary",text:r.selectionText})},t?0:5e3)):r.menuItemId==="rephrase-pa"?(t||i.sidebarAction.toggle(),setTimeout(async()=>{await i.runtime.sendMessage({type:"rephrase",from:"background",text:r.selectionText})},t?0:5e3)):r.menuItemId==="translate-pg"?(t||i.sidebarAction.toggle(),setTimeout(async()=>{await i.runtime.sendMessage({type:"translate",from:"background",text:r.selectionText})},t?0:5e3)):r.menuItemId==="explain-pa"?(t||i.sidebarAction.toggle(),setTimeout(async()=>{await i.runtime.sendMessage({type:"explain",from:"background",text:r.selectionText})},t?0:5e3)):r.menuItemId==="custom-pg"&&(t||i.sidebarAction.toggle(),setTimeout(async()=>{await i.runtime.sendMessage({type:"custom",from:"background",text:r.selectionText})},t?0:5e3))}),i.commands.onCommand.addListener(r=>{switch(r){case"execute_side_panel":i.sidebarAction.toggle();break}}),u()},persistent:!0});function Te(){}function I(e,...t){}const ye={debug:(...e)=>I(console.debug,...e),log:(...e)=>I(console.log,...e),warn:(...e)=>I(console.warn,...e),error:(...e)=>I(console.error,...e)};let L;try{L=we.main(),L instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(e){throw ye.error("The background crashed on startup!"),e}return L}();
background;
