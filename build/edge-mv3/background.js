var _background=function(){"use strict";function Q(e){return e==null||typeof e=="function"?{main:e}:e}var X=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Y(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var _={exports:{}};(function(e,t){(function(n,c){c(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:X,function(n){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)n.exports=globalThis.browser;else{const c="The message port closed before a response was received.",A=d=>{const g={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(g).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class s extends WeakMap{constructor(a,m=void 0){super(m),this.createItem=a}get(a){return this.has(a)||this.set(a,this.createItem(a)),super.get(a)}}const i=r=>r&&typeof r=="object"&&typeof r.then=="function",o=(r,a)=>(...m)=>{d.runtime.lastError?r.reject(new Error(d.runtime.lastError.message)):a.singleCallbackArg||m.length<=1&&a.singleCallbackArg!==!1?r.resolve(m[0]):r.resolve(m)},x=r=>r==1?"argument":"arguments",N=(r,a)=>function(h,...f){if(f.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${x(a.minArgs)} for ${r}(), got ${f.length}`);if(f.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${x(a.maxArgs)} for ${r}(), got ${f.length}`);return new Promise((w,y)=>{if(a.fallbackToNoCallback)try{h[r](...f,o({resolve:w,reject:y},a))}catch(l){console.warn(`${r} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,l),h[r](...f),a.fallbackToNoCallback=!1,a.noCallback=!0,w()}else a.noCallback?(h[r](...f),w()):h[r](...f,o({resolve:w,reject:y},a))})},O=(r,a,m)=>new Proxy(a,{apply(h,f,w){return m.call(f,r,...w)}});let M=Function.call.bind(Object.prototype.hasOwnProperty);const b=(r,a={},m={})=>{let h=Object.create(null),f={has(y,l){return l in r||l in h},get(y,l,C){if(l in h)return h[l];if(!(l in r))return;let p=r[l];if(typeof p=="function")if(typeof a[l]=="function")p=O(r,r[l],a[l]);else if(M(m,l)){let R=N(l,m[l]);p=O(r,r[l],R)}else p=p.bind(r);else if(typeof p=="object"&&p!==null&&(M(a,l)||M(m,l)))p=b(p,a[l],m[l]);else if(M(m,"*"))p=b(p,a[l],m["*"]);else return Object.defineProperty(h,l,{configurable:!0,enumerable:!0,get(){return r[l]},set(R){r[l]=R}}),p;return h[l]=p,p},set(y,l,C,p){return l in h?h[l]=C:r[l]=C,!0},defineProperty(y,l,C){return Reflect.defineProperty(h,l,C)},deleteProperty(y,l){return Reflect.deleteProperty(h,l)}},w=Object.create(r);return new Proxy(w,f)},U=r=>({addListener(a,m,...h){a.addListener(r.get(m),...h)},hasListener(a,m){return a.hasListener(r.get(m))},removeListener(a,m){a.removeListener(r.get(m))}}),we=new s(r=>typeof r!="function"?r:function(m){const h=b(m,{},{getContent:{minArgs:0,maxArgs:0}});r(h)}),J=new s(r=>typeof r!="function"?r:function(m,h,f){let w=!1,y,l=new Promise(P=>{y=function(k){w=!0,P(k)}}),C;try{C=r(m,h,y)}catch(P){C=Promise.reject(P)}const p=C!==!0&&i(C);if(C!==!0&&!p&&!w)return!1;const R=P=>{P.then(k=>{f(k)},k=>{let B;k&&(k instanceof Error||typeof k.message=="string")?B=k.message:B="An unexpected error occurred",f({__mozWebExtensionPolyfillReject__:!0,message:B})}).catch(k=>{console.error("Failed to send onMessage rejected reply",k)})};return R(p?C:l),!0}),be=({reject:r,resolve:a},m)=>{d.runtime.lastError?d.runtime.lastError.message===c?a():r(new Error(d.runtime.lastError.message)):m&&m.__mozWebExtensionPolyfillReject__?r(new Error(m.message)):a(m)},Z=(r,a,m,...h)=>{if(h.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${x(a.minArgs)} for ${r}(), got ${h.length}`);if(h.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${x(a.maxArgs)} for ${r}(), got ${h.length}`);return new Promise((f,w)=>{const y=be.bind(null,{resolve:f,reject:w});h.push(y),m.sendMessage(...h)})},ye={devtools:{network:{onRequestFinished:U(we)}},runtime:{onMessage:U(J),onMessageExternal:U(J),sendMessage:Z.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:Z.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},$={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return g.privacy={network:{"*":$},services:{"*":$},websites:{"*":$}},b(d,ye,g)};n.exports=A(chrome)}})})(_);var ee=_.exports;const u=Y(ee),v=({title:e})=>{chrome.action.setTitle({title:e})},E=({color:e})=>{chrome.action.setBadgeBackgroundColor({color:e})},S=({text:e})=>{chrome.action.setBadgeText({text:e})},V=(e,t,n,c)=>function(...A){const d=t.promiseModule;return new d((g,s)=>{t.multiArgs?A.push((...o)=>{t.errorFirst?o[0]?s(o):(o.shift(),g(o)):g(o)}):t.errorFirst?A.push((o,x)=>{o?s(o):g(x)}):A.push(g),Reflect.apply(e,this===n?c:this,A)})},W=new WeakMap;function te(e,t){t={exclude:[/.+(?:Sync|Stream)$/],errorFirst:!0,promiseModule:Promise,...t};const n=typeof e;if(!(e!==null&&(n==="object"||n==="function")))throw new TypeError(`Expected \`input\` to be a \`Function\` or \`Object\`, got \`${e===null?"null":n}\``);const c=(g,s)=>{let i=W.get(g);if(i||(i={},W.set(g,i)),s in i)return i[s];const o=b=>typeof b=="string"||typeof s=="symbol"?s===b:b.test(s),x=Reflect.getOwnPropertyDescriptor(g,s),N=x===void 0||x.writable||x.configurable,M=(t.include?t.include.some(b=>o(b)):!t.exclude.some(b=>o(b)))&&N;return i[s]=M,M},A=new WeakMap,d=new Proxy(e,{apply(g,s,i){const o=A.get(g);if(o)return Reflect.apply(o,s,i);const x=t.excludeMain?g:V(g,t,d,g);return A.set(g,x),Reflect.apply(x,s,i)},get(g,s){const i=g[s];if(!c(g,s)||i===Function.prototype[s])return i;const o=A.get(i);if(o)return o;if(typeof i=="function"){const x=V(i,t,d,g);return A.set(i,x),x}return i}});return d}var se=()=>{try{let e=(globalThis.navigator?.userAgent).match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(e[1]==="Chrome")return parseInt(e[2])<100||globalThis.chrome.runtime?.getManifest()?.manifest_version===2}catch{return!1}return!1},re=class{#r;#e;get primaryClient(){return this.#e}#t;get secondaryClient(){return this.#t}#n;get area(){return this.#n}get hasWebApi(){try{return typeof window<"u"&&!!window.localStorage}catch(e){return console.error(e),!1}}#s=new Map;#a;get copiedKeySet(){return this.#a}isCopied=e=>this.hasWebApi&&(this.allCopied||this.copiedKeySet.has(e));#i=!1;get allCopied(){return this.#i}getExtStorageApi=()=>globalThis.browser?.storage||globalThis.chrome?.storage;get hasExtensionApi(){try{return!!this.getExtStorageApi()}catch(e){return console.error(e),!1}}isWatchSupported=()=>this.hasExtensionApi;keyNamespace="";isValidKey=e=>e.startsWith(this.keyNamespace);getNamespacedKey=e=>`${this.keyNamespace}${e}`;getUnnamespacedKey=e=>e.slice(this.keyNamespace.length);constructor({area:e="sync",allCopied:t=!1,copiedKeyList:n=[]}={}){this.setCopiedKeySet(n),this.#n=e,this.#i=t;try{this.hasWebApi&&(t||n.length>0)&&(this.#t=window.localStorage)}catch{}try{this.hasExtensionApi&&(this.#r=this.getExtStorageApi(),se()?this.#e=te(this.#r[this.area],{exclude:["getBytesInUse"],errorFirst:!1}):this.#e=this.#r[this.area])}catch{}}setCopiedKeySet(e){this.#a=new Set(e)}rawGetAll=()=>this.#e?.get();getAll=async()=>{let e=await this.rawGetAll();return Object.entries(e).filter(([t])=>this.isValidKey(t)).reduce((t,[n,c])=>(t[this.getUnnamespacedKey(n)]=c,t),{})};copy=async e=>{let t=e===void 0;if(!t&&!this.copiedKeySet.has(e)||!this.allCopied||!this.hasExtensionApi)return!1;let n=this.allCopied?await this.rawGetAll():await this.#e.get((t?[...this.copiedKeySet]:[e]).map(this.getNamespacedKey));if(!n)return!1;let c=!1;for(let A in n){let d=n[A],g=this.#t?.getItem(A);this.#t?.setItem(A,d),c||=d!==g}return c};rawGet=async e=>this.hasExtensionApi?(await this.#e.get(e))[e]:this.isCopied(e)?this.#t?.getItem(e):null;rawSet=async(e,t)=>(this.isCopied(e)&&this.#t?.setItem(e,t),this.hasExtensionApi&&await this.#e.set({[e]:t}),null);clear=async(e=!1)=>{e&&this.#t?.clear(),await this.#e.clear()};rawRemove=async e=>{this.isCopied(e)&&this.#t?.removeItem(e),this.hasExtensionApi&&await this.#e.remove(e)};removeAll=async()=>{let e=await this.rawGetAll(),t=Object.keys(e);await Promise.all(t.map(this.rawRemove))};watch=e=>{let t=this.isWatchSupported();return t&&this.#o(e),t};#o=e=>{for(let t in e){let n=this.getNamespacedKey(t),c=this.#s.get(n)?.callbackSet||new Set;if(c.add(e[t]),c.size>1)continue;let A=(d,g)=>{if(g!==this.area||!d[n])return;let s=this.#s.get(n);if(!s)throw new Error(`Storage comms does not exist for nsKey: ${n}`);Promise.all([this.parseValue(d[n].newValue),this.parseValue(d[n].oldValue)]).then(([i,o])=>{for(let x of s.callbackSet)x({newValue:i,oldValue:o},g)})};this.#r.onChanged.addListener(A),this.#s.set(n,{callbackSet:c,listener:A})}};unwatch=e=>{let t=this.isWatchSupported();return t&&this.#l(e),t};#l(e){for(let t in e){let n=this.getNamespacedKey(t),c=e[t],A=this.#s.get(n);A&&(A.callbackSet.delete(c),A.callbackSet.size===0&&(this.#s.delete(n),this.#r.onChanged.removeListener(A.listener)))}}unwatchAll=()=>this.#c();#c(){this.#s.forEach(({listener:e})=>this.#r.onChanged.removeListener(e)),this.#s.clear()}async getItem(e){return this.get(e)}async setItem(e,t){await this.set(e,t)}async removeItem(e){return this.remove(e)}},T=class extends re{get=async e=>{let t=this.getNamespacedKey(e),n=await this.rawGet(t);return this.parseValue(n)};set=async(e,t)=>{let n=this.getNamespacedKey(e),c=JSON.stringify(t);return this.rawSet(n,c)};remove=async e=>{let t=this.getNamespacedKey(e);return this.rawRemove(t)};setNamespace=e=>{this.keyNamespace=e};parseValue=async e=>{try{if(e!==void 0)return JSON.parse(e)}catch(t){console.error(t)}}};const j=e=>e.endsWith("/")?e.slice(0,-1):e,F=new T,ne=new T({area:"local"}),ae="http://127.0.0.1:11434",ie=async()=>await F.get("urlRewriteEnabled")??!1,oe=async()=>{try{return await ne.get("autoCORSFix")??!0}catch{return!0}},le=async()=>{const e=await F.get("rewriteUrl");return!e||e.trim()===""?ae:e},ce=async()=>{const[e,t,n]=await Promise.all([ie(),le(),oe()]);return{isEnableRewriteUrl:e,rewriteUrl:t,autoCORSFix:n}},ge=async()=>{const e=await F.get("customOllamaHeaders");return e||[]},me=async()=>{const e=await ge(),t={};for(const n of e)t[n.key]=n.value;return t},K=async function(e,t="ollama"){if(u.runtime&&u.runtime.id){const{isEnableRewriteUrl:n,rewriteUrl:c,autoCORSFix:A}=await ce();if(!A){try{await u.declarativeNetRequest.updateDynamicRules({removeRuleIds:[1],addRules:[]})}catch{}return}{const d=new URL(e),g=[d.hostname];let s=`${d.protocol}//${d.hostname}`;n&&c&&t==="ollama"&&(s=c);const i=[{id:1,priority:1,condition:{requestDomains:g},action:{type:"modifyHeaders",requestHeaders:[{header:"Origin",operation:"set",value:s}]}}];await u.declarativeNetRequest.updateDynamicRules({removeRuleIds:i.map(o=>o.id),addRules:i})}}};new T;const D=async(e,t)=>{const n={...t},c=await me();return n.headers={...c,...n?.headers},fetch(e,n)},ue=new T;new T({area:"local"});const q="http://127.0.0.1:11434",z=async()=>{const e=await ue.get("ollamaURL");return!e||e.length===0?(await K(q),q):(await K(j(e)),e)},Ae=async()=>{try{const e=await z(),t=await D(`${j(e)}`);if(!t.ok)throw new Error(t.statusText);return!0}catch(e){return console.error(e),!1}},de=(e,t)=>(e/t*100).toFixed(0)+"%",G=()=>{S({text:""}),v({title:""})},he=async(e,t)=>{e+="/api/pull";const c=(await D(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:t,stream:!0})})).body?.getReader(),A=new TextDecoder;let d=!0;for(;c;){const{done:g,value:s}=await c.read();if(g)break;const i=A.decode(s);try{const o=JSON.parse(i.trim());o.total&&o.completed?(S({text:de(o.completed,o.total)}),E({color:"#0000FF"})):(S({text:"ðŸ‹ï¸â€â™‚ï¸"}),E({color:"#FFFFFF"})),v({title:o.status}),o.status==="success"&&(d=!0)}catch(o){console.error(o)}}d?(S({text:"âœ…"}),E({color:"#00FF00"}),v({title:"Model pulled successfully"})):(S({text:"âŒ"}),E({color:"#FF0000"}),v({title:"Model pull failed"})),setTimeout(()=>{G()},5e3)},H=new T({area:"local"}),xe=async()=>{const e=await H.get("actionIconClick"),t=await H.get("contextMenuClick");return{actionIconClick:e||"webui",contextMenuClick:t||"sidePanel"}},pe=Q({main(){const e=new T({area:"local"});let t=!1,n="webui",c="sidePanel";const A={webui:"open-web-ui-pa",sidePanel:"open-side-panel-pa"},d=async()=>{try{e.watch({actionIconClick:i=>{const o=i?.oldValue||"webui",x=i?.newValue||"webui";o!==x&&(n=x)},contextMenuClick:i=>{const o=i?.oldValue||"sidePanel",x=i?.newValue||"sidePanel";o!==x&&(c=x,u.contextMenus.remove(A[o]),u.contextMenus.create({id:A[x],title:g[x],contexts:["page","selection"]}))}});const s=await xe();c=s.contextMenuClick,n=s.actionIconClick,u.contextMenus.create({id:A[c],title:g[c],contexts:["page","selection"]}),u.contextMenus.create({id:"summarize-pa",title:u.i18n.getMessage("contextSummarize"),contexts:["selection"]}),u.contextMenus.create({id:"explain-pa",title:u.i18n.getMessage("contextExplain"),contexts:["selection"]}),u.contextMenus.create({id:"rephrase-pa",title:u.i18n.getMessage("contextRephrase"),contexts:["selection"]}),u.contextMenus.create({id:"translate-pg",title:u.i18n.getMessage("contextTranslate"),contexts:["selection"]}),u.contextMenus.create({id:"custom-pg",title:u.i18n.getMessage("contextCustom"),contexts:["selection"]})}catch(s){console.error("Error in initLogic:",s)}};u.runtime.onMessage.addListener(async s=>{if(s.type==="sidepanel")await u.sidebarAction.open();else if(s.type==="pull_model"){const i=await z();await Ae()||(S({text:"E"}),E({color:"#FF0000"}),v({title:"Ollama is not running"}),setTimeout(()=>{G()},5e3)),await he(i,s.modelName)}}),u.runtime.onConnect.addListener(s=>{s.name==="pgCopilot"&&(t=!0,s.onDisconnect.addListener(()=>{t=!1}))}),chrome.action.onClicked.addListener(s=>{n==="webui"?chrome.tabs.create({url:chrome.runtime.getURL("/options.html")}):chrome.sidePanel.open({tabId:s.id})});const g={webui:u.i18n.getMessage("openOptionToChat"),sidePanel:u.i18n.getMessage("openSidePanelToChat")};u.contextMenus.onClicked.addListener(async(s,i)=>{s.menuItemId==="open-side-panel-pa"?chrome.sidePanel.open({tabId:i.id}):s.menuItemId==="open-web-ui-pa"?u.tabs.create({url:u.runtime.getURL("/options.html")}):s.menuItemId==="summarize-pa"?(chrome.sidePanel.open({tabId:i.id}),setTimeout(async()=>{await u.runtime.sendMessage({from:"background",type:"summary",text:s.selectionText})},t?0:5e3)):s.menuItemId==="rephrase-pa"?(chrome.sidePanel.open({tabId:i.id}),setTimeout(async()=>{await u.runtime.sendMessage({type:"rephrase",from:"background",text:s.selectionText})},t?0:5e3)):s.menuItemId==="translate-pg"?(chrome.sidePanel.open({tabId:i.id}),setTimeout(async()=>{await u.runtime.sendMessage({type:"translate",from:"background",text:s.selectionText})},t?0:5e3)):s.menuItemId==="explain-pa"?(chrome.sidePanel.open({tabId:i.id}),setTimeout(async()=>{await u.runtime.sendMessage({type:"explain",from:"background",text:s.selectionText})},t?0:5e3)):s.menuItemId==="custom-pg"&&(chrome.sidePanel.open({tabId:i.id}),setTimeout(async()=>{await u.runtime.sendMessage({type:"custom",from:"background",text:s.selectionText})},t?0:5e3))}),u.commands.onCommand.addListener(s=>{switch(s){case"execute_side_panel":chrome.tabs.query({active:!0,currentWindow:!0},async i=>{const o=i[0];chrome.sidePanel.open({tabId:o.id})});break}}),d()},persistent:!0});function ke(){}function I(e,...t){}const fe={debug:(...e)=>I(console.debug,...e),log:(...e)=>I(console.log,...e),warn:(...e)=>I(console.warn,...e),error:(...e)=>I(console.error,...e)};let L;try{L=pe.main(),L instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(e){throw fe.error("The background crashed on startup!"),e}return L}();
_background;
